VERSION 5.00
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "Comdlg32.ocx"
Object = "{C932BA88-4374-101B-A56C-00AA003668DC}#1.1#0"; "MSMASK32.ocx"
Object = "{3B7C8863-D78F-101B-B9B5-04021C009402}#1.2#0"; "richtx32.ocx"
Object = "{BDC217C8-ED16-11CD-956C-0000C04E4C0A}#1.1#0"; "tabctl32.ocx"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.ocx"
Object = "{935C9182-411B-4FFB-9512-97C8745743BC}#2.5#0"; "AResize.ocx"
Object = "{4F446E73-0578-46E4-81BC-6A88ADF59FEA}#2.3#0"; "DrawSuite2022.ocx"
Object = "{50D37AD9-8D3C-43DD-ADD5-7C957C951843}#1.9#0"; "FlexCell.ocx"
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.2#0"; "MSCOMCTL.OCX"
Begin VB.Form frmprod 
   BackColor       =   &H00E0E0E0&
   Caption         =   "PCP - Gerenciamento de ordem"
   ClientHeight    =   10005
   ClientLeft      =   480
   ClientTop       =   450
   ClientWidth     =   15480
   ClipControls    =   0   'False
   ControlBox      =   0   'False
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmprod.frx":0000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   ScaleHeight     =   10005
   ScaleWidth      =   15480
   WindowState     =   2  'Maximized
   Begin ActiveResizeCtl.ActiveResize ActiveResize1 
      Left            =   1290
      Top             =   0
      _ExtentX        =   847
      _ExtentY        =   847
      Resolution      =   26
      ScreenHeight    =   1080
      ScreenWidth     =   1920
      ScreenHeightDT  =   1080
      ScreenWidthDT   =   1920
      AutoResizeOnLoad=   0   'False
      ApplicationName =   "Active Resize Control Professional"
      FormHeightDT    =   10470
      FormWidthDT     =   15600
      FormScaleHeightDT=   10005
      FormScaleWidthDT=   15480
      ResizeFormBackground=   -1  'True
      ResizePictureBoxContents=   -1  'True
   End
   Begin VB.ComboBox txtreferencia 
      Appearance      =   0  'Flat
      BackColor       =   &H00FFFFFF&
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   330
      Left            =   2760
      TabIndex        =   44
      ToolTipText     =   "Código de referência."
      Top             =   5040
      Visible         =   0   'False
      Width           =   2115
   End
   Begin VB.ComboBox cmbOSMaquina 
      BackColor       =   &H00FFFFFF&
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00000000&
      Height          =   330
      Left            =   6690
      Sorted          =   -1  'True
      Style           =   2  'Dropdown List
      TabIndex        =   83
      ToolTipText     =   "Posto de trabalho."
      Top             =   2490
      Visible         =   0   'False
      Width           =   1875
   End
   Begin TabDlg.SSTab SSTab1 
      Height          =   10005
      Left            =   0
      TabIndex        =   160
      Top             =   0
      Width           =   15495
      _ExtentX        =   27331
      _ExtentY        =   17648
      _Version        =   393216
      Tabs            =   6
      Tab             =   2
      TabsPerRow      =   6
      TabHeight       =   520
      BackColor       =   14737632
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      TabCaption(0)   =   "Carteira de produção"
      TabPicture(0)   =   "frmprod.frx":000C
      Tab(0).ControlEnabled=   0   'False
      Tab(0).Control(0)=   "Frame1(2)"
      Tab(0).Control(1)=   "USToolBar1"
      Tab(0).Control(2)=   "ImageList1"
      Tab(0).Control(3)=   "Frame1(3)"
      Tab(0).Control(4)=   "Frame_estoque"
      Tab(0).Control(5)=   "listaitens"
      Tab(0).ControlCount=   6
      TabCaption(1)   =   "Gerenciar ordem"
      TabPicture(1)   =   "frmprod.frx":0028
      Tab(1).ControlEnabled=   0   'False
      Tab(1).Control(0)=   "SSTab2"
      Tab(1).Control(1)=   "Frame9"
      Tab(1).Control(2)=   "USToolBar2"
      Tab(1).Control(3)=   "Lista"
      Tab(1).ControlCount=   4
      TabCaption(2)   =   "Gerenciar OS"
      TabPicture(2)   =   "frmprod.frx":0044
      Tab(2).ControlEnabled=   -1  'True
      Tab(2).Control(0)=   "Framedetalhes"
      Tab(2).Control(0).Enabled=   0   'False
      Tab(2).Control(1)=   "USToolBar3"
      Tab(2).Control(1).Enabled=   0   'False
      Tab(2).Control(2)=   "ListaOS_maq"
      Tab(2).Control(2).Enabled=   0   'False
      Tab(2).Control(3)=   "ListaOS"
      Tab(2).Control(3).Enabled=   0   'False
      Tab(2).Control(4)=   "Frame24"
      Tab(2).Control(4).Enabled=   0   'False
      Tab(2).Control(5)=   "USImageList3"
      Tab(2).Control(5).Enabled=   0   'False
      Tab(2).Control(6)=   "Frame14"
      Tab(2).Control(6).Enabled=   0   'False
      Tab(2).ControlCount=   7
      TabCaption(3)   =   "Lista de requisições"
      TabPicture(3)   =   "frmprod.frx":0060
      Tab(3).ControlEnabled=   0   'False
      Tab(3).Control(0)=   "USImageList4"
      Tab(3).Control(1)=   "Frame23"
      Tab(3).Control(2)=   "USToolBar4"
      Tab(3).Control(3)=   "Frame25"
      Tab(3).Control(4)=   "Frame26"
      Tab(3).ControlCount=   5
      TabCaption(4)   =   "Gerenciar coleta"
      TabPicture(4)   =   "frmprod.frx":007C
      Tab(4).ControlEnabled=   0   'False
      Tab(4).Control(0)=   "APLista"
      Tab(4).Control(1)=   "Frame7"
      Tab(4).Control(2)=   "Frame18"
      Tab(4).Control(3)=   "Frame20"
      Tab(4).Control(4)=   "Frame21"
      Tab(4).Control(5)=   "Chk_reaproveitamento_tempo_prep"
      Tab(4).Control(6)=   "Frame19"
      Tab(4).Control(7)=   "Chk_apont_simultaneo"
      Tab(4).Control(8)=   "Frame16"
      Tab(4).Control(9)=   "Frame5"
      Tab(4).Control(10)=   "Txt_ID_apontamento"
      Tab(4).Control(10).Enabled=   0   'False
      Tab(4).Control(11)=   "Frame15"
      Tab(4).Control(12)=   "Frame6"
      Tab(4).Control(13)=   "Frame4"
      Tab(4).ControlCount=   14
      TabCaption(5)   =   "Resultados ordem"
      TabPicture(5)   =   "frmprod.frx":0098
      Tab(5).ControlEnabled=   0   'False
      Tab(5).Control(0)=   "Frame8"
      Tab(5).Control(1)=   "USImageList5"
      Tab(5).Control(2)=   "ListaRE"
      Tab(5).Control(3)=   "USToolBar5"
      Tab(5).ControlCount=   4
      Begin MSComctlLib.ListView listaitens 
         Height          =   7200
         Left            =   -74910
         TabIndex        =   357
         Top             =   1350
         Width           =   15315
         _ExtentX        =   27014
         _ExtentY        =   12700
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   -1  'True
         AllowReorder    =   -1  'True
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         SmallIcons      =   "ImageList1"
         ForeColor       =   0
         BackColor       =   16777215
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   27
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "N"
            Object.Width           =   529
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   1
            Object.Tag             =   "N"
            Text            =   "Cotacao"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Object.Tag             =   "T"
            Text            =   "Empresa"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   3
            Object.Tag             =   "T"
            Text            =   "Cód. int."
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   4
            Object.Tag             =   "N"
            Text            =   "Rev."
            Object.Width           =   882
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   5
            Object.Tag             =   "T"
            Text            =   "Referência"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   6
            Object.Tag             =   "T"
            Text            =   "Descrição"
            Object.Width           =   9173
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   7
            Object.Tag             =   "N"
            Text            =   "Vendido"
            Object.Width           =   1587
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   8
            Object.Tag             =   "N"
            Text            =   "Qt. faturada"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   9
            Object.Tag             =   "N"
            Text            =   "Qt. faturar"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   10
            Object.Tag             =   "N"
            Text            =   "Emp. est."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(12) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   11
            Object.Tag             =   "N"
            Text            =   "Emp. prod."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(13) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   12
            Object.Tag             =   "N"
            Text            =   "Á produzir"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(14) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   13
            Object.Tag             =   "D"
            Text            =   "Prazo"
            Object.Width           =   1499
         EndProperty
         BeginProperty ColumnHeader(15) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   14
            Object.Tag             =   "T"
            Text            =   "Processo?"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(16) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   15
            Object.Tag             =   "T"
            Text            =   "Plano?"
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(17) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   16
            Object.Tag             =   "T"
            Text            =   "Estrutura?"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(18) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   17
            Text            =   "MRP"
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(19) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   18
            Object.Tag             =   "T"
            Text            =   "Versão proc."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(20) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   19
            Object.Tag             =   "N"
            Text            =   "Dt. venda"
            Object.Width           =   1499
         EndProperty
         BeginProperty ColumnHeader(21) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   20
            Object.Tag             =   "N"
            Text            =   "Ped. int./SPR"
            Object.Width           =   1940
         EndProperty
         BeginProperty ColumnHeader(22) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   21
            Object.Tag             =   "N"
            Text            =   "Rev."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(23) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   22
            Object.Tag             =   "T"
            Text            =   "Cliente"
            Object.Width           =   4939
         EndProperty
         BeginProperty ColumnHeader(24) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   23
            Object.Tag             =   "T"
            Text            =   "Ped. cliente"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(25) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   24
            Object.Tag             =   "N"
            Text            =   "Qt. expda."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(26) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   25
            Object.Tag             =   "N"
            Text            =   "Qt. expedir"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(27) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   26
            Object.Tag             =   "T"
            Text            =   "Observação"
            Object.Width           =   5292
         EndProperty
      End
      Begin VB.Frame Frame4 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Dados da ordem de serviço"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   915
         Left            =   -74940
         TabIndex        =   343
         Top             =   3780
         Width           =   3315
         Begin VB.ComboBox cmbAPOS 
            Height          =   315
            Left            =   180
            Style           =   2  'Dropdown List
            TabIndex        =   345
            ToolTipText     =   "Número da ordem de serviço."
            Top             =   450
            Width           =   915
         End
         Begin VB.ComboBox txtAPMaquina 
            Height          =   315
            Left            =   1110
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   347
            ToolTipText     =   "Posto de trabalho."
            Top             =   450
            Width           =   1725
         End
         Begin VB.CommandButton cmdAPOS 
            Appearance      =   0  'Flat
            BackColor       =   &H00C0C0C0&
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   2850
            Picture         =   "frmprod.frx":00B4
            Style           =   1  'Graphical
            TabIndex        =   344
            ToolTipText     =   "Filtrar apontamento pelo número da ordem de serviço e a máquina."
            Top             =   450
            Width           =   315
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Nº OS"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   20
            Left            =   405
            TabIndex        =   348
            Top             =   240
            Width           =   435
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Posto de trabalho"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   83
            Left            =   1380
            TabIndex        =   346
            Top             =   240
            Width           =   1275
         End
      End
      Begin VB.Frame Frame6 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Menu de comandos"
         Height          =   885
         Left            =   -74925
         TabIndex        =   177
         Top             =   330
         Width           =   10995
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   0
            Left            =   90
            TabIndex        =   328
            Top             =   270
            Width           =   855
            _ExtentX        =   1508
            _ExtentY        =   873
            Caption         =   "Novo (F2)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   1
            Left            =   990
            TabIndex        =   329
            Top             =   270
            Width           =   975
            _ExtentX        =   1720
            _ExtentY        =   873
            Caption         =   "Gravar (F3)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   2
            Left            =   2010
            TabIndex        =   330
            Top             =   270
            Width           =   975
            _ExtentX        =   1720
            _ExtentY        =   873
            Caption         =   "Excluir (F4 )"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   3
            Left            =   3030
            TabIndex        =   331
            Top             =   270
            Width           =   1035
            _ExtentX        =   1826
            _ExtentY        =   873
            Caption         =   "Imprimir (F5)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   4
            Left            =   4110
            TabIndex        =   332
            Top             =   270
            Width           =   1215
            _ExtentX        =   2143
            _ExtentY        =   873
            Caption         =   "Recalcular (F7)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   5
            Left            =   5370
            TabIndex        =   333
            Top             =   270
            Width           =   1335
            _ExtentX        =   2355
            _ExtentY        =   873
            Caption         =   "Abrir postos (F8)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   6
            Left            =   6750
            TabIndex        =   334
            Top             =   270
            Width           =   1305
            _ExtentX        =   2302
            _ExtentY        =   873
            Caption         =   "Desvincular (F9)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   7
            Left            =   8100
            TabIndex        =   335
            Top             =   270
            Width           =   1215
            _ExtentX        =   2143
            _ExtentY        =   873
            Caption         =   "Listar 20 (F11)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btn 
            Height          =   495
            Index           =   8
            Left            =   9360
            TabIndex        =   336
            Top             =   270
            Width           =   1515
            _ExtentX        =   2672
            _ExtentY        =   873
            Caption         =   "Listar todos (F12)"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            Theme           =   4
         End
         Begin VB.Label Label1 
            Alignment       =   2  'Center
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "F8 - ABRIR POSTOS UTIL. / F9 - DESVINCULAR O.S / F11 - LISTAR TODOS EVENTOS / F12 - LISTAR OS 7 ULTIMOS"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   165
            Index           =   119
            Left            =   930
            TabIndex        =   179
            Top             =   1320
            Width           =   7920
         End
         Begin VB.Label Label1 
            Alignment       =   2  'Center
            AutoSize        =   -1  'True
            BackColor       =   &H00E0E0E0&
            BackStyle       =   0  'Transparent
            Caption         =   "F2 - NOVO / F3 - GRAVAR / F4  - EXCLUIR / F5 - VISUALIZAR IMPRESSÃO / F7 - RECALCULAR"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   165
            Index           =   120
            Left            =   1665
            TabIndex        =   178
            Top             =   1290
            Width           =   6405
         End
      End
      Begin VB.Frame Frame15 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Dados para apontamento"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   915
         Left            =   -71625
         TabIndex        =   163
         Top             =   3780
         Width           =   12045
         Begin VB.ComboBox cmbdescricao 
            BackColor       =   &H00FFFFFF&
            Height          =   315
            Left            =   3090
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   338
            ToolTipText     =   "Descrição do código de trabalho."
            Top             =   450
            Width           =   4815
         End
         Begin VB.ComboBox cmbOperador 
            Height          =   315
            Left            =   120
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   337
            ToolTipText     =   "Operador."
            Top             =   450
            Width           =   2955
         End
         Begin VB.TextBox txtTOK 
            Alignment       =   2  'Center
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   9
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   330
            Left            =   10140
            Locked          =   -1  'True
            TabIndex        =   341
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade conforme."
            Top             =   450
            Width           =   900
         End
         Begin VB.TextBox txtTNC 
            Alignment       =   2  'Center
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   9
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   330
            Left            =   11055
            Locked          =   -1  'True
            TabIndex        =   342
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade não conforme."
            Top             =   450
            Width           =   840
         End
         Begin VB.TextBox txtCodigo 
            Alignment       =   2  'Center
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   330
            Left            =   6420
            Locked          =   -1  'True
            TabIndex        =   327
            TabStop         =   0   'False
            Top             =   450
            Width           =   585
         End
         Begin MSComCtl2.DTPicker mskdata 
            Height          =   315
            Left            =   7920
            TabIndex        =   339
            ToolTipText     =   "Data do inicio do evento."
            Top             =   450
            Width           =   1185
            _ExtentX        =   2090
            _ExtentY        =   556
            _Version        =   393216
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            CalendarBackColor=   16777215
            CalendarForeColor=   0
            CalendarTitleBackColor=   8421504
            CalendarTitleForeColor=   16777215
            CalendarTrailingForeColor=   255
            Format          =   138543107
            CurrentDate     =   39057
         End
         Begin MSComCtl2.DTPicker txtinicioap 
            Height          =   315
            Left            =   9120
            TabIndex        =   340
            ToolTipText     =   "Hora do inicio do evento."
            Top             =   450
            Width           =   1005
            _ExtentX        =   1773
            _ExtentY        =   556
            _Version        =   393216
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Format          =   138543106
            CurrentDate     =   39055
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Operador"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   85
            Left            =   1245
            TabIndex        =   326
            Top             =   240
            Width           =   690
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Não conf."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   97
            Left            =   11100
            TabIndex        =   301
            Top             =   240
            Width           =   765
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Aprovado"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00800000&
            Height          =   195
            Index           =   96
            Left            =   10185
            TabIndex        =   300
            Top             =   240
            Width           =   825
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Hora"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   95
            Left            =   9465
            TabIndex        =   299
            Top             =   240
            Width           =   345
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Descrição do evento"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   94
            Left            =   4755
            TabIndex        =   298
            Top             =   240
            Width           =   1470
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Data"
            ForeColor       =   &H00000080&
            Height          =   195
            Index           =   24
            Left            =   8250
            TabIndex        =   186
            Top             =   240
            Width           =   345
         End
      End
      Begin MSComctlLib.ListView Lista 
         Height          =   3795
         Left            =   -74925
         TabIndex        =   51
         Top             =   5520
         Width           =   15315
         _ExtentX        =   27014
         _ExtentY        =   6694
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   0   'False
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   0
         BackColor       =   16777215
         Appearance      =   1
         MousePointer    =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MouseIcon       =   "frmprod.frx":04CF
         NumItems        =   11
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "N"
            Object.Width           =   529
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   1
            Object.Tag             =   "N"
            Text            =   "N° ordem"
            Object.Width           =   1941
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   2
            Object.Tag             =   "T"
            Text            =   "Empresa"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   3
            Object.Tag             =   "D"
            Text            =   "Prazo final"
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   4
            Object.Tag             =   "T"
            Text            =   "Cód. interno"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   5
            Object.Tag             =   "T"
            Text            =   "Cód. de ref."
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   6
            Object.Tag             =   "T"
            Text            =   "Descrição"
            Object.Width           =   10276
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   7
            Object.Tag             =   "D"
            Text            =   "Dt. concl."
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   8
            Object.Tag             =   "T"
            Text            =   "Validado"
            Object.Width           =   1499
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   9
            Object.Tag             =   "T"
            Text            =   "Result. validado"
            Object.Width           =   2469
         EndProperty
         BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   10
            Object.Tag             =   "T"
            Text            =   "Impressa"
            Object.Width           =   1499
         EndProperty
      End
      Begin DrawSuite2022.USToolBar USToolBar2 
         Height          =   1005
         Left            =   -74910
         TabIndex        =   194
         Top             =   330
         Width           =   15315
         _ExtentX        =   27014
         _ExtentY        =   1773
         ButtonCount     =   14
         GradientColor2  =   14737632
         GradientColorOverRight1=   16315633
         GradientColorOverRight2=   15195350
         GripperColor    =   15195350
         IsStrech        =   -1  'True
         RightColor1     =   0
         RightColor2     =   0
         ShowEndPanel    =   0   'False
         Theme           =   1
         ButtonCaption1  =   "Novo"
         ButtonEnabled1  =   0   'False
         ButtonIconSize1 =   32
         ButtonToolTipText1=   "Novo (Insert)"
         ButtonKey1      =   "1"
         ButtonAlignment1=   2
         BeginProperty ButtonFont1 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft1     =   2
         ButtonTop1      =   2
         ButtonWidth1    =   36
         ButtonHeight1   =   21
         ButtonUseMaskColor1=   0   'False
         ButtonCaption2  =   "Filtrar"
         ButtonEnabled2  =   0   'False
         ButtonIconSize2 =   32
         ButtonToolTipText2=   "Filtrar (F2)"
         ButtonKey2      =   "2"
         ButtonAlignment2=   2
         BeginProperty ButtonFont2 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft2     =   40
         ButtonTop2      =   2
         ButtonWidth2    =   42
         ButtonHeight2   =   21
         ButtonUseMaskColor2=   0   'False
         ButtonCaption3  =   "Salvar"
         ButtonEnabled3  =   0   'False
         ButtonIconSize3 =   32
         ButtonToolTipText3=   "Salvar (F3)"
         ButtonKey3      =   "3"
         ButtonAlignment3=   2
         BeginProperty ButtonFont3 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft3     =   84
         ButtonTop3      =   2
         ButtonWidth3    =   44
         ButtonHeight3   =   21
         ButtonUseMaskColor3=   0   'False
         ButtonCaption4  =   "Excluir"
         ButtonEnabled4  =   0   'False
         ButtonIconSize4 =   32
         ButtonToolTipText4=   "Excluir (F4)"
         ButtonKey4      =   "4"
         ButtonAlignment4=   2
         BeginProperty ButtonFont4 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft4     =   130
         ButtonTop4      =   2
         ButtonWidth4    =   45
         ButtonHeight4   =   21
         ButtonUseMaskColor4=   0   'False
         ButtonCaption5  =   "Relatório"
         ButtonEnabled5  =   0   'False
         ButtonIconSize5 =   32
         ButtonToolTipText5=   "Relatório (F5)"
         ButtonKey5      =   "5"
         ButtonAlignment5=   2
         BeginProperty ButtonFont5 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft5     =   177
         ButtonTop5      =   2
         ButtonWidth5    =   60
         ButtonHeight5   =   21
         ButtonUseMaskColor5=   0   'False
         ButtonCaption6  =   "Anterior"
         ButtonEnabled6  =   0   'False
         ButtonIconSize6 =   32
         ButtonToolTipText6=   "Registro anterior."
         ButtonKey6      =   "6"
         ButtonAlignment6=   2
         BeginProperty ButtonFont6 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft6     =   239
         ButtonTop6      =   2
         ButtonWidth6    =   55
         ButtonHeight6   =   21
         ButtonUseMaskColor6=   0   'False
         ButtonCaption7  =   "Próximo"
         ButtonEnabled7  =   0   'False
         ButtonIconSize7 =   32
         ButtonToolTipText7=   "Próximo registro."
         ButtonKey7      =   "7"
         ButtonAlignment7=   2
         BeginProperty ButtonFont7 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft7     =   296
         ButtonTop7      =   2
         ButtonWidth7    =   55
         ButtonHeight7   =   21
         ButtonUseMaskColor7=   0   'False
         ButtonCaption8  =   "Status"
         ButtonEnabled8  =   0   'False
         ButtonIconSize8 =   32
         ButtonToolTipText8=   "Marcar/desmarcar ordem como concluída (F8)"
         ButtonKey8      =   "8"
         ButtonAlignment8=   2
         BeginProperty ButtonFont8 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft8     =   353
         ButtonTop8      =   2
         ButtonWidth8    =   45
         ButtonHeight8   =   21
         ButtonUseMaskColor8=   0   'False
         ButtonCaption9  =   "Validação"
         ButtonEnabled9  =   0   'False
         ButtonIconSize9 =   32
         ButtonToolTipText9=   "Validar/Cancelar validação."
         ButtonKey9      =   "9"
         ButtonAlignment9=   2
         BeginProperty ButtonFont9 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft9     =   400
         ButtonTop9      =   2
         ButtonWidth9    =   53
         ButtonHeight9   =   21
         ButtonUseMaskColor9=   0   'False
         ButtonCaption10 =   "Rastreabilidade"
         ButtonEnabled10 =   0   'False
         ButtonIconSize10=   32
         ButtonToolTipText10=   "Rastrabilidade dos numeros de serie do lote"
         ButtonKey10     =   "10"
         ButtonAlignment10=   2
         BeginProperty ButtonFont10 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft10    =   455
         ButtonTop10     =   2
         ButtonWidth10   =   82
         ButtonHeight10  =   21
         ButtonUseMaskColor10=   0   'False
         ButtonCaption11 =   "Atualizar"
         ButtonEnabled11 =   0   'False
         ButtonIconSize11=   32
         ButtonToolTipText11=   "Utilizado pelo administrador do sistema."
         ButtonKey11     =   "11"
         ButtonAlignment11=   2
         BeginProperty ButtonFont11 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft11    =   539
         ButtonTop11     =   2
         ButtonWidth11   =   59
         ButtonHeight11  =   21
         ButtonUseMaskColor11=   0   'False
         ButtonEnabled12 =   0   'False
         ButtonIconSize12=   32
         ButtonAlignment12=   2
         ButtonType12    =   1
         ButtonStyle12   =   -1
         BeginProperty ButtonFont12 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState12   =   -1
         ButtonLeft12    =   600
         ButtonTop12     =   4
         ButtonWidth12   =   2
         ButtonHeight12  =   56
         ButtonCaption13 =   "Ajuda"
         ButtonEnabled13 =   0   'False
         ButtonIconSize13=   32
         ButtonToolTipText13=   "Ajuda (F1)"
         ButtonKey13     =   "13"
         ButtonAlignment13=   2
         BeginProperty ButtonFont13 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft13    =   604
         ButtonTop13     =   2
         ButtonWidth13   =   41
         ButtonHeight13  =   21
         ButtonUseMaskColor13=   0   'False
         ButtonCaption14 =   "Sair"
         ButtonEnabled14 =   0   'False
         ButtonIconSize14=   32
         ButtonToolTipText14=   "Sair (Esc)"
         ButtonKey14     =   "14"
         ButtonAlignment14=   2
         BeginProperty ButtonFont14 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft14    =   647
         ButtonTop14     =   2
         ButtonWidth14   =   30
         ButtonHeight14  =   21
         ButtonUseMaskColor14=   0   'False
         Begin DrawSuite2022.USImageList USImageList2 
            Left            =   10860
            Top             =   240
            _ExtentX        =   900
            _ExtentY        =   767
            Img1            =   "frmprod.frx":07E9
            Count           =   1
         End
      End
      Begin VB.Frame Frame_estoque 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "Arial"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   855
         Left            =   -74925
         TabIndex        =   169
         Top             =   8580
         Width           =   15315
         Begin VB.ComboBox cmbVersao 
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   330
            ItemData        =   "frmprod.frx":927D
            Left            =   14220
            List            =   "frmprod.frx":92CF
            Style           =   2  'Dropdown List
            TabIndex        =   319
            ToolTipText     =   "Versão."
            Top             =   360
            Width           =   795
         End
         Begin VB.CommandButton Cmd_visualizar_arquivo1 
            Appearance      =   0  'Flat
            BackColor       =   &H00C0C0C0&
            Height          =   315
            Left            =   1560
            Picture         =   "frmprod.frx":9321
            Style           =   1  'Graphical
            TabIndex        =   9
            ToolTipText     =   "Visualizar arquivo."
            Top             =   390
            Width           =   315
         End
         Begin VB.TextBox Txt_qtde_total_disp 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   12270
            Locked          =   -1  'True
            TabIndex        =   20
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade total disponível."
            Top             =   390
            Width           =   1515
         End
         Begin VB.TextBox Txt_qtde_disp_prod 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   10770
            Locked          =   -1  'True
            TabIndex        =   19
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade disponível produzindo."
            Top             =   390
            Width           =   1485
         End
         Begin VB.TextBox Txt_qtde_emp_est 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   9060
            Locked          =   -1  'True
            TabIndex        =   17
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade total empenhada."
            Top             =   390
            Width           =   1365
         End
         Begin VB.TextBox Txt_qtde_prod 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   7680
            Locked          =   -1  'True
            TabIndex        =   16
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade total produzindo."
            Top             =   390
            Width           =   1365
         End
         Begin VB.CommandButton Cmd_empenhado_prod 
            Appearance      =   0  'Flat
            BackColor       =   &H00C0C0C0&
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   10440
            Picture         =   "frmprod.frx":98E3
            Style           =   1  'Graphical
            TabIndex        =   18
            ToolTipText     =   "Abrir lista de empenhos da produção."
            Top             =   390
            Width           =   315
         End
         Begin VB.CommandButton Cmd_empenhado 
            Appearance      =   0  'Flat
            BackColor       =   &H00C0C0C0&
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   5910
            Picture         =   "frmprod.frx":99E5
            Style           =   1  'Graphical
            TabIndex        =   14
            ToolTipText     =   "Abrir lista de empenhos do estoque."
            Top             =   390
            Width           =   315
         End
         Begin VB.TextBox TxtEstCodigo 
            Alignment       =   2  'Center
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   180
            Locked          =   -1  'True
            TabIndex        =   8
            TabStop         =   0   'False
            ToolTipText     =   "Código interno."
            Top             =   390
            Width           =   1365
         End
         Begin VB.TextBox TxtEstUN 
            Alignment       =   2  'Center
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   1980
            Locked          =   -1  'True
            TabIndex        =   10
            TabStop         =   0   'False
            ToolTipText     =   "Unidade."
            Top             =   390
            Width           =   435
         End
         Begin VB.TextBox TxtEstEmpenhado 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   4710
            Locked          =   -1  'True
            TabIndex        =   13
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade total empenhada."
            Top             =   390
            Width           =   1185
         End
         Begin VB.TextBox TxtEstdisponivel 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   6330
            Locked          =   -1  'True
            TabIndex        =   15
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade disponível em estoque."
            Top             =   390
            Width           =   1245
         End
         Begin DrawSuite2022.USButton Cmd_buscarest 
            Height          =   315
            Left            =   2415
            TabIndex        =   11
            ToolTipText     =   "Buscar dados do estoque."
            Top             =   390
            Width           =   990
            _ExtentX        =   1746
            _ExtentY        =   556
            Caption         =   "Buscar est."
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            HandPointer     =   0   'False
            PicAlign        =   8
            PicSize         =   4
            PicSizeH        =   48
            PicSizeW        =   48
         End
         Begin VB.TextBox TxtEstTotal 
            Alignment       =   1  'Right Justify
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   3510
            Locked          =   -1  'True
            TabIndex        =   12
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade total em estoque."
            Top             =   390
            Width           =   1185
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "- Qtde. empen."
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   42
            Left            =   9187
            TabIndex        =   248
            Top             =   180
            Width           =   1110
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "- Qtde. empen."
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   41
            Left            =   4747
            TabIndex        =   247
            Top             =   180
            Width           =   1110
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Qtde. estoque"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   40
            Left            =   3577
            TabIndex        =   246
            Top             =   180
            Width           =   1050
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Un."
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   39
            Left            =   2070
            TabIndex        =   245
            Top             =   180
            Width           =   255
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Total disp."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   5
            Left            =   12570
            TabIndex        =   222
            Top             =   180
            Width           =   1110
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "= Qtde. disp."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   4
            Left            =   10830
            TabIndex        =   221
            Top             =   180
            Width           =   1275
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Qtde. produzindo"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   3
            Left            =   7732
            TabIndex        =   220
            Top             =   180
            Width           =   1260
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Código interno"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   0
            Left            =   337
            TabIndex        =   171
            Top             =   180
            Width           =   1050
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "= Qtde. disp."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   2
            Left            =   6420
            TabIndex        =   170
            Top             =   180
            Width           =   1065
         End
      End
      Begin VB.Frame Frame1 
         BackColor       =   &H00E0E0E0&
         BorderStyle     =   0  'None
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   7245
         Index           =   3
         Left            =   -74925
         TabIndex        =   244
         Top             =   1320
         Visible         =   0   'False
         Width           =   15285
         Begin FlexCell.Grid Grid1 
            Height          =   7230
            Left            =   0
            TabIndex        =   320
            Top             =   0
            Width           =   15345
            _ExtentX        =   27067
            _ExtentY        =   12753
            Cols            =   2
            DefaultFontSize =   8.25
            GridColor       =   12632256
            ReadOnly        =   -1  'True
            Rows            =   2
         End
      End
      Begin VB.Frame Frame8 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   2265
         Left            =   -74925
         TabIndex        =   228
         Top             =   1320
         Width           =   15315
         Begin VB.TextBox Txt_valor_nc 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   10620
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   140
            TabStop         =   0   'False
            ToolTipText     =   "Valor do refugo."
            Top             =   390
            Width           =   960
         End
         Begin VB.TextBox txtquantNC 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   9615
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   139
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade refugada."
            Top             =   390
            Width           =   960
         End
         Begin VB.TextBox txtquantprev 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   5685
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   137
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade prevista."
            Top             =   390
            Width           =   960
         End
         Begin VB.TextBox txtdataconclusao 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   4680
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   136
            TabStop         =   0   'False
            ToolTipText     =   "Data de conclusão."
            Top             =   390
            Width           =   960
         End
         Begin VB.TextBox txtquantreal 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   6690
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   138
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade produzida."
            Top             =   390
            Width           =   900
         End
         Begin VB.TextBox txtAprovado 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   7650
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   324
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade produzida."
            Top             =   390
            Width           =   870
         End
         Begin VB.TextBox txtQTCD 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   8580
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   322
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade produzida."
            Top             =   390
            Width           =   990
         End
         Begin VB.TextBox Txt_qtde_entrada 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   11625
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   141
            TabStop         =   0   'False
            ToolTipText     =   "Quantidade de entrada no estoque."
            Top             =   390
            Width           =   930
         End
         Begin VB.TextBox txtDtValidacao_custo 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            Enabled         =   0   'False
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   150
            Locked          =   -1  'True
            TabIndex        =   134
            TabStop         =   0   'False
            ToolTipText     =   "Data e hora da validação."
            Top             =   390
            Width           =   1575
         End
         Begin VB.TextBox txtRespValidacao_custo 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   1740
            Locked          =   -1  'True
            TabIndex        =   135
            TabStop         =   0   'False
            ToolTipText     =   "Responsável pela validação."
            Top             =   390
            Width           =   2895
         End
         Begin VB.Frame Frame11 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Tempos da ordem"
            ForeColor       =   &H00000080&
            Height          =   1485
            Left            =   150
            TabIndex        =   232
            Top             =   750
            Width           =   3735
            Begin VB.TextBox txtpecaprev 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   180
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   145
               TabStop         =   0   'False
               ToolTipText     =   "Tempo previsto por peça."
               Top             =   480
               Width           =   1680
            End
            Begin VB.TextBox txtpecautil 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   1875
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   146
               TabStop         =   0   'False
               ToolTipText     =   "Tempo real por peça."
               Top             =   480
               Width           =   1680
            End
            Begin VB.TextBox txttempoutilizado 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   1875
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   148
               TabStop         =   0   'False
               ToolTipText     =   "Tempo real do lote."
               Top             =   1050
               Width           =   1680
            End
            Begin VB.TextBox txttempoprevisto 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   180
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   147
               TabStop         =   0   'False
               ToolTipText     =   "Tempo previsto do lote."
               Top             =   1050
               Width           =   1680
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Real do lote"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   108
               Left            =   2288
               TabIndex        =   310
               Top             =   840
               Width           =   855
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Real unitário"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   107
               Left            =   2265
               TabIndex        =   309
               Top             =   270
               Width           =   900
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Previsto do lote"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   29
               Left            =   458
               TabIndex        =   238
               Top             =   840
               Width           =   1125
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Previsto unitário"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   28
               Left            =   435
               TabIndex        =   233
               Top             =   270
               Width           =   1170
            End
         End
         Begin VB.Frame Frame10 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Custos da ordem"
            ForeColor       =   &H00000080&
            Height          =   1485
            Left            =   3900
            TabIndex        =   230
            Top             =   750
            Width           =   8850
            Begin VB.TextBox Txt_vlr_unit_estoque 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   7440
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   158
               TabStop         =   0   'False
               ToolTipText     =   "Valor unitário do estoque."
               Top             =   1050
               Width           =   1260
            End
            Begin VB.TextBox Txt_custo_outras 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   3000
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   155
               TabStop         =   0   'False
               ToolTipText     =   "Custo de outras despesas."
               Top             =   1050
               Width           =   1230
            End
            Begin VB.TextBox Txt_custo_total_peca 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   5865
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   157
               TabStop         =   0   'False
               ToolTipText     =   "Custo total por peça."
               Top             =   1050
               Width           =   1170
            End
            Begin VB.TextBox Txt_custo_total 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   4620
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   156
               TabStop         =   0   'False
               ToolTipText     =   "Custo total."
               Top             =   1050
               Width           =   1140
            End
            Begin VB.TextBox Txt_custo_terceiros 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   1905
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   154
               TabStop         =   0   'False
               ToolTipText     =   "Custo de terceiros."
               Top             =   1050
               Width           =   1080
            End
            Begin VB.TextBox Txt_custo_material 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   510
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   153
               TabStop         =   0   'False
               ToolTipText     =   "Custo de material."
               Top             =   1050
               Width           =   1020
            End
            Begin VB.TextBox cpecareal 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   2445
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   150
               TabStop         =   0   'False
               ToolTipText     =   "Custo da mão de obra real por peça."
               Top             =   480
               Width           =   1920
            End
            Begin VB.TextBox cpecaprev 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   510
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   149
               TabStop         =   0   'False
               ToolTipText     =   "Custo da mão de obra prevista por peça."
               Top             =   480
               Width           =   1920
            End
            Begin VB.TextBox txtcustoefet 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   6315
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   152
               TabStop         =   0   'False
               ToolTipText     =   "Custo da mão de obra real do lote."
               Top             =   480
               Width           =   2385
            End
            Begin VB.TextBox txtcustoprev 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   4380
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   151
               TabStop         =   0   'False
               ToolTipText     =   "Custo da mão de obra prevista do lote."
               Top             =   480
               Width           =   1920
            End
            Begin DrawSuite2022.USButton cmdMateriais 
               Height          =   315
               Left            =   1560
               TabIndex        =   352
               ToolTipText     =   "Materiais empregados"
               Top             =   1050
               Width           =   315
               _ExtentX        =   556
               _ExtentY        =   556
               DibPicture      =   "frmprod.frx":9AE7
               Caption         =   ""
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               BorderColor     =   8421504
               BorderColorDown =   15048022
               BorderColorOver =   15381630
               PicAlign        =   8
               ShowFocusRect   =   0   'False
            End
            Begin DrawSuite2022.USButton Cmd_custo_outras 
               Height          =   315
               Left            =   4260
               TabIndex        =   353
               ToolTipText     =   "Outras despesas"
               Top             =   1050
               Width           =   315
               _ExtentX        =   556
               _ExtentY        =   556
               DibPicture      =   "frmprod.frx":27BEC
               Caption         =   ""
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               BorderColor     =   8421504
               BorderColorDown =   15048022
               BorderColorOver =   15381630
               PicAlign        =   8
               ShowFocusRect   =   0   'False
            End
            Begin DrawSuite2022.USButton btnvlrEstoque 
               Height          =   315
               Left            =   7050
               TabIndex        =   367
               ToolTipText     =   "Atualizar valor unitario estoque."
               Top             =   1050
               Width           =   315
               _ExtentX        =   556
               _ExtentY        =   556
               DibPicture      =   "frmprod.frx":45CF1
               Caption         =   ""
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               BorderColor     =   1154291
               BorderColorDisabled=   13160660
               BorderColorDown =   16576
               BorderColorOver =   8438015
               GradientColor1  =   1154291
               GradientColor2  =   1154291
               GradientColor3  =   1154291
               GradientColor4  =   1154291
               GradientColorDisabled1=   14215660
               GradientColorDisabled2=   14215660
               GradientColorDisabled3=   14215660
               GradientColorDisabled4=   14215660
               GradientColorOver1=   8438015
               GradientColorOver2=   8438015
               GradientColorOver3=   8438015
               GradientColorOver4=   8438015
               GradientColorDown1=   16576
               GradientColorDown2=   16576
               GradientColorDown3=   16576
               GradientColorDown4=   16576
               PicAlign        =   8
               ShowFocusRect   =   0   'False
               Theme           =   5
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "médio unit. est."
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   116
               Left            =   7500
               TabIndex        =   318
               Top             =   840
               Width           =   1125
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Vlr unitário"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   115
               Left            =   6000
               TabIndex        =   317
               Top             =   840
               Width           =   840
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "(=) Total Lote"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   114
               Left            =   4635
               TabIndex        =   316
               Top             =   840
               Width           =   1005
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "(+) Outr. desp."
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   113
               Left            =   3060
               TabIndex        =   315
               Top             =   840
               Width           =   1125
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "(+) Terceiros"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   112
               Left            =   1980
               TabIndex        =   314
               Top             =   840
               Width           =   945
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "MO real do lote"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   111
               Left            =   6855
               TabIndex        =   313
               Top             =   270
               Width           =   1095
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "MO prevista do lote"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   110
               Left            =   4635
               TabIndex        =   312
               Top             =   270
               Width           =   1410
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "MO real unitário"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   109
               Left            =   2835
               TabIndex        =   311
               Top             =   270
               Width           =   1140
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "(+) Material"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   99
               Left            =   570
               TabIndex        =   237
               Top             =   840
               Width           =   855
            End
            Begin VB.Label Label1 
               Alignment       =   1  'Right Justify
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "MO prevista unitário"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   98
               Left            =   750
               TabIndex        =   231
               Top             =   270
               Width           =   1455
            End
         End
         Begin VB.Frame Frame22 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Eficiência %"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   11.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   1995
            Left            =   12780
            TabIndex        =   229
            Top             =   240
            Width           =   2445
            Begin VB.TextBox Txt_eficiencia_prep 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial Narrow"
                  Size            =   9.75
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   -1  'True
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   405
               Left            =   930
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   142
               TabStop         =   0   'False
               ToolTipText     =   "Eficiência de preparação."
               Top             =   390
               Width           =   1410
            End
            Begin VB.TextBox Txt_eficiencia_exec 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial Narrow"
                  Size            =   9.75
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   -1  'True
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   405
               Left            =   930
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   143
               TabStop         =   0   'False
               ToolTipText     =   "Eficiência de execução."
               Top             =   900
               Width           =   1410
            End
            Begin VB.TextBox txteficiencia 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial Narrow"
                  Size            =   9.75
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   -1  'True
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   405
               Left            =   930
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   144
               TabStop         =   0   'False
               ToolTipText     =   "Média de eficiência."
               Top             =   1440
               Width           =   1410
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "% MÉDIA"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   9
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00404040&
               Height          =   210
               Index           =   32
               Left            =   45
               TabIndex        =   241
               Top             =   1545
               Width           =   780
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "% EXEC."
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   9
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00404040&
               Height          =   210
               Index           =   31
               Left            =   90
               TabIndex        =   240
               Top             =   1005
               Width           =   720
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "% SETUP "
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   9
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00404040&
               Height          =   210
               Index           =   30
               Left            =   60
               TabIndex        =   239
               Top             =   540
               Width           =   855
            End
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Aprovado"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   118
            Left            =   7770
            TabIndex        =   325
            Top             =   180
            Width           =   705
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Condicional"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   117
            Left            =   8700
            TabIndex        =   323
            Top             =   180
            Width           =   810
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Qtde. entr."
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   106
            Left            =   11685
            TabIndex        =   308
            Top             =   180
            Width           =   825
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Vlr. rejeito"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   105
            Left            =   10710
            TabIndex        =   307
            Top             =   180
            Width           =   750
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Rejeitado"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   104
            Left            =   9765
            TabIndex        =   306
            Top             =   180
            Width           =   690
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Produzido"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   103
            Left            =   6810
            TabIndex        =   305
            Top             =   180
            Width           =   705
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Á produzir"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   102
            Left            =   5775
            TabIndex        =   304
            Top             =   180
            Width           =   735
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Conclusão"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   101
            Left            =   4785
            TabIndex        =   303
            Top             =   180
            Width           =   735
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Responsável pela validação"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   100
            Left            =   2160
            TabIndex        =   302
            Top             =   180
            Width           =   1980
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Validado em "
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   27
            Left            =   465
            TabIndex        =   234
            Top             =   180
            Width           =   900
         End
      End
      Begin VB.Frame Frame9 
         BackColor       =   &H00E0E0E0&
         ForeColor       =   &H00000000&
         Height          =   615
         Left            =   -74850
         TabIndex        =   215
         Top             =   9360
         Width           =   15225
         Begin VB.ComboBox Cmb_opcao_lista3 
            Appearance      =   0  'Flat
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   300
            ItemData        =   "frmprod.frx":4E4EB
            Left            =   6960
            List            =   "frmprod.frx":4E4FE
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   53
            TabStop         =   0   'False
            Top             =   187
            Width           =   1965
         End
         Begin VB.TextBox txtPagIr2 
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   9540
            TabIndex        =   54
            ToolTipText     =   "Número da página."
            Top             =   180
            Width           =   555
         End
         Begin VB.TextBox txtNreg2 
            Alignment       =   2  'Center
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   2730
            TabIndex        =   52
            Text            =   "30"
            ToolTipText     =   "Número de registros por página."
            Top             =   180
            Width           =   555
         End
         Begin DrawSuite2022.USButton cmdPagProx2 
            Height          =   315
            Left            =   11760
            TabIndex        =   58
            ToolTipText     =   "Próxima página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":4E53E
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagAnt2 
            Height          =   315
            Left            =   11220
            TabIndex        =   57
            ToolTipText     =   "Página anterior."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":51CE2
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagIr2 
            Height          =   315
            Left            =   10110
            TabIndex        =   55
            Top             =   180
            Width           =   465
            _ExtentX        =   820
            _ExtentY        =   556
            Caption         =   "Ir"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagPrim2 
            Height          =   315
            Left            =   10680
            TabIndex        =   56
            ToolTipText     =   "Primeira página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":557EB
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagUlt2 
            Height          =   315
            Left            =   12300
            TabIndex        =   59
            ToolTipText     =   "Última página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":598DA
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "registros por página"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   38
            Left            =   3360
            TabIndex        =   243
            Top             =   240
            Width           =   1440
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Operação da lista"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   37
            Left            =   5610
            TabIndex        =   227
            Top             =   240
            Width           =   1260
         End
         Begin VB.Label lblRegistros2 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Nº de registros: 0"
            ForeColor       =   &H00000000&
            Height          =   195
            Left            =   180
            TabIndex        =   218
            Top             =   240
            Width           =   1275
         End
         Begin VB.Label lblPaginas2 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Página: 0 de: 0"
            ForeColor       =   &H00000000&
            Height          =   195
            Left            =   13050
            TabIndex        =   217
            Top             =   240
            Width           =   1095
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Carregar"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   36
            Left            =   2040
            TabIndex        =   216
            Top             =   240
            Width           =   645
         End
      End
      Begin MSComctlLib.ImageList ImageList1 
         Left            =   -63810
         Top             =   4230
         _ExtentX        =   1005
         _ExtentY        =   1005
         BackColor       =   -2147483643
         ImageWidth      =   16
         ImageHeight     =   16
         MaskColor       =   12632256
         _Version        =   393216
         BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
            NumListImages   =   4
            BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
               Picture         =   "frmprod.frx":5D166
               Key             =   ""
            EndProperty
            BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
               Picture         =   "frmprod.frx":5EE40
               Key             =   ""
            EndProperty
            BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
               Picture         =   "frmprod.frx":60B1A
               Key             =   ""
            EndProperty
            BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
               Picture         =   "frmprod.frx":627F4
               Key             =   ""
            EndProperty
         EndProperty
      End
      Begin VB.TextBox Txt_ID_apontamento 
         Alignment       =   2  'Center
         BackColor       =   &H00FFFFFF&
         BeginProperty Font 
            Name            =   "Arial"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   -73680
         Locked          =   -1  'True
         TabIndex        =   204
         TabStop         =   0   'False
         Top             =   5700
         Visible         =   0   'False
         Width           =   735
      End
      Begin VB.Frame Frame14 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Operação da lista de ordem de serviço"
         Height          =   705
         Left            =   60
         TabIndex        =   203
         Top             =   1290
         Width           =   6435
         Begin VB.ComboBox Cmb_opcao_lista1 
            Appearance      =   0  'Flat
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   300
            ItemData        =   "frmprod.frx":644CE
            Left            =   180
            List            =   "frmprod.frx":644DB
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   100
            TabStop         =   0   'False
            Top             =   300
            Width           =   2145
         End
      End
      Begin DrawSuite2022.USImageList USImageList5 
         Left            =   -64950
         Top             =   570
         _ExtentX        =   900
         _ExtentY        =   767
         Img1            =   "frmprod.frx":644FD
         Count           =   1
      End
      Begin DrawSuite2022.USImageList USImageList4 
         Left            =   -64140
         Top             =   510
         _ExtentX        =   900
         _ExtentY        =   767
         Img1            =   "frmprod.frx":69A08
         Count           =   1
      End
      Begin DrawSuite2022.USImageList USImageList3 
         Left            =   12690
         Top             =   570
         _ExtentX        =   900
         _ExtentY        =   767
         Img1            =   "frmprod.frx":6D221
         Count           =   1
      End
      Begin VB.Frame Frame23 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Lista de materiais"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   5385
         Left            =   -74925
         TabIndex        =   181
         Top             =   1320
         Width           =   15315
         Begin VB.Frame Frame2 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Operação lista"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   645
            Left            =   13935
            TabIndex        =   214
            Top             =   150
            Width           =   1320
            Begin VB.ComboBox Cmb_opcao_lista2 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0FF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   300
               ItemData        =   "frmprod.frx":75059
               Left            =   150
               List            =   "frmprod.frx":75063
               Sorted          =   -1  'True
               Style           =   2  'Dropdown List
               TabIndex        =   101
               TabStop         =   0   'False
               Top             =   240
               Width           =   1035
            End
         End
         Begin MSComctlLib.ListView ListaRequisicao 
            Height          =   5070
            Left            =   60
            TabIndex        =   354
            Top             =   210
            Visible         =   0   'False
            Width           =   13845
            _ExtentX        =   24421
            _ExtentY        =   8943
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   0   'False
            Checkboxes      =   -1  'True
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            SmallIcons      =   "ImageList1"
            ForeColor       =   -2147483640
            BackColor       =   16777215
            Appearance      =   1
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            NumItems        =   11
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Object.Tag             =   "N"
               Object.Width           =   529
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   1
               Object.Tag             =   "T"
               Text            =   "Cód. interno"
               Object.Width           =   2117
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   2
               Object.Tag             =   "T"
               Text            =   "Descrição"
               Object.Width           =   5115
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   3
               Object.Tag             =   "N"
               Text            =   "Un"
               Object.Width           =   706
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   4
               Object.Tag             =   "T"
               Text            =   "Requisitado"
               Object.Width           =   2469
            EndProperty
            BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   5
               Text            =   "Baixado"
               Object.Width           =   2540
            EndProperty
            BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   6
               Text            =   "Saldo"
               Object.Width           =   2540
            EndProperty
            BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   7
               Object.Tag             =   "T"
               Text            =   "Status"
               Object.Width           =   2293
            EndProperty
            BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   8
               Text            =   "Tipo"
               Object.Width           =   2540
            EndProperty
            BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   9
               Text            =   "SaldoEstoque"
               Object.Width           =   2117
            EndProperty
            BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   10
               Text            =   "Versão"
               Object.Width           =   1482
            EndProperty
         End
         Begin DrawSuite2022.USButton btnExluirMov 
            Height          =   2295
            Left            =   13950
            TabIndex        =   364
            ToolTipText     =   "Excluir movimentação"
            Top             =   810
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   4048
            DibPicture      =   "frmprod.frx":75078
            Caption         =   "Excluir baixa"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            PicAlign        =   8
            PicSize         =   3
            PicSizeH        =   32
            PicSizeW        =   32
            ShowFocusRect   =   0   'False
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btnBaixar 
            Height          =   2115
            Left            =   13950
            TabIndex        =   365
            ToolTipText     =   "Baixar item do estoque"
            Top             =   3150
            Width           =   1275
            _ExtentX        =   2249
            _ExtentY        =   3731
            DibPicture      =   "frmprod.frx":7B140
            Caption         =   "Baixar estoque"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   4960354
            BorderColorDisabled=   13160660
            BorderColorDown =   4210752
            BorderColorOver =   49152
            GradientColor1  =   4960354
            GradientColor2  =   4960354
            GradientColor3  =   4960354
            GradientColor4  =   4960354
            GradientColorDisabled1=   14215660
            GradientColorDisabled2=   14215660
            GradientColorDisabled3=   14215660
            GradientColorDisabled4=   14215660
            GradientColorOver1=   49152
            GradientColorOver2=   49152
            GradientColorOver3=   49152
            GradientColorOver4=   49152
            GradientColorDown1=   32768
            GradientColorDown2=   32768
            GradientColorDown3=   32768
            GradientColorDown4=   32768
            PicAlign        =   8
            PicSize         =   3
            PicSizeH        =   32
            PicSizeW        =   32
            ShowFocusRect   =   0   'False
            Theme           =   3
         End
      End
      Begin VB.Frame Frame24 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Observações"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   1185
         Left            =   6525
         TabIndex        =   180
         Top             =   8745
         Width           =   8865
         Begin VB.TextBox txtobs 
            BackColor       =   &H00FFFFFF&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   645
            Left            =   210
            MultiLine       =   -1  'True
            ScrollBars      =   2  'Vertical
            TabIndex        =   98
            ToolTipText     =   "Observações."
            Top             =   360
            Width           =   8505
         End
      End
      Begin VB.Frame Frame5 
         BackColor       =   &H00E0E0E0&
         Caption         =   "STATUS"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00800000&
         Height          =   885
         Left            =   -63930
         TabIndex        =   176
         Top             =   330
         Width           =   4365
         Begin VB.TextBox txtstatus 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   9
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   330
            Left            =   90
            Locked          =   -1  'True
            TabIndex        =   105
            TabStop         =   0   'False
            Top             =   420
            Width           =   4155
         End
      End
      Begin MSComctlLib.ListView ListaOS 
         Height          =   5235
         Left            =   75
         TabIndex        =   76
         Top             =   1980
         Width           =   6420
         _ExtentX        =   11324
         _ExtentY        =   9234
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   0   'False
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   16777215
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   10
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "N"
            Text            =   "OS"
            Object.Width           =   1411
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   1
            Object.Tag             =   "T"
            Text            =   "Versão"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   2
            Object.Tag             =   "N"
            Text            =   "Fase"
            Object.Width           =   882
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   3
            Object.Tag             =   "T"
            Text            =   "Grupo/op."
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   4
            Object.Tag             =   "T"
            Text            =   "PT"
            Object.Width           =   1411
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   5
            Object.Tag             =   "T"
            Text            =   "Conc."
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   6
            Text            =   "Rastreável"
            Object.Width           =   1501
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   7
            Text            =   "Aprovadas"
            Object.Width           =   1499
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   8
            Text            =   "Rejeitadas"
            Object.Width           =   1499
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   1
            SubItemIndex    =   9
            Text            =   "Saldo"
            Object.Width           =   1148
         EndProperty
      End
      Begin VB.Frame Frame16 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   855
         Left            =   -74925
         TabIndex        =   164
         Top             =   1200
         Width           =   10995
         Begin VB.TextBox Txt_APeficiencia_prep 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   7440
            Locked          =   -1  'True
            TabIndex        =   113
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Eficiência de preparação."
            Top             =   420
            Width           =   1110
         End
         Begin VB.TextBox Txt_APeficiencia_exec 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   8570
            Locked          =   -1  'True
            TabIndex        =   114
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Eficiência de execução."
            Top             =   420
            Width           =   1110
         End
         Begin VB.TextBox Txt_APeficiencia_media 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   9690
            Locked          =   -1  'True
            TabIndex        =   115
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Eficiência média."
            Top             =   420
            Width           =   1110
         End
         Begin VB.TextBox txtturno 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   6645
            Locked          =   -1  'True
            TabIndex        =   112
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Turno."
            Top             =   420
            Width           =   780
         End
         Begin VB.TextBox txtProduzida 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   5370
            Locked          =   -1  'True
            TabIndex        =   111
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Quantidade produzida."
            Top             =   420
            Width           =   1005
         End
         Begin VB.TextBox Txtttnc 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   4320
            Locked          =   -1  'True
            TabIndex        =   110
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Quantidade não conforme."
            Top             =   420
            Width           =   975
         End
         Begin VB.TextBox txtAPOF 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   180
            Locked          =   -1  'True
            TabIndex        =   106
            TabStop         =   0   'False
            Text            =   "0000000"
            ToolTipText     =   "Número da ordem."
            Top             =   420
            Width           =   1035
         End
         Begin VB.TextBox txtttok 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   3270
            Locked          =   -1  'True
            TabIndex        =   109
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Quatidade aprovada."
            Top             =   420
            Width           =   975
         End
         Begin VB.TextBox txtAPprazo 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   1230
            Locked          =   -1  'True
            TabIndex        =   107
            TabStop         =   0   'False
            Text            =   "00/00/00"
            ToolTipText     =   "Prazo final."
            Top             =   420
            Width           =   975
         End
         Begin VB.TextBox txtAPquant 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   2220
            Locked          =   -1  'True
            TabIndex        =   108
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Quantidade do lote."
            Top             =   420
            Width           =   975
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Efic. média"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   80
            Left            =   9795
            TabIndex        =   286
            Top             =   210
            Width           =   900
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Efic. exec."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   79
            Left            =   8713
            TabIndex        =   285
            Top             =   210
            Width           =   825
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Efic. prep."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   78
            Left            =   7590
            TabIndex        =   284
            Top             =   210
            Width           =   810
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Turno"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   77
            Left            =   6788
            TabIndex        =   283
            Top             =   210
            Width           =   495
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Prod."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   76
            Left            =   5655
            TabIndex        =   282
            Top             =   210
            Width           =   435
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "="
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   75
            Left            =   5280
            TabIndex        =   281
            Top             =   210
            Width           =   135
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "NC"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   74
            Left            =   4710
            TabIndex        =   280
            Top             =   210
            Width           =   210
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "+"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   73
            Left            =   4200
            TabIndex        =   279
            Top             =   210
            Width           =   135
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Aprov."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   72
            Left            =   3480
            TabIndex        =   278
            Top             =   210
            Width           =   555
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Lote"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   71
            Left            =   2520
            TabIndex        =   277
            Top             =   210
            Width           =   375
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Pr. final"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   70
            Left            =   1402
            TabIndex        =   276
            Top             =   210
            Width           =   630
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "N° ordem"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   17
            Left            =   300
            TabIndex        =   165
            Top             =   210
            Width           =   795
         End
      End
      Begin MSComctlLib.ListView ListaOS_maq 
         Height          =   2700
         Left            =   75
         TabIndex        =   99
         Top             =   7230
         Width           =   6420
         _ExtentX        =   11324
         _ExtentY        =   4763
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   0   'False
         Checkboxes      =   -1  'True
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   -2147483640
         BackColor       =   16777215
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   1
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "T"
            Text            =   "Posto(s) de trabalho utilizado(s)"
            Object.Width           =   10636
         EndProperty
      End
      Begin MSComctlLib.ListView ListaRE 
         Height          =   6345
         Left            =   -74925
         TabIndex        =   159
         Top             =   3600
         Width           =   15315
         _ExtentX        =   27014
         _ExtentY        =   11192
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   0   'False
         FullRowSelect   =   -1  'True
         GridLines       =   -1  'True
         _Version        =   393217
         ForeColor       =   0
         BackColor       =   -2147483628
         Appearance      =   1
         MousePointer    =   99
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   23
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "N"
            Text            =   "OS"
            Object.Width           =   1235
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   1
            Object.Tag             =   "N"
            Text            =   "Fase"
            Object.Width           =   882
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   2
            Object.Tag             =   "T"
            Text            =   "Gupo/op."
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   3
            Object.Tag             =   "T"
            Text            =   "Posto de trab."
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   4
            Object.Tag             =   "T"
            Text            =   "Descrição"
            Object.Width           =   3881
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   5
            Object.Tag             =   "N"
            Text            =   "Ct hr. prep. prev."
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   6
            Object.Tag             =   "D"
            Text            =   "Prep. prev. un"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   7
            Object.Tag             =   "D"
            Text            =   "Prep. utiliz. un"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   8
            Object.Tag             =   "N"
            Text            =   "Ct hr. exec. prev."
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   9
            Object.Tag             =   "D"
            Text            =   "Exec. prev. un"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   10
            Object.Tag             =   "D"
            Text            =   "Exec. utiliz. un"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(12) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   11
            Object.Tag             =   "N"
            Text            =   "Qtde. aprov."
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(13) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   12
            Text            =   "Qtde. aprov. COND."
            Object.Width           =   2540
         EndProperty
         BeginProperty ColumnHeader(14) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   13
            Object.Tag             =   "N"
            Text            =   "Qtde. Rejeito"
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(15) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   14
            Object.Tag             =   "N"
            Text            =   "Qtde. prod."
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(16) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   15
            Object.Tag             =   "N"
            Text            =   "Ct. prep. prev. lote"
            Object.Width           =   2522
         EndProperty
         BeginProperty ColumnHeader(17) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   16
            Object.Tag             =   "N"
            Text            =   "Ct. exec. prev. lote"
            Object.Width           =   2522
         EndProperty
         BeginProperty ColumnHeader(18) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   17
            Object.Tag             =   "N"
            Text            =   "Ct. prep. real lote"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(19) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   18
            Object.Tag             =   "N"
            Text            =   "Ct. exec. real lote"
            Object.Width           =   2293
         EndProperty
         BeginProperty ColumnHeader(20) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   19
            Object.Tag             =   "N"
            Text            =   "Ct. total lote"
            Object.Width           =   2205
         EndProperty
         BeginProperty ColumnHeader(21) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   20
            Object.Tag             =   "N"
            Text            =   "Efic. prep."
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(22) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   21
            Object.Tag             =   "N"
            Text            =   "Efic. exec."
            Object.Width           =   1764
         EndProperty
         BeginProperty ColumnHeader(23) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   22
            Object.Tag             =   "N"
            Text            =   "Efic. média"
            Object.Width           =   1764
         EndProperty
      End
      Begin DrawSuite2022.USToolBar USToolBar1 
         Height          =   1005
         Left            =   -74910
         TabIndex        =   193
         Top             =   360
         Width           =   15330
         _ExtentX        =   27040
         _ExtentY        =   1773
         ButtonCount     =   11
         GradientColor2  =   14737632
         GradientColorOverRight1=   16315633
         GradientColorOverRight2=   15195350
         GripperColor    =   15195350
         IsStrech        =   -1  'True
         RightColor1     =   0
         RightColor2     =   0
         ShowEndPanel    =   0   'False
         Theme           =   1
         ButtonCaption1  =   "Filtrar"
         ButtonEnabled1  =   0   'False
         ButtonIconSize1 =   32
         ButtonToolTipText1=   "Filtrar (F2)"
         ButtonKey1      =   "1"
         ButtonAlignment1=   2
         BeginProperty ButtonFont1 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft1     =   2
         ButtonTop1      =   2
         ButtonWidth1    =   42
         ButtonHeight1   =   21
         ButtonUseMaskColor1=   0   'False
         ButtonCaption2  =   "Alterar lista"
         ButtonEnabled2  =   0   'False
         ButtonIconSize2 =   32
         ButtonToolTipText2=   "Alternar lista de informações (F7)"
         ButtonKey2      =   "2"
         ButtonAlignment2=   2
         BeginProperty ButtonFont2 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft2     =   46
         ButtonTop2      =   2
         ButtonWidth2    =   75
         ButtonHeight2   =   21
         ButtonUseMaskColor2=   0   'False
         ButtonCaption3  =   "Relatório"
         ButtonEnabled3  =   0   'False
         ButtonIconSize3 =   32
         ButtonToolTipText3=   "Visualizar impressão da carteira de pedidos (F5)"
         ButtonKey3      =   "3"
         ButtonAlignment3=   2
         BeginProperty ButtonFont3 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft3     =   123
         ButtonTop3      =   2
         ButtonWidth3    =   60
         ButtonHeight3   =   21
         ButtonUseMaskColor3=   0   'False
         ButtonCaption4  =   "Gerar MRP"
         ButtonEnabled4  =   0   'False
         ButtonIconSize4 =   32
         ButtonToolTipText4=   "Gerar MRP do(s) produto(s)/serviço(s) da carteira de produção (F3)"
         ButtonKey4      =   "4"
         ButtonAlignment4=   2
         BeginProperty ButtonFont4 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft4     =   185
         ButtonTop4      =   2
         ButtonWidth4    =   68
         ButtonHeight4   =   21
         ButtonUseMaskColor4=   0   'False
         ButtonCaption5  =   "Cancelar MRP"
         ButtonEnabled5  =   0   'False
         ButtonIconSize5 =   32
         ButtonToolTipText5=   "Excluir ordem(ns) emitida(s) para o(s) produto(s)/serviço(s) em carteira (F4)"
         ButtonKey5      =   "5"
         ButtonAlignment5=   2
         BeginProperty ButtonFont5 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft5     =   255
         ButtonTop5      =   2
         ButtonWidth5    =   85
         ButtonHeight5   =   21
         ButtonUseMaskColor5=   0   'False
         ButtonCaption6  =   "Alterar status"
         ButtonEnabled6  =   0   'False
         ButtonIconSize6 =   32
         ButtonToolTipText6=   "Alterar status (F8)"
         ButtonKey6      =   "6"
         ButtonAlignment6=   2
         BeginProperty ButtonFont6 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft6     =   342
         ButtonTop6      =   2
         ButtonWidth6    =   87
         ButtonHeight6   =   21
         ButtonUseMaskColor6=   0   'False
         ButtonCaption7  =   "Empenhos"
         ButtonEnabled7  =   0   'False
         ButtonIconSize7 =   32
         ButtonToolTipText7=   "Empenhos do pedido interno (F11)"
         ButtonKey7      =   "7"
         ButtonAlignment7=   2
         BeginProperty ButtonFont7 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft7     =   431
         ButtonTop7      =   2
         ButtonWidth7    =   66
         ButtonHeight7   =   21
         ButtonUseMaskColor7=   0   'False
         ButtonEnabled8  =   0   'False
         ButtonIconSize8 =   32
         ButtonAlignment8=   2
         ButtonType8     =   1
         ButtonStyle8    =   -1
         BeginProperty ButtonFont8 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState8    =   -1
         ButtonLeft8     =   499
         ButtonTop8      =   4
         ButtonWidth8    =   2
         ButtonHeight8   =   56
         ButtonCaption9  =   "Ajuda"
         ButtonEnabled9  =   0   'False
         ButtonIconSize9 =   32
         ButtonToolTipText9=   "Ajuda (F1)"
         ButtonKey9      =   "9"
         ButtonAlignment9=   2
         BeginProperty ButtonFont9 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft9     =   503
         ButtonTop9      =   2
         ButtonWidth9    =   41
         ButtonHeight9   =   21
         ButtonUseMaskColor9=   0   'False
         ButtonCaption10 =   "Sair"
         ButtonEnabled10 =   0   'False
         ButtonIconSize10=   32
         ButtonToolTipText10=   "Sair (Esc)"
         ButtonKey10     =   "10"
         ButtonAlignment10=   2
         BeginProperty ButtonFont10 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft10    =   546
         ButtonTop10     =   2
         ButtonWidth10   =   30
         ButtonHeight10  =   21
         ButtonUseMaskColor10=   0   'False
         ButtonEnabled11 =   0   'False
         ButtonIconSize11=   32
         ButtonKey11     =   "11"
         BeginProperty ButtonFont11 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState11   =   5
         ButtonLeft11    =   578
         ButtonTop11     =   2
         ButtonWidth11   =   24
         ButtonHeight11  =   24
         ButtonUseMaskColor11=   0   'False
         Begin DrawSuite2022.USImageList USImageList1 
            Left            =   13380
            Top             =   210
            _ExtentX        =   900
            _ExtentY        =   767
            Img1            =   "frmprod.frx":7F4B9
            Count           =   1
         End
         Begin VB.Image imgFolder 
            Height          =   240
            Left            =   0
            Picture         =   "frmprod.frx":84A1D
            Top             =   0
            Visible         =   0   'False
            Width           =   240
         End
         Begin VB.Image imgFile 
            Height          =   240
            Left            =   270
            Picture         =   "frmprod.frx":84FA7
            Top             =   0
            Visible         =   0   'False
            Width           =   240
         End
      End
      Begin DrawSuite2022.USToolBar USToolBar3 
         Height          =   975
         Left            =   30
         TabIndex        =   197
         Top             =   330
         Width           =   15375
         _ExtentX        =   27120
         _ExtentY        =   1720
         ButtonCount     =   14
         GradientColor2  =   14737632
         GradientColorOverRight1=   16315633
         GradientColorOverRight2=   15195350
         GripperColor    =   15195350
         IsStrech        =   -1  'True
         RightColor1     =   0
         RightColor2     =   0
         ShowEndPanel    =   0   'False
         Theme           =   1
         ButtonCaption1  =   "Novo"
         ButtonEnabled1  =   0   'False
         ButtonIconSize1 =   32
         ButtonToolTipText1=   "Novo (Insert)"
         ButtonKey1      =   "1"
         ButtonAlignment1=   2
         BeginProperty ButtonFont1 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft1     =   2
         ButtonTop1      =   2
         ButtonWidth1    =   36
         ButtonHeight1   =   21
         ButtonUseMaskColor1=   0   'False
         ButtonCaption2  =   "Salvar"
         ButtonEnabled2  =   0   'False
         ButtonIconSize2 =   32
         ButtonToolTipText2=   "Salvar (F3)"
         ButtonKey2      =   "2"
         ButtonAlignment2=   2
         BeginProperty ButtonFont2 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft2     =   40
         ButtonTop2      =   2
         ButtonWidth2    =   44
         ButtonHeight2   =   21
         ButtonUseMaskColor2=   0   'False
         ButtonCaption3  =   "Excluir"
         ButtonEnabled3  =   0   'False
         ButtonIconSize3 =   32
         ButtonToolTipText3=   "Excluir (F4)"
         ButtonKey3      =   "3"
         ButtonAlignment3=   2
         BeginProperty ButtonFont3 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft3     =   86
         ButtonTop3      =   2
         ButtonWidth3    =   45
         ButtonHeight3   =   21
         ButtonUseMaskColor3=   0   'False
         ButtonCaption4  =   "Relatório"
         ButtonEnabled4  =   0   'False
         ButtonIconSize4 =   32
         ButtonToolTipText4=   "Relatório (F5)"
         ButtonKey4      =   "4"
         ButtonAlignment4=   2
         BeginProperty ButtonFont4 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft4     =   133
         ButtonTop4      =   2
         ButtonWidth4    =   60
         ButtonHeight4   =   21
         ButtonUseMaskColor4=   0   'False
         ButtonCaption5  =   "Anterior"
         ButtonEnabled5  =   0   'False
         ButtonIconSize5 =   32
         ButtonToolTipText5=   "Registro anterior."
         ButtonKey5      =   "5"
         ButtonAlignment5=   2
         BeginProperty ButtonFont5 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft5     =   195
         ButtonTop5      =   2
         ButtonWidth5    =   55
         ButtonHeight5   =   21
         ButtonUseMaskColor5=   0   'False
         ButtonCaption6  =   "Próximo"
         ButtonEnabled6  =   0   'False
         ButtonIconSize6 =   32
         ButtonToolTipText6=   "Próximo registro."
         ButtonKey6      =   "6"
         ButtonAlignment6=   2
         BeginProperty ButtonFont6 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft6     =   252
         ButtonTop6      =   2
         ButtonWidth6    =   55
         ButtonHeight6   =   21
         ButtonUseMaskColor6=   0   'False
         ButtonCaption7  =   "Status"
         ButtonEnabled7  =   0   'False
         ButtonIconSize7 =   32
         ButtonToolTipText7=   "Marcar/desmarcar OS como concluída (F8)"
         ButtonKey7      =   "7"
         ButtonAlignment7=   2
         BeginProperty ButtonFont7 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft7     =   309
         ButtonTop7      =   2
         ButtonWidth7    =   45
         ButtonHeight7   =   21
         ButtonUseMaskColor7=   0   'False
         ButtonCaption8  =   "Prazo final"
         ButtonEnabled8  =   0   'False
         ButtonIconSize8 =   32
         ButtonToolTipText8=   "Alterar prazo final (F10)"
         ButtonKey8      =   "8"
         ButtonAlignment8=   2
         BeginProperty ButtonFont8 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft8     =   356
         ButtonTop8      =   2
         ButtonWidth8    =   58
         ButtonHeight8   =   21
         ButtonUseMaskColor8=   0   'False
         ButtonCaption9  =   "Renumerar"
         ButtonEnabled9  =   0   'False
         ButtonIconSize9 =   32
         ButtonToolTipText9=   "Renumerar fases (F11)"
         ButtonKey9      =   "9"
         ButtonAlignment9=   2
         BeginProperty ButtonFont9 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft9     =   416
         ButtonTop9      =   2
         ButtonWidth9    =   72
         ButtonHeight9   =   21
         ButtonUseMaskColor9=   0   'False
         ButtonCaption10 =   "Atualizar"
         ButtonEnabled10 =   0   'False
         ButtonIconSize10=   32
         ButtonToolTipText10=   "Utilizado pelo administrador do sistema."
         ButtonKey10     =   "10"
         ButtonAlignment10=   2
         BeginProperty ButtonFont10 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft10    =   490
         ButtonTop10     =   2
         ButtonWidth10   =   59
         ButtonHeight10  =   21
         ButtonUseMaskColor10=   0   'False
         ButtonEnabled11 =   0   'False
         ButtonIconSize11=   32
         ButtonAlignment11=   2
         ButtonType11    =   1
         ButtonStyle11   =   -1
         BeginProperty ButtonFont11 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState11   =   -1
         ButtonLeft11    =   551
         ButtonTop11     =   4
         ButtonWidth11   =   2
         ButtonHeight11  =   54
         ButtonCaption12 =   "Ajuda"
         ButtonEnabled12 =   0   'False
         ButtonIconSize12=   32
         ButtonToolTipText12=   "Ajuda (F1)"
         ButtonKey12     =   "12"
         ButtonAlignment12=   2
         BeginProperty ButtonFont12 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft12    =   555
         ButtonTop12     =   2
         ButtonWidth12   =   41
         ButtonHeight12  =   21
         ButtonUseMaskColor12=   0   'False
         ButtonCaption13 =   "Sair"
         ButtonEnabled13 =   0   'False
         ButtonIconSize13=   32
         ButtonToolTipText13=   "Sair (Esc)"
         ButtonKey13     =   "13"
         ButtonAlignment13=   2
         BeginProperty ButtonFont13 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft13    =   598
         ButtonTop13     =   2
         ButtonWidth13   =   30
         ButtonHeight13  =   21
         ButtonUseMaskColor13=   0   'False
         ButtonEnabled14 =   0   'False
         ButtonIconSize14=   32
         ButtonKey14     =   "14"
         ButtonAlignment14=   2
         BeginProperty ButtonFont14 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState14   =   5
         ButtonLeft14    =   630
         ButtonTop14     =   2
         ButtonWidth14   =   24
         ButtonHeight14  =   24
         ButtonUseMaskColor14=   0   'False
      End
      Begin DrawSuite2022.USToolBar USToolBar4 
         Height          =   975
         Left            =   -74940
         TabIndex        =   198
         Top             =   330
         Width           =   15345
         _ExtentX        =   27067
         _ExtentY        =   1720
         ButtonCount     =   7
         GradientColor2  =   14737632
         GradientColorOverRight1=   16315633
         GradientColorOverRight2=   15195350
         GripperColor    =   15195350
         IsStrech        =   -1  'True
         RightColor1     =   0
         RightColor2     =   0
         ShowEndPanel    =   0   'False
         Theme           =   1
         ButtonCaption1  =   "Novo"
         ButtonEnabled1  =   0   'False
         ButtonIconSize1 =   32
         ButtonToolTipText1=   "Novo (Insert)"
         ButtonKey1      =   "1"
         ButtonAlignment1=   2
         BeginProperty ButtonFont1 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft1     =   2
         ButtonTop1      =   2
         ButtonWidth1    =   36
         ButtonHeight1   =   21
         ButtonUseMaskColor1=   0   'False
         ButtonCaption2  =   "Alterar"
         ButtonEnabled2  =   0   'False
         ButtonIconSize2 =   32
         ButtonToolTipText2=   "Alterar (F3)"
         ButtonKey2      =   "2"
         ButtonAlignment2=   2
         BeginProperty ButtonFont2 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft2     =   40
         ButtonTop2      =   2
         ButtonWidth2    =   41
         ButtonHeight2   =   21
         ButtonUseMaskColor2=   0   'False
         ButtonCaption3  =   "Excluir"
         ButtonEnabled3  =   0   'False
         ButtonIconSize3 =   32
         ButtonToolTipText3=   "Excluir (F4)"
         ButtonKey3      =   "3"
         ButtonAlignment3=   2
         BeginProperty ButtonFont3 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft3     =   83
         ButtonTop3      =   2
         ButtonWidth3    =   45
         ButtonHeight3   =   21
         ButtonUseMaskColor3=   0   'False
         ButtonEnabled4  =   0   'False
         ButtonIconSize4 =   32
         ButtonAlignment4=   2
         ButtonType4     =   1
         ButtonStyle4    =   -1
         BeginProperty ButtonFont4 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState4    =   -1
         ButtonLeft4     =   130
         ButtonTop4      =   4
         ButtonWidth4    =   2
         ButtonHeight4   =   54
         ButtonCaption5  =   "Ajuda"
         ButtonEnabled5  =   0   'False
         ButtonIconSize5 =   32
         ButtonToolTipText5=   "Ajuda (F1)"
         ButtonKey5      =   "9"
         ButtonAlignment5=   2
         BeginProperty ButtonFont5 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft5     =   134
         ButtonTop5      =   2
         ButtonWidth5    =   41
         ButtonHeight5   =   21
         ButtonUseMaskColor5=   0   'False
         ButtonCaption6  =   "Sair"
         ButtonEnabled6  =   0   'False
         ButtonIconSize6 =   32
         ButtonToolTipText6=   "Sair (Esc)"
         ButtonKey6      =   "10"
         ButtonAlignment6=   2
         BeginProperty ButtonFont6 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft6     =   177
         ButtonTop6      =   2
         ButtonWidth6    =   30
         ButtonHeight6   =   21
         ButtonUseMaskColor6=   0   'False
         ButtonEnabled7  =   0   'False
         ButtonIconSize7 =   32
         ButtonKey7      =   "11"
         ButtonAlignment7=   2
         BeginProperty ButtonFont7 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState7    =   5
         ButtonLeft7     =   209
         ButtonTop7      =   2
         ButtonWidth7    =   24
         ButtonHeight7   =   24
      End
      Begin VB.Frame Frame25 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Lista de empenhos"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   3285
         Left            =   -74910
         TabIndex        =   182
         Top             =   6690
         Width           =   7605
         Begin MSComctlLib.ListView ListaLote 
            Height          =   2655
            Left            =   180
            TabIndex        =   103
            Top             =   270
            Width           =   6405
            _ExtentX        =   11298
            _ExtentY        =   4683
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   0   'False
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            SmallIcons      =   "ImageList1"
            ForeColor       =   -2147483640
            BackColor       =   16777215
            Appearance      =   1
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            NumItems        =   8
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Object.Tag             =   "N"
               Text            =   "ID/Cód. cart."
               Object.Width           =   0
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   1
               Object.Tag             =   "N"
               Text            =   "RE"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   2
               Object.Tag             =   "T"
               Text            =   "Lote"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   3
               Object.Tag             =   "T"
               Text            =   "Local de armaz."
               Object.Width           =   3217
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   4
               Object.Tag             =   "T"
               Text            =   "Corrida"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   5
               Object.Tag             =   "T"
               Text            =   "Certificado"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   6
               Object.Tag             =   "N"
               Text            =   "Qtde."
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   7
               Object.Tag             =   "N"
               Text            =   "Qtde. PÇ"
               Object.Width           =   0
            EndProperty
         End
         Begin MSComctlLib.ListView ListaConsignacao 
            Height          =   2655
            Left            =   180
            TabIndex        =   102
            Top             =   270
            Width           =   6405
            _ExtentX        =   11298
            _ExtentY        =   4683
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   0   'False
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            SmallIcons      =   "ImageList1"
            ForeColor       =   -2147483640
            BackColor       =   16777215
            Appearance      =   1
            MousePointer    =   1
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            MouseIcon       =   "frmprod.frx":85531
            NumItems        =   9
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Object.Tag             =   "N"
               Text            =   "ID"
               Object.Width           =   0
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   1
               Object.Tag             =   "N"
               Text            =   "RE"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   2
               Object.Tag             =   "D"
               Text            =   "Dt. emissão"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   3
               Object.Tag             =   "N"
               Text            =   "Nota fiscal"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   4
               Object.Tag             =   "T"
               Text            =   "Local de armaz."
               Object.Width           =   1455
            EndProperty
            BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   5
               Object.Tag             =   "T"
               Text            =   "Corrida"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   6
               Object.Tag             =   "T"
               Text            =   "Certificado"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   7
               Object.Tag             =   "N"
               Text            =   "Qtde."
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   8
               Object.Tag             =   "N"
               Text            =   "Qtde PÇ"
               Object.Width           =   1587
            EndProperty
         End
         Begin DrawSuite2022.USButton btnExcluirEmpenho 
            Height          =   1365
            Left            =   6660
            TabIndex        =   350
            ToolTipText     =   "Excluir empenho"
            Top             =   270
            Width           =   795
            _ExtentX        =   1402
            _ExtentY        =   2408
            DibPicture      =   "frmprod.frx":8584B
            Caption         =   "Excluir empenho"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            PicAlign        =   8
            PicSize         =   3
            PicSizeH        =   32
            PicSizeW        =   32
            ShowFocusRect   =   0   'False
            Theme           =   4
         End
         Begin DrawSuite2022.USButton btnEmpenhar 
            Height          =   1215
            Left            =   6660
            TabIndex        =   351
            ToolTipText     =   "Empenhar lote"
            Top             =   1680
            Width           =   795
            _ExtentX        =   1402
            _ExtentY        =   2143
            DibPicture      =   "frmprod.frx":8A59D
            Caption         =   "Empenhar item"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   4960354
            BorderColorDisabled=   13160660
            BorderColorDown =   4210752
            BorderColorOver =   49152
            GradientColor1  =   4960354
            GradientColor2  =   4960354
            GradientColor3  =   4960354
            GradientColor4  =   4960354
            GradientColorDisabled1=   14215660
            GradientColorDisabled2=   14215660
            GradientColorDisabled3=   14215660
            GradientColorDisabled4=   14215660
            GradientColorOver1=   49152
            GradientColorOver2=   49152
            GradientColorOver3=   49152
            GradientColorOver4=   49152
            GradientColorDown1=   32768
            GradientColorDown2=   32768
            GradientColorDown3=   32768
            GradientColorDown4=   32768
            PicAlign        =   8
            PicSize         =   3
            PicSizeH        =   32
            PicSizeW        =   32
            ShowFocusRect   =   0   'False
            Theme           =   3
         End
      End
      Begin VB.Frame Frame26 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Lista de baixas no estoque"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   3285
         Left            =   -67305
         TabIndex        =   183
         Top             =   6690
         Width           =   7695
         Begin MSComctlLib.ListView ListaMovimentacao 
            Height          =   2625
            Left            =   210
            TabIndex        =   104
            Top             =   300
            Width           =   7350
            _ExtentX        =   12965
            _ExtentY        =   4630
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   0   'False
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            SmallIcons      =   "ImageList1"
            ForeColor       =   -2147483640
            BackColor       =   16777215
            Appearance      =   1
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            NumItems        =   8
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Object.Tag             =   "N"
               Text            =   "ID"
               Object.Width           =   0
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   1
               Object.Tag             =   "N"
               Text            =   "RE"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   2
               Object.Tag             =   "D"
               Text            =   "Dt. retirada"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   3
               Object.Tag             =   "T"
               Text            =   "Lote"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   4
               Object.Tag             =   "T"
               Text            =   "Corrida"
               Object.Width           =   1923
            EndProperty
            BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   5
               Object.Tag             =   "T"
               Text            =   "Certificado"
               Object.Width           =   1923
            EndProperty
            BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   6
               Object.Tag             =   "N"
               Text            =   "Qtde. saída"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   7
               Object.Tag             =   "N"
               Text            =   "Qt. saída PÇ"
               Object.Width           =   0
            EndProperty
         End
      End
      Begin VB.CheckBox Chk_apont_simultaneo 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Apont. simultâneo"
         Enabled         =   0   'False
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000007&
         Height          =   195
         Left            =   -63840
         TabIndex        =   116
         Top             =   1200
         Width           =   1845
      End
      Begin VB.Frame Frame19 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   9.75
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   885
         Left            =   -63930
         TabIndex        =   205
         Top             =   1170
         Width           =   2055
         Begin VB.ComboBox Cmb_OS_apont_simult 
            Height          =   315
            Left            =   180
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   117
            ToolTipText     =   "Número da ordem de serviço apontada simultaneamente."
            Top             =   450
            Width           =   1680
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "OS"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   18
            Left            =   908
            TabIndex        =   206
            Top             =   270
            Width           =   225
         End
      End
      Begin VB.CheckBox Chk_reaproveitamento_tempo_prep 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Reapr. tempo prep."
         Enabled         =   0   'False
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   6.75
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H80000007&
         Height          =   195
         Left            =   -61800
         TabIndex        =   118
         Top             =   1230
         Width           =   1935
      End
      Begin VB.Frame Frame21 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   855
         Left            =   -61875
         TabIndex        =   207
         Top             =   1200
         Width           =   2325
         Begin VB.TextBox Txt_OS_reapr_tempo_prep 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   180
            Locked          =   -1  'True
            TabIndex        =   119
            TabStop         =   0   'False
            Text            =   "0"
            ToolTipText     =   "Número da ordem de serviço reaproveitada."
            Top             =   420
            Width           =   1920
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "OS"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   19
            Left            =   953
            TabIndex        =   208
            Top             =   210
            Width           =   225
         End
      End
      Begin VB.Frame Frame20 
         BackColor       =   &H00E0E0E0&
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   885
         Left            =   -74955
         TabIndex        =   168
         Top             =   2910
         Width           =   15375
         Begin VB.CheckBox chkOrdemRastreavel 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem Rastreável"
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   210
            Left            =   10980
            TabIndex        =   374
            Top             =   270
            Width           =   1725
         End
         Begin VB.CheckBox chkOSRastreavel 
            BackColor       =   &H00E0E0E0&
            Caption         =   "OS Rastreável"
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   210
            Left            =   10980
            TabIndex        =   373
            Top             =   540
            Width           =   1725
         End
         Begin VB.CheckBox Chk_carregar_bloqueado 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Carregar postos de trabalho bloqueados"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   195
            Left            =   150
            TabIndex        =   349
            TabStop         =   0   'False
            Top             =   0
            Width           =   2805
         End
         Begin VB.TextBox Txt_grupo_op 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   810
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   121
            TabStop         =   0   'False
            Text            =   "00"
            ToolTipText     =   "Grupo/operação."
            Top             =   510
            Width           =   1155
         End
         Begin VB.TextBox Txt_descricao_posto 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   2700
            Locked          =   -1  'True
            MaxLength       =   255
            TabIndex        =   122
            TabStop         =   0   'False
            ToolTipText     =   "Descrição do posto de trabalho."
            Top             =   510
            Width           =   7995
         End
         Begin VB.TextBox txtAPFase 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   60
            Locked          =   -1  'True
            TabIndex        =   120
            TabStop         =   0   'False
            Text            =   "00"
            ToolTipText     =   "Fase."
            Top             =   510
            Width           =   735
         End
         Begin DrawSuite2022.USButton btnNumeroSerie 
            Height          =   585
            Left            =   12900
            TabIndex        =   372
            ToolTipText     =   "Calcular tempo de execução"
            Top             =   180
            Width           =   2325
            _ExtentX        =   4101
            _ExtentY        =   1032
            DibPicture      =   "frmprod.frx":8E0D5
            Caption         =   "Numeros de série"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   5263559
            BorderColorDisabled=   13160660
            BorderColorDown =   4013465
            BorderColorOver =   4408288
            GradientColor1  =   5263559
            GradientColor2  =   5263559
            GradientColor3  =   5263559
            GradientColor4  =   5263559
            GradientColorDisabled1=   13160660
            GradientColorDisabled2=   13160660
            GradientColorDisabled3=   13160660
            GradientColorDisabled4=   13160660
            GradientColorOver1=   4408288
            GradientColorOver2=   4408288
            GradientColorOver3=   4408288
            GradientColorOver4=   4408288
            GradientColorDown1=   4013465
            GradientColorDown2=   4013465
            GradientColorDown3=   4013465
            GradientColorDown4=   4013465
            ShowFocusRect   =   0   'False
            Theme           =   4
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Descrição do posto de trabalho"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   84
            Left            =   5280
            TabIndex        =   289
            Top             =   300
            Width           =   2625
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Grupo/op."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   82
            Left            =   960
            TabIndex        =   288
            Top             =   300
            Width           =   855
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Fase"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   81
            Left            =   225
            TabIndex        =   287
            Top             =   300
            Width           =   390
         End
      End
      Begin VB.Frame Frame18 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Tempos previstos"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   885
         Left            =   -74940
         TabIndex        =   166
         Top             =   2040
         Width           =   7275
         Begin VB.TextBox txtPcHoraPrevista 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   2685
            Locked          =   -1  'True
            MaxLength       =   5
            TabIndex        =   125
            TabStop         =   0   'False
            Text            =   "1"
            ToolTipText     =   "Total de peças por tempo de execução previsto."
            Top             =   510
            Width           =   825
         End
         Begin VB.TextBox txtAPexecucao 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   1080
            Locked          =   -1  'True
            TabIndex        =   124
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo de execução previsto."
            Top             =   510
            Width           =   1395
         End
         Begin VB.TextBox txtAPpreparacao 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   30
            Locked          =   -1  'True
            TabIndex        =   123
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo de preparação previsto."
            Top             =   510
            Width           =   1395
         End
         Begin VB.TextBox txtAPtotal 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   5760
            Locked          =   -1  'True
            TabIndex        =   127
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo total previsto."
            Top             =   510
            Width           =   1485
         End
         Begin VB.TextBox TxtA3Prevista 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            Height          =   210
            Left            =   3960
            Locked          =   -1  'True
            TabIndex        =   126
            TabStop         =   0   'False
            Text            =   "00:00:00"
            Top             =   510
            Width           =   1665
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Total do lote"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   89
            Left            =   6060
            TabIndex        =   293
            Top             =   300
            Width           =   900
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Execução x unidade"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   88
            Left            =   4140
            TabIndex        =   292
            Top             =   300
            Width           =   1440
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Unidade(s) x exec."
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   87
            Left            =   2505
            TabIndex        =   291
            Top             =   300
            Width           =   1365
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Execução"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   86
            Left            =   1425
            TabIndex        =   290
            Top             =   300
            Width           =   690
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Preparação"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   21
            Left            =   315
            TabIndex        =   167
            Top             =   300
            Width           =   825
         End
      End
      Begin VB.Frame Frame7 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Tempos reais"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   885
         Left            =   -67650
         TabIndex        =   161
         Top             =   2040
         Width           =   8085
         Begin VB.TextBox txtPcHorareal 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   2895
            Locked          =   -1  'True
            MaxLength       =   5
            TabIndex        =   130
            TabStop         =   0   'False
            Text            =   "1"
            ToolTipText     =   "Total de peças por tempo de execução real."
            Top             =   510
            Width           =   945
         End
         Begin VB.TextBox TxtA3Real 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            Height          =   210
            Left            =   4500
            Locked          =   -1  'True
            TabIndex        =   131
            TabStop         =   0   'False
            Text            =   "00:00:00"
            Top             =   510
            Width           =   1215
         End
         Begin VB.TextBox txtTEUTIL 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   1380
            Locked          =   -1  'True
            TabIndex        =   129
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo de execução real."
            Top             =   510
            Width           =   1395
         End
         Begin VB.TextBox txtTPUTIL 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   120
            Locked          =   -1  'True
            TabIndex        =   128
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo de preparação real."
            Top             =   510
            Width           =   1095
         End
         Begin VB.TextBox txtTTReal 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BorderStyle     =   0  'None
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   315
            Left            =   6390
            Locked          =   -1  'True
            TabIndex        =   132
            TabStop         =   0   'False
            Text            =   "000:00:00"
            ToolTipText     =   "Tempo total real."
            Top             =   510
            Width           =   1635
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Tempo total"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   93
            Left            =   6750
            TabIndex        =   297
            Top             =   300
            Width           =   855
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Execução x Item"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   92
            Left            =   4500
            TabIndex        =   296
            Top             =   300
            Width           =   1200
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Unidade(s) x exec."
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   91
            Left            =   2925
            TabIndex        =   295
            Top             =   300
            Width           =   1365
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Execução"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   90
            Left            =   1725
            TabIndex        =   294
            Top             =   300
            Width           =   690
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Preparação"
            ForeColor       =   &H00C00000&
            Height          =   195
            Index           =   22
            Left            =   255
            TabIndex        =   162
            Top             =   300
            Width           =   825
         End
      End
      Begin VB.Frame Framedetalhes 
         BackColor       =   &H00E0E0E0&
         Caption         =   "Dados da ordem de serviço"
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H00000000&
         Height          =   7425
         Left            =   6510
         TabIndex        =   172
         Top             =   1290
         Width           =   8895
         Begin VB.CheckBox chkRastreavel 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem de serviço rastreável com lançamento de numero de série"
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   210
            Left            =   270
            TabIndex        =   371
            Top             =   5670
            Width           =   5655
         End
         Begin VB.CheckBox chk_QTFinalOS 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Liberar apontamento das quantidades no encerramento da OS."
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   195
            Left            =   270
            TabIndex        =   370
            ToolTipText     =   "Somente libera o apontamento das quantidades produzidas no encerramento da OS."
            Top             =   7080
            Width           =   5925
         End
         Begin VB.TextBox txtdescmaquina 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   2070
            Locked          =   -1  'True
            TabIndex        =   85
            TabStop         =   0   'False
            ToolTipText     =   "Descrição do posto de trabalho."
            Top             =   1195
            Width           =   6705
         End
         Begin VB.CheckBox Chk_sublinhado 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Sublinhado"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   -1  'True
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   195
            Left            =   7590
            TabIndex        =   363
            Top             =   2880
            Width           =   1245
         End
         Begin VB.CheckBox Chk_italico 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Itálico"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   -1  'True
               Strikethrough   =   0   'False
            EndProperty
            Height          =   195
            Left            =   6780
            TabIndex        =   362
            Top             =   2895
            Width           =   795
         End
         Begin VB.CheckBox Chk_negrito 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Negrito"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   195
            Left            =   5850
            TabIndex        =   361
            Top             =   2910
            Width           =   915
         End
         Begin VB.CheckBox Chk_agrega_custos_efic 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem de serviço agrega custos e eficiência a ordem de produção"
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000080&
            Height          =   210
            Left            =   270
            TabIndex        =   92
            Top             =   6513
            Width           =   5745
         End
         Begin VB.ComboBox Cmb_fonte 
            BackColor       =   &H00FFFFFF&
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   240
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   94
            ToolTipText     =   "Fonte."
            Top             =   2835
            Width           =   3165
         End
         Begin VB.ComboBox Cmb_tamanho_fonte 
            BackColor       =   &H00FFFFFF&
            ForeColor       =   &H00000000&
            Height          =   315
            ItemData        =   "frmprod.frx":9E999
            Left            =   3420
            List            =   "frmprod.frx":9E99B
            Style           =   2  'Dropdown List
            TabIndex        =   95
            ToolTipText     =   "Tamanho."
            Top             =   2835
            Width           =   735
         End
         Begin VB.PictureBox Cor_fonte 
            BackColor       =   &H00000000&
            Height          =   195
            Left            =   4230
            ScaleHeight     =   135
            ScaleWidth      =   135
            TabIndex        =   209
            Top             =   2880
            Visible         =   0   'False
            Width           =   195
         End
         Begin VB.TextBox txtVersao 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   1059
            Locked          =   -1  'True
            TabIndex        =   78
            ToolTipText     =   "Versão."
            Top             =   570
            Width           =   545
         End
         Begin VB.CheckBox ChkProcesso_controlado 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem de serviço pertence a um processo controlado"
            ForeColor       =   &H00000080&
            Height          =   195
            Left            =   270
            TabIndex        =   90
            Top             =   6237
            Width           =   4935
         End
         Begin VB.TextBox TxtOS_grupo_op 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   2187
            Locked          =   -1  'True
            TabIndex        =   80
            ToolTipText     =   "Grupo/operação."
            Top             =   570
            Width           =   935
         End
         Begin VB.CommandButton Cmd_abrir_instrucao 
            BackColor       =   &H00C0C0C0&
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   1935
            Left            =   8250
            Picture         =   "frmprod.frx":9E99D
            Style           =   1  'Graphical
            TabIndex        =   97
            ToolTipText     =   "Localizar instruções de trabalho."
            Top             =   3420
            Width           =   525
         End
         Begin VB.Frame Frame29 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Tempos para setup e execução"
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   885
            Left            =   180
            TabIndex        =   184
            Top             =   1710
            Width           =   8595
            Begin VB.CheckBox chkPchora 
               BackColor       =   &H00E0E0E0&
               Caption         =   "itens x T. de exec.?"
               ForeColor       =   &H00000080&
               Height          =   210
               Left            =   5490
               TabIndex        =   366
               Top             =   210
               Value           =   1  'Checked
               Width           =   1815
            End
            Begin VB.TextBox TxtA3 
               Alignment       =   2  'Center
               Appearance      =   0  'Flat
               BackColor       =   &H00E0E0E0&
               BorderStyle     =   0  'None
               Height          =   210
               Left            =   3765
               Locked          =   -1  'True
               TabIndex        =   88
               TabStop         =   0   'False
               Text            =   "00:00:00"
               Top             =   465
               Width           =   1305
            End
            Begin VB.TextBox txtPcHora 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   2535
               MaxLength       =   5
               TabIndex        =   87
               Text            =   "1"
               ToolTipText     =   "Total de peças por tempo de execução prevista."
               Top             =   420
               Width           =   1155
            End
            Begin MSMask.MaskEdBox txtpreparacao 
               BeginProperty DataFormat 
                  Type            =   1
                  Format          =   "H:mm:ss"
                  HaveTrueFalseNull=   0
                  FirstDayOfWeek  =   0
                  FirstWeekOfYear =   0
                  LCID            =   1046
                  SubFormatType   =   4
               EndProperty
               Height          =   315
               Left            =   120
               TabIndex        =   358
               ToolTipText     =   "Tempo de preparação previsto."
               Top             =   420
               Width           =   900
               _ExtentX        =   1588
               _ExtentY        =   556
               _Version        =   393216
               BackColor       =   16777215
               ForeColor       =   0
               AutoTab         =   -1  'True
               MaxLength       =   9
               MouseIcon       =   "frmprod.frx":9EA9F
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Mask            =   "###:##:##"
               PromptChar      =   "_"
            End
            Begin DrawSuite2022.USButton btnExe 
               Height          =   315
               Left            =   2010
               TabIndex        =   359
               ToolTipText     =   "Calcular tempo de execução"
               Top             =   420
               Width           =   375
               _ExtentX        =   661
               _ExtentY        =   556
               DibPicture      =   "frmprod.frx":9EDB9
               Caption         =   ""
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               BorderColor     =   5263559
               BorderColorDisabled=   13160660
               BorderColorDown =   4013465
               BorderColorOver =   4408288
               GradientColor1  =   5263559
               GradientColor2  =   5263559
               GradientColor3  =   5263559
               GradientColor4  =   5263559
               GradientColorDisabled1=   13160660
               GradientColorDisabled2=   13160660
               GradientColorDisabled3=   13160660
               GradientColorDisabled4=   13160660
               GradientColorOver1=   4408288
               GradientColorOver2=   4408288
               GradientColorOver3=   4408288
               GradientColorOver4=   4408288
               GradientColorDown1=   4013465
               GradientColorDown2=   4013465
               GradientColorDown3=   4013465
               GradientColorDown4=   4013465
               ShowFocusRect   =   0   'False
               Theme           =   4
            End
            Begin MSMask.MaskEdBox txtexecucao 
               BeginProperty DataFormat 
                  Type            =   1
                  Format          =   "H:mm:ss"
                  HaveTrueFalseNull=   0
                  FirstDayOfWeek  =   0
                  FirstWeekOfYear =   0
                  LCID            =   1046
                  SubFormatType   =   4
               EndProperty
               Height          =   315
               Left            =   1050
               TabIndex        =   360
               ToolTipText     =   "Tempo de execução previsto."
               Top             =   420
               Width           =   945
               _ExtentX        =   1667
               _ExtentY        =   556
               _Version        =   393216
               BackColor       =   16777215
               ForeColor       =   0
               AutoTab         =   -1  'True
               MaxLength       =   9
               MouseIcon       =   "frmprod.frx":9F31A
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Mask            =   "###:##:##"
               PromptChar      =   "_"
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H00C0C0C0&
               BackStyle       =   0  'Transparent
               Caption         =   "Execução x item"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   68
               Left            =   3795
               TabIndex        =   274
               Top             =   210
               Width           =   1410
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H00C0C0C0&
               BackStyle       =   0  'Transparent
               Caption         =   "Itens(s) x exec."
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   67
               Left            =   2535
               TabIndex        =   273
               Top             =   210
               Width           =   1155
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H00C0C0C0&
               BackStyle       =   0  'Transparent
               Caption         =   "Execução"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   66
               Left            =   1155
               TabIndex        =   272
               Top             =   210
               Width           =   690
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H00C0C0C0&
               BackStyle       =   0  'Transparent
               Caption         =   "Setup"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   14
               Left            =   330
               TabIndex        =   185
               Top             =   210
               Width           =   420
            End
         End
         Begin VB.TextBox TxtTempoTotal 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   4080
            Locked          =   -1  'True
            TabIndex        =   82
            ToolTipText     =   "Tempo total utilizado pela OS."
            Top             =   570
            Width           =   980
         End
         Begin VB.CheckBox chkControlada 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem de serviço com quantidades produzidas controladas"
            ForeColor       =   &H00000080&
            Height          =   195
            Left            =   270
            TabIndex        =   89
            Top             =   5961
            Width           =   5265
         End
         Begin VB.CheckBox chkRetrabalho 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Ordem de serviço destina-se ao um retrabalho da produção"
            ForeColor       =   &H00000080&
            Height          =   195
            Left            =   270
            TabIndex        =   91
            Top             =   6804
            Width           =   5625
         End
         Begin VB.TextBox txtStatus_OS 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   5085
            Locked          =   -1  'True
            MaxLength       =   20
            TabIndex        =   84
            TabStop         =   0   'False
            ToolTipText     =   "Status."
            Top             =   570
            Width           =   2460
         End
         Begin VB.TextBox TXTOS 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   210
            Locked          =   -1  'True
            TabIndex        =   77
            TabStop         =   0   'False
            ToolTipText     =   "Número da OS."
            Top             =   570
            Width           =   840
         End
         Begin VB.TextBox txtOSFase 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   315
            Left            =   1623
            Locked          =   -1  'True
            TabIndex        =   79
            ToolTipText     =   "Fase."
            Top             =   570
            Width           =   525
         End
         Begin VB.TextBox txtOSLote 
            Alignment       =   2  'Center
            Appearance      =   0  'Flat
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   3141
            Locked          =   -1  'True
            TabIndex        =   81
            ToolTipText     =   "Quantidade."
            Top             =   570
            Width           =   930
         End
         Begin MSComCtl2.DTPicker Cmb_prazo_os 
            Height          =   315
            Left            =   7590
            TabIndex        =   86
            ToolTipText     =   "Prazo final."
            Top             =   555
            Width           =   1185
            _ExtentX        =   2090
            _ExtentY        =   556
            _Version        =   393216
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            CalendarBackColor=   16777215
            CalendarForeColor=   0
            CalendarTitleBackColor=   8421504
            CalendarTitleForeColor=   16777215
            CalendarTrailingForeColor=   255
            Format          =   178257923
            CurrentDate     =   39057
         End
         Begin VB.CommandButton Cmd_cor 
            BackColor       =   &H00C0C0C0&
            Caption         =   "Cor"
            Height          =   315
            Left            =   4170
            Style           =   1  'Graphical
            TabIndex        =   96
            ToolTipText     =   "Mudar cor das instruções de trabalho."
            Top             =   2820
            Width           =   855
         End
         Begin MSComDlg.CommonDialog CommonDialog1 
            Left            =   2970
            Top             =   3570
            _ExtentX        =   847
            _ExtentY        =   847
            _Version        =   393216
         End
         Begin RichTextLib.RichTextBox txtDescricao 
            Height          =   1935
            Left            =   180
            TabIndex        =   93
            ToolTipText     =   "Instruções de trabalho."
            Top             =   3420
            Width           =   8055
            _ExtentX        =   14208
            _ExtentY        =   3413
            _Version        =   393217
            BorderStyle     =   0
            ScrollBars      =   2
            TextRTF         =   $"frmprod.frx":9F634
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Tamanho"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   69
            Left            =   3450
            TabIndex        =   275
            Top             =   2625
            Width           =   660
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Prazo final"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   65
            Left            =   7800
            TabIndex        =   271
            Top             =   360
            Width           =   750
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Status"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   64
            Left            =   6090
            TabIndex        =   270
            Top             =   360
            Width           =   465
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Posto de trabalho"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   63
            Left            =   360
            TabIndex        =   269
            Top             =   990
            Width           =   1275
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Tempo total"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   62
            Left            =   4140
            TabIndex        =   268
            Top             =   360
            Width           =   855
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Quantidade"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   61
            Left            =   3180
            TabIndex        =   267
            Top             =   360
            Width           =   840
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Grupo/op."
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   60
            Left            =   2280
            TabIndex        =   266
            Top             =   360
            Width           =   735
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Fase"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   59
            Left            =   1725
            TabIndex        =   265
            Top             =   360
            Width           =   345
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Versão"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   58
            Left            =   1080
            TabIndex        =   264
            Top             =   360
            Width           =   495
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Fonte"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   16
            Left            =   360
            TabIndex        =   210
            Top             =   2640
            Width           =   420
         End
         Begin VB.Label Label1 
            Alignment       =   1  'Right Justify
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Instruções de trabalho"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   15
            Left            =   315
            TabIndex        =   175
            Top             =   3210
            Width           =   1635
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   " OS"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   12
            Left            =   510
            TabIndex        =   174
            Top             =   360
            Width           =   255
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackColor       =   &H00C0C0C0&
            BackStyle       =   0  'Transparent
            Caption         =   "Descrição do posto de trabalho"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   13
            Left            =   4305
            TabIndex        =   173
            Top             =   990
            Width           =   2235
         End
      End
      Begin VB.Frame Frame1 
         BackColor       =   &H00E0E0E0&
         ForeColor       =   &H00000000&
         Height          =   615
         Index           =   2
         Left            =   -74925
         TabIndex        =   200
         Top             =   9360
         Width           =   15315
         Begin VB.ComboBox Cmb_opcao_lista 
            Appearance      =   0  'Flat
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   300
            ItemData        =   "frmprod.frx":9F6CE
            Left            =   6960
            List            =   "frmprod.frx":9F6D8
            Sorted          =   -1  'True
            Style           =   2  'Dropdown List
            TabIndex        =   1
            TabStop         =   0   'False
            Top             =   187
            Width           =   1965
         End
         Begin VB.TextBox txtNreg 
            Alignment       =   2  'Center
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   2730
            TabIndex        =   0
            Text            =   "30"
            ToolTipText     =   "Número de registros por página."
            Top             =   180
            Width           =   555
         End
         Begin VB.TextBox txtPagIr 
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   9540
            TabIndex        =   2
            ToolTipText     =   "Número da página."
            Top             =   180
            Width           =   555
         End
         Begin DrawSuite2022.USButton cmdPagProx 
            Height          =   315
            Left            =   11760
            TabIndex        =   6
            ToolTipText     =   "Próxima página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":9F6F5
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagAnt 
            Height          =   315
            Left            =   11220
            TabIndex        =   5
            ToolTipText     =   "Página anterior."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":A2E99
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagIr 
            Height          =   315
            Left            =   10110
            TabIndex        =   3
            Top             =   180
            Width           =   465
            _ExtentX        =   820
            _ExtentY        =   556
            Caption         =   "Ir"
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagPrim 
            Height          =   315
            Left            =   10680
            TabIndex        =   4
            ToolTipText     =   "Primeira página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":A69A2
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin DrawSuite2022.USButton cmdPagUlt 
            Height          =   315
            Left            =   12300
            TabIndex        =   7
            ToolTipText     =   "Última página."
            Top             =   180
            Width           =   525
            _ExtentX        =   926
            _ExtentY        =   556
            DibPicture      =   "frmprod.frx":AAA91
            Caption         =   ""
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            BorderColor     =   14404026
            BorderColorDown =   11632444
            BorderColorOver =   11632444
            GradientColor2  =   16777215
            GradientColor3  =   16777215
            GradientColorOver1=   16643560
            GradientColorOver2=   16576988
            GradientColorOver3=   16441780
            GradientColorOver4=   16178091
            GradientColorDown2=   16246986
            GradientColorDown3=   15189380
            GradientColorDown4=   14596208
            PicSizeH        =   19
            PicSizeW        =   19
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "registros por página"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   35
            Left            =   3360
            TabIndex        =   242
            Top             =   240
            Width           =   1440
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Operação da lista"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   34
            Left            =   5610
            TabIndex        =   219
            Top             =   240
            Width           =   1260
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Carregar"
            ForeColor       =   &H00000000&
            Height          =   195
            Index           =   33
            Left            =   2040
            TabIndex        =   213
            Top             =   240
            Width           =   645
         End
         Begin VB.Label lblRegistros 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Nº de registros: 0"
            ForeColor       =   &H00000000&
            Height          =   195
            Left            =   180
            TabIndex        =   202
            Top             =   240
            Width           =   1275
         End
         Begin VB.Label lblPaginas 
            AutoSize        =   -1  'True
            BackStyle       =   0  'Transparent
            Caption         =   "Página: 0 de: 0"
            ForeColor       =   &H00000000&
            Height          =   195
            Left            =   13050
            TabIndex        =   201
            Top             =   240
            Width           =   1095
         End
      End
      Begin DrawSuite2022.USToolBar USToolBar5 
         Height          =   975
         Left            =   -74925
         TabIndex        =   199
         Top             =   330
         Width           =   15345
         _ExtentX        =   27067
         _ExtentY        =   1720
         ButtonCount     =   10
         GradientColor2  =   14737632
         GradientColorOverRight1=   16315633
         GradientColorOverRight2=   15195350
         GripperColor    =   15195350
         IsStrech        =   -1  'True
         RightColor1     =   0
         RightColor2     =   0
         ShowEndPanel    =   0   'False
         Theme           =   1
         ButtonCaption1  =   "Relatório"
         ButtonEnabled1  =   0   'False
         ButtonIconSize1 =   32
         ButtonToolTipText1=   "Relatório (F5)"
         ButtonKey1      =   "1"
         ButtonAlignment1=   2
         BeginProperty ButtonFont1 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft1     =   2
         ButtonTop1      =   2
         ButtonWidth1    =   60
         ButtonHeight1   =   21
         ButtonUseMaskColor1=   0   'False
         ButtonCaption2  =   "Anterior"
         ButtonEnabled2  =   0   'False
         ButtonIconSize2 =   32
         ButtonToolTipText2=   "Registro anterior."
         ButtonKey2      =   "2"
         ButtonAlignment2=   2
         BeginProperty ButtonFont2 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft2     =   64
         ButtonTop2      =   2
         ButtonWidth2    =   55
         ButtonHeight2   =   21
         ButtonUseMaskColor2=   0   'False
         ButtonCaption3  =   "Próximo"
         ButtonEnabled3  =   0   'False
         ButtonIconSize3 =   32
         ButtonToolTipText3=   "Próximo registro."
         ButtonKey3      =   "3"
         ButtonAlignment3=   2
         BeginProperty ButtonFont3 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft3     =   121
         ButtonTop3      =   2
         ButtonWidth3    =   55
         ButtonHeight3   =   21
         ButtonUseMaskColor3=   0   'False
         ButtonCaption4  =   "Custos"
         ButtonEnabled4  =   0   'False
         ButtonIconSize4 =   32
         ButtonToolTipText4=   "Visualizar custos detalhado (F9)"
         ButtonKey4      =   "4"
         ButtonAlignment4=   2
         BeginProperty ButtonFont4 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft4     =   178
         ButtonTop4      =   2
         ButtonWidth4    =   41
         ButtonHeight4   =   21
         ButtonUseMaskColor4=   0   'False
         ButtonCaption5  =   "Atualizar ordem"
         ButtonEnabled5  =   0   'False
         ButtonIconSize5 =   32
         ButtonToolTipText5=   "Atualizar dados da ordem."
         ButtonKey5      =   "5"
         ButtonAlignment5=   2
         BeginProperty ButtonFont5 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft5     =   221
         ButtonTop5      =   2
         ButtonWidth5    =   83
         ButtonHeight5   =   21
         ButtonUseMaskColor5=   0   'False
         ButtonCaption6  =   "Validação"
         ButtonEnabled6  =   0   'False
         ButtonIconSize6 =   32
         ButtonToolTipText6=   "Validar/Cancelar validação."
         ButtonKey6      =   "6"
         ButtonAlignment6=   2
         BeginProperty ButtonFont6 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft6     =   306
         ButtonTop6      =   2
         ButtonWidth6    =   53
         ButtonHeight6   =   21
         ButtonUseMaskColor6=   0   'False
         ButtonEnabled7  =   0   'False
         ButtonIconSize7 =   32
         ButtonAlignment7=   2
         ButtonType7     =   1
         ButtonStyle7    =   -1
         BeginProperty ButtonFont7 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState7    =   -1
         ButtonLeft7     =   361
         ButtonTop7      =   4
         ButtonWidth7    =   2
         ButtonHeight7   =   54
         ButtonCaption8  =   "Ajuda"
         ButtonEnabled8  =   0   'False
         ButtonIconSize8 =   32
         ButtonToolTipText8=   "Ajuda (F1)"
         ButtonKey8      =   "8"
         ButtonAlignment8=   2
         BeginProperty ButtonFont8 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft8     =   365
         ButtonTop8      =   2
         ButtonWidth8    =   41
         ButtonHeight8   =   21
         ButtonUseMaskColor8=   0   'False
         ButtonCaption9  =   "Sair"
         ButtonEnabled9  =   0   'False
         ButtonIconSize9 =   32
         ButtonToolTipText9=   "Sair (Esc)"
         ButtonKey9      =   "9"
         ButtonAlignment9=   2
         BeginProperty ButtonFont9 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonLeft9     =   408
         ButtonTop9      =   2
         ButtonWidth9    =   30
         ButtonHeight9   =   21
         ButtonUseMaskColor9=   0   'False
         ButtonEnabled10 =   0   'False
         ButtonIconSize10=   32
         ButtonKey10     =   "10"
         ButtonAlignment10=   2
         BeginProperty ButtonFont10 {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ButtonState10   =   5
         ButtonLeft10    =   440
         ButtonTop10     =   2
         ButtonWidth10   =   24
         ButtonHeight10  =   24
         ButtonUseMaskColor10=   0   'False
      End
      Begin TabDlg.SSTab SSTab2 
         Height          =   8715
         Left            =   -74910
         TabIndex        =   187
         Top             =   1320
         Width           =   15345
         _ExtentX        =   27067
         _ExtentY        =   15372
         _Version        =   393216
         Tabs            =   2
         TabsPerRow      =   2
         TabHeight       =   520
         TabCaption(0)   =   "Dados da ordem"
         TabPicture(0)   =   "frmprod.frx":AE31D
         Tab(0).ControlEnabled=   -1  'True
         Tab(0).Control(0)=   "Frame30"
         Tab(0).Control(0).Enabled=   0   'False
         Tab(0).Control(1)=   "Frame1(0)"
         Tab(0).Control(1).Enabled=   0   'False
         Tab(0).Control(2)=   "Frame12"
         Tab(0).Control(2).Enabled=   0   'False
         Tab(0).Control(3)=   "Frame17"
         Tab(0).Control(3).Enabled=   0   'False
         Tab(0).ControlCount=   4
         TabCaption(1)   =   "Empenhos"
         TabPicture(1)   =   "frmprod.frx":AE339
         Tab(1).ControlEnabled=   0   'False
         Tab(1).Control(0)=   "Lista_pedidos"
         Tab(1).Control(1)=   "Frame3"
         Tab(1).ControlCount=   2
         Begin VB.Frame Frame17 
            BackColor       =   &H00E0E0E0&
            Caption         =   "Movimen. automática"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   480
            Left            =   13440
            TabIndex        =   236
            Top             =   330
            Width           =   1845
            Begin VB.CheckBox Chk_entrar_estoque 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Entrada"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000080&
               Height          =   195
               Left            =   150
               TabIndex        =   70
               Top             =   210
               Width           =   765
            End
            Begin VB.CheckBox Chk_retirar_estoque 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Saída"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000080&
               Height          =   195
               Left            =   1080
               TabIndex        =   71
               Top             =   210
               Width           =   705
            End
         End
         Begin VB.Frame Frame3 
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "MS Sans Serif"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   855
            Left            =   -74925
            TabIndex        =   223
            Top             =   3300
            Width           =   15045
            Begin VB.TextBox Txt_qtde_total_produzindo 
               Alignment       =   1  'Right Justify
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   9540
               Locked          =   -1  'True
               TabIndex        =   73
               TabStop         =   0   'False
               ToolTipText     =   "Quantidade total produzindo."
               Top             =   420
               Width           =   1575
            End
            Begin VB.TextBox Txt_qtde_total_emp_produzindo 
               Alignment       =   1  'Right Justify
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   11370
               Locked          =   -1  'True
               TabIndex        =   74
               TabStop         =   0   'False
               ToolTipText     =   "Quatidade total empenhada."
               Top             =   420
               Width           =   1575
            End
            Begin VB.TextBox Txt_qtde_total_disp_produzindo 
               Alignment       =   1  'Right Justify
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   13260
               Locked          =   -1  'True
               TabIndex        =   75
               TabStop         =   0   'False
               ToolTipText     =   "Quantidade disponível."
               Top             =   420
               Width           =   1575
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Qtde. disponível"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   57
               Left            =   13372
               TabIndex        =   263
               Top             =   210
               Width           =   1350
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Qtde. empenhada"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   56
               Left            =   11407
               TabIndex        =   262
               Top             =   210
               Width           =   1500
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "-                                       ="
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   26
               Left            =   11190
               TabIndex        =   226
               Top             =   480
               Width           =   1965
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   121
               Left            =   0
               TabIndex        =   225
               Top             =   0
               Width           =   75
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Qtde. produzindo"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   25
               Left            =   9600
               TabIndex        =   224
               Top             =   210
               Width           =   1440
            End
         End
         Begin MSComctlLib.ListView Lista_pedidos 
            Height          =   2955
            Left            =   -74925
            TabIndex        =   72
            Top             =   360
            Width           =   15045
            _ExtentX        =   26538
            _ExtentY        =   5212
            View            =   3
            LabelEdit       =   1
            LabelWrap       =   -1  'True
            HideSelection   =   0   'False
            Checkboxes      =   -1  'True
            FullRowSelect   =   -1  'True
            GridLines       =   -1  'True
            _Version        =   393217
            ForeColor       =   0
            BackColor       =   16777215
            Appearance      =   1
            BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
               Name            =   "Tahoma"
               Size            =   6.75
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            NumItems        =   18
            BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Object.Tag             =   "N"
               Object.Width           =   529
            EndProperty
            BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   1
               Object.Tag             =   "N"
               Text            =   "Cód. cart."
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   2
               Object.Tag             =   "N"
               Text            =   "Ped. int./SPR"
               Object.Width           =   2028
            EndProperty
            BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   3
               Object.Tag             =   "N"
               Text            =   "Rev."
               Object.Width           =   882
            EndProperty
            BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   4
               Object.Tag             =   "T"
               Text            =   "Cliente"
               Object.Width           =   2297
            EndProperty
            BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   5
               Object.Tag             =   "T"
               Text            =   "Cód. int."
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   6
               Object.Tag             =   "T"
               Text            =   "Rev."
               Object.Width           =   882
            EndProperty
            BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   7
               Object.Tag             =   "T"
               Text            =   "Cod. ref."
               Object.Width           =   1499
            EndProperty
            BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   8
               Object.Tag             =   "T"
               Text            =   "Descrição"
               Object.Width           =   2914
            EndProperty
            BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   9
               Object.Tag             =   "N"
               Text            =   "Ordem"
               Object.Width           =   1411
            EndProperty
            BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   10
               Object.Tag             =   "N"
               Text            =   "Qtde. emp."
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(12) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   11
               Object.Tag             =   "N"
               Text            =   "Qtde. ent."
               Object.Width           =   1499
            EndProperty
            BeginProperty ColumnHeader(13) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   1
               SubItemIndex    =   12
               Object.Tag             =   "N"
               Text            =   "Saldo"
               Object.Width           =   1499
            EndProperty
            BeginProperty ColumnHeader(14) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               Alignment       =   2
               SubItemIndex    =   13
               Object.Tag             =   "D"
               Text            =   "Pr. final"
               Object.Width           =   1464
            EndProperty
            BeginProperty ColumnHeader(15) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   14
               Object.Tag             =   "T"
               Text            =   "Tipo"
               Object.Width           =   0
            EndProperty
            BeginProperty ColumnHeader(16) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   15
               Object.Tag             =   "T"
               Text            =   "Ped. cliente"
               Object.Width           =   1587
            EndProperty
            BeginProperty ColumnHeader(17) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   16
               Object.Tag             =   "T"
               Text            =   "N. item"
               Object.Width           =   1147
            EndProperty
            BeginProperty ColumnHeader(18) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
               SubItemIndex    =   17
               Object.Tag             =   "T"
               Text            =   "Status"
               Object.Width           =   1764
            EndProperty
         End
         Begin VB.Frame Frame12 
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Arial"
               Size            =   6.75
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   480
            Left            =   75
            TabIndex        =   195
            Top             =   330
            Width           =   13365
            Begin VB.CheckBox chkQT_Final 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Quant. final O.S"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000080&
               Height          =   195
               Left            =   11730
               TabIndex        =   369
               ToolTipText     =   "Somente libera lançamento das quantidades produzidas no encerramento da  ordem de serviço em todas as OS."
               Top             =   210
               Width           =   1365
            End
            Begin VB.CheckBox Chk_impressa 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Impressa"
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H80000007&
               Height          =   240
               Left            =   9450
               TabIndex        =   368
               Top             =   180
               Width           =   885
            End
            Begin VB.CheckBox chkIndividual 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Rast. individual"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000080&
               Height          =   195
               Left            =   10350
               TabIndex        =   69
               Top             =   210
               Width           =   1275
            End
            Begin VB.CheckBox Opt_servico 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Serviço"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   3375
               TabIndex        =   63
               Top             =   210
               Width           =   765
            End
            Begin VB.CheckBox OptReposicao 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Reposição"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   8520
               TabIndex        =   68
               Top             =   210
               Width           =   915
            End
            Begin VB.CheckBox Chk_urgente 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Urgente"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H80000007&
               Height          =   195
               Left            =   4155
               TabIndex        =   64
               Top             =   210
               Width           =   795
            End
            Begin VB.CheckBox OptOSControlada 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Controlada"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Left            =   6000
               TabIndex        =   66
               Top             =   210
               Width           =   975
            End
            Begin VB.CheckBox optconsignacao 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Consignada"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   4965
               TabIndex        =   65
               Top             =   210
               Width           =   1035
            End
            Begin VB.CheckBox Opt_subconjunto 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Subconjunto"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   1200
               TabIndex        =   61
               Top             =   210
               Width           =   1065
            End
            Begin VB.CheckBox Opt_produto_final 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Produto final"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   90
               TabIndex        =   60
               Top             =   210
               Width           =   1275
            End
            Begin VB.CheckBox Opt_componente 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Componente"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   195
               Left            =   2265
               TabIndex        =   62
               Top             =   210
               Width           =   1095
            End
            Begin VB.CheckBox Opt_processo_controlado 
               BackColor       =   &H00E0E0E0&
               Caption         =   "Processo controlado"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   6.75
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Left            =   6990
               TabIndex        =   67
               Top             =   210
               Width           =   1545
            End
         End
         Begin VB.Frame Frame1 
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   2505
            Index           =   0
            Left            =   75
            TabIndex        =   188
            Top             =   810
            Width           =   15225
            Begin VB.TextBox TxtUN 
               Alignment       =   2  'Center
               BackColor       =   &H00C0C0FF&
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   9510
               MaxLength       =   9
               TabIndex        =   355
               ToolTipText     =   "Código do cliente."
               Top             =   975
               Width           =   585
            End
            Begin VB.TextBox txtdata 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   4730
               Locked          =   -1  'True
               MaxLength       =   50
               TabIndex        =   22
               TabStop         =   0   'False
               ToolTipText     =   "Data do cadastro."
               Top             =   390
               Width           =   795
            End
            Begin VB.TextBox txtDtValidacao 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   8720
               Locked          =   -1  'True
               TabIndex        =   24
               TabStop         =   0   'False
               ToolTipText     =   "Data e hora da validação."
               Top             =   390
               Width           =   1755
            End
            Begin VB.TextBox txtRespValidacao 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   10490
               Locked          =   -1  'True
               TabIndex        =   25
               TabStop         =   0   'False
               ToolTipText     =   "Responsável pela validação."
               Top             =   390
               Width           =   3060
            End
            Begin VB.ComboBox Cmb_empresa 
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   330
               Left            =   180
               Sorted          =   -1  'True
               Style           =   2  'Dropdown List
               TabIndex        =   21
               ToolTipText     =   "Empresa."
               Top             =   390
               Width           =   4535
            End
            Begin VB.CommandButton cmdcodordem 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   14820
               Picture         =   "frmprod.frx":AE355
               Style           =   1  'Graphical
               TabIndex        =   39
               ToolTipText     =   "Filtrar por status."
               Top             =   975
               Width           =   315
            End
            Begin VB.CommandButton cmdordem 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   1440
               Picture         =   "frmprod.frx":AE770
               Style           =   1  'Graphical
               TabIndex        =   28
               ToolTipText     =   "Filtrar por número."
               Top             =   975
               Width           =   315
            End
            Begin VB.CommandButton cmdfiltro_prazo 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   11340
               Picture         =   "frmprod.frx":AEB8B
               Style           =   1  'Graphical
               TabIndex        =   35
               ToolTipText     =   "Filtrar por prazo final."
               Top             =   975
               Width           =   315
            End
            Begin VB.TextBox txtof 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   180
               MaxLength       =   10
               TabIndex        =   27
               ToolTipText     =   "Número da ordem."
               Top             =   975
               Width           =   1245
            End
            Begin VB.TextBox txtquantidade 
               Alignment       =   2  'Center
               BackColor       =   &H00C0C0FF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   8505
               MaxLength       =   20
               TabIndex        =   33
               ToolTipText     =   "Quantidade de peças para produzir."
               Top             =   975
               Width           =   990
            End
            Begin VB.CommandButton cmdConcluida 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   12735
               Picture         =   "frmprod.frx":AEFA6
               Style           =   1  'Graphical
               TabIndex        =   37
               ToolTipText     =   "Filtrar por data de conclusão."
               Top             =   960
               Width           =   315
            End
            Begin VB.ComboBox CmbStatus 
               Appearance      =   0  'Flat
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   330
               ItemData        =   "frmprod.frx":AF3C1
               Left            =   13080
               List            =   "frmprod.frx":AF3DA
               TabIndex        =   38
               ToolTipText     =   "Status."
               Top             =   975
               Width           =   1725
            End
            Begin VB.TextBox Txt_obs 
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   795
               Left            =   180
               MaxLength       =   1500
               MultiLine       =   -1  'True
               ScrollBars      =   2  'Vertical
               TabIndex        =   40
               ToolTipText     =   "Observações."
               Top             =   1560
               Width           =   13215
            End
            Begin VB.TextBox txtconcluida 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   11655
               Locked          =   -1  'True
               MaxLength       =   20
               TabIndex        =   36
               TabStop         =   0   'False
               ToolTipText     =   "Data de conclusão."
               Top             =   975
               Width           =   1065
            End
            Begin VB.TextBox txtResponsavel 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   5540
               Locked          =   -1  'True
               MaxLength       =   50
               TabIndex        =   23
               TabStop         =   0   'False
               ToolTipText     =   "Responsável."
               Top             =   390
               Width           =   3160
            End
            Begin VB.TextBox Txt_ID_cliente 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   1860
               MaxLength       =   9
               TabIndex        =   29
               ToolTipText     =   "Código do cliente."
               Top             =   975
               Width           =   795
            End
            Begin VB.CommandButton Cmdlocalizarcli 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   8160
               Picture         =   "frmprod.frx":AF42C
               Style           =   1  'Graphical
               TabIndex        =   32
               ToolTipText     =   "Localizar clientes."
               Top             =   975
               Width           =   315
            End
            Begin VB.TextBox txtcliente 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   2670
               Locked          =   -1  'True
               MaxLength       =   255
               TabIndex        =   30
               TabStop         =   0   'False
               ToolTipText     =   "Cliente."
               Top             =   975
               Width           =   5160
            End
            Begin VB.CommandButton cmdfiltro_cliente 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   7845
               Picture         =   "frmprod.frx":AF52E
               Style           =   1  'Graphical
               TabIndex        =   31
               ToolTipText     =   "Filtrar por cliente."
               Top             =   975
               Width           =   315
            End
            Begin MSComCtl2.DTPicker mskprazofina 
               Height          =   315
               Left            =   10110
               TabIndex        =   34
               ToolTipText     =   "Prazo final."
               Top             =   975
               Width           =   1215
               _ExtentX        =   2143
               _ExtentY        =   556
               _Version        =   393216
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               CalendarBackColor=   16777215
               CalendarForeColor=   0
               CalendarTitleBackColor=   8421504
               CalendarTitleForeColor=   16777215
               CalendarTrailingForeColor=   255
               Format          =   138543107
               CurrentDate     =   39057
            End
            Begin MSComCtl2.DTPicker txtData_emissao 
               Height          =   315
               Left            =   13560
               TabIndex        =   26
               ToolTipText     =   "Data de emissão."
               Top             =   390
               Width           =   1245
               _ExtentX        =   2196
               _ExtentY        =   556
               _Version        =   393216
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               CalendarBackColor=   16777215
               CalendarForeColor=   0
               CalendarTitleBackColor=   8421504
               CalendarTitleForeColor=   16777215
               CalendarTrailingForeColor=   255
               Format          =   138543107
               CurrentDate     =   39057
            End
            Begin DrawSuite2022.USButton cmdEncerrarordem 
               Height          =   1005
               Left            =   13470
               TabIndex        =   321
               Top             =   1380
               Width           =   1695
               _ExtentX        =   2990
               _ExtentY        =   1773
               DibPicture      =   "frmprod.frx":AF949
               Caption         =   "Encerrar ordem de produção"
               BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               BorderColor     =   5263559
               BorderColorDisabled=   13160660
               BorderColorDown =   4013465
               BorderColorOver =   4408288
               GradientColor1  =   5263559
               GradientColor2  =   5263559
               GradientColor3  =   5263559
               GradientColor4  =   5263559
               GradientColorDisabled1=   13160660
               GradientColorDisabled2=   13160660
               GradientColorDisabled3=   13160660
               GradientColorDisabled4=   13160660
               GradientColorOver1=   4408288
               GradientColorOver2=   4408288
               GradientColorOver3=   4408288
               GradientColorOver4=   4408288
               GradientColorDown1=   4013465
               GradientColorDown2=   4013465
               GradientColorDown3=   4013465
               GradientColorDown4=   4013465
               PicAlign        =   7
               PicSize         =   3
               PicSizeH        =   32
               PicSizeW        =   32
               Theme           =   4
            End
            Begin VB.Label Label1 
               Alignment       =   2  'Center
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Un"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   23
               Left            =   9705
               TabIndex        =   356
               Top             =   780
               Width           =   195
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Status"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   51
               Left            =   13710
               TabIndex        =   257
               Top             =   780
               Width           =   465
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Dt. conclusão"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   50
               Left            =   11715
               TabIndex        =   256
               Top             =   780
               Width           =   975
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Prazo final"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   49
               Left            =   10335
               TabIndex        =   255
               Top             =   780
               Width           =   750
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Quantidade"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   48
               Left            =   8580
               TabIndex        =   254
               Top             =   780
               Width           =   840
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Cliente"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   47
               Left            =   5003
               TabIndex        =   253
               Top             =   780
               Width           =   495
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Dt. emissão"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   46
               Left            =   13860
               TabIndex        =   252
               Top             =   180
               Width           =   840
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Responsável pela validação"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   45
               Left            =   11075
               TabIndex        =   251
               Top             =   180
               Width           =   1980
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Data/hora validação"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   44
               Left            =   8870
               TabIndex        =   250
               Top             =   180
               Width           =   1455
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Responsável"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   43
               Left            =   6663
               TabIndex        =   249
               Top             =   180
               Width           =   915
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Ordem"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   9
               Left            =   517
               TabIndex        =   235
               Top             =   780
               Width           =   570
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackStyle       =   0  'Transparent
               Caption         =   "Empresa"
               BeginProperty Font 
                  Name            =   "Tahoma"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   700
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   6
               Left            =   2080
               TabIndex        =   212
               Top             =   180
               Width           =   735
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Observações"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   10
               Left            =   6315
               TabIndex        =   211
               Top             =   1350
               Width           =   945
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Data"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   7
               Left            =   4955
               TabIndex        =   190
               Top             =   180
               Width           =   345
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "ID"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   8
               Left            =   2175
               TabIndex        =   189
               Top             =   780
               Width           =   165
            End
         End
         Begin VB.Frame Frame30 
            BackColor       =   &H00E0E0E0&
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   700
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            ForeColor       =   &H00000000&
            Height          =   855
            Left            =   75
            TabIndex        =   191
            Top             =   3330
            Width           =   15225
            Begin VB.CommandButton cmdreferencia 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   4710
               Picture         =   "frmprod.frx":B1C6F
               Style           =   1  'Graphical
               TabIndex        =   45
               ToolTipText     =   "Filtrar por código de referência."
               Top             =   390
               Width           =   315
            End
            Begin VB.CommandButton cmdfiltro_item 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   1860
               Picture         =   "frmprod.frx":B208A
               Style           =   1  'Graphical
               TabIndex        =   43
               ToolTipText     =   "Filtrar por código interno."
               Top             =   390
               Width           =   315
            End
            Begin VB.CommandButton cmdfiltro_componente 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   12000
               Picture         =   "frmprod.frx":B24A5
               Style           =   1  'Graphical
               TabIndex        =   47
               ToolTipText     =   "Filtrar por descrição."
               Top             =   390
               Width           =   315
            End
            Begin VB.TextBox txtProduto 
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   5130
               TabIndex        =   46
               ToolTipText     =   "Descrição."
               Top             =   390
               Width           =   6855
            End
            Begin VB.TextBox txtRevitem 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   1410
               Locked          =   -1  'True
               TabIndex        =   42
               TabStop         =   0   'False
               ToolTipText     =   "Revisão."
               Top             =   390
               Width           =   435
            End
            Begin VB.TextBox txtDesenho 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   180
               TabIndex        =   41
               ToolTipText     =   "Código interno."
               Top             =   390
               Width           =   1215
            End
            Begin VB.TextBox Txt_cod_prod 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   12405
               TabIndex        =   48
               ToolTipText     =   "Código interno."
               Top             =   390
               Width           =   1665
            End
            Begin VB.TextBox Txt_rev_cod_prod 
               Alignment       =   2  'Center
               BackColor       =   &H00FFFFFF&
               Enabled         =   0   'False
               BeginProperty Font 
                  Name            =   "Arial"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               ForeColor       =   &H00000000&
               Height          =   315
               Left            =   14085
               Locked          =   -1  'True
               TabIndex        =   49
               TabStop         =   0   'False
               ToolTipText     =   "Revisão."
               Top             =   390
               Width           =   435
            End
            Begin VB.CommandButton Cmd_filtrar_cod_prod 
               Appearance      =   0  'Flat
               BackColor       =   &H00C0C0C0&
               BeginProperty Font 
                  Name            =   "MS Sans Serif"
                  Size            =   8.25
                  Charset         =   0
                  Weight          =   400
                  Underline       =   0   'False
                  Italic          =   0   'False
                  Strikethrough   =   0   'False
               EndProperty
               Height          =   315
               Left            =   14535
               Picture         =   "frmprod.frx":B28C0
               Style           =   1  'Graphical
               TabIndex        =   50
               ToolTipText     =   "Filtrar por código interno."
               Top             =   390
               Width           =   315
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Rev."
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   55
               Left            =   14130
               TabIndex        =   261
               Top             =   180
               Width           =   345
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Descrição"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   54
               Left            =   8212
               TabIndex        =   260
               Top             =   180
               Width           =   690
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Cod. de referência"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   53
               Left            =   2910
               TabIndex        =   259
               Top             =   180
               Width           =   1350
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Rev."
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   52
               Left            =   1455
               TabIndex        =   258
               Top             =   180
               Width           =   345
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Cód. produto"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   1
               Left            =   12757
               TabIndex        =   196
               Top             =   180
               Width           =   960
            End
            Begin VB.Label Label1 
               AutoSize        =   -1  'True
               BackColor       =   &H8000000A&
               BackStyle       =   0  'Transparent
               Caption         =   "Cód. interno"
               ForeColor       =   &H00000000&
               Height          =   195
               Index           =   11
               Left            =   337
               TabIndex        =   192
               Top             =   180
               Width           =   900
            End
         End
      End
      Begin MSComctlLib.ListView APLista 
         Height          =   5295
         Left            =   -74940
         TabIndex        =   133
         Top             =   4680
         Width           =   15345
         _ExtentX        =   27067
         _ExtentY        =   9340
         View            =   3
         LabelEdit       =   1
         LabelWrap       =   -1  'True
         HideSelection   =   0   'False
         AllowReorder    =   -1  'True
         FullRowSelect   =   -1  'True
         _Version        =   393217
         SmallIcons      =   "ImageList1"
         ForeColor       =   -2147483640
         BackColor       =   16777215
         Appearance      =   1
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         NumItems        =   11
         BeginProperty ColumnHeader(1) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Object.Tag             =   "N"
            Text            =   "IDProducao"
            Object.Width           =   0
         EndProperty
         BeginProperty ColumnHeader(2) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   1
            Object.Tag             =   "N"
            Text            =   "Cód."
            Object.Width           =   1058
         EndProperty
         BeginProperty ColumnHeader(3) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   2
            Object.Tag             =   "T"
            Text            =   "Descrição"
            Object.Width           =   8467
         EndProperty
         BeginProperty ColumnHeader(4) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   3
            Object.Tag             =   "D"
            Text            =   "Início"
            Object.Width           =   2822
         EndProperty
         BeginProperty ColumnHeader(5) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   4
            Object.Tag             =   "D"
            Text            =   "Final"
            Object.Width           =   2822
         EndProperty
         BeginProperty ColumnHeader(6) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   5
            Object.Tag             =   "D"
            Text            =   "Tempo total"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(7) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   6
            Object.Tag             =   "T"
            Text            =   "Operador"
            Object.Width           =   2646
         EndProperty
         BeginProperty ColumnHeader(8) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   7
            Object.Tag             =   "N"
            Text            =   "Qtde. aprov."
            Object.Width           =   2117
         EndProperty
         BeginProperty ColumnHeader(9) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   8
            Object.Tag             =   "N"
            Text            =   "Qtde. NC"
            Object.Width           =   1940
         EndProperty
         BeginProperty ColumnHeader(10) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            Alignment       =   2
            SubItemIndex    =   9
            Object.Tag             =   "T"
            Text            =   "Pronta"
            Object.Width           =   1587
         EndProperty
         BeginProperty ColumnHeader(11) {BDD1F052-858B-11D1-B16A-00C0F0283628} 
            SubItemIndex    =   10
            Text            =   "Data"
            Object.Width           =   0
         EndProperty
      End
   End
End
Attribute VB_Name = "frmprod"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False

Dim CODIGO                    As String 'OK
Dim TBLISTA_Ordem             As ADODB.Recordset
Dim TBLISTA_Ordem1            As ADODB.Recordset

'Váriaveis Gerprod
Dim UltimoDesc                As String 'OK
Dim UltimoMaq                 As String 'OK
Dim PenultimoDesc             As String 'OK
Dim PenultimoMaq              As String 'OK
Dim TempoUtilizadoDescricao   As Date 'OK

Dim CFase                     As String 'OK
Dim EventoAP                  As String 'OK
Public Leadtime               As Integer 'OK
Dim QuantProd                 As Double 'OK
Dim Turno                     As Integer 'OK
Dim TurnoMaq                  As Integer 'OK
Dim Fase                      As Integer 'OK
Dim IDOperador                As Long 'OK
Dim TotalEstoque              As Double 'OK
Dim TotalRequisitado          As Double 'OK
Public IDProducao             As Long 'OK
Dim TotalQuant                As Double 'OK
Dim QtdeAntigaAP              As Double 'OK
Public ExcluiSel              As Boolean 'OK
Public Consignacao            As Boolean 'OK
Public Validacao              As Boolean 'OK
Public Individual             As Boolean 'OK

Dim qtdeOK As Double
Dim qtdeNC As Double

Public MRP_Imprimir_Ordem         As Boolean 'OK
Public MRP_Imprimir_Ordem_RM      As Boolean 'OK
Public MRP_Imprimir_Ordem_RM_Res  As Boolean 'OK
Public MRP_Imprimir_Ordem_APM     As Boolean 'OK
Public MRP_Imprimir_RM            As Boolean 'OK
Public MRP_Imprimir_Plano         As Boolean 'OK
Public MRP_Imprimir_Freq          As Boolean 'OK
Public MRP_Imprimir_Etiq          As Boolean 'OK
Public MRP_Qtcopias_Etiq          As Integer 'OK
Public MRP_considerar_estoque     As Boolean 'OK
Public MRP_utilizaMatConsPI       As Boolean 'OK

Public Novo_Ordem             As Boolean 'OK
Dim Novo_Ordem1               As Boolean 'OK
Dim Novo_Ordem2               As Boolean 'OK
Public StrSql_Ordem_Localizar As String 'OK
Public FormulaRel_Ordem       As String 'OK
Public FormulaRel_Ordem_Carteira       As String 'OK
Public Expedicao              As Boolean 'OK
Public Montagem               As Boolean 'OK
Public Fabricacao             As Boolean 'OK
Public Agrupar_ordem          As Boolean 'OK
Dim ExcluirAP                 As Boolean
Public Versao_por_item_estrutura        As Boolean 'OK
Public Versao_por_item        As Boolean 'OK
Public Versao_estrutura        As String  'OK
Public Versao_processo        As String  'OK

Public EntrarEstoque          As Boolean 'OK
Public RetirarEstoque         As Boolean 'OK

Dim Processo                  As Variant 'OK

'Declara as variaveis de total de preparacao prevista
Dim TotalPrepPrev             As Variant 'OK
Dim TotalPrepUtil             As Variant 'OK
Dim EfiPrep                   As Variant 'OK

'Declara as variaveis de segundos previstos e utilizados em preparacao
Dim PrepSegPrev               As Variant 'OK
Dim PrepSegUtil               As Variant 'OK

'Declara as variaveis de total de execucao prevista
Dim TotalExecPrev             As Variant 'OK
Dim TotalExecUtil             As Variant 'OK
Dim EfiExec                   As Variant 'OK
Dim ExecPecaPrev              As Variant 'OK
Dim ExecPecaUtil              As Variant 'OK
Dim PecaSegPrev               As Variant 'OK
Dim PecaSegUtil               As Variant 'OK
Dim TotalDiaPrev              As Variant 'OK
Dim TotalDiaUtil              As Variant 'OK

'Declara as variaveis de segundos previstos e utilizados em execucao
Dim ExecSegPrev               As Variant 'OK
Dim ExecSegUtil               As Variant 'OK

'Declara as variaveis de tempo total previsto
Dim SomaPrepPrev              As Variant 'OK
Dim SomaExecPrev              As Variant 'OK
Dim TempoTotalPrev            As Variant 'OK

'Declara as variaveis de tempo total utilizado
Dim SomaPrepUtil              As Variant 'OK
Dim SomaExecUtil              As Variant 'OK

'Declara as variaveis de tempototal previstos e utilizados
Dim TotalPrevisto             As Variant 'OK
Dim TotalUtil                 As Variant 'OK
Dim TotalPrev                 As Variant 'OK

'Declara as variaveis de total de segundos previstos e utilizados
Dim TotalSegPrev              As Variant 'OK
Dim HoraUtil                  As Variant 'OK
Dim HoraPrev                  As Variant 'OK

'Declara as variaveis de controle de custo das fases
Dim CustoFasePrev             As Variant 'OK
Dim CustoFaseReal             As Variant 'OK
Dim CustoTotalPrev            As Variant 'OK
Dim CustoTotalReal            As Variant 'OK
Dim FaseSegPrev               As Variant 'OK
Dim FaseSegReal               As Variant 'OK

'Controle de NC
Dim DataNC                    As Date 'OK
Dim MaquinaNC                 As String 'OK
Dim InicioNC                  As Date 'OK
Dim TurnoNC                   As Integer 'OK

'Controle do MRP
Public MRPgerado              As Boolean 'OK
Public MRP_Prod               As Boolean 'OK
Public StrSql_Ordem_MRP       As String 'OK
Public StrSql_Ordem_MRP1      As String 'OK
Public DesenhoMRP             As String 'OK
Public RevDesenhoMRP          As String 'OK
Dim GerouOrdem                As Boolean 'OK
Public ID_empresa_MRP         As Long 'OK

'GridEstrutura
Public m_Tree As New Node
Public m_Row As Long
Public m_Col As Long
Dim tempNode As Node
Dim intIndex, i As Integer
Dim CodRef As String, DataValidacao As String, RespValidacao As String

Public OrdemEmpenho As Long, OrdemEmpenho1 As Long, OrdemEmpenho2 As Long, OrdemEmpenho3 As Long, OrdemEmpenho4 As Long, OrdemEmpenho5 As Long, OrdemEmpenho6 As Long, OrdemEmpenho7 As Long, OrdemEmpenho8 As Long, OrdemEmpenho9 As Long, OrdemEmpenho10 As Long, OrdemEmpenho11 As Long, OrdemEmpenho12 As Long, OrdemEmpenho13 As Long, OrdemEmpenho14 As Long, OrdemEmpenho15 As Long

Sub ProcAjuda()
On Error GoTo tratar_erro

FunAbrirVideoWeb ("http://www.youtube.com/watch?v=U54EjL6c2Uk&list=UUODGiDjQ-BCrxh0YXfJvoqg&index=4&feature=plcp")

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub FiltraEstruturaCarteira()
On Error GoTo tratar_erro
''ReDim arrNodes(2000)

QuantsolicitadoN1 = 0
QuantsolicitadoN2 = 0
QuantsolicitadoN3 = 0
QuantsolicitadoN4 = 0
QuantsolicitadoN5 = 0
QuantsolicitadoN6 = 0
QuantsolicitadoN7 = 0
QuantsolicitadoN8 = 0
QuantsolicitadoN9 = 0
QuantsolicitadoN10 = 0
QuantsolicitadoN11 = 0
QuantsolicitadoN12 = 0
QuantsolicitadoN13 = 0
QuantsolicitadoN14 = 0

Call m_Tree.Nodes.Clear
Grid1.rows = 1

m_Row = 1
m_Col = 1
Desenho = ""
Contador1 = -1
    
Contador = 0
Set TBCarteira = CreateObject("adodb.recordset")
TBCarteira.Open StrSql_Ordem_MRP1, Conexao, adOpenKeyset, adLockOptimistic
If TBCarteira.EOF = False Then
    Do While Not TBCarteira.EOF
        Ordem = TBCarteira!CODIGO
        quantidade = IIf(TBCarteira!Necessidade > 0, TBCarteira!Necessidade, TBCarteira!Qtde_produzir)
                
        Processos = "NÃO"
        Set TBProcessos = CreateObject("adodb.recordset")
        TBProcessos.Open "Select PR.IDProcesso FROM Processos PR INNER JOIN Projproduto P ON PR.Codproduto = P.Codproduto where P.Desenho = '" & TBCarteira!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProcessos.EOF = False Then
            Processos = "SIM"
        End If
        OrdemCarteira = ""
        Set TBOrdem = CreateObject("adodb.recordset")
        TBOrdem.Open "Select PR.Ordem FROM Producao PR INNER JOIN Producao_pedidos PP ON PR.Ordem = PP.Ordem where PP.IDCarteira = " & Ordem & " and PR.Desenho = '" & TBCarteira!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdem.EOF = False Then
            OrdemCarteira = TBOrdem!Ordem
        End If
        
        DataValidacao = ""
        RespValidacao = ""
        Set TBLISTA = CreateObject("adodb.recordset")
        TBLISTA.Open "Select * from Projproduto where Desenho = '" & TBCarteira!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBLISTA.EOF = False Then
            IDlista = TBLISTA!Codproduto
            If TBLISTA!SubTipoItem <> 0 Then
                Set TBFI = CreateObject("adodb.recordset")
                TBFI.Open "Select * from Projconjunto_desc_versao where codproduto = " & TBLISTA!Codproduto & " and Versao = '" & cmbVersao & "'", Conexao, adOpenKeyset, adLockOptimistic
                If TBFI.EOF = False Then
                    DataValidacao = IIf(IsNull(TBFI!DtValidacao), "", TBFI!DtValidacao)
                    RespValidacao = IIf(IsNull(TBFI!RespValidacao), "", TBFI!RespValidacao)
                End If
            End If
        End If
        Contador1 = Contador1 + 1
        arrNodes(Contador1).Level = 0
        arrNodes(Contador1).Text = TBCarteira!Desenho & vbTab & "" & vbTab & IDlista & vbTab & IIf(IsNull(TBCarteira!N_referencia), "", TBCarteira!N_referencia) & vbTab & TBCarteira!descricao_tecnica & vbTab & TBCarteira!Unidade_com & vbTab & cmbVersao & vbTab & TBCarteira!Ncotacao & vbTab & TBCarteira!Cliente & vbTab & Format(TBCarteira!Necessidade, "###,##0.0000") & vbTab & Format(TBCarteira!PrazoFinal, "dd/mm/yy") & vbTab & Format(TBCarteira!Datavendas, "dd/mm/yy") & vbTab & Processos & vbTab & OrdemCarteira & vbTab & DataValidacao & vbTab & RespValidacao
        
        Codproduto = TBLISTA!Codproduto
        
        ProcNivel2Estrutura frmprod, cmbVersao, False, True, True, False
       
        Contador = Contador + 1
        TBCarteira.MoveNext
    Loop
    
    With Grid1
        .AutoRedraw = False
        .AllowUserPaste = cellTextOnly
        .ExtendLastCol = True
        .DrawMode = cellOwnerDraw
        .Cols = 17
        .rows = m_Row
        .Cell(0, 1).Text = "Cód. interno"
        .Cell(0, 2).Text = "Pos."
        .Cell(0, 3).Text = "ID"
        .Cell(0, 4).Text = "Cód. de ref."
        .Cell(0, 5).Text = "Descrição"
        .Cell(0, 6).Text = "Un. com."
        .Cell(0, 7).Text = "Ver."
        .Cell(0, 8).Text = "Ped. interno"
        .Cell(0, 9).Text = "Cliente"
        .Cell(0, 10).Text = "Qtde."
        .Cell(0, 11).Text = "Prazo final"
        .Cell(0, 12).Text = "Dt. venda"
        .Cell(0, 13).Text = "Processo"
        .Cell(0, 14).Text = "Ordem"
        .Cell(0, 15).Text = "Dt. validação"
        .Cell(0, 16).Text = "Resp. validação"
        .Range(0, 1, 0, 16).Alignment = cellCenterCenter
        .Column(1).Width = 200
        .Column(2).Width = 30
        .Column(3).Width = 0
        .Column(4).Width = 80
        .Column(5).Width = 300
        .Column(6).Width = 50
        .Column(6).Alignment = cellCenterCenter
        .Column(7).Width = 40
        .Column(7).Alignment = cellCenterCenter
        .Column(8).Width = 80
        .Column(9).Width = 300
        .Column(10).Width = 100
        .Column(10).Alignment = cellRightCenter
        .Column(11).Width = 100
        .Column(11).Alignment = cellCenterCenter
        .Column(12).Width = 100
        .Column(12).Alignment = cellCenterCenter
        .Column(13).Width = 60
        .Column(13).Alignment = cellCenterCenter
        .Column(14).Width = 80
        .Column(15).Width = 120
        .Column(16).Width = 100

        'First node
        Set tempNode = m_Tree.Nodes.Add("")
        .AddItem arrNodes(0).Text
        
        'Other nodes
        For intIndex = 1 To Contador1 'UBound(arrNodes)
            If arrNodes(intIndex).Level = arrNodes(intIndex - 1).Level Then
                Set tempNode = tempNode.Parent.Nodes.Add("")
            ElseIf arrNodes(intIndex).Level > arrNodes(intIndex - 1).Level Then
                Set tempNode = tempNode.Nodes.Add("")
            ElseIf arrNodes(intIndex).Level < arrNodes(intIndex - 1).Level Then
                For i = arrNodes(intIndex).Level To arrNodes(intIndex - 1).Level
                    Set tempNode = tempNode.Parent
                Next
                Set tempNode = tempNode.Nodes.Add("")
            End If
            .AddItem arrNodes(intIndex).Text
        Next
        
        .Visible = True
        .AutoRedraw = True
        .Refresh
    End With
End If
TBCarteira.Close

ProcEsconderMostrarBotoes

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ActiveResize1_ResizeComplete()
On Error GoTo tratar_erro

ProcCorrigeForm

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub btn_Click(index As Integer)
On Error GoTo tratar_erro


Select Case index
Case 0:
ProcNovoAP
Case 1:
ProcGravarAP
Case 2:
ProcExcluirAP
Case 3:
ProcImprimirAP
Case 4:
ProcRecalcular_OS
Case 5:
If cmbAPOS <> "" Then Frmprod_maq_utilizadas.Show 1
Case 6:
ProcDesvincularOS
Case 7:
ProcAtualizaProducao
Case 8:
ProcLista12Ultimos
Case 9:
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub BtnBaixar_Click()
On Error GoTo tratar_erro

ProcBaixar_estoque

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub btnEmpenhar_Click()
On Error GoTo tratar_erro

ProcEmpenhar

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub btnExcluirEmpenho_Click()
On Error GoTo tratar_erro

ProcCancelarEmpenho

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub btnExe_Click()
On Error GoTo tratar_erro

frmProd_CalculaExecucao.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub btnExluirMov_Click()
On Error GoTo tratar_erro

If USMsgBox("Deseja realmente excluir a saida do estoque selecionada?", vbYesNo, "CAPRIND v5.0") = vbNo Then
Exit Sub
End If

qtdeliberada = 0
qtdeliberar = 0

' Se não tiver item selecionado ou não tiver movimentação
If ListaMovimentacao.SelectedItem = "" Then Exit Sub

With ListaMovimentacao
'======================================================================================
' Apaga movimentacao selecionada do estoque
'======================================================================================
Conexao.Execute "DELETE from estoque_movimentacao where idoperacao = " & .SelectedItem
quantidade = 0
QuantidadePC = 0

'======================================================================================
' Verifica se é consignado
'======================================================================================
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from Estoque_controle where IDEstoque = " & Lista.SelectedItem & " and consignacao = 'True'", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
TextoFiltro = "IDEstoque = " & Lista.SelectedItem
Else
TextoFiltro = "Desenho = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "'"
End If

'======================================================================================
' Verifica se tem mais movimentacoes com o item
'======================================================================================
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select Sum(Saida) as Quantidade, Sum(ISNULL(Saida_PC, 0)) as QuantidadePC from estoque_movimentacao where " & TextoFiltro & " and documento = '" & txtof.Text & "' and (operacao = 'SAIDA_ORDEM' or operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
quantidade = IIf(IsNull(TBAbrir!quantidade), 0, TBAbrir!quantidade)
QuantidadePC = IIf(IsNull(TBAbrir!QuantidadePC), 0, TBAbrir!QuantidadePC)
End If
TBAbrir.Close

'======================================================================================
' Corrige status e quantidade da saida do item na requisicao
'======================================================================================
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from producaomaterial where codigo = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "' and Ordem = " & txtof.Text, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
If quantidade = 0 Then
TBproducao!Saida = "NÃO"
ElseIf quantidade >= TBproducao!Requisitado Or QuantidadePC >= TBproducao!Total_pc Then
TBproducao!Saida = "SIM"
Else
TBproducao!Saida = "PARCIAL"
End If

TBproducao!Valor_saida_estoque = Format(IIf(IsNull(TBproducao!Valor_saida_estoque), 0, TBproducao!Valor_saida_estoque) - (valor * QuantSolicitado), "###,##0.00")
TBproducao.Update

'=======================================================================================
'Atualiza qtde. de saída do empenho da ordem
'=======================================================================================
QuantEmpenho = 0
QuantEmpenhoPC = 0
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select Sum(Saida) as QuantEmpenho, Sum(ISNULL(Saida_PC, 0)) as QuantEmpenhoPC from estoque_movimentacao where IDestoque = " & ListaMovimentacao.SelectedItem.ListSubItems(1) & " and oe = '" & TBproducao!Ordem & "' and desenho = '" & TBproducao!CODIGO & "' and documento = '" & TBproducao!Ordem & "' and (operacao = 'SAIDA_ORDEM' or operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
QuantEmpenho = IIf(IsNull(TBAbrir!QuantEmpenho), 0, Format(TBAbrir!QuantEmpenho, "###,##0.0000"))
QuantEmpenhoPC = IIf(IsNull(TBAbrir!QuantEmpenhoPC), 0, Format(TBAbrir!QuantEmpenhoPC, "###,##0.0000"))
End If

NovoValor = Replace(QuantEmpenho, ",", ".")
NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & NovoValor & " where IDestoque = " & ListaMovimentacao.SelectedItem.ListSubItems(1) & " and Ordem = " & TBproducao!Ordem & " and Codinterno = '" & TBproducao!CODIGO & "'"
Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida_PC = " & NovoValor1 & " where IDestoque = " & ListaMovimentacao.SelectedItem.ListSubItems(1) & " and Ordem = " & TBproducao!Ordem & " and Codinterno = '" & TBproducao!CODIGO & "' and Quantidade_PC IS NOT NULL and Quantidade_PC > 0"
End If
TBproducao.Close

'=======================================================================================
'Verifica se o item movimenta estoque
'=======================================================================================
Permitido1 = True
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select * from projproduto where Desenho = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "' and Estoque = 'True'", Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = True Then
Permitido1 = False
End If
TBProduto.Close

'=======================================================================================
'Apaga do Centro de custo
'=======================================================================================
Conexao.Execute "DELETE from CC_realizado where ID_estoque = " & Lista.SelectedItem
'=======================================================================================
'Corrige saldo no estoque controle estoque real
'=======================================================================================
Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select * from estoque_controle where idestoque = " & ListaMovimentacao.SelectedItem.ListSubItems(1), Conexao, adOpenKeyset, adLockOptimistic
If TBEstoque.EOF = False Then
If Permitido1 = True Then
Qtde = Valor1
TBEstoque!estoque_real = Format(Qtde, "###,##0.0000")
TBEstoque!Qtde = Format(Qtde, "###,##0.0000")
'TBEstoque!estoque_real_PC = Format(IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC) - IIf(.ListItems.Item(InitFor).SubItems(5) = "", 0, .ListItems.Item(InitFor).SubItems(5)) + IIf(.ListItems.Item(InitFor).SubItems(7) = "", 0, .ListItems.Item(InitFor).SubItems(7)), "###,##0.0000")
Else
TBEstoque!estoque_real = 0
TBEstoque!estoque_real_PC = 0
Qtde = 0
End If
'=======================================================================================
'Atualiza valor do material no estoque
'=======================================================================================
TBEstoque!Valor_total = Format(IIf(IsNull(TBEstoque!valor_unitario), 0, TBEstoque!valor_unitario) * Qtde, "###,##0.00")
TBEstoque.Update
'=======================================================================================
' Por ultimo apaga se houver qualquer movimentação com idestoque igual
'=======================================================================================
Set TBMaterial = CreateObject("adodb.recordset")
TBMaterial.Open "Select * from Estoque_movimentacao where IDEstoque = " & TBEstoque!IDEstoque, Conexao, adOpenKeyset, adLockOptimistic
If TBMaterial.EOF = True Then TBEstoque.Delete

'=======================================================================================
' Corrige o Saldo da RE
'=======================================================================================
Set TBAbrir = CreateObject("adodb.recordset")

TBAbrir.Open "select Sum(Entrada) - Sum(Saida) as Saldo from Estoque_movimentacao where Idestoque = '" & TBEstoque!IDEstoque & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
StrSql = "update estoque_controle set Estoque_real = '" & Replace(TBAbrir!Saldo, ",", ".") & "' from Estoque_controle where IDEstoque = '" & TBEstoque!IDEstoque & "'"
'Debug.print StrSql
QTSaldo = TBAbrir!Saldo
Conexao.Execute (StrSql)
End If
TBAbrir.Close
TBMaterial.Close
End If
TBEstoque.Close
'=======================================================================================
End With

USMsgBox ("Movimentação(ões) excluída(s) com sucesso."), vbInformation, "CAPRIND v5.0"

ProcCarregaListaRequisicao
ProcCarregaListaEmpenhos

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Public Sub procVoltarEmpenhoLocal(idEstoqueEntrada As Long, idEstoqueSaida As Long)
On Error GoTo tratar_erro

Set TBCFOP = CreateObject("adodb.recordset")
TBCFOP.Open "SELECT ID_estoque, IdAntigoLocal, Qtde_empenhada FROM Estoque_Controle_Empenho_Vendas where id_estoque = " & idEstoqueEntrada, Conexao, adOpenKeyset, adLockOptimistic
If TBCFOP.EOF = False Then
    Do While TBCFOP.EOF = False
        If IsNull(TBCFOP!IdAntigoLocal) = True Then
            TBCFOP!ID_estoque = idEstoqueSaida
            TBCFOP.Update
        Else
            Set TBCorretiva = CreateObject("adodb.recordset")
            TBCorretiva.Open "SELECT Qtde_empenhada FROM Estoque_Controle_Empenho_Vendas where id = " & TBCFOP!IdAntigoLocal, Conexao, adOpenKeyset, adLockOptimistic
            If TBCorretiva.EOF = False Then
                TBCorretiva!Qtde_empenhada = TBCFOP!Qtde_empenhada + TBCorretiva!Qtde_empenhada
                TBCorretiva.Update
            End If
            TBCorretiva.Close
            TBCFOP.Delete
        End If
        TBCFOP.MoveNext
    Loop
End If
TBCFOP.Close

Set TBCFOP = CreateObject("adodb.recordset")
TBCFOP.Open "SELECT IDestoque, IdAntigoLocal, Quantidade, Quantidade_PC FROM Producao_NF_Consignada where idestoque = " & idEstoqueEntrada, Conexao, adOpenKeyset, adLockOptimistic
If TBCFOP.EOF = False Then
    Do While TBCFOP.EOF = False
        If IsNull(TBCFOP!IdAntigoLocal) = True Then
            TBCFOP!IDEstoque = idEstoqueSaida
            TBCFOP.Update
        Else
            Set TBCorretiva = CreateObject("adodb.recordset")
            TBCorretiva.Open "SELECT * FROM Producao_NF_Consignada where id = " & TBCFOP!IdAntigoLocal, Conexao, adOpenKeyset, adLockOptimistic
            If TBCorretiva.EOF = False Then
                TBCorretiva!quantidade = TBCFOP!quantidade + TBCorretiva!quantidade
                TBCorretiva!Quantidade_PC = TBCFOP!Quantidade_PC + TBCorretiva!Quantidade_PC
                TBCorretiva.Update
            End If
            TBCorretiva.Close
            TBCFOP.Delete
        End If
        TBCFOP.MoveNext
    Loop
End If
TBCFOP.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Sub ProcAtualizaStatus_RM()
On Error GoTo tratar_erro

Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from Requisicao_materiais where requisicao = '" & TBAbrir!Documento & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    Set TBMateriaprima = CreateObject("adodb.recordset")
    TBMateriaprima.Open "Select * from Requisicao_materiais_lista where idrequisicao = " & TBproducao!ID & " and status <> 'CANCELADO'", Conexao, adOpenKeyset, adLockOptimistic
    If TBMateriaprima.EOF = False Then
        Set TBMateriaprima = CreateObject("adodb.recordset")
        TBMateriaprima.Open "Select * from Requisicao_materiais_lista where idrequisicao = " & TBproducao!ID & " and status <> 'REQUISIT.'", Conexao, adOpenKeyset, adLockOptimistic
        If TBMateriaprima.EOF = True Then
            TBproducao!status = "ABERTA"
        Else
            Set TBMateriaprima = CreateObject("adodb.recordset")
            TBMateriaprima.Open "Select * from Requisicao_materiais_lista where idrequisicao = " & TBproducao!ID & " and status <> 'RETIRADO'", Conexao, adOpenKeyset, adLockOptimistic
            If TBMateriaprima.EOF = True Then
                TBproducao!status = "RETIRADA"
            Else
                TBproducao!status = "PARCIAL"
            End If
        End If
        TBproducao.Update
    End If
    TBMateriaprima.Close
End If
TBproducao.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Sub ProcOrdem()
On Error GoTo tratar_erro

If Status_movimentacao = "SAIDA_ORDEM" Or Status_movimentacao = "SAIDA_ORDEM_PARCIAL" Then
    Set TBProduto = CreateObject("adodb.recordset")
    TBProduto.Open "Select * from projproduto where Desenho = '" & Lista.SelectedItem.ListSubItems(3) & "' and SubTipoItem <> 0 and SubTipoItem <> 4", Conexao, adOpenKeyset, adLockOptimistic
    If TBProduto.EOF = False Then
        If TBCiclo!QuantProd - Qtd <= 0 Then TBCiclo!QuantProd = 0 Else TBCiclo!QuantProd = TBCiclo!QuantProd - Qtd
    End If
    TBProduto.Close
    If TBCiclo!QuantProd <> 0 Then
        TBCiclo!CPR = IIf(IsNull(TBCiclo!CTTReal), 0, TBCiclo!CTTReal) / TBCiclo!QuantProd
    Else
        TBCiclo!CPR = 0
        TBCiclo!Controlado_estoque = False
    End If
    If TBCiclo!QuantProd < TBCiclo!Quant Then
        TBCiclo!DataEntrega = Null
        TBCiclo!Concluida = False
        TBCiclo!pronta = "NÃO"
        If TBCiclo!status <> "Entregue" Then TBCiclo!status = "Aberta"
        
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from producao where Ordem = " & TBCiclo!Ordem & " and Ap_backup = 'True'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            NomeTabelaAp = "ProducaoFases_Backup"
        Else
            NomeTabelaAp = "ProducaoFases"
        End If
        
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from ordemservico where Ordem = " & TBCiclo!Ordem & " and pronto = 'SIM'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                TBproducao!Pronto = "NÃO"
                TBproducao!DataConclusao = Null
                TBproducao!status = Null
                TBproducao.Update
                'Filtra todos os eventos desta OS na tabela producaofases para marcar como fase pronta
                Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'NÃO' where idfase = " & TBproducao!IDProducao
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
    End If
    TBCiclo.Update
End If
'==================================
Modulo = "Estoque/Movimentação/Entrada"
Evento = "Alterar OF p/ não concluída"
ID_documento = TBCiclo!NOF
Documento = "Ordem: " & TBCiclo!Ordem
Documento1 = ""
ProcGravaEvento
'==================================

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub


Private Sub btnvlrEstoque_Click()
On Error GoTo tratar_erro

If frmprod.txtDtValidacao_custo = "" Then
    USMsgBox ("Não é permitido atualizar o valor unitário no estoque, pois o resultado da ordem ainda não foi validado."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

    If USMsgBox("Deseja realmente atualizar o valor do estoque desta ordem?", vbYesNo, "CAPRIND v5.0") = vbYes Then
        Set TBOrdem = CreateObject("adodb.recordset")
        TBOrdem.Open "Select * from producao where Ordem = '" & txtof.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdem.EOF = False Then
            Contador1 = 0
            Do While TBOrdem.EOF = False
                NovoValor = Replace(Txt_custo_total_peca, ",", ".")
                Conexao.Execute "Update Estoque_Controle set valor_unitario = " & NovoValor & " where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "'"
                Conexao.Execute "Update Estoque_Controle set Valor_Total = ROUND(valor_unitario * qtde, 2) where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "'"
                Conexao.Execute "Update EM Set VlrUnit = " & NovoValor & " from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
                Conexao.Execute "Update EM Set VlrTotal = ROUND(VlrUnit * Entrada, 2) from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
                Conexao.Execute "Update CC Set CC.Valor = EM.VlrTotal from (CC_realizado CC INNER JOIN Estoque_movimentacao EM ON CC.ID_estoque = EM.Idoperacao) INNER JOIN Estoque_controle EC ON EC.IdEstoque = EM.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EC.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
  '              Conexao.Execute "Update EM set EM.VlrUnit = EM1.VlrUnit from Estoque_movimentacao EM INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
               ' Conexao.Execute "Update EC set EC.valor_unitario = " & NovoValor & " from Estoque_Controle EC INNER JOIN Estoque_movimentacao EM ON EM.IdEstoque = EC.IdEstoque INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
                Conexao.Execute "Update Estoque_movimentacao set VlrTotal = ROUND(VlrUnit * Saida, 2) where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "' and Saida > 0"
                TBOrdem.MoveNext
                Contador1 = Contador1 + 1
            Loop
        End If
        TBOrdem.Close
        USMsgBox ("Valor unitário atualizado no estoque com sucesso."), vbInformation, "CAPRIND v5.0"
        '==================================
        Modulo = "PCP/Gerenciamento de ordem"
        Evento = "Atualizar valor unitário no estoque"
        ID_documento = txtof
        Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
        Documento1 = ""
        ProcGravaEvento
        '==================================
        ProcAbrirRe
    End If



Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub


Private Sub chkIndividual_Click()
On Error GoTo tratar_erro
       
OrdemRastreavel = IIf(chkindividual.Value = 0, False, True)
       
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdEncerrarordem_Click()
On Error GoTo tratar_erro

If cmbStatus.Text <> "Aberta" Then
USMsgBox "Só é permitido encerrar ordem de produção com status Aberta", vbCritical, "CAPRIND v5.0"
Exit Sub
End If


If txtof.Text = "" Then
USMsgBox "Escolha uma ordem para mudar o Status", vbInformation, "CAPRIND v5.0"
Exit Sub
End If

NOrdem = txtof


If USMsgBox("Deseja realmente encerrar a ordem produção n° " & NOrdem & ", QTBaixar as requisições, e dar entrada do item no estoque?", vbYesNo, "CAPRIND V5.0") = vbYes Then

frmProd_EncerrarOrdem.Show 1

End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Command1_Click()

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from ordemServico Where IDProducao >= '118735'", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
Do While TBOrdem.EOF = False
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from CQ_NC_FABRICA Where OS = " & TBOrdem!IDProducao, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
Do While TBproducao.EOF = False
TBproducao!LOTE = TBOrdem!quantidade
TBproducao.Update
TBproducao.MoveNext
Loop
End If

TBOrdem.MoveNext
Loop
End If
TBOrdem.Close


End Sub

Private Sub cmdMateriais_Click()
On Error GoTo tratar_erro

FrmProd_Resultados_Material.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Grid1_OwnerDrawCell(ByVal Row As Long, ByVal Col As Long, ByVal hdc As Long, ByVal Left As Long, ByVal Top As Long, ByVal Right As Long, ByVal Bottom As Long, Handled As Boolean)
On Error GoTo tratar_erro
Dim i As Long, j As Long
Dim x As Long, Y As Long
Dim hPen As Long, hOldPen As Long
Dim hBrush As Long, hOldBrush As Long
Dim lngLevel As Long
Dim blnDrawLine As Boolean
Dim objNode As Node, tmpNode As Node
Dim intWidth As Integer
Dim intAdd As Integer

If Row < m_Row Or Col <> m_Col Then Exit Sub

intWidth = 20
intAdd = 26
    
Set objNode = m_Tree.FindNode(Row - m_Row + 2)
If Not objNode Is Nothing Then
    lngLevel = objNode.Level - 1

    'Tree lines
    hPen = CreatePen(0, 1, RGB(128, 128, 128))
    hOldPen = SelectObject(hdc, hPen)
    For i = 0 To lngLevel
        If i < lngLevel - 1 Then
            blnDrawLine = True
            Set tmpNode = objNode
            For j = i To lngLevel - 2
                Set tmpNode = tmpNode.Parent
            Next
            If tmpNode.NextNode Is Nothing Then
                blnDrawLine = False
            End If
            If blnDrawLine Then
                'All
                Call DrawLine(hdc, Left + intWidth * i + intAdd, Top - 1, Left + intWidth * i + intAdd, Bottom + 1)
            End If
        ElseIf i = lngLevel - 1 Then
            'Top
            Call DrawLine(hdc, Left + intWidth * i + intAdd, Top - 1, Left + intWidth * i + intAdd, Top + (Bottom - Top) / 2)
            If Not objNode.NextNode Is Nothing Then
                'Bottom
                Call DrawLine(hdc, Left + intWidth * i + intAdd, Top + (Bottom - Top) / 2, Left + intWidth * i + intAdd, Bottom + 1)
            End If
        ElseIf i = lngLevel Then
            'Top
            If objNode.VisibleNodesCount > 1 Then
                Call DrawLine(hdc, Left + intWidth * i + intAdd, Top + (Bottom - Top) / 2, Left + intWidth * i + intAdd, Bottom + 1)
            End If
        End If
        'Horizontal line
        If lngLevel > 0 Then
            Call DrawLine(hdc, Left + intWidth * (lngLevel - 1) + intAdd, Top + (Bottom - Top) / 2, Left + intWidth * (lngLevel - 1) + intAdd + 10, Top + (Bottom - Top) / 2)
        End If
    Next
    
    Call SelectObject(hdc, hOldPen)
    Call DeleteObject(hPen)

    '+/-
    If objNode.ChildrenCount > 0 Then
        hPen = CreatePen(0, 1, 0)
        hOldPen = SelectObject(hdc, hPen)
        hBrush = CreateSolidBrush(RGB(255, 255, 255))
        hOldPen = SelectObject(hdc, hBrush)
        
        x = Left + 2 + intWidth * lngLevel
        Y = Top + (Bottom - Top - 9) / 2
        
        Call Rectangle(hdc, x, Y, x + 9, Y + 9)
        If objNode.Expanded Then
            Call DrawLine(hdc, x + 2, Y + 4, x + 7, Y + 4)
        Else
            Call DrawLine(hdc, x + 2, Y + 4, x + 7, Y + 4)
            Call DrawLine(hdc, x + 4, Y + 2, x + 4, Y + 7)
        End If
    
        Call SelectObject(hdc, hOldPen)
        Call DeleteObject(hPen)
        Call SelectObject(hdc, hOldBrush)
        Call DeleteObject(hBrush)
    End If
    
    'Icon
    If objNode.ChildrenCount > 0 Then
        DrawIconEx hdc, Left + intWidth * lngLevel + 18, Top + (Bottom - Top - 16) / 2, imgFolder.Picture, 16, 16, 0, 0, DI_NORMAL
    Else
        DrawIconEx hdc, Left + intWidth * lngLevel + 18, Top + (Bottom - Top - 16) / 2, imgFile.Picture, 16, 16, 0, 0, DI_NORMAL
    End If
    
    'Text
    With Grid1.Cell(Row, Col)
        Dim rc As rect
        Call SetRect(rc, Left + intWidth * lngLevel + 37, Top, Right, Bottom)
        Call DrawText(hdc, .Text, -1, rc, DT_SINGLELINE Or DT_VCENTER)
    End With

    Handled = True
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Function FunCheckEditStatus() As Boolean
On Error GoTo tratar_erro
Dim hWnd As Long
Dim strClassName As String
Dim intPos As Integer

strClassName = Space(256)
hWnd = GetFocus()
Call GetClassName(hWnd, strClassName, 256)
intPos = InStr(1, strClassName, Chr(0))
strClassName = Left(strClassName, intPos - 1)
If strClassName = "ThunderRT6TextBox" Then FunCheckEditStatus = True    'Editing Else    FunCheckEditStatus = False

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Private Sub Grid1_Click()
On Error GoTo tratar_erro
Dim point As POINTAPI
Dim objCell As FlexCell.Cell
Dim intWidth As Integer

If FunCheckEditStatus() Then Exit Sub
intWidth = 20

Call GetCursorPos(point)
Call ScreenToClient(Grid1.hWnd, point)
Set objCell = Grid1.HitTest(point.x, point.Y)

If Not objCell Is Nothing Then
    If objCell.Row >= m_Row And objCell.Col = m_Col Then
        Dim objNode As Node
        Set objNode = m_Tree.FindNode(objCell.Row - m_Row + 2)
        If Not objNode Is Nothing Then
            Dim i As Long, x As Long, Y As Long
            x = objCell.Left + 2 + (objNode.Level - 1) * intWidth
            Y = objCell.Top + (objCell.Height - 9) / 2
            If point.x >= x And point.x <= x + 9 And point.Y >= Y And point.Y <= Y + 9 Then
                If objNode.Expanded Then
                    objNode.Collapse
                    Grid1.AutoRedraw = False
                    For i = 1 To objNode.ChildrenCount
                        Grid1.RowHeight(objCell.Row + i) = 0
                    Next
                    Grid1.AutoRedraw = True
                    Grid1.Refresh
                Else
                    objNode.Expand
                    Grid1.AutoRedraw = False
                    For i = 1 To objNode.ChildrenCount
                        If objNode.FindNode(i + 1).Visible Then
                            Grid1.RowHeight(objCell.Row + i) = -1 'DefaultRowHeight
                        End If
                    Next
                    Grid1.AutoRedraw = True
                    Grid1.Refresh
                End If
            End If
        End If
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcEsconderMostrarBotoes()
On Error GoTo tratar_erro

With USToolBar1
    If Frame1(3).Visible = True Then .ButtonState(6) = 5 Else .ButtonState(6) = 0
    .Refresh
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizalista()
On Error GoTo tratar_erro

'Deleta registros e adiciona novos
ProcExcluirDadosProducaoRelatoriosTotal

ListaRE.ListItems.Clear
Set TBOrdem = CreateObject("adodb.recordset")
NomeCamposFiltro = "OS.QTCD, OS.Ordem, OS.IDProducao, OS.Fase, OS.Grupo_op, OS.maquina, OS.TempoPreparacao, OS.TPUTIL, OS.TempoExecucao, OS.TEUTIL, OS.QTOK, OS.QTNC, OS.Totalprod, OS.CPPECA, OS.CPLOTE, OS.TPUSEG, OS.Custos, OS.CRLOTE, OS.CTServico, OS.Eficiencia_prep, OS.Eficiencia_exec, OS.Eficiencia, OS.TempoPrepUtilPeca, OS.CTPrepPrevPeca, M.Descricao, OS.Valor_hs_prep, OS.Valor_hs_exec"
TBOrdem.Open "Select " & NomeCamposFiltro & " from ordemservico OS INNER JOIN CadMaquinas M on OS.Maquina = M.Maquina where OS.Ordem = " & txtof.Text & " order by OS.fase, OS.retrabalho, OS.IDproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    'PBLista.Min = 0
    'PBLista.Max = TBOrdem.RecordCount
    'PBLista.Value = 1
    Contador = 0
    Do While TBOrdem.EOF = False
        Set TBFI = CreateObject("adodb.recordset")
        NomeCamposFiltro = "OSMU.QTCD, OSMU.ID, OSMU.maquina, OSMU.TPUTIL, OSMU.TEUTIL, OSMU.QTOK, OSMU.QTNC, OSMU.Totalprod, OSMU.TPUSEG, OSMU.CRLOTE, OSMU.CRPECA, OSMU.Eficiencia_prep, OSMU.Eficiencia_exec, OSMU.Eficiencia, OSMU.TempoPrepUtilPeca, OSMU.CTPrepPrevPeca, M.Descricao"
        TBFI.Open "Select " & NomeCamposFiltro & " from Ordemservico_maq_utilizadas OSMU INNER JOIN CadMaquinas M on OSMU.Maquina = M.Maquina  where OSMU.OS = " & TBOrdem!IDProducao & " order by OSMU.ID", Conexao, adOpenKeyset, adLockOptimistic
        If TBFI.EOF = False Then
            Do While TBFI.EOF = False
                With ListaRE.ListItems
                    .Add , , TBOrdem!IDProducao
                    .Item(.Count).SubItems(1) = IIf(IsNull(TBOrdem!Fase), "", TBOrdem!Fase)
                    .Item(.Count).SubItems(2) = IIf(IsNull(TBOrdem!Grupo_op), "", TBOrdem!Grupo_op)
                    .Item(.Count).SubItems(3) = IIf(IsNull(TBFI!maquina), "", TBFI!maquina)
                    .Item(.Count).SubItems(4) = IIf(IsNull(TBFI!Descricao), "", TBFI!Descricao)
                    .Item(.Count).SubItems(5) = IIf(IsNull(TBOrdem!Valor_hs_prep), "", Format(TBOrdem!Valor_hs_prep, "###,##0.00"))
                    .Item(.Count).SubItems(6) = IIf(IsNull(TBOrdem!TempoPreparacao), "00:00:00", Format(TBOrdem!TempoPreparacao, "hh:mm:ss"))
                   
                    'Tempo de preparação real p/ peça
                    TPUSEG = IIf(IsNull(TBFI!TPUSEG), 0, TBFI!TPUSEG)
                    s = TPUSEG
                    .Item(.Count).SubItems(7) = FormataTempo(s)
                    
                    .Item(.Count).SubItems(8) = IIf(IsNull(TBOrdem!Valor_hs_exec), "", Format(TBOrdem!Valor_hs_exec, "###,##0.00"))
                    .Item(.Count).SubItems(9) = IIf(IsNull(TBOrdem!TempoExecucao), "00:00:00", Format(TBOrdem!TempoExecucao, "hh:mm:ss"))
                    
                    'Tempo de execucao real p/ peça
                    .Item(.Count).SubItems(10) = IIf(IsNull(TBFI!TEUTIL), "00:00:00", Format(TBFI!TEUTIL, "hh:mm:ss"))
                    
                    .Item(.Count).SubItems(11) = IIf(IsNull(TBFI!QTOK), "", Format(TBFI!QTOK, "###,##0.00"))
                    .Item(.Count).SubItems(12) = IIf(IsNull(TBFI!QTCD), "", Format(TBFI!QTCD, "###,##0.00"))
                    
                    .Item(.Count).SubItems(13) = IIf(IsNull(TBFI!QTNC), "", Format(TBFI!QTNC, "###,##0.00"))
                    
                    .Item(.Count).SubItems(14) = IIf(IsNull(TBFI!Totalprod), "", Format(TBFI!Totalprod, "###,##0.00"))
                            
                    valor = IIf(IsNull(TBOrdem!Valor_hs_prep), 0, TBOrdem!Valor_hs_prep)
                    valor = valor / 3600
                                
                    'Tempo de preparação previsto por peça
'                    If TBOrdem!TempoPreparacao <= "23:59:59" Then
'                        TempoTotalPrep = IIf(IsNull(TBOrdem!TempoPreparacao), 0, TBOrdem!TempoPreparacao)
'                        ElapsedTime (TempoTotalPrep)
'                    Else
                        ProcFormataHora (IIf(IsNull(TBOrdem!TempoPreparacao), 0, TBOrdem!TempoPreparacao))
                    'End If
                                
                    'Custo de preparação previsto por peça
                    .Item(.Count).SubItems(15) = Format(s * valor, "###,##0.00")
                    
                    'Custo previsto por peça x qtde. total prod. por máquina
                    .Item(.Count).SubItems(16) = Format(IIf(IsNull(TBOrdem!CPPECA), "", TBOrdem!CPPECA) * IIf(IsNull(TBFI!Totalprod), "", TBFI!Totalprod), "###,##0.00")
                    
                    'Tempo de preparação real do lote
                    quantidade = IIf(IsNull(TBFI!TPUSEG), 0, TBFI!TPUSEG)
                    'Custo de preparação real do lote
                    Valor1 = Format(quantidade * valor, "###,##0.00")
                    .Item(.Count).SubItems(17) = Format(Valor1, "###,##0.00")
                    
                    'Custo de preparação real do lote
                    .Item(.Count).SubItems(18) = Format(IIf(IsNull(TBFI!CRLOTE), 0, TBFI!CRLOTE) - Valor1, "###,##0.00")
                    
                    'Custo de execução real do lote
                    If TBOrdem!custos = True Then
                        .Item(.Count).SubItems(19) = IIf(IsNull(TBFI!CRLOTE), "", Format(TBFI!CRLOTE, "###,##0.00"))
                    Else
                        .Item(.Count).SubItems(19) = IIf(IsNull(TBOrdem!CTServico), "", Format(TBOrdem!CTServico, "###,##0.00"))
                    End If
                    .Item(.Count).SubItems(20) = IIf(IsNull(TBFI!Eficiencia_prep), "", TBFI!Eficiencia_prep & " %")
                    .Item(.Count).SubItems(21) = IIf(IsNull(TBFI!Eficiencia_exec), "", TBFI!Eficiencia_exec & " %")
                    .Item(.Count).SubItems(22) = IIf(IsNull(TBFI!Eficiencia), "", TBFI!Eficiencia & " %")
                    
                    TBFI!TempoPrepUtilPeca = .Item(.Count).SubItems(7) 'Tempo de preparação real p/ peça
                    TBFI!CTPrepPrevPeca = .Item(.Count).SubItems(15) 'Custo de preparação previsto do lote
                    TBFI.Update
                End With
                TBFI.MoveNext
            Loop
        Else
            With ListaRE.ListItems
                .Add , , TBOrdem!IDProducao
                .Item(.Count).SubItems(1) = IIf(IsNull(TBOrdem!Fase), "", TBOrdem!Fase)
                .Item(.Count).SubItems(2) = IIf(IsNull(TBOrdem!Grupo_op), "", TBOrdem!Grupo_op)
                .Item(.Count).SubItems(3) = IIf(IsNull(TBOrdem!maquina), "", TBOrdem!maquina)
                .Item(.Count).SubItems(4) = IIf(IsNull(TBOrdem!Descricao), "", TBOrdem!Descricao)
                .Item(.Count).SubItems(5) = IIf(IsNull(TBOrdem!Valor_hs_prep), "", Format(TBOrdem!Valor_hs_prep, "###,##0.00"))
                .Item(.Count).SubItems(6) = IIf(IsNull(TBOrdem!TempoPreparacao), "00:00:00", Format(TBOrdem!TempoPreparacao, "hh:mm:ss"))
               
                'Tempo de preparação real p/ peça
                TPUSEG = IIf(IsNull(TBOrdem!TPUSEG), 0, TBOrdem!TPUSEG)
                s = TPUSEG
                .Item(.Count).SubItems(7) = FormataTempo(s)
                
                .Item(.Count).SubItems(8) = IIf(IsNull(TBOrdem!Valor_hs_exec), "", Format(TBOrdem!Valor_hs_exec, "###,##0.00"))
                .Item(.Count).SubItems(9) = IIf(IsNull(TBOrdem!TempoExecucao), "00:00:00", Format(TBOrdem!TempoExecucao, "hh:mm:ss"))
                
                'Tempo de execucao real p/ peça
                .Item(.Count).SubItems(10) = IIf(IsNull(TBOrdem!TEUTIL), "00:00:00", Format(TBOrdem!TEUTIL, "hh:mm:ss"))
                
                .Item(.Count).SubItems(11) = IIf(IsNull(TBOrdem!QTOK), "", Format(TBOrdem!QTOK, "###,##0.00"))
                .Item(.Count).SubItems(12) = IIf(IsNull(TBOrdem!QTCD), "", Format(TBOrdem!QTCD, "###,##0.00"))
                .Item(.Count).SubItems(13) = IIf(IsNull(TBOrdem!QTNC), "", Format(TBOrdem!QTNC, "###,##0.00"))
                .Item(.Count).SubItems(15) = IIf(IsNull(TBOrdem!Totalprod), "", Format(TBOrdem!Totalprod, "###,##0.00"))
                        
                valor = IIf(IsNull(TBOrdem!Valor_hs_prep), 0, TBOrdem!Valor_hs_prep)
                valor = valor / 3600
                            
                'Tempo de preparação previsto por peça
'                If TBOrdem!TempoPreparacao <= "23:59:59" Then
'                    TempoTotalPrep = IIf(IsNull(TBOrdem!TempoPreparacao), 0, TBOrdem!TempoPreparacao)
'                    ElapsedTime (TempoTotalPrep)
'                Else
                    ProcFormataHora (IIf(IsNull(TBOrdem!TempoPreparacao), 0, TBOrdem!TempoPreparacao))
'                End If
                            
                'Custo de preparação previsto por peça
                .Item(.Count).SubItems(16) = Format(s * valor, "###,##0.00")
                
                'Custo previsto por peça x qtde. total prod. por máquina
                .Item(.Count).SubItems(17) = Format(IIf(IsNull(TBOrdem!CPLOTE), "", TBOrdem!CPLOTE), "###,##0.00")
                
                'Tempo de preparação real do lote
                quantidade = IIf(IsNull(TBOrdem!TPUSEG), 0, TBOrdem!TPUSEG)
                'Custo de preparação real do lote
                .Item(.Count).SubItems(17) = Format(quantidade * valor, "###,##0.00")
                Valor1 = quantidade * valor
                
                'Custo de preparação real do lote
                .Item(.Count).SubItems(18) = Format(IIf(IsNull(TBOrdem!CRLOTE), 0, TBOrdem!CRLOTE) - Valor1, "###,##0.00")
                
                'Custo de execução real do lote
                If TBOrdem!custos = True Then
                    .Item(.Count).SubItems(19) = IIf(IsNull(TBOrdem!CRLOTE), "", Format(TBOrdem!CRLOTE, "###,##0.00"))
                Else
                    .Item(.Count).SubItems(19) = IIf(IsNull(TBOrdem!CTServico), "", Format(TBOrdem!CTServico, "###,##0.00"))
                End If
                .Item(.Count).SubItems(20) = IIf(IsNull(TBOrdem!Eficiencia_prep), "", TBOrdem!Eficiencia_prep & " %")
                .Item(.Count).SubItems(21) = IIf(IsNull(TBOrdem!Eficiencia_exec), "", TBOrdem!Eficiencia_exec & " %")
                .Item(.Count).SubItems(22) = IIf(IsNull(TBOrdem!Eficiencia), "", TBOrdem!Eficiencia & " %")
                
                TBOrdem!TempoPrepUtilPeca = .Item(.Count).SubItems(7) 'Tempo de preparação real p/ peça
                TBOrdem!CTPrepPrevPeca = .Item(.Count).SubItems(15) 'Custo de preparação previsto do lote
                TBOrdem.Update
            End With
        End If
        TBFI.Close
        TBOrdem.MoveNext
        Contador = Contador + 1
        'PBLista.Value = Contador
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAbrirRe()
On Error GoTo tratar_erro
Dim QTCD As Double
Dim QTOK As Double
Dim QTNC As Double
Dim QTProd As Double

If txtconcluida.Text <> "" Then

OF = txtof.Text

'If cmbAPOS.Text <> "" Then
'ProcAtualizaPrepExecUtil
'End If
'
'ProcCalculaEficienciaOF OF, txtQuantidade

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from producao where Ordem = " & OF, Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    txtDtValidacao_custo = IIf(IsNull(TBOrdem!DtValidacao_custo), "", TBOrdem!DtValidacao_custo)
    txtRespValidacao_custo = IIf(IsNull(TBOrdem!RespValidacao_Custo), "", TBOrdem!RespValidacao_Custo)
    'txtprazofinal.Text = Format(TBOrdem!Prazoentrega, "dd/mm/yy")
    txtdataconclusao.Text = IIf(IsNull(TBOrdem!DataEntrega), "", Format(TBOrdem!DataEntrega, "dd/mm/yyyy"))
    txtquantprev.Text = Format(TBOrdem!Quant, "###,##0.000")

    QTOK = TBOrdem!QuantProd - IIf(IsNull(TBOrdem!QuantNC), "0,000", Format(TBOrdem!QuantNC, "###,##0.000"))
    QTNC = IIf(IsNull(TBOrdem!QuantNC), "0,000", Format(TBOrdem!QuantNC, "###,##0.000"))
    QTCD = IIf(IsNull(TBOrdem!QTCD), "0,000", Format(TBOrdem!QTCD, "###,##0.000"))
    
    QTProd = QTOK + QTCD + QTNC
    QTProd2 = QTProd

    txtquantreal = Format(TBOrdem!QuantProd, "###,##0.000")
    txtQuantNC = IIf(IsNull(TBOrdem!QuantNC), "0,000", Format(TBOrdem!QuantNC, "###,##0.000"))
    txtQTCD.Text = Format(IIf(IsNull(TBOrdem!QTCD), 0, TBOrdem!QTCD), "###,##0.000")
    txtAprovado.Text = Format(QTOK, "###,##0.000")
    
    'Tempos
    '==============================================================================================
    ' Tempo por unidade previsto e realizado
    '==============================================================================================
    txtpecaprev = IIf(IsNull(TBOrdem!TPP), "00:00:00", TBOrdem!TPP) ' Tempo por unidade previsto
    txtpecautil = IIf(IsNull(TBOrdem!tpr), "00:00:00", TBOrdem!tpr) ' Tempo por unidade realizado
    
    '==============================================================================================
    ' Tempo por ordem previsto e realizado
    '==============================================================================================
    txttempoprevisto = IIf(IsNull(TBOrdem!TTTPrev), "00:00:00", TBOrdem!TTTPrev) ' Tempo por ordem previsto
    txttempoutilizado = IIf(IsNull(TBOrdem!TTTReal), "00:00:00", TBOrdem!TTTReal) ' Tempo por ordem realizado
    
    Txt_eficiencia_prep = IIf(IsNull(TBOrdem!Eficiencia_prep), "0,000", Format(TBOrdem!Eficiencia_prep, "###,##0.000"))
    Txt_eficiencia_exec = IIf(IsNull(TBOrdem!Eficiencia_exec), "0,000", Format(TBOrdem!Eficiencia_exec, "###,##0.000"))
    txtEficiencia = IIf(IsNull(TBOrdem!Eficiencia), "0,000", Format(TBOrdem!Eficiencia, "###,##0.000"))
    
    '==============================================================================================
    ' Tempo por ordem previsto e realizado
    '==============================================================================================
    cpecaprev = IIf(IsNull(TBOrdem!cpp), "0,00000", Format(TBOrdem!cpp, "###,##0.000"))
    txtcustoprev = IIf(IsNull(TBOrdem!CTTPrev), "0,000", Format(TBOrdem!CTTPrev, "###,##0.000"))
    cpecareal = IIf(IsNull(TBOrdem!CPR), "0,00000", Format(TBOrdem!CPR, "###,##0.000"))
    
    CustoUnitario = cpecareal.Text
    TotalProduzido = txtquantreal.Text
    
    If TotalProduzido >= 1 Then
    Custototal = CustoUnitario * TotalProduzido
    End If
    
    If TotalProduzido < 1 And TotalProduzido >= 0.1 Then
    Custototal = (CustoUnitario * TotalProduzido)
    End If
    
'    If TotalProduzido < 0.1 And TotalProduzido >= 0.01 Then
'    Custototal = CustoUnitario * (TotalProduzido * 100)
'    End If
    

    txtcustoefet = Format(Custototal, "###,##0.000") ' IIf(IsNull(TBOrdem!CTTReal), "0,00", Format(TBOrdem!CTTReal, "###,##0.00"))
    
    Txt_custo_material = IIf(IsNull(TBOrdem!CTMaterial), "0,000", Format(TBOrdem!CTMaterial, "###,##0.000"))
    Txt_custo_terceiros = IIf(IsNull(TBOrdem!CTServico), "0,000", Format(TBOrdem!CTServico, "###,##0.000"))
    Txt_custo_outras = IIf(IsNull(TBOrdem!CTOutras), "0,000", Format(TBOrdem!CTOutras, "###,##0.000"))
    
    Valor1 = IIf(txtcustoefet = "", 0, txtcustoefet)
    Valor2 = IIf(Txt_custo_material = "", 0, Txt_custo_material)
    Valor3 = IIf(Txt_custo_terceiros = "", 0, Txt_custo_terceiros)
    ValorConta = IIf(Txt_custo_outras = "", 0, Txt_custo_outras)
    
    Txt_custo_total = Format(Valor1 + Valor2 + Valor3 + ValorConta, "###,##0.000")
                                                'ORDEM          QTDE. PREVISTA                                QTDE. OK                                              QT. PROD.(OK+NC)                                                                                         CUSTO LOTE    CUSTO PEÇA    CUSTO TERCEIROS     CUSTO MATERIAL    CUSTO OUTRAS      ORDEM CONSIGNADA
    If QTProd > 0 Then
    Txt_custo_total_peca = (Valor1 + Valor2 + Valor3 + ValorConta) / QTProd 'FunCalculaValorUnitOrdem(TBOrdem!Ordem, IIf(IsNull(TBOrdem!Quant), 0, TBOrdem!Quant), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd) + IIf(IsNull(TBOrdem!QuantNC), 0, TBOrdem!QuantNC), txtcustoefet, cpecareal, Txt_custo_terceiros, Txt_custo_material, Txt_custo_outras, TBOrdem!consignacao)
    Txt_custo_total_peca = Format(Txt_custo_total_peca, "###,##0.000")
    
    Txt_valor_nc = Txt_custo_total_peca * QTNC 'FunCalculaValorUnitOrdem(TBOrdem!Ordem, IIf(IsNull(TBOrdem!Quant), 0, TBOrdem!Quant), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd) + IIf(IsNull(TBOrdem!QuantNC), 0, TBOrdem!QuantNC), txtcustoefet, cpecareal, Txt_custo_terceiros, Txt_custo_material, Txt_custo_outras, TBOrdem!consignacao)
    Txt_valor_nc = Format(Txt_valor_nc, "###,##0.000")
    End If
    
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select Qtde_Entrada from Qtde_entrada_estoque_produto_produzido_lote where Lote = " & TBOrdem!Ordem, Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
        Txt_qtde_entrada = Format(TBAbrir!Qtde_entrada, "###,##0.000")
        Set TBAbrir = CreateObject("adodb.recordset")
        'StrSql = "select avg(vlrunit) as valor_unitario from Estoque_movimentacao where Desenho = '" & txtdesenho.Text & "'"
        'Strsql= "Select Valor_unitario from Estoque_controle where Lote = '" & TBOrdem!Ordem & "' and Left(Status, 13) = 'ENTRADA_ORDEM'"
        StrSql = "select avg(valor_unitario) as valor_unitario from Estoque_controle where Desenho = '" & txtdesenho.Text & "'"
      
        TBAbrir.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Txt_vlr_unit_estoque = Format(TBAbrir!valor_unitario, "###,##0.000")
        End If
        valor = IIf(Txt_custo_total_peca = "", 0, Txt_custo_total_peca)
        With Txt_vlr_unit_estoque
            Valor1 = IIf(.Text = "", 0, .Text)
            If valor <> Valor1 Then
            .ForeColor = vbRed
            Else
            .ForeColor = vbBlack
            End If
        End With
    Else
        Txt_qtde_entrada = "0,000"
        Txt_vlr_unit_estoque = "0,000"
    End If
    TBAbrir.Close
    
    OF = TBOrdem!Ordem
    
    ProcAtualizalista
    
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select * from Producao_Relatorios_Total", Conexao, adOpenKeyset, adLockOptimistic
    TBAbrir.AddNew
    TBAbrir!QtdePrevista = OF
    TBAbrir!qtdeNC = Txt_valor_nc
    TBAbrir!QtdeProduzida = Txt_custo_total_peca
    TBAbrir!Responsavel = pubUsuario
    TBAbrir!Modulo = Formulario
    TBAbrir.Update
    TBAbrir.Close
End If
TBOrdem.Close
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub APLista_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

ProcOrdenaListView APLista, ColumnHeader

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Chk_carregar_bloqueado_Click()
On Error GoTo tratar_erro

txtCodigo.Text = ""
cmbdescricao.ListIndex = -1
mskData.Value = Date
txtinicioap.Value = "00:00:00"
txtTOK.Text = ""
txtTNC.Text = ""
Txt_descricao_posto = ""
APLista.ListItems.Clear
If Chk_carregar_bloqueado.Value = 1 Then
    ProcCarregaComboPostoTrab txtAPMaquina, "Maquina is not null", False, False
    ProcCarregaComboUsuario cmbOperador, "U.Usuario is not null", False
Else
    ProcCarregaComboPostoTrab txtAPMaquina, "Bloqueado = 'False'", False, False
    ProcCarregaComboUsuario cmbOperador, "U.Bloqueado = 'False'", False
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Chk_italico_Click()
On Error GoTo tratar_erro

txtdescricao.SelItalic = Chk_italico

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Chk_negrito_Click()
On Error GoTo tratar_erro

txtdescricao.SelBold = Chk_negrito

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Chk_sublinhado_Click()
On Error GoTo tratar_erro

txtdescricao.SelUnderline = Chk_sublinhado

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub chkPchora_Click()
On Error GoTo tratar_erro:

With txtPcHora
    If chkPchora.Value = 1 Then
'        .Locked = False
'        .TabStop = True
    Else
'        .Locked = True
'        .TabStop = False
'        .Text = 1
    End If
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_empresa_Click()
On Error GoTo tratar_erro

ProcLimpar True
'Debug.print Modulo_caprind

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_fonte_Click()
On Error GoTo tratar_erro

txtdescricao.SelFontName = Cmb_fonte

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_opcao_lista_Click()
On Error GoTo tratar_erro

With listaitens
    For InitFor = 1 To .ListItems.Count
        .ListItems.Item(InitFor).Checked = False
    Next InitFor
End With

With USToolBar1
    Select Case Cmb_opcao_lista
        Case "Gerar MRP":
            .ButtonState(4) = 0
            .ButtonState(5) = 5
        Case "Cancelar MRP":
            .ButtonState(4) = 5
            .ButtonState(5) = 0
    End Select
    .Refresh
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_opcao_lista1_Click()
On Error GoTo tratar_erro

With ListaOS
    For InitFor = 1 To .ListItems.Count
        .ListItems.Item(InitFor).Checked = False
    Next InitFor
End With

With USToolBar3
    Select Case Cmb_opcao_lista1
        Case "Excluir":
            .ButtonState(3) = 0
            .ButtonState(7) = 5
            .ButtonState(8) = 5
        Case "Status":
            .ButtonState(3) = 5
            .ButtonState(7) = 0
            .ButtonState(8) = 5
        Case "Prazo final":
            .ButtonState(3) = 5
            .ButtonState(7) = 5
            .ButtonState(8) = 0
    End Select
    .Refresh
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_opcao_lista2_Click()
On Error GoTo tratar_erro

With ListaRequisicao
    For InitFor = 1 To .ListItems.Count
        .ListItems.Item(InitFor).Checked = False
    Next InitFor
End With

With USToolBar4
    If Cmb_opcao_lista2 = "Excluir" Then
        .ButtonState(3) = 0
        .ButtonState(7) = 5
    Else
        .ButtonState(3) = 5
        .ButtonState(7) = 0
    End If
    .Refresh
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_opcao_lista3_Click()
On Error GoTo tratar_erro

With Lista
    For InitFor = 1 To .ListItems.Count
        .ListItems.Item(InitFor).Checked = False
    Next InitFor
End With
ProcHabDesBotoesOrdem

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcHabDesBotoesOrdem()
On Error GoTo tratar_erro

With USToolBar2
    If Cmb_opcao_lista3 = "Excluir" Then
        .ButtonState(4) = 0
        .ButtonState(8) = 5
        .ButtonState(9) = 5
    ElseIf Cmb_opcao_lista3 = "Validação" Or Cmb_opcao_lista3 = "Validação resultado" Then
            .ButtonState(4) = 5
            .ButtonState(8) = 5
            .ButtonState(9) = 0
        ElseIf Cmb_opcao_lista3 = "Status" Then
                .ButtonState(4) = 5
                .ButtonState(8) = 0
                .ButtonState(9) = 5
        Else
                .ButtonState(4) = 5
                .ButtonState(8) = 5
                .ButtonState(9) = 5
    End If
    .Refresh
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmb_tamanho_fonte_Click()
On Error GoTo tratar_erro

txtdescricao.SelFontSize = Cmb_tamanho_fonte

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmbAPOS_Click()
On Error GoTo tratar_erro

ProcCarregaDadosOSAP

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCarregaDadosOSAP()
On Error GoTo tratar_erro

ProcLimpaCamposAP
ProcAPabrir

TempoPreparacao = "000:00:00"
TempoExecucao = "000:00:00"
ProcLimparCamposOS
ProcCarregaDadosOS cmbAPOS
ProcLista12Ultimos

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmbOSMaquina_Click()
On Error GoTo tratar_erro

Set TBMaquinas = CreateObject("adodb.recordset")
TBMaquinas.Open "Select Descricao from cadmaquinas where maquina = '" & cmbOSMaquina.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
txtdescmaquina.Text = TBMaquinas!Descricao
End If
TBMaquinas.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmbVersao_Click()
On Error GoTo tratar_erro

Call m_Tree.Nodes.Clear
Grid1.rows = 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_abrir_instrucao_Click()
On Error GoTo tratar_erro

If cmbOSMaquina = "" Then
    USMsgBox ("Informe o posto de trabalho antes de localizar as instruções de trabalho."), vbExclamation, "CAPRIND v5.0"
    cmbOSMaquina.SetFocus
    Exit Sub
End If
Processos_instrucoes = False
FrmInstrucoes_trabalho.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCusto()
On Error GoTo tratar_erro

If Opt_produto_final.Value = True Then Exit Sub
FrmProd_Resultados.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_buscarest_Click()
On Error GoTo tratar_erro

ProcCarregaDadosProdEstImaProc True

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_cor_Click()
On Error GoTo tratar_erro

With CommonDialog1
    .Color = Cor_fonte.BackColor
    .ShowColor
End With
Cor_fonte.BackColor = CommonDialog1.Color
txtdescricao.SelColor = CommonDialog1.Color

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_custo_outras_Click()
On Error GoTo tratar_erro

frmprod_outras_despesas.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcEntradaEstoqueOrdem()
On Error GoTo tratar_erro

Set TBOrdem = CreateObject("adodb.recordset")

TBOrdem.Open "Select * from Producao where Ordem = " & NOrdem & "", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then

ValorTotal = 0
quantestoque = 0
TextoFiltro = "ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and desenho = '" & TBOrdem!Desenho & "' and lote = '" & NOrdem & "' and local_armaz = 'ESTOQUE PADRÃO' and corrida = '0' and certificado = '0'"

Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select * from estoque_controle where " & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBEstoque.EOF = True Then
    TBEstoque.AddNew
    TBEstoque!LOTE = NOrdem
End If

Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select * from Estoque_movimentacao", Conexao, adOpenKeyset, adLockOptimistic
TBProduto.AddNew

TBProduto!Destino = "Interno"
TBProduto!Terceiros = False
TBEstoque!ID_empresa = Cmb_empresa.ItemData(Cmb_empresa.ListIndex)

TBProduto!LOTE = NOrdem
    
TBEstoque!Desenho = TBOrdem!Desenho
TBProduto!Desenho = TBOrdem!Desenho

'Atualiza valor do produto no estoque
Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select Codproduto, UNIDADE,Estoque, classe from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBItem.EOF = False Then
    If TBItem!Estoque = True Then ControlaEstoque = True Else ControlaEstoque = False
    TBEstoque!Classe = TBItem!Classe
    TBProduto!Familia = TBItem!Classe
    TBEstoque!Un = TBItem!Unidade
'    TBProduto!Un = TBItem!Unidade
   
    'Grava código de referência no produto
    If cmbReferencia <> "" Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from item_aplicacoes where Codproduto = " & TBItem!Codproduto & " and n_referencia = '" & cmbReferencia & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = True Then TBAbrir.AddNew
        TBAbrir!Codproduto = TBItem!Codproduto
        TBAbrir!N_referencia = cmbReferencia
        TBAbrir!Descricao = IIf(txtdescricao = "", Null, txtdescricao)
        TBAbrir.Update
        TBAbrir.Close
    End If
    
    TBEstoque!Ref = IIf(cmbReferencia = "", Null, cmbReferencia)
End If
TBItem.Close

ValorTotal = txtvlrUnit

'Estoque_movimentação
quantestoque = TBOrdem!Quant
TBProduto!VlrUnit = Format(ValorTotal, "###,##0.0000000000")
TBProduto!vlrTotal = Format(ValorTotal * quantestoque, "###,##0.00")

TBEstoque!Descricao = TBOrdem!Produto
TBProduto!Descricao = TBOrdem!Produto
'=========================================================================
' Acerta data da RE e da movimentação
'=========================================================================
TBEstoque!Data = frmProd_EncerrarOrdem.dtEncerramento.Value
TBProduto!Data = frmProd_EncerrarOrdem.dtEncerramento.Value
'=========================================================================
TBEstoque!Responsavel = pubUsuario
TBProduto!Responsavel = pubUsuario
TBEstoque!Certificado = 0
TBEstoque!Numero_serie = 0
TBEstoque!Corrida = 0
TBEstoque!local_armaz = "ESTOQUE PADRÃO"
TBProduto!Entrada = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBProduto!Entrada_PC = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBEstoque!Qtde = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
Qtde = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
Entrada = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBProduto!Operacao = "ENTRADA_ORDEM"
TBEstoque!status = "ENTRADA_ORDEM"
TBEstoque!Cliente = TBOrdem!Cliente

If ControlaEstoque = True Then
QtdeEstoque = frmProd_EncerrarOrdem.txtQuantProd
Else
QtdeEstoque = 0
End If

TBProduto!estoque_venda = QtdeEstoque
TBProduto!Obs = ""
TBProduto.Update


TBEstoque!estoque_real = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBEstoque!estoque_real_PC = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBEstoque!estoque_venda = frmProd_EncerrarOrdem.txtQuantProd 'TBOrdem!Quant
TBEstoque!valor_unitario = Format(ValorTotal, "###,##0.0000000000")
TBEstoque!Valor_total = Format(QtdeEstoque * ValorTotal, "###,##0.00")

'Verifica se a ordem é consignada
If IsNumeric(NOrdem) = True Then
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open "Select * from producao where Ordem = " & NOrdem & " and Status <> 'Cancelada' and ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex), Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
        TBEstoque!ID_Cliente = TBproducao!IDCliente
        TBEstoque!Cliente = TBproducao!Cliente
        If TBproducao!Consignacao = True Then TBEstoque!Consignacao = True Else TBEstoque!Consignacao = False
    End If
    TBproducao.Close
End If
TBEstoque.Update

Conexao.Execute "UPDATE Estoque_movimentacao Set IDEstoque = " & TBEstoque!IDEstoque & " where IDoperacao = " & TBProduto!IDoperacao
IDEstoque = TBEstoque!IDEstoque
'ProcEmpenhaProdutoeAtualQtdeEntEmpOrdem  NOrdem, TBOrdem!Desenho, Entrada, TBEstoque!IDestoque

'==================================
Modulo = "Estoque/Movimentação/Entrada"
Evento = "Entrar"
ID_documento = IDEstoque
Documento = "Cód. interno: " & TBOrdem!Desenho & " - Lote: " & NOrdem & " - Corrida: 0  - Certificado: 0 - Qtde.: " & Format(TBOrdem!Quant, "###,##0.0000")
Documento1 = ""
ProcGravaEvento
'==================================

End If
TBOrdem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_QTEmpenhado_Click()
On Error GoTo tratar_erro

If TxtEstCodigo = "" Then Exit Sub
Desenho = TxtEstCodigo
PCP_Ordem = True
frmEstoque_Empenho.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_QTEmpenhado_prod_Click()
On Error GoTo tratar_erro

If TxtEstCodigo = "" Then Exit Sub
frmprod_empenhos_produzindo.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_filtrar_cod_prod_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If Txt_cod_prod <> "" Then
    ProcFiltrarPadrao "P.Codigo_produto = '" & Txt_cod_prod & "'"
    FormulaRel_Ordem = "{Producao.Codigo_produto} = '" & Codigo_produto & "'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_visualizar_arquivo_Click()
On Error GoTo tratar_erro

If txtdesenho = "" Then Exit Sub
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select imagem from projproduto where desenho = '" & txtdesenho & "' and imagem is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = False Then
    If TBProduto!imagem <> "" Then ProcAbrirArquivo TBProduto!imagem
End If
TBProduto.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmd_visualizar_arquivo1_Click()
On Error GoTo tratar_erro

If TxtEstCodigo = "" Then Exit Sub
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select imagem from projproduto where desenho = '" & TxtEstCodigo & "' and imagem is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = False Then
    If TBProduto!imagem <> "" Then ProcAbrirArquivo TBProduto!imagem
End If
TBProduto.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdAPOS_Click()
On Error GoTo tratar_erro

If cmbAPOS.Text = "" Or txtAPMaquina.Text = "" Then
    USMsgBox ("Selecione a ordem de serviço e o posto de trabalho antes de filtrar."), vbInformation, "CAPRIND v5.0"
    Exit Sub
End If
ProcAtualizaProducao

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcBaixar_estoque_ordem()
On Error GoTo tratar_erro

'Busca na requisição de materiais itens que ainda não sairam
Set TBMaterial = CreateObject("adodb.recordset")
TBMaterial.Open "Select * from Producaomaterial where ordem = " & NOrdem & " and saida <> 'SIM'", Conexao, adOpenKeyset, adLockOptimistic
If TBMaterial.EOF = False Then

Do While TBMaterial.EOF = False
'Busca material consignado empenhado para essa ordem
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from Producao_NF_Consignada where Ordem = " & NOrdem & " and Codinterno = '" & TBMaterial!CODIGO & "' and Quantidade - ISNULL(Qtde_saida, 0) > 0 order by Codinterno", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                Do While TBproducao.EOF = False
                    Set TBEstoque = CreateObject("adodb.recordset")
                    TBEstoque.Open "Select * from estoque_controle where IDestoque = " & TBproducao!IDEstoque & " and estoque_real > 0", Conexao, adOpenKeyset, adLockOptimistic
                    If TBEstoque.EOF = False Then
                        Permitido2 = True
                        ProcRetirarEstoqueOrdem True
                        Modificado = True
                    End If
                    TBEstoque.Close
                    
                    Desenho = TBproducao!Codinterno
                    TBproducao.MoveNext
                Loop
            End If
            TBproducao.Close
            
            If optconsignacao.Value = 1 Then
            TextoFiltro = "(EP.Consignacao = 'True' and EP.id_cliente = " & Txt_ID_cliente & " and EP.Cliente = '" & txtCliente & "' or EP.Consignacao = 'False')"
            Else
            TextoFiltro = "EP.Consignacao = 'False'"
            End If
            
            Set TBEstoque = CreateObject("adodb.recordset")
            TBEstoque.Open "Select EP.* from Estoque_produtos EP where EP.ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and EP.Desenho = '" & TBMaterial!CODIGO & "' and EP.Estoque_real > 0 and EP.Liberado = 'SIM' and " & TextoFiltro & " order by EP.Data, EP.IdEstoque", Conexao, adOpenKeyset, adLockOptimistic
'            TBEstoque.Open "Select EP.* from Estoque_produtos EP INNER JOIN Estoque_Localarmazenamento_criar EL ON EL.descricao = EP.local_armaz where EP.ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and EP.Desenho = '" & TBMaterial!CODIGO & "' and EP.Estoque_real > 0 and EP.Liberado = 'SIM' AND EL.Estoque = 'False' and " & TextoFiltro & " order by EP.Data, EP.IdEstoque", Conexao, adOpenKeyset, adLockOptimistic
            If TBEstoque.EOF = False Then
                Permitido2 = False
                ProcRetirarEstoqueOrdem False
                Modificado = True
            End If
            TBEstoque.Close
        
TBMaterial.MoveNext
Loop
End If


Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcBaixar_estoque()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Permitido = False
Permitido1 = False
Permitido2 = False
Desenho = ""
With ListaRequisicao
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True And (.ListItems.Item(InitFor).SubItems(7) = "REQUISITADO" Or .ListItems.Item(InitFor).SubItems(7) = "PARCIAL") Then
            If Permitido = False Then
                If .ListItems.Item(InitFor).SubItems(8) = "Alternativo" Then
                    USMsgBox "Não é permitido baixar item alternativo", vbInformation, "CAPRIND v5.0"
                    Exit Sub
                End If
                
                If USMsgBox("Deseja realmente Baixar este(s) material(ais) do estoque?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
            
            

            Modificado = False
            Permitido = True
            Set TBproducao = CreateObject("adodb.recordset")
'===================================================================
' Verifica se está empenhado algum lote
'===================================================================
            TBproducao.Open "Select * from Producao_NF_Consignada where Ordem = " & txtof & " and Codinterno = '" & .ListItems.Item(InitFor).SubItems(1) & "' order by Codinterno", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                Do While TBproducao.EOF = False
                    Set TBEstoque = CreateObject("adodb.recordset")
                    TBEstoque.Open "Select * from estoque_controle where IDestoque = " & TBproducao!IDEstoque & "", Conexao, adOpenKeyset, adLockOptimistic
                    If TBEstoque.EOF = False Then
                        Permitido2 = True
                        QTBaixar = TBproducao!quantidade
                        QTEmpenhado = TBproducao!quantidade
                        ProcBaixarempenhos
                        Modificado = True
                    End If
                    TBEstoque.Close
                    
                    Desenho = TBproducao!Codinterno
                    TBproducao.MoveNext
                Loop
            End If
'=============================================================================
' Acerta status materia prima
'=============================================================================
'Set TBMateriaprima = CreateObject("adodb.recordset")
'TBMateriaprima.Open "Select * from Producaomaterial where Idmateriaprima = " & .ListItems.Item(InitFor), Conexao, adOpenKeyset, adLockOptimistic
'If TBMateriaprima.EOF = False Then
'If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
'If QtdeSaidaPC >= qtdeliberada Then TBMateriaprima!Saida = "SIM" Else TBMateriaprima!Saida = "PARCIAL"
'Else
'If QtdeSaida >= qtdeliberada Then
'TBMateriaprima!Saida = "SIM"
'Else
'TBMateriaprima!Saida = "PARCIAL"
'End If
'End If
'TBMateriaprima!Valor_saida_estoque = TBMateriaprima!Valor_saida_estoque + Format(QtdeSaida * TBEstoque!valor_unitario, "###,##0.00")
'TBMateriaprima.Update

    
'End If
TBproducao.Close
'===============================================================================
' Verifica se é materia prima consignada
'===============================================================================
If optconsignacao.Value = 1 Then
TextoFiltro = "(EP.Consignacao = 'True' and EP.id_cliente = " & Txt_ID_cliente & " and EP.Cliente = '" & txtCliente & "' or EP.Consignacao = 'False')"
Else
TextoFiltro = "EP.Consignacao = 'False'"
End If

Set TBEstoque = CreateObject("adodb.recordset")
StrSql = "Select EP.* from Estoque_produtos EP where EP.ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and EP.Desenho = '" & ListaRequisicao.ListItems.Item(InitFor).SubItems(1) & "' and EP.Estoque_real > 0 and EP.Liberado = 'SIM' and " & TextoFiltro & " order by EP.Data, EP.IdEstoque"
'Debug.print StrSql

TBEstoque.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
If TBEstoque.EOF = False Then
Permitido2 = False
ProcRetirarEstoque False
Modificado = True
End If
TBEstoque.Close

End If

Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe o(s) material(ais) antes de dar baixa no estoque."), vbExclamation, "CAPRIND v5.0"
Else
    If Permitido1 = True Then
        USMsgBox ("Material(ais) retirado(s) do estoque com sucesso."), vbInformation, "CAPRIND v5.0"
        ProcCarregaListaRequisicao
        ProcCarregaListaEmpenhos
    Else
        USMsgBox ("O(s) material(ais) não foi(ram) retirado(s) do estoque."), vbExclamation, "CAPRIND v5.0"
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcQTBaixar_estoque_ordem()
On Error GoTo tratar_erro

'Busca na requisição de materiais itens que ainda não sairam
Set TBMaterial = CreateObject("adodb.recordset")
TBMaterial.Open "Select * from Producaomaterial where ordem = " & NOrdem & " and saida <> 'SIM'", Conexao, adOpenKeyset, adLockOptimistic
If TBMaterial.EOF = False Then

Do While TBMaterial.EOF = False
'Busca material consignado QTEmpenhado para essa ordem
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from Producao_NF_Consignada where Ordem = " & NOrdem & " and Codinterno = '" & TBMaterial!CODIGO & "' and Quantidade - ISNULL(Qtde_saida, 0) > 0 order by Codinterno", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                Do While TBproducao.EOF = False
                    Set TBEstoque = CreateObject("adodb.recordset")
                    TBEstoque.Open "Select * from estoque_controle where IDestoque = " & TBproducao!IDEstoque & " and estoque_real > 0", Conexao, adOpenKeyset, adLockOptimistic
                    If TBEstoque.EOF = False Then
                        Permitido2 = True
                        ProcRetirarEstoqueOrdem True
                        Modificado = True
                    End If
                    TBEstoque.Close
                    
                    Desenho = TBproducao!Codinterno
                    TBproducao.MoveNext
                Loop
            End If
            TBproducao.Close
            
            If optconsignacao.Value = 1 Then
            TextoFiltro = "(EP.Consignacao = 'True' and EP.id_cliente = " & Txt_ID_cliente & " and EP.Cliente = '" & txtCliente & "' or EP.Consignacao = 'False')"
            Else
            TextoFiltro = "EP.Consignacao = 'False'"
            End If
            
            Set TBEstoque = CreateObject("adodb.recordset")
            TBEstoque.Open "Select EP.* from Estoque_produtos EP where EP.ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and EP.Desenho = '" & TBMaterial!CODIGO & "' and EP.Estoque_real > 0 and EP.Liberado = 'SIM' and " & TextoFiltro & " order by EP.Data, EP.IdEstoque", Conexao, adOpenKeyset, adLockOptimistic
'            TBEstoque.Open "Select EP.* from Estoque_produtos EP INNER JOIN Estoque_Localarmazenamento_criar EL ON EL.descricao = EP.local_armaz where EP.ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and EP.Desenho = '" & TBMaterial!CODIGO & "' and EP.Estoque_real > 0 and EP.Liberado = 'SIM' AND EL.Estoque = 'False' and " & TextoFiltro & " order by EP.Data, EP.IdEstoque", Conexao, adOpenKeyset, adLockOptimistic
            If TBEstoque.EOF = False Then
                Permitido2 = False
                ProcRetirarEstoqueOrdem False
                Modificado = True
            End If
            TBEstoque.Close
        
TBMaterial.MoveNext
Loop
End If


Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub


Sub ProcRetirarEstoque(QTBaixarQTEmpenhado As Boolean)
On Error GoTo tratar_erro
qtdeliberar = 0

With ListaRequisicao
    'vERIFICA SE CONTROLA EM PÇ
    '=====================================================================
    If Modificado = False Then
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 And .ListItems.Item(InitFor).SubItems(6) <> "" And .ListItems.Item(InitFor).SubItems(6) <> "0" Then
            qtdeliberar = .ListItems.Item(InitFor).SubItems(4)
            CampoFiltro = "Saida_PC"
        Else
            qtdeliberar = .ListItems.Item(InitFor).SubItems(4)
            CampoFiltro = "Saida"
        End If
        Saida = 0
'==============================
' vERIFICA SE JÁ BAIXOU ALGUMA QUANTIDADE
'============================================
        Set TBFI = CreateObject("adodb.recordset")
        TBFI.Open "Select " & CampoFiltro & " as Saida from Qtde_saida_estoque_produto where Ordem = " & txtof & " and Desenho = '" & .ListItems.Item(InitFor).SubItems(1) & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBFI.EOF = False Then
            qtdeliberar = qtdeliberar - IIf(IsNull(TBFI!Saida), 0, TBFI!Saida)
        End If
        TBFI.Close
        qtdeliberada = qtdeliberar 'Quantidade requisitada - baixada
        
        'Verifica se tem empenho para a ordem e pedido interno
        Set TBFI = CreateObject("adodb.recordset")
        StrSql = "Select SUM(PP.Qtde_empenho) AS Qtde_empenho from Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem and P.Desenho = '" & .ListItems.Item(InitFor).SubItems(1) & "' where PP.OrdemEmpenho = " & txtof
        'Debug.print StrSql
        
        TBFI.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
        If TBFI.EOF = False Then
            qtdeliberar = qtdeliberar - IIf(IsNull(TBFI!Qtde_empenho), 0, TBFI!Qtde_empenho)
        End If
        TBFI.Close
    End If
    
    Qtde = qtdeliberar
'    If QTBaixarQTEmpenhado = True Then
'        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBproducao!Quantidade_PC) = False And TBproducao!Quantidade_PC > 0 Then Qtde = TBproducao!Quantidade_PC Else Qtde = TBproducao!quantidade
'    End If
    Qtd = 0
    
            Set TBAbrir = CreateObject("adodb.recordset")
            
            TBAbrir.Open "select Sum(Entrada) - Sum(Saida) as Saldo from Estoque_movimentacao where Idestoque = '" & TBEstoque!IDEstoque & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
            StrSql = "update estoque_controle set Estoque_real = '" & Replace(TBAbrir!Saldo, ",", ".") & "' from Estoque_controle where IDEstoque = '" & TBEstoque!IDEstoque & "'"
            'Debug.print StrSql
            QTSaldo = TBAbrir!Saldo
            Conexao.Execute (StrSql)
            End If
            TBAbrir.Close
    
    
    Do While TBEstoque.EOF = False And Qtde > 0
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            Qtd = TBEstoque!estoque_real_PC
            Qtd = Qtd - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & txtof, True)
        Else
            Qtd = QTSaldo
            Qtd = Qtd - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & txtof, False)
            If Qtd = 0 Then Qtd = QTSaldo
        End If
        Qtd = Qtd - FunVerificaQtdeEmpenhoREPI("ID_estoque = " & TBEstoque!IDEstoque)
        If Qtd = 0 Then Qtd = QTSaldo
        
        If Qtd <= 0 Then GoTo Proximo
        
        If Permitido2 = False Then
            If Qtde > Qtd Then
                If USMsgBox("Deseja utilizar mais que um lote para o material " & TBEstoque!Desenho & "?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
        End If
        Permitido2 = True
        
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            If Qtde >= Qtd Then QtdeSaidaPC = Qtd Else QtdeSaidaPC = Qtde
            QtdeSaida = FunCalculaQtdePCKG(TBEstoque!estoque_real, TBEstoque!estoque_real_PC, QtdeSaidaPC, False)
        Else
            If Qtde >= Qtd Then QtdeSaida = Qtd Else QtdeSaida = Qtde
            QtdeSaidaPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), QtdeSaida, True)
        End If
            
        'Arruma status materia prima
        Set TBMateriaprima = CreateObject("adodb.recordset")
        TBMateriaprima.Open "Select * from Producaomaterial where Idmateriaprima = " & .ListItems.Item(InitFor), Conexao, adOpenKeyset, adLockOptimistic
        If TBMateriaprima.EOF = False Then
            If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
                If QtdeSaidaPC >= qtdeliberada Then TBMateriaprima!Saida = "SIM" Else TBMateriaprima!Saida = "PARCIAL"
            Else
                If QtdeSaida >= qtdeliberada Then
                 TBMateriaprima!Saida = "SIM"
                Else
                 TBMateriaprima!Saida = "PARCIAL"
                End If
            End If
            TBMateriaprima!Valor_saida_estoque = TBMateriaprima!Valor_saida_estoque + Format(QtdeSaida * TBEstoque!valor_unitario, "###,##0.00")
            TBMateriaprima.Update
            
            'Atualiza qtde. de saída do empenho da ordem
            QuantEmpenho = 0
            QuantEmpenhoPC = 0
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select Sum(Saida) as QuantEmpenho, Sum(ISNULL(Saida_PC, 0)) as QuantEmpenhoPC from estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and oe = '" & txtof & "' and desenho = '" & .ListItems.Item(InitFor).ListSubItems(1) & "' and documento = '" & txtof & "' and (operacao = 'SAIDA_ORDEM' or operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                QuantEmpenho = IIf(IsNull(TBFIltro!QuantEmpenho), 0, Format(TBFIltro!QuantEmpenho, "###,##0.0000"))
                QuantEmpenhoPC = IIf(IsNull(TBFIltro!QuantEmpenhoPC), 0, TBFIltro!QuantEmpenhoPC)
                QuantEmpenho = QuantEmpenho + QtdeSaida
                QuantEmpenhoPC = QuantEmpenhoPC + QtdeSaidaPC
            End If
            NovoValor = Replace(QuantEmpenho, ",", ".")
            NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
            Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & NovoValor & ", Qtde_saida_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & txtof & " and Codinterno = '" & .ListItems.Item(InitFor).ListSubItems(1) & "'"
        End If
        TBMateriaprima.Close
        
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select * from projproduto where Desenho = '" & .ListItems.Item(InitFor).SubItems(1) & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProduto.EOF = False Then
            If TBProduto!Estoque = True Then
                QuantEmpenho = Format(TBEstoque!estoque_real - QtdeSaida, "###,##0.0000")
                QuantEmpenhoPC = IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC) - QtdeSaidaPC
            Else
                QuantEmpenho = 0
                QuantEmpenhoPC = 0
            End If
            NovoValor = Replace(QuantEmpenho, ",", ".")
            NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
            Conexao.Execute "UPDATE Estoque_controle Set Estoque_real = " & NovoValor & ", Estoque_real_PC = " & NovoValor1 & ", Estoque_venda = " & NovoValor & ", peso_unit = '" & IIf(IsNull(TBProduto!peso_metro), "", TBProduto!peso_metro) & "', Pedido = '" & IIf(IsNull(TBProduto!Un_Kg), "", TBProduto!Un_Kg) & "' where IDestoque = " & TBEstoque!IDEstoque
        End If
        TBProduto.Close
            
        'Atualiza valor do total no estoque
        Conexao.Execute "UPDATE Estoque_controle Set Valor_Total = ROUND(valor_unitario * Estoque_real, 2) where IDestoque = " & TBEstoque!IDEstoque
               
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select * from Estoque_movimentacao", Conexao, adOpenKeyset, adLockOptimistic
        TBProduto.AddNew
        TBProduto!Destino = "Interno"
        TBProduto!Terceiros = False
        TBProduto!Documento = txtof.Text
        TBProduto!LOTE = IIf(IsNull(TBEstoque!LOTE), "", TBEstoque!LOTE)
        TBProduto!Desenho = IIf(IsNull(TBEstoque!Desenho), "", TBEstoque!Desenho)
        TBProduto!Data = IIf(IsNull(DataOrdem) = True, DataOrdem, Date)
        TBProduto!Descricao = IIf(IsNull(TBEstoque!Descricao), "", TBEstoque!Descricao)
        TBProduto!Familia = IIf(IsNull(TBEstoque!Classe), "", TBEstoque!Classe)
        TBProduto!Requisitante = pubUsuario
        TBProduto!Responsavel = pubUsuario
        TBProduto!IDEstoque = TBEstoque!IDEstoque
        TBProduto!Ordem = txtof.Text
        TBProduto!OE = txtof.Text
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            If QtdeSaidaPC >= qtdeliberada Then TBProduto!Operacao = "SAIDA_ORDEM" Else TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
            qtdeliberada = qtdeliberada - QtdeSaidaPC
        Else
            If QtdeSaida >= qtdeliberada Then TBProduto!Operacao = "SAIDA_ORDEM" Else TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
            qtdeliberada = qtdeliberada - QtdeSaida
        End If
        
        If qtdeliberar >= Qtd Then
            Qtde = Qtde - Qtd
            qtdeliberar = qtdeliberar - Qtd
        Else
            Qtde = 0
            qtdeliberar = 0
        End If
        
        TBProduto!Saida = QtdeSaida
        TBProduto!Saida_PC = QtdeSaidaPC
        TBProduto!estoque_venda = QtdeSaida
    
        'Atualiza valor do material no estoque
        TBProduto!VlrUnit = IIf(IsNull(TBEstoque!valor_unitario), 0, Format(TBEstoque!valor_unitario, "###,##0.0000000000"))
        TBProduto!vlrTotal = Format(QtdeSaida * TBProduto!VlrUnit, "###,##0.00")
            
        '==================================
        Modulo = "PCP/Gerenciamento de ordem"
        Evento = "Retirar material do estoque"
        ID_documento = .ListItems.Item(InitFor)
        Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
        Documento1 = "Cód. interno: " & TBEstoque!Desenho & " - RE: " & TBEstoque!IDEstoque
        ProcGravaEvento
        '==================================
        Permitido1 = True
        
        TBProduto.Update
        
        'Centro de custo
        IDlista = TBProduto!IDoperacao
        Set TBItem = CreateObject("adodb.recordset")
        TBItem.Open "Select * from projproduto where desenho = '" & TBEstoque!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBItem.EOF = False Then
            Codproduto = TBItem!Codproduto
            IDAntigo = IIf(IsNull(TBItem!ID_PC), 0, TBItem!ID_PC)
        End If
        TBItem.Close
        
        ProcCriaCreditoCCProdutoItem
        
        ProcAtualizaCTMaterialOrdem Cmb_empresa.ItemData(Cmb_empresa.ListIndex), txtof
    
        TBProduto.Close

Proximo:
        TBEstoque.MoveNext
    Loop
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcBaixarempenhos()
On Error GoTo tratar_erro

With ListaRequisicao
    
'=============================================================================
' Acerta saldo da RE
'=============================================================================
Set TBAbrir = CreateObject("adodb.recordset")

TBAbrir.Open "select Sum(Entrada) - Sum(Saida) as Saldo from Estoque_movimentacao where Idestoque = '" & TBEstoque!IDEstoque & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
StrSql = "update estoque_controle set Estoque_real = '" & Replace(TBAbrir!Saldo, ",", ".") & "' from Estoque_controle where IDEstoque = '" & TBEstoque!IDEstoque & "'"
'Debug.print StrSql
QTSaldo = TBAbrir!Saldo
Conexao.Execute (StrSql)
End If
TBAbrir.Close

'========================================================
'Atualiza qtde. de saída no empenho do item da requisicao
'========================================================
'QuantEmpenho = 0
'QuantEmpenhoPC = 0
'Set TBFIltro = CreateObject("adodb.recordset")
'StrSql = "Select Sum(Saida) as QuantEmpenho, Sum(ISNULL(Saida_PC, 0)) as QuantEmpenhoPC from estoque_movimentacao where IDestoque = " & TBEstoque!IDestoque & " and oe = '" & txtOF & "' and desenho = '" & .ListItems.Item(InitFor).ListSubItems(1) & "' and documento = '" & txtOF & "' and (operacao = 'SAIDA_ORDEM' or operacao = 'SAIDA_ORDEM_PARCIAL')"
'Debug.print StrSql
'
'TBFIltro.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
'If TBFIltro.EOF = False Then
'QuantEmpenho = IIf(IsNull(TBFIltro!QuantEmpenho), 0, Format(TBFIltro!QuantEmpenho, "###,##0.0000"))
'QuantEmpenhoPC = IIf(IsNull(TBFIltro!QuantEmpenhoPC), 0, TBFIltro!QuantEmpenhoPC)
'QuantEmpenho = QuantEmpenho + QtdeSaida
'QuantEmpenhoPC = QuantEmpenhoPC + QtdeSaidaPC
'End If
'NovoValor = Replace(QuantEmpenho, ",", ".")
'NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & Replace(QTBaixar, ",", ".") & ", Qtde_saida_PC = " & Replace(QTBaixar, ",", ".") & " where IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & txtof & " and Codinterno = '" & .ListItems.Item(InitFor).ListSubItems(1) & "'"

'TBMateriaprima.Close
        
'===================================================================================
' Se o tem controle estoque, atualiza saldo no estoque controle da RE
'===================================================================================
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select * from projproduto where Desenho = '" & .ListItems.Item(InitFor).SubItems(1) & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = False Then
If TBProduto!Estoque = True Then
QuantEmpenho = Format(TBEstoque!estoque_real - QTBaixar, "###,##0.0000")
QuantEmpenhoPC = IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC) - QTBaixar
Else
QuantEmpenho = 0
QuantEmpenhoPC = 0
End If
NovoValor = Replace(QuantEmpenho, ",", ".")
NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
Conexao.Execute "UPDATE Estoque_controle Set Estoque_real = " & NovoValor & ", Estoque_real_PC = " & NovoValor1 & ", Estoque_venda = " & NovoValor & ", peso_unit = '" & IIf(IsNull(TBProduto!peso_metro), "", TBProduto!peso_metro) & "', Pedido = '" & IIf(IsNull(TBProduto!Un_Kg), "", TBProduto!Un_Kg) & "' where IDestoque = " & TBEstoque!IDEstoque
'==========================================================================================
'Atualiza valor do total no estoque
'==========================================================================================
Conexao.Execute "UPDATE Estoque_controle Set Valor_Total = ROUND(valor_unitario * Estoque_real, 2) where IDestoque = " & TBEstoque!IDEstoque
End If
TBProduto.Close
DataOrdem = txtData.Text
'==========================================================================================
'Criar movimentação da baixa em estoque_movimentação
'==========================================================================================
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select * from Estoque_movimentacao", Conexao, adOpenKeyset, adLockOptimistic
TBProduto.AddNew
TBProduto!Destino = "Interno"
TBProduto!Terceiros = False
TBProduto!Documento = txtof.Text
TBProduto!LOTE = IIf(IsNull(TBEstoque!LOTE), "", TBEstoque!LOTE)
TBProduto!Desenho = IIf(IsNull(TBEstoque!Desenho), "", TBEstoque!Desenho)
TBProduto!Data = IIf(IsNull(DataOrdem) = True, DataOrdem, Date)
TBProduto!Descricao = IIf(IsNull(TBEstoque!Descricao), "", TBEstoque!Descricao)
TBProduto!Familia = IIf(IsNull(TBEstoque!Classe), "", TBEstoque!Classe)
TBProduto!Requisitante = pubUsuario
TBProduto!Responsavel = pubUsuario
TBProduto!IDEstoque = TBEstoque!IDEstoque
TBProduto!Ordem = txtof.Text
TBProduto!OE = txtof.Text
TBProduto!Operacao = "SAIDA_ORDEM"

TBProduto!Saida = QTBaixar
TBProduto!Saida_PC = QTBaixar
TBProduto!estoque_venda = QTBaixar
'==============================================================================
'Atualiza valor do material no estoque
'==============================================================================
TBProduto!VlrUnit = IIf(IsNull(TBEstoque!valor_unitario), 0, Format(TBEstoque!valor_unitario, "###,##0.0000000000"))
TBProduto!vlrTotal = Format(QTBaixar * TBProduto!VlrUnit, "###,##0.00")
'==============================================================================
' Grava o evento realizado pra controle
'==============================================================================
Modulo = "PCP/Gerenciamento de ordem"
Evento = "Retirar material do estoque"
ID_documento = .ListItems.Item(InitFor)
Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
Documento1 = "Cód. interno: " & TBEstoque!Desenho & " - RE: " & TBEstoque!IDEstoque
ProcGravaEvento
Permitido1 = True
TBProduto.Update
'==================================
'Centro de custo
'==================================
IDlista = TBProduto!IDoperacao
Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select * from projproduto where desenho = '" & TBEstoque!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBItem.EOF = False Then
Codproduto = TBItem!Codproduto
IDAntigo = IIf(IsNull(TBItem!ID_PC), 0, TBItem!ID_PC)
End If
TBItem.Close

ProcCriaCreditoCCProdutoItem

ProcAtualizaCTMaterialOrdem Cmb_empresa.ItemData(Cmb_empresa.ListIndex), txtof

TBProduto.Close
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub



Sub ProcRetirarEstoqueOrdem(QTBaixarQTEmpenhado As Boolean)
On Error GoTo tratar_erro

    'Só verifica quando for a primeira vez do produto
    If Modificado = False Then
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 And TBMaterial!Requisitado <> "" And TBMaterial!Requisitado <> "0" Then
            qtdeliberar = TBMaterial!Requisitado
            CampoFiltro = "Saida_PC"
        Else
            qtdeliberar = TBMaterial!Requisitado
            CampoFiltro = "Saida"
        End If
        Saida = 0
        Set TBFI = CreateObject("adodb.recordset")
        TBFI.Open "Select " & CampoFiltro & " as Saida from Qtde_saida_estoque_produto where Ordem = " & NOrdem & " and Desenho = '" & TBMaterial!CODIGO & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBFI.EOF = False Then
            qtdeliberar = qtdeliberar - IIf(IsNull(TBFI!Saida), 0, TBFI!Saida)
        End If
        TBFI.Close
        qtdeliberada = qtdeliberar 'Quantidade requisitada - baixada
        
        'Verifica se tem empenho para a ordem e pedido interno
        Set TBFI = CreateObject("adodb.recordset")
        TBFI.Open "Select SUM(PP.Qtde_empenho) AS Qtde_empenho from Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem and P.Desenho = '" & TBMaterial!CODIGO & "' where PP.OrdemEmpenho = " & NOrdem, Conexao, adOpenKeyset, adLockOptimistic
        If TBFI.EOF = False Then
            qtdeliberar = qtdeliberar - IIf(IsNull(TBFI!Qtde_empenho), 0, TBFI!Qtde_empenho)
        End If
        TBFI.Close
    End If
    
    Qtde = TBMaterial!Requisitado
    If QTBaixarQTEmpenhado = True Then
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBproducao!Quantidade_PC) = False And TBproducao!Quantidade_PC > 0 Then Qtde = TBproducao!Quantidade_PC Else Qtde = TBproducao!quantidade
    End If
    Qtd = 0
    Do While TBEstoque.EOF = False And Qtde > 0
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            Qtd = TBEstoque!estoque_real_PC
            Qtd = Qtd - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem <> " & NOrdem, True)
        Else
            Qtd = TBEstoque!estoque_real
            Qtd = Qtd - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem <> " & NOrdem, False)
        End If
        Qtd = Qtd - FunVerificaQtdeEmpenhoREPI("ID_estoque = " & TBEstoque!IDEstoque)
        If Qtd <= 0 Then GoTo Proximo
        
        If Permitido2 = False Then
            If Qtde > Qtd Then
                If USMsgBox("Deseja utilizar mais que um lote para o material " & TBEstoque!Desenho & "?", vbYesNo, "CAPRIND") = vbNo Then Exit Sub
            End If
        End If
        Permitido2 = True
        
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            If Qtde >= Qtd Then QtdeSaidaPC = Qtd Else QtdeSaidaPC = Qtde
            QtdeSaida = FunCalculaQtdePCKG(TBEstoque!estoque_real, TBEstoque!estoque_real_PC, QtdeSaidaPC, False)
        Else
            If Qtde >= Qtd Then QtdeSaida = Qtd Else QtdeSaida = Qtde
            QtdeSaidaPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), QtdeSaida, True)
        End If
            
        'Arruma status materia prima
        Set TBMateriaprima = CreateObject("adodb.recordset")
        TBMateriaprima.Open "Select * from Producaomaterial where Idmateriaprima = " & TBMaterial!IdMateriaPrima, Conexao, adOpenKeyset, adLockOptimistic
        If TBMateriaprima.EOF = False Then
            If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
                If QtdeSaidaPC >= qtdeliberada Then TBMateriaprima!Saida = "SIM" Else TBMateriaprima!Saida = "PARCIAL"
            Else
                If QtdeSaida >= qtdeliberada Then TBMateriaprima!Saida = "SIM" Else TBMateriaprima!Saida = "PARCIAL"
            End If
            TBMateriaprima!Valor_saida_estoque = TBMateriaprima!Valor_saida_estoque + Format(QtdeSaida * TBEstoque!valor_unitario, "###,##0.00")
            TBMateriaprima.Update
            
            'Atualiza qtde. de saída do empenho da ordem
            QuantEmpenho = 0
            QuantEmpenhoPC = 0
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select Sum(Saida) as QuantEmpenho, Sum(ISNULL(Saida_PC, 0)) as QuantEmpenhoPC from estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and oe = '" & NOrdem & "' and desenho = '" & TBMaterial!CODIGO & "' and documento = '" & NOrdem & "' and (operacao = 'SAIDA_ORDEM' or operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                QuantEmpenho = IIf(IsNull(TBFIltro!QuantEmpenho), 0, Format(TBFIltro!QuantEmpenho, "###,##0.0000"))
                QuantEmpenhoPC = IIf(IsNull(TBFIltro!QuantEmpenhoPC), 0, TBFIltro!QuantEmpenhoPC)
                QuantEmpenho = QuantEmpenho + QtdeSaida
                QuantEmpenhoPC = QuantEmpenhoPC + QtdeSaidaPC
            End If
            NovoValor = Replace(QuantEmpenho, ",", ".")
            NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
            Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & NovoValor & ", Qtde_saida_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & NOrdem & " and Codinterno = '" & TBMaterial!CODIGO & "'"
        End If
        TBMateriaprima.Close
        
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select * from projproduto where Desenho = '" & TBMaterial!CODIGO & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProduto.EOF = False Then
            If TBProduto!Estoque = True Then
                QuantEmpenho = Format(TBEstoque!estoque_real - QtdeSaida, "###,##0.0000")
                QuantEmpenhoPC = IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC) - QtdeSaidaPC
            Else
                QuantEmpenho = 0
                QuantEmpenhoPC = 0
            End If
            NovoValor = Replace(QuantEmpenho, ",", ".")
            NovoValor1 = Replace(QuantEmpenhoPC, ",", ".")
            Conexao.Execute "UPDATE Estoque_controle Set Estoque_real = " & NovoValor & ", Estoque_real_PC = " & NovoValor1 & ", Estoque_venda = " & NovoValor & ", peso_unit = '" & IIf(IsNull(TBProduto!peso_metro), "", TBProduto!peso_metro) & "', Pedido = '" & IIf(IsNull(TBProduto!Un_Kg), "", TBProduto!Un_Kg) & "' where IDestoque = " & TBEstoque!IDEstoque
        End If
        TBProduto.Close
            
        'Atualiza valor do total no estoque
        Conexao.Execute "UPDATE Estoque_controle Set Valor_Total = ROUND(valor_unitario * Estoque_real, 2) where IDestoque = " & TBEstoque!IDEstoque
               
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select * from Estoque_movimentacao", Conexao, adOpenKeyset, adLockOptimistic
        TBProduto.AddNew
        TBProduto!Destino = "Interno"
        TBProduto!Terceiros = False
        TBProduto!Documento = NOrdem
        TBProduto!LOTE = IIf(IsNull(TBEstoque!LOTE), "", TBEstoque!LOTE)
        TBProduto!Desenho = IIf(IsNull(TBEstoque!Desenho), "", TBEstoque!Desenho)
        TBProduto!Data = IIf(IsNull(DataOrdem) = False, DataOrdem, Date)
        TBProduto!Descricao = IIf(IsNull(TBEstoque!Descricao), "", TBEstoque!Descricao)
        TBProduto!Familia = IIf(IsNull(TBEstoque!Classe), "", TBEstoque!Classe)
        TBProduto!Requisitante = pubUsuario
        TBProduto!Responsavel = pubUsuario
        TBProduto!IDEstoque = TBEstoque!IDEstoque
        TBProduto!Ordem = NOrdem
        TBProduto!OE = NOrdem
        If FunVerifMovimentacaoEstPC(Cmb_empresa.ItemData(Cmb_empresa.ListIndex)) = True And IsNull(TBEstoque!estoque_real_PC) = False And TBEstoque!estoque_real_PC > 0 Then
            If QtdeSaidaPC >= qtdeliberada Then TBProduto!Operacao = "SAIDA_ORDEM" Else TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
            qtdeliberada = qtdeliberada - QtdeSaidaPC
        Else
            If QtdeSaida >= qtdeliberada Then TBProduto!Operacao = "SAIDA_ORDEM" Else TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
            qtdeliberada = qtdeliberada - QtdeSaida
        End If
        
        If qtdeliberar >= Qtd Then
            Qtde = Qtde - Qtd
            qtdeliberar = qtdeliberar - Qtd
        Else
            Qtde = 0
            qtdeliberar = 0
        End If
        
        TBProduto!Saida = QtdeSaida
        TBProduto!Saida_PC = QtdeSaidaPC
        TBProduto!estoque_venda = QtdeSaida
    
        'Atualiza valor do material no estoque
        TBProduto!VlrUnit = IIf(IsNull(TBEstoque!valor_unitario), 0, Format(TBEstoque!valor_unitario, "###,##0.0000000000"))
        TBProduto!vlrTotal = Format(QtdeSaida * TBProduto!VlrUnit, "###,##0.00")
            
        '==================================
        Modulo = "PCP/Gerenciamento de ordem"
        Evento = "Retirar material do estoque"
        ID_documento = TBMaterial!IdMateriaPrima
        Documento = "Ordem: " & NOrdem & " - Cód. interno: " & TBEstoque!Desenho
        Documento1 = "Cód. interno: " & TBEstoque!Desenho & " - RE: " & TBEstoque!IDEstoque
        ProcGravaEvento
        '==================================
        Permitido1 = True
        
        TBProduto.Update
        
        'Centro de custo
        IDlista = TBProduto!IDoperacao
        Set TBItem = CreateObject("adodb.recordset")
        TBItem.Open "Select * from projproduto where desenho = '" & TBEstoque!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBItem.EOF = False Then
            Codproduto = TBItem!Codproduto
            IDAntigo = IIf(IsNull(TBItem!ID_PC), 0, TBItem!ID_PC)
        End If
        TBItem.Close
        
        'ProcCriaCreditoCCProdutoItem
        
        'ProcAtualizaCTMaterialOrdem Cmb_empresa.ItemData(Cmb_empresa.ListIndex), NOrdem
    
        TBProduto.Close

Proximo:
        TBEstoque.MoveNext
    Loop

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcConcluiOS()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Permitido = False
With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente marcar esta(s) OS('s) como concluída?", vbYesNo, "CAPRIND v5.0") = vbYes Then GoTo 1 Else Exit Sub
            End If
1:
            Permitido = True
            Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'SIM' where idfase = " & .ListItems.Item(InitFor).Text
            Set TBOrdemServico = CreateObject("adodb.recordset")
            TBOrdemServico.Open "Select * from ordemservico where IDPRODUCAO = " & .ListItems.Item(InitFor).Text, Conexao, adOpenKeyset, adLockOptimistic
            If TBOrdemServico.EOF = False Then
                TBOrdemServico!Pronto = "SIM"
                TBOrdemServico!DataConclusao = Date
                TBOrdemServico!status = "Concluída"
                TBOrdemServico.Update
                TBOrdemServico.Close
            End If
            ProcConcluirLiberarOS
            'Libera máquina
            Conexao.Execute "Update cadmaquinas Set cadmaquinas.Liberada = 'True' from cadmaquinas INNER JOIN cadmaquinas_Monitor ON cadmaquinas.Maquina = cadmaquinas_Monitor.Maquina where cadmaquinas_Monitor.maquina = '" & .ListItems.Item(InitFor).ListSubItems(2).Text & "' and cadmaquinas_Monitor.OS = " & ListaOS.ListItems.Item(InitFor).Text
            'Conclui a OS na tabela de máquinas utilizadas por OS
            Conexao.Execute "Update Ordemservico_maq_utilizadas Set Pronto = 'SIM' where OS = " & ListaOS.ListItems.Item(InitFor).Text
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar OS p/ concluída"
            ID_documento = .ListItems.Item(InitFor).Text
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "OS: " & .ListItems.Item(InitFor).Text
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) OS('s) na lista antes de marcar como concluída."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcAtualizalista_os
    ProcLimpar True
    ProcCarregaOrdem
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcConcluirLiberarOS()
On Error GoTo tratar_erro

Set TBFases = CreateObject("adodb.recordset")
TBFases.Open "Select * from ordemservico where Ordem = " & txtof.Text, Conexao, adOpenKeyset, adLockOptimistic
If TBFases.EOF = False Then
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select * from Producao where Ordem = " & txtof.Text, Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
        'Checa se todas as ordens de servicos com processo da ordem foram executadas e da baixa na ordem
        Set TBOrdemServico = CreateObject("adodb.recordset")
        TBOrdemServico.Open "Select * from ordemservico where Ordem = " & txtof.Text & " and pronto = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdemServico.EOF = True Then
            TBAbrir!pronta = "SIM"
            TBAbrir!Concluida = True
            If TBAbrir!status <> "Entregue" Then TBAbrir!status = "Concluída"
            TBAbrir!DataEntrega = Date
        Else
            TBAbrir!pronta = "NÃO"
            TBAbrir!Concluida = False
            If TBAbrir!status <> "Cancelada" And TBAbrir!status <> "Aguardando" And TBAbrir!status <> "Entregue" And TBAbrir!status <> "Sem material" Then
                Set TBProducaoFases = CreateObject("adodb.recordset")
                TBProducaoFases.Open "Select * from " & NomeTabelaAp & " where Ordem = " & txtof, Conexao, adOpenKeyset, adLockOptimistic
                If TBProducaoFases.EOF = False Then
                    TBAbrir!status = "Produzindo"
                Else
                    TBAbrir!status = "Aberta"
                End If
            End If
            TBProducaoFases.Close
            TBAbrir!DataEntrega = Null
        End If
        TBOrdemServico.Close
        TBAbrir.Update

        'Verifica se todas as ordems de fabricação do produto já foram concluidas
        Set TBFIltro = CreateObject("adodb.recordset")
        TBFIltro.Open "Select * from producao_pedidos where Ordem = " & txtof & " order by IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
        If TBFIltro.EOF = False Then
            Do While TBFIltro.EOF = False
                Set TBVendas = CreateObject("adodb.recordset")
                TBVendas.Open "Select * from Vendas_carteira where Codigo = " & TBFIltro!IDcarteira, Conexao, adOpenKeyset, adLockOptimistic
                If TBVendas.EOF = False Then
                    Set TBProcessos = CreateObject("adodb.recordset")
                    TBProcessos.Open "Select producao.* FROM Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem where Producao_pedidos.IDCarteira = " & TBFIltro!IDcarteira & " and Producao.pronta = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBProcessos.EOF = True Then
                        TBVendas!saida_estoque = True
                        TBVendas!dataprodsaida = Date
                    Else
                        TBVendas!saida_estoque = False
                        TBVendas!dataprodsaida = Null
                    End If
                    TBProcessos.Close
                    TBVendas.Update
                End If
                TBVendas.Close
                TBFIltro.MoveNext
            Loop
        End If
        TBFIltro.Close
    End If
    TBAbrir.Close
End If
TBFases.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdcodordem_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If cmbStatus.Text <> "" Then
    ProcFiltrarPadrao "P.Status = '" & cmbStatus & "'"
    FormulaRel_Ordem = "{Producao.Status} = '" & cmbStatus & "'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdConcluida_Click()
On Error GoTo tratar_erro

If txtconcluida.Text <> "__/__/__" Then
    ProcFiltrarPadrao "P.dataentrega = '" & Format(txtconcluida, "Short Date") & "'"
    FormulaRel_Ordem = "{Producao.dataentrega} = Date(" & Year(txtconcluida) & "," & Month(txtconcluida) & "," & Day(txtconcluida) & ")"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCancelarEmpenho()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If USMsgBox("Deseja realmente cancelar este empenho?", vbYesNo, "CAPRIND v5.0") = vbYes Then
    'Verifica se o resultado da ordem foi validado
    Set TBOSC = CreateObject("adodb.recordset")
    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
    If TBOSC.EOF = False Then
        USMsgBox ("Não é permitido cancelar empenho da requisição, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
        TBOSC.Close
        Exit Sub
    End If
    TBOSC.Close
    
    With ListaLote
        If .ListItems.Count = 0 Then Exit Sub
        ID_documento = .SelectedItem
        Documento1 = "Cód. interno: " & ListaRequisicao.SelectedItem.ListSubItems(1) & " - RE: " & .SelectedItem.ListSubItems(1)
    End With
    
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select * from Producao_NF_Consignada where ID = " & ID_documento & " and Qtde_saida > 0", Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
        USMsgBox ("Não é permitido excluir este empenho, pois o mesmo já foi baixado no estoque."), vbExclamation, "CAPRIND v5.0"
        TBAbrir.Close
        Exit Sub
    End If
    TBAbrir.Close
    
    Conexao.Execute "DELETE from Producao_NF_Consignada where ID = " & ID_documento
    USMsgBox ("Empenho cancelado com sucesso."), vbInformation, "CAPRIND v5.0"
    '==================================
    Modulo = "PCP/Gerenciamento de ordem"
    Evento = "Cancelar empenho"
    Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
    ProcGravaEvento
    '==================================
    ProcCarregaListaEmpenhos
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExcluirMRP()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

Permitido = False
With listaitens
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente excluir a(s) ordem(ns) emitida(s) para o(s) pedido(s) em carteira com MRP gerado", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
            Permitido = True
            Set TBLISTA = CreateObject("adodb.recordset")
            TBLISTA.Open "Select VC.*, CP.ID_empresa, CP.IDcliente, CP.Necessidade from vendas_carteira VC INNER JOIN Carteira_producao CP ON CP.Codigo = VC.Codigo where VC.Codigo = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockReadOnly
            If TBLISTA.EOF = False Then
                
                Conexao.Execute "Update vendas_carteira Set OE = 'False' where Codigo = " & TBLISTA!CODIGO
                'TBLISTA!OE = False
                'TBLISTA.Update
                
                'Exclui as ordens emitidas para o produto da carteira
                Set TBFI = CreateObject("adodb.recordset")
                TBFI.Open "Select PP.IDCarteira, PP.Qtde_empenho, P.* FROM Producao P INNER JOIN Producao_pedidos PP ON P.Ordem = PP.Ordem where PP.IDCarteira = " & TBLISTA!CODIGO & " order by P.Ordem", Conexao, adOpenKeyset, adLockOptimistic
                If TBFI.EOF = False Then
                    Do While TBFI.EOF = False
                        Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'False' where Codigo = " & TBFI!IDcarteira
                        
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select * from Producao where Ordem = " & TBFI!Ordem & "", Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            Qtde = TBproducao!Quant
                            TBproducao!Quant = ProcVerifQtdLoteMinimo(TBproducao!Desenho, TBproducao!Quant - TBFI!Qtde_empenho, TBproducao!ID_empresa, False)
                            TBproducao.Update
                            
                            Conexao.Execute "DELETE from producao_pedidos WHERE Ordem = " & TBFI!Ordem & " and IDcarteira = " & TBFI!IDcarteira
                            
                            Set TBFIltro = CreateObject("adodb.recordset")
                            TBFIltro.Open "Select ID from producao_pedidos where Ordem = " & TBFI!Ordem & "", Conexao, adOpenKeyset, adLockOptimistic
                            If TBFIltro.EOF = True Then
                                Conexao.Execute "DELETE from producaomaterial WHERE Ordem = " & TBFI!Ordem
                                Conexao.Execute "DELETE from Producao_NF_Consignada WHERE Ordem = " & TBFI!Ordem
                                Conexao.Execute "DELETE from producao WHERE Ordem = " & TBFI!Ordem
                                Conexao.Execute "DELETE from Ordemservico_maq_utilizadas WHERE Ordem = " & TBFI!Ordem
                                Conexao.Execute "DELETE from OSH from Ordemservico_HoraUtilizadaporDia OSH INNER JOIN Ordemservico OS ON OS.IDProducao = OSH.OS Where OS.Ordem = " & TBFI!Ordem
                                Conexao.Execute "DELETE from ordemservico WHERE Ordem = " & TBFI!Ordem
                            Else
                                OF = TBFI!Ordem
                                ProcAcertaOS TBproducao!Quant, False
                                ProcAtualizaRequisicaoOrdem TBFI!Ordem, Qtde, TBproducao!Quant, True
                            End If
                        End If
                        TBproducao.Close
                        
                        TBFI.MoveNext
                    Loop
                Else
                Permitido = False
                End If
                TBFI.Close
                
                ProcExcluirEmpenhos TBLISTA!ID_empresa, TBLISTA!CODIGO, False
                
            End If
            TBLISTA.Close
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Excluir ordem(ns) do produto/serviço MRP"
            ID_documento = .ListItems(InitFor)
            Documento = "Ped. interno: " & .ListItems.Item(InitFor).SubItems(19) & " - Rev.: " & .ListItems.Item(InitFor).SubItems(20) & " - Cód. interno: " & .ListItems.Item(InitFor).SubItems(3)
            Documento1 = ""
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Favor excluir as ordens manualmente pois não estão empenhadas no pedido."), vbExclamation, "CAPRIND v5.0"
    ProcAtualizalista_carteira
Else
    USMsgBox ("Ordem(ns) excluída(s) com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcAtualizalista_carteira
    atualiza_lista_ordens (1)
    ProcLimpar True
    ProcCarregaDadosProdEstImaProc False
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExcluirOS()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Permitido = False
With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente excluir esta(s) OS(s)?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
            Permitido = True
            Conexao.Execute "DELETE from ordemservico WHERE IDProducao = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from Ordemservico_maq_utilizadas WHERE OS = " & .ListItems(InitFor)
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Excluir OS"
            ID_documento = .ListItems(InitFor)
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "OS: " & .ListItems(InitFor)
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) OS(s) antes de excluir."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("OS(s) excluída(s) com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcAlterarStatusOrdem1 txtof
    ProcAtualizalista_os
    ListaOS_maq.ListItems.Clear
End If
        
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcFiltrarCarteira()
On Error GoTo tratar_erro

frmProd_imp_carteira.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcFiltrarOrdem()
On Error GoTo tratar_erro

ProcLimpar True
frmProd_imp_filtro.Show 1
Novo_Ordem = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdfiltro_cliente_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If txtCliente.Text <> "" Then
    ProcFiltrarPadrao "P.cliente like '" & txtCliente.Text & "%'"
    FormulaRel_Ordem = "{Producao.cliente} like '" & txtCliente.Text & "*'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdfiltro_componente_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If txtProduto.Text <> "" Then
    ProcFiltrarPadrao "P.produto = '" & txtProduto & "'"
    FormulaRel_Ordem = "{Producao.produto} = '" & txtProduto & "'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdfiltro_item_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If txtdesenho.Text <> "" Then
    ProcFiltrarPadrao "P.desenho = '" & txtdesenho.Text & "'"
    FormulaRel_Ordem = "{Producao.Desenho} = '" & txtdesenho & "'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdfiltro_prazo_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
ProcFiltrarPadrao "P.prazoentrega = '" & Format(mskprazofina.Value, "Short Date") & "'"
FormulaRel_Ordem = "{Producao.PrazoEntrega} = Date(" & Year(mskprazofina) & "," & Month(mskprazofina) & "," & Day(mskprazofina) & ")"
atualiza_lista_ordens (1)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcImprimirAP()
On Error GoTo tratar_erro

If txtAPOF.Text = "" Then
    USMsgBox ("Informe a ordem antes de visualizar impressão."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If NomeTabelaAp = "ProducaoFase_Backup" Then NomeRel = "Pcp_apontamento manual_backup.rpt" Else NomeRel = "Pcp_apontamento manual.rpt"
If cmbAPOS.Text <> "" And txtAPMaquina.Text <> "" Then
    ProcImprimirRel "{" & NomeTabelaAp & ".Ordem} = " & txtAPOF.Text & " and {" & NomeTabelaAp & ".idfase} = " & cmbAPOS.Text & " and {" & NomeTabelaAp & ".maquina} = '" & txtAPMaquina.Text & "'", ""
ElseIf cmbAPOS.Text <> "" And txtAPMaquina.Text = "" Then
        ProcImprimirRel "{" & NomeTabelaAp & ".Ordem} = " & txtAPOF.Text & " and {" & NomeTabelaAp & ".idfase} = " & cmbAPOS.Text, ""
    ElseIf cmbAPOS.Text = "" And txtAPMaquina.Text = "" Then
            ProcImprimirRel "{" & NomeTabelaAp & ".Ordem} = " & txtAPOF.Text, ""
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcImprimirCarteira()
On Error GoTo tratar_erro

frmprod_menuimpressao.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcImprimir()
On Error GoTo tratar_erro

If Lista.ListItems.Count = 0 Then Exit Sub
frmProd_MenuImpressaoOrdem.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcImprimirResultados()
On Error GoTo tratar_erro

NomeRel = "Pcp_resultados da ordem.rpt"
ProcImprimirRel "{Producao.Ordem} = " & txtof & " and {Producao_Relatorios_Total.Responsavel}= '" & pubUsuario & "' and {Producao_Relatorios_Total.Modulo} = '" & Formulario & "' and {Producao_Relatorios_Total.QtdePrevista} = " & txtof, ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcInformacoesOrdem()
On Error GoTo tratar_erro

frmProd_Informacoes.Show

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCancelaOS()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Permitido = False
With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente marcar esta(s) OS('s) como não concluída?", vbYesNo, "CAPRIND v5.0") = vbYes Then GoTo 1 Else Exit Sub
            End If
1:
            Permitido = True
            Set TBOrdemServico = CreateObject("adodb.recordset")
            TBOrdemServico.Open "Select * from ordemservico where IDPRODUCAO = " & .ListItems.Item(InitFor).Text, Conexao, adOpenKeyset, adLockOptimistic
            If TBOrdemServico.EOF = False Then
                TBOrdemServico!Pronto = "NÃO"
                TBOrdemServico!DataConclusao = Null
                Set TBProducaoFases = CreateObject("adodb.recordset")
                TBProducaoFases.Open "Select CodigoDesc, Data from " & NomeTabelaAp & " where IDFase = " & .ListItems.Item(InitFor).Text & " order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
                If TBProducaoFases.EOF = False Then
                    TBProducaoFases.MoveLast
                    If TBProducaoFases!CodigoDesc = 1 Then TBOrdemServico!status = "Preparando"
                    If TBProducaoFases!CodigoDesc = 2 Then TBOrdemServico!status = "Produzindo"
                    'Filtra todos os eventos desta OS na tabela producaofases para marcar como fase não pronta
                    If TBProducaoFases!CodigoDesc = 3 Then
                        TBOrdemServico!status = "Concluída"
                        TBOrdemServico!Pronto = "SIM"
                        TBOrdemServico!DataConclusao = TBProducaoFases!Data
                    Else
                        Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'NÃO' where idfase = " & .ListItems.Item(InitFor).Text
                    End If
                Else
                    TBOrdemServico!status = "Aguardando"
                End If
                TBProducaoFases.Close
                TBOrdemServico.Update
                Pronto = TBOrdemServico!Pronto
                TBOrdemServico.Close
            End If
            ProcConcluirLiberarOS
            'Bloqueia liberação da máquina
            If Pronto = "SIM" Then Liberada = "cadmaquinas.Liberada = 'True'" Else Liberada = "cadmaquinas.Liberada = 'False'"
            Conexao.Execute "Update cadmaquinas Set " & Liberada & " from cadmaquinas INNER JOIN cadmaquinas_Monitor ON cadmaquinas.Maquina = cadmaquinas_Monitor.Maquina where cadmaquinas_Monitor.maquina = '" & .ListItems.Item(InitFor).ListSubItems(2).Text & "' and cadmaquinas_Monitor.OS = " & ListaOS.ListItems.Item(InitFor).Text
            'Marca como concluída a OS na tabela de máquinas utilizadas por OS
            Conexao.Execute "Update Ordemservico_maq_utilizadas Set Pronto = '" & Pronto & "' where OS = " & ListaOS.ListItems.Item(InitFor).Text
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar OS p/ não concluída"
            ID_documento = .ListItems.Item(InitFor).Text
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "OS: " & .ListItems.Item(InitFor).Text
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) OS('s) na lista antes de marcar como não concluída."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcAtualizalista_os
    ProcLimpar True
    ProcCarregaOrdem
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Cmdlocalizarcli_Click()
On Error GoTo tratar_erro

ProcConfVariaveisLocCliente False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, False, True, False, False, False, False, False, False, False, False, False
frmVendas_LocalizarCliente.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcGeraMrpItem()
On Error GoTo tratar_erro

If USMsgBox("Deseja realmente gerar o MRP desse(s) produto(s)?", vbYesNo, "CAPRIND V5.0") = vbNo Then Exit Sub
frmProd_Opcoes_Mrp.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcGerarMrp()
On Error GoTo tratar_erro

ProcLimpar True
With frmProd_Opcoes_Mrp
    Versao_processo = .cmbVersao
    Versao_estrutura = .cmbVersao_estrutura
End With

'Verifica se está tudo de acordo
Set TBCarteira = CreateObject("adodb.recordset")
TBCarteira.Open StrSql_Ordem_MRP, Conexao, adOpenKeyset, adLockReadOnly
If TBCarteira.EOF = False Then
    Do While TBCarteira.EOF = False
        If TBCarteira!Necessidade > 0 Then
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select SubTipoItem from projproduto where desenho = '" & TBCarteira!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                If IsNull(TBAbrir!SubTipoItem) = True Or TBAbrir!SubTipoItem = 0 Then
                    USMsgBox ("Informe o tipo do registro " & TBAbrir!Desenho & " no cadastro antes de gerar o MRP."), vbExclamation, "CAPRIND v5.0"
                    MRPgerado = False
                    Exit Sub
                End If
            End If
            TBAbrir.Close
            
            If IsNull(TBCarteira!Versao_estrutura) = False And TBCarteira!Versao_estrutura <> "" And TBCarteira!Versao_estrutura <> Versao_estrutura Then
                If USMsgBox("A versão selecionada da estrutura está diferente da versão informada pela engenharia para o produto " & TBCarteira!Desenho & ", deseja prosseguir mesmo assim?", vbYesNo, "CAPRIND v5.0") = vbNo Then
                    MRPgerado = False
                    Exit Sub
                End If
            End If
            If IsNull(TBCarteira!Versao_processo) = False And TBCarteira!Versao_processo <> "" And TBCarteira!Versao_processo <> Versao_processo Then
                If USMsgBox("A versão selecionada do processo está diferente da versão informada pela engenharia para o produto " & TBCarteira!Desenho & ", deseja prosseguir mesmo assim?", vbYesNo, "CAPRIND v5.0") = vbNo Then
                    MRPgerado = False
                    Exit Sub
                End If
            End If
        End If
        TBCarteira.MoveNext
    Loop
End If

MRPgerado = False
Set TBCarteira = CreateObject("adodb.recordset")
TBCarteira.Open StrSql_Ordem_MRP, Conexao, adOpenKeyset, adLockReadOnly
If TBCarteira.EOF = False Then
    Contador = 0
    'PBLista.Min = 0
    'PBLista.Max = TBCarteira.RecordCount
    Do While TBCarteira.EOF = False
        If TBCarteira!Necessidade > 0 Then
            MRPgerado = True
            
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select * from projproduto where desenho = '" & TBCarteira!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                Codproduto = TBAbrir!Codproduto
                Leadtime = IIf(IsNull(TBAbrir!Leadtime), 0, TBAbrir!Leadtime)
                SubTipoItem = TBAbrir!SubTipoItem
                
                QuantsolicitadoN1 = 0
                QuantsolicitadoN2 = 0
                QuantsolicitadoN3 = 0
                QuantsolicitadoN4 = 0
                QuantsolicitadoN5 = 0
                QuantsolicitadoN6 = 0
                QuantsolicitadoN7 = 0
                QuantsolicitadoN8 = 0
                QuantsolicitadoN9 = 0
                QuantsolicitadoN10 = 0
                QuantsolicitadoN11 = 0
                QuantsolicitadoN12 = 0
                QuantsolicitadoN13 = 0
                QuantsolicitadoN14 = 0
                Cliente = ""
                
                If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(TBCarteira!Desenho)
                If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(TBCarteira!Desenho)
                
                QuantSolicitado = TBCarteira!Necessidade
                If MRP_considerar_estoque = True And TBCarteira!Cotacao <> 0 Then
                    ProcEmpenharProdEstoque TBCarteira!ID_empresa, TBCarteira!CODIGO, TBCarteira!Desenho, False, True, TBCarteira!Qtde_produzir
                    If QuantSolicitado > 0 Then ProcEmpenharProdProduzindo TBCarteira!ID_empresa, TBCarteira!CODIGO, TBCarteira!Desenho, TBCarteira!PrazoFinal, False
                End If
                If QuantSolicitado > 0 Then
                    Quant = ProcVerifQtdLoteMinimo(TBCarteira!Desenho, QuantSolicitado, TBCarteira!ID_empresa, False)
                    QuantSolicitado = Quant
                    ProcGerarOrdemProdutoVendido
                    OrdemEmpenho1 = OF
                    ProcNivel1 OrdemEmpenho1
                End If
Pular:
                Conexao.Execute "UPDATE vendas_carteira Set OE = 1, datapcp = '" & Date & "' where Codigo = " & TBCarteira!CODIGO
            End If
        End If
        TBCarteira.MoveNext
        Contador = Contador + 1
        'PBLista.Value = Contador
    Loop
End If
TBCarteira.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcNivel1(OrdemEmpenhoN1 As Long)
On Error GoTo tratar_erro

Set TBNivel1 = CreateObject("adodb.recordset")
TBNivel1.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel1.EOF = False Then
    Do While TBNivel1.EOF = False
        Desenho = TBNivel1!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel1!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            
            QuantsolicitadoN1 = TBNivel1!quantidade * Quant
            QuantSolicitado = TBNivel1!quantidade * Quant
            
            OrdemEmpenho = OrdemEmpenhoN1
            ProcGerarOrdem TBNivel1!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN1 = QuantSolicitado
                OrdemEmpenho2 = OF
                ProcNivel2 OrdemEmpenho2
            End If
        End If
        If Permitido = False Then QuantSolicitado = Quant Else QuantSolicitado = TBNivel1!quantidade * IIf(IsNumeric(frmProd_Opcoes_Mrp.txtQuantidade) = True, frmProd_Opcoes_Mrp.txtQuantidade, 0)
        TBNivel1.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel2(OrdemEmpenhoN2 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN1
Set TBNivel2 = CreateObject("adodb.recordset")
TBNivel2.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel2.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel2.EOF = False Then
    Do While TBNivel2.EOF = False
        Desenho = TBNivel2!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel2!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel2!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN2
            ProcGerarOrdem TBNivel2!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN2 = QuantSolicitado
                OrdemEmpenho3 = OF
                ProcNivel3 OrdemEmpenho3
            End If
            QuantSolicitado = QuantsolicitadoN1
        End If
        TBNivel2.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel3(OrdemEmpenhoN3 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN2
Set TBNivel3 = CreateObject("adodb.recordset")
TBNivel3.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel3.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel3.EOF = False Then
    Do While TBNivel3.EOF = False
        Desenho = TBNivel3!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel3!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel3!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN3
            ProcGerarOrdem TBNivel3!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN3 = QuantSolicitado
                OrdemEmpenho4 = OF
                ProcNivel4 OrdemEmpenho4
            End If
            QuantSolicitado = QuantsolicitadoN2
        End If
        TBNivel3.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel4(OrdemEmpenhoN4 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN3
Set TBNivel4 = CreateObject("adodb.recordset")
TBNivel4.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel4.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel4.EOF = False Then
    Do While TBNivel4.EOF = False
        Desenho = TBNivel4!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel4!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel4!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN4
            ProcGerarOrdem TBNivel4!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN4 = QuantSolicitado
                OrdemEmpenho5 = OF
                ProcNivel5 OrdemEmpenho5
            End If
            QuantSolicitado = QuantsolicitadoN3
        End If
        TBNivel4.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel5(OrdemEmpenhoN5 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN4
Set TBNivel5 = CreateObject("adodb.recordset")
TBNivel5.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel5.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel5.EOF = False Then
    Do While TBNivel5.EOF = False
        Desenho = TBNivel5!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel5!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel5!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN5
            ProcGerarOrdem TBNivel5!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN5 = QuantSolicitado
                OrdemEmpenho6 = OF
                ProcNivel6 OrdemEmpenho6
            End If
            QuantSolicitado = QuantsolicitadoN4
        End If
        TBNivel5.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel6(OrdemEmpenhoN6 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN5
Set TBNivel6 = CreateObject("adodb.recordset")
TBNivel6.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel6.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel6.EOF = False Then
    Do While TBNivel6.EOF = False
        Desenho = TBNivel6!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel6!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel6!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN6
            ProcGerarOrdem TBNivel6!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN6 = QuantSolicitado
                OrdemEmpenho7 = OF
                ProcNivel7 OrdemEmpenho7
            End If
            QuantSolicitado = QuantsolicitadoN5
        End If
        TBNivel6.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel7(OrdemEmpenhoN7 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN6
Set TBNivel7 = CreateObject("adodb.recordset")
TBNivel7.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel7.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel7.EOF = False Then
    Do While TBNivel7.EOF = False
        Desenho = TBNivel7!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel7!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel7!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN7
            ProcGerarOrdem TBNivel7!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN7 = QuantSolicitado
                OrdemEmpenho8 = OF
                ProcNivel8 OrdemEmpenho8
            End If
            QuantSolicitado = QuantsolicitadoN6
        End If
        TBNivel7.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel8(OrdemEmpenhoN8 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN7
Set TBNivel8 = CreateObject("adodb.recordset")
TBNivel8.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel8.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel8.EOF = False Then
    Do While TBNivel8.EOF = False
        Desenho = TBNivel8!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel8!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel8!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN8
            ProcGerarOrdem TBNivel8!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN8 = QuantSolicitado
                OrdemEmpenho9 = OF
                ProcNivel9 OrdemEmpenho9
            End If
            QuantSolicitado = QuantsolicitadoN7
        End If
        TBNivel8.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel9(OrdemEmpenhoN9 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN8
Set TBNivel9 = CreateObject("adodb.recordset")
TBNivel9.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel9.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel9.EOF = False Then
    Do While TBNivel9.EOF = False
        Desenho = TBNivel9!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel9!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel9!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN9
            ProcGerarOrdem TBNivel9!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN9 = QuantSolicitado
                OrdemEmpenho10 = OF
                ProcNivel10 OrdemEmpenho10
            End If
            QuantSolicitado = QuantsolicitadoN8
        End If
        TBNivel9.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel10(OrdemEmpenhoN10 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN9
Set TBNivel10 = CreateObject("adodb.recordset")
TBNivel10.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel10.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel10.EOF = False Then
    Do While TBNivel10.EOF = False
        Desenho = TBNivel10!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel10!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel10!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN10
            ProcGerarOrdem TBNivel10!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN10 = QuantSolicitado
                OrdemEmpenho11 = OF
                ProcNivel11 OrdemEmpenho11
            End If
            QuantSolicitado = QuantsolicitadoN9
        End If
        TBNivel10.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel11(OrdemEmpenhoN11 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN10
Set TBNivel11 = CreateObject("adodb.recordset")
TBNivel11.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel11.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel11.EOF = False Then
    Do While TBNivel11.EOF = False
        Desenho = TBNivel11!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel11!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel11!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN11
            ProcGerarOrdem TBNivel11!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN11 = QuantSolicitado
                OrdemEmpenho12 = OF
                ProcNivel12 OrdemEmpenho12
            End If
            QuantSolicitado = QuantsolicitadoN10
        End If
        TBNivel11.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel12(OrdemEmpenhoN12 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN11
Set TBNivel12 = CreateObject("adodb.recordset")
TBNivel12.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel12.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel12.EOF = False Then
    Do While TBNivel12.EOF = False
        Desenho = TBNivel12!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel12!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel12!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN12
            ProcGerarOrdem TBNivel12!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN12 = QuantSolicitado
                OrdemEmpenho13 = OF
                ProcNivel13 OrdemEmpenho13
            End If
            QuantSolicitado = QuantsolicitadoN11
        End If
        TBNivel12.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel13(OrdemEmpenhoN13 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN12
Set TBNivel13 = CreateObject("adodb.recordset")
TBNivel13.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel13.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel13.EOF = False Then
    Do While TBNivel13.EOF = False
        Desenho = TBNivel13!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel13!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel13!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN13
            ProcGerarOrdem TBNivel13!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN13 = QuantSolicitado
                OrdemEmpenho14 = OF
                ProcNivel14 OrdemEmpenho14
            End If
            QuantSolicitado = QuantsolicitadoN12
        End If
        TBNivel13.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel14(OrdemEmpenhoN14 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN13
Set TBNivel14 = CreateObject("adodb.recordset")
TBNivel14.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel14.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel14.EOF = False Then
    Do While TBNivel14.EOF = False
        Desenho = TBNivel14!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel14!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel14!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN14
            ProcGerarOrdem TBNivel4!Codproduto
            If GerouOrdem = True Then
                QuantsolicitadoN14 = QuantSolicitado
                OrdemEmpenho15 = OF
                ProcNivel15 OrdemEmpenho15
            End If
            QuantSolicitado = QuantsolicitadoN13
        End If
        TBNivel14.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNivel15(OrdemEmpenhoN15 As Long)
On Error GoTo tratar_erro

QuantSolicitado = QuantsolicitadoN14
Set TBNivel15 = CreateObject("adodb.recordset")
TBNivel15.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
'TBNivel15.Open "Select PC.* from projconjunto PC LEFT JOIN Projconjunto_desc_versao PCDV ON PCDV.Codproduto = PC.Codproduto and PCDV.Versao = PC.Versao where PC.codproduto = " & Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and PCDV.DtValidacao IS NOT NULL order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel15.EOF = False Then
    Do While TBNivel15.EOF = False
        Desenho = TBNivel15!Desenho
        Set TBControleNF = CreateObject("adodb.recordset")
        TBControleNF.Open "Select * from projproduto where desenho = '" & Desenho & "' and bloqueado <> 1 and Producao = 'True' and (SubTipoItem = 1 or SubTipoItem = 2 or SubTipoItem = 3)", Conexao, adOpenKeyset, adLockOptimistic
        If TBControleNF.EOF = False Then
            If Versao_por_item_estrutura = True Then Versao_estrutura = VerifVersaoEstrutura(Desenho) Else Versao_estrutura = TBNivel15!Versao_desenho
            If Versao_por_item = True Then Versao_processo = VerifVersaoProcesso(Desenho) Else Versao_processo = Versao_estrutura
            QuantSolicitado = TBNivel15!quantidade * QuantSolicitado
            OrdemEmpenho = OrdemEmpenhoN14
            ProcGerarOrdem TBNivel5!Codproduto
            If GerouOrdem = True Then QuantsolicitadoN14 = QuantSolicitado
            QuantSolicitado = QuantsolicitadoN14
        End If
        TBNivel15.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Function VerifVersaoEstrutura(Codinterno As String) As String
On Error GoTo tratar_erro

Versao_texto = ""
Mensagem1:
    Versao_texto = InputBox("Favor informar a versão da estrutura do produto " & Codinterno & ".")
    If Versao_texto = "" Then
        VerifVersaoEstrutura = "A"
    Else
        Set TBProcessos = CreateObject("adodb.recordset")
        TBProcessos.Open "Select P.Codproduto from Projproduto INNER JOIN Projconjunto PC ON PC.codproduto = P.codproduto where P.Desenho = '" & Codinterno & "' and PC.versao = '" & Versao_texto & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProcessos.EOF = True Then
            USMsgBox ("Não foi encontrado nenhuma estrutura com a versão " & Versao_texto & " do produto " & Codinterno & "."), vbExclamation, "CAPRIND v5.0"
            TBProcessos.Close
            GoTo Mensagem1
        Else
            VerifVersaoEstrutura = Versao_texto
        End If
        TBProcessos.Close
    End If

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Function VerifVersaoProcesso(Codinterno As String) As String
On Error GoTo tratar_erro

Versao_texto = ""
Mensagem1:
    Versao_texto = InputBox("Favor informar a versão do processo do produto " & Codinterno & ".")
    If Versao_texto = "" Then
        VerifVersaoProcesso = "A"
    Else
        Set TBProcessos = CreateObject("adodb.recordset")
        TBPROCE.Open "Select F.Versao from (Projproduto P INNER JOIN Processos PROCE ON P.codproduto = PROCE.codproduto) INNER JOIN Fases F ON F.IDProcesso = PROCE.IDprocesso where P.Desenho = '" & Codinterno & "' and F.versao = '" & Versao_texto & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBPROCE.EOF = True Then
            USMsgBox ("Não foi encontrado nenhum processo com a versão " & Versao_texto & " do produto " & Codinterno & "."), vbExclamation, "CAPRIND v5.0"
            TBPROCE.Close
            GoTo Mensagem1
        Else
            VerifVersaoProcesso = Versao_texto
        End If
        TBPROCE.Close
    End If

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Private Sub ProcVerificaItem()
On Error GoTo tratar_erro

NomeRel = "Pcp_lista de ordens.rpt"
ProcImprimirRel "{producao.pronta}= '" & "NÃO" & "'", ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcMRP()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If listaitens.ListItems.Count = 0 Then Exit Sub

quantidade = 0
Permitido = False
With listaitens
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            Permitido = True
            quantidade = quantidade + .ListItems.Item(InitFor).ListSubItems(12)
        End If
    Next InitFor
End With
If Permitido = False Then
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select Codigo from Empresa where Codigo = " & ID_empresa_MRP & " and (Bloq_OP_estrutura = 'True' or Bloq_OP_processo = 'True' or Bloq_OP_plano = 'True')", Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
        USMsgBox ("Informe o(s) produto(s)/serviço(s) antes de gerar MRP."), vbExclamation, "CAPRIND v5.0"
        TBAbrir.Close
        Exit Sub
    Else
        If USMsgBox("Nenhum produto/serviço foi selecionado na lista, deseja gerar MRP da carteira de produção?", vbYesNo, "CAPRIND v5.0") = vbYes Then
            MRP_Prod = False
            frmProd_Opcoes_Mrp.Show 1
        End If
    End If
    'TBAbrir.Close
Else
    MRP_Prod = True
    ProcGeraMrpItem
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNF()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtof.Text = "" Then
    USMsgBox ("Informe a ordem antes de prosseguir."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtDtValidacao = "" Then
    USMsgBox ("Não é possivel prosseguir, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

'Verifica se o resultado da ordem foi validado
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    USMsgBox ("Não é possivel prosseguir, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close

frmprod_NF.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNovoOS()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If FunVerifValidacaoRegistro("criar nova", txtDtValidacao, "ordem", "OS", False) = False Then Exit Sub
If txtof.Text = "" Or cmbStatus.Text = "" Then Exit Sub
If Novo_Ordem = True Then
    USMsgBox ("Salve a ordem antes de criar uma OS nova."), vbInformation, "CAPRIND v5.0"
    SSTab1.Tab = 1
    imgSalvar.SetFocus
    Exit Sub
End If
ProcLimparCamposOS
If USMsgBox("Deseja realmente criar uma OS nova para a ordem " & txtof.Text & "?", vbYesNo, "CAPRIND v5.0") = vbYes Then
    Framedetalhes.Enabled = True
    Frame24.Enabled = True
    With txtVersao
        .Locked = False
        .TabStop = True
        .SetFocus
    End With
    With txtOSFase
        .Locked = False
        .TabStop = True
    End With
    With TxtOS_grupo_op
        .Locked = False
        .TabStop = True
    End With
    With txtOSLote
        .Locked = False
        .TabStop = True
        .Text = txtQuantidade
    End With
    With cmbOSMaquina
        .Locked = False
        .TabStop = True
    End With
    With txtPcHora
'        .Locked = False
'        .TabStop = True
'        Enabled = True
    End With
    Chk_agrega_custos_efic.Enabled = False
   ' Frame13.Enabled = True
'    Frame31.Enabled = True
    Novo_Ordem1 = True
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcLimparCamposOS()
On Error GoTo tratar_erro

txtOS.Text = ""
txtOSFase.Text = ""
TxtOS_grupo_op = ""

txtOSLote = ""
TxtTempoTotal = ""
cmbOSMaquina.ListIndex = -1
txtStatus_OS = "Aguardando"
txtdescmaquina = ""
Cmb_prazo_os = Date
chkPchora.Value = 0
txtpreparacao = "___:__:__"
txtexecucao.Text = "___:__:__"
TxtA3 = "00:00:00"
chkControlada.Value = 0
ChkProcesso_controlado.Value = 0
chkRetrabalho.Value = 0
chkRastreavel.Value = 0

Chk_agrega_custos_efic.Value = 0
txtdescricao.Text = ""
txtObs.Text = ""
ProcOSCarregaMaquina

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdordem_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If txtof <> "" Then
    ProcFiltrarPadrao "P.Ordem = " & txtof
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcFiltrarPadrao(TextoFiltro As String)
On Error GoTo tratar_erro

CamposFiltro = "P.Ordem, P.PrazoEntrega, P.Desenho, P.N_Referencia, P.Produto, P.dataentrega, P.DtValidacao, P.DtValidacao_custo, P.Impof, E.Empresa"
INNERJOINTEXTO = "Select " & CamposFiltro & " from (Producao P LEFT JOIN Empresa E ON E.Codigo = P.ID_empresa) LEFT JOIN Producao_pedidos PP ON P.Ordem = PP.Ordem where "
StrSql_Ordem_Localizar = INNERJOINTEXTO & TextoFiltro & " group by " & CamposFiltro & " order by P.Ordem desc"

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAnterior()
On Error GoTo tratar_erro

If txtof.Text = "" Then Exit Sub
Set TBAfericao = CreateObject("adodb.recordset")
TBAfericao.Open "Select * from producao order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
If TBAfericao.EOF = False Then
    TBAfericao.Find ("Ordem = " & txtof)
    TBAfericao.MovePrevious
    If TBAfericao.BOF = False Then
        Ordem = TBAfericao!Ordem
        ProcCarregaOrdem
        ProcLimparCamposOS
        ProcAtualizalista_os
        ProcCarregaResultados
    Else
        USMsgBox ("Fim dos cadastros de ordens."), vbInformation, "CAPRIND v5.0"
    End If
End If
Novo_Ordem = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub procProxima()
On Error GoTo tratar_erro

If txtof.Text = "" Then Exit Sub
Set TBAfericao = CreateObject("adodb.recordset")
TBAfericao.Open "Select * from producao order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
If TBAfericao.EOF = False Then
    TBAfericao.Find ("Ordem =" & txtof)
    TBAfericao.MoveNext
    If TBAfericao.EOF = False Then
        Ordem = TBAfericao!Ordem
        ProcCarregaOrdem
        ProcLimparCamposOS
        ProcAtualizalista_os
        ProcCarregaResultados
    Else
        USMsgBox ("Fim dos cadastros de ordens."), vbInformation, "CAPRIND v5.0"
    End If
End If
Novo_Ordem = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagAnt_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas.Caption, 4)) <= 1 Then Exit Sub
If TBLISTA_Ordem.AbsolutePage <> 2 Then
    If TBLISTA_Ordem.AbsolutePage = -3 Then
        ProcExibePagina (TBLISTA_Ordem.PageCount - 1)
    Else
        TBLISTA_Ordem.AbsolutePage = TBLISTA_Ordem.AbsolutePage - 2
        ProcExibePagina (TBLISTA_Ordem.AbsolutePage)
    End If
Else
    ProcExibePagina (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagAnt2_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas2.Caption, 4)) <= 1 Then Exit Sub
If TBLISTA_Ordem1.AbsolutePage <> 2 Then
    If TBLISTA_Ordem1.AbsolutePage = -3 Then
        ProcExibePagina2 (TBLISTA_Ordem1.PageCount - 1)
    Else
        TBLISTA_Ordem1.AbsolutePage = TBLISTA_Ordem1.AbsolutePage - 2
        ProcExibePagina2 (TBLISTA_Ordem1.AbsolutePage)
    End If
Else
    ProcExibePagina2 (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagIr_Click()
On Error GoTo tratar_erro

If txtPagIr = "" Then Exit Sub
Quant = ReturnNumbersOnly(Right(lblPaginas.Caption, 4))
If Quant <= 1 Or txtPagIr > Quant Then Exit Sub
If txtPagIr.Text >= 1 And txtPagIr.Text <= Quant Then
    TBLISTA_Ordem.AbsolutePage = txtPagIr.Text
    ProcExibePagina (TBLISTA_Ordem.AbsolutePage)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagIr2_Click()
On Error GoTo tratar_erro

If txtPagIr2 = "" Then Exit Sub
Quant = ReturnNumbersOnly(Right(lblPaginas2.Caption, 4))
If Quant <= 1 Or txtPagIr2 > Quant Then Exit Sub
If txtPagIr2.Text >= 1 And txtPagIr2.Text <= Quant Then
    TBLISTA_Ordem1.AbsolutePage = txtPagIr2.Text
    ProcExibePagina2 (TBLISTA_Ordem1.AbsolutePage)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagPrim_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas.Caption, 4)) <= 1 Then Exit Sub
TBLISTA_Ordem.AbsolutePage = 1
ProcExibePagina (TBLISTA_Ordem.AbsolutePage)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagPrim2_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas2.Caption, 4)) <= 1 Then Exit Sub
TBLISTA_Ordem1.AbsolutePage = 1
ProcExibePagina2 (TBLISTA_Ordem1.AbsolutePage)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagProx_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas.Caption, 4)) <= 1 Then Exit Sub
If TBLISTA_Ordem.AbsolutePage <> -3 Then
    If TBLISTA_Ordem.AbsolutePage = 1 Then
        ProcExibePagina (2)
    Else
        ProcExibePagina (TBLISTA_Ordem.AbsolutePage)
    End If
Else
    ProcExibePagina (TBLISTA_Ordem.PageCount)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagProx2_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas2.Caption, 4)) <= 1 Then Exit Sub
If TBLISTA_Ordem1.AbsolutePage <> -3 Then
    If TBLISTA_Ordem1.AbsolutePage = 1 Then
        ProcExibePagina2 (2)
    Else
        ProcExibePagina2 (TBLISTA_Ordem1.AbsolutePage)
    End If
Else
    ProcExibePagina2 (TBLISTA_Ordem1.PageCount)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagUlt_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas.Caption, 4)) <= 1 Then Exit Sub
TBLISTA_Ordem.AbsolutePage = TBLISTA_Ordem.PageCount
ProcExibePagina (TBLISTA_Ordem.AbsolutePage)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdPagUlt2_Click()
On Error GoTo tratar_erro

If ReturnNumbersOnly(Right(lblPaginas2.Caption, 4)) <= 1 Then Exit Sub
TBLISTA_Ordem1.AbsolutePage = TBLISTA_Ordem1.PageCount
ProcExibePagina2 (TBLISTA_Ordem1.AbsolutePage)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmdReferencia_Click()
On Error GoTo tratar_erro

Novo_Ordem = False
If txtreferencia.Text <> "" Then
    ProcFiltrarPadrao "P.n_referencia = '" & txtreferencia & "'"
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcSair()
On Error GoTo tratar_erro

ProcExcluirDadosProducaoRelatorios
ProcExcluirDadosProducaoRelatoriosTotal
If Novo_Ordem = True Then
    SSTab1.Tab = 1
    If USMsgBox("A ordem ainda não foi salva, deseja salvar antes de fechar o módulo?", vbYesNo) = vbYes Then
        ProcSalvarOrdem
        If Novo_Ordem = True Then
            Exit Sub
        Else
            If Novo_Ordem1 = False Then Unload Me
        End If
    Else
        GoTo Excluir
    End If
Else
Excluir:
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from Producao_NF_Consignada order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from producao where Ordem = " & TBAbrir!Ordem, Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = True Then
                Conexao.Execute "DELETE from Producao_NF_Consignada WHERE Ordem = " & TBAbrir!Ordem
            End If
            TBproducao.Close
        End If
        TBAbrir.Close
End If
Novo_Ordem = False

If Novo_Ordem1 = True Then
    SSTab1.Tab = 2
    If USMsgBox("A OS ainda não foi salva, deseja salvar antes de fechar o módulo?", vbYesNo) = vbYes Then
        ProcSalvarOS
        If Novo_Ordem1 = True Then
            Exit Sub
        Else
            If Novo_Ordem = False Then Unload Me
        End If
    End If
End If
Novo_Ordem1 = False
If Novo_Ordem = False And Novo_Ordem1 = False Then Unload Me

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcLiberaCamposAP()
On Error GoTo tratar_erro

cmbdescricaoap.Enabled = True
txtinicioap.Enabled = True
txtfinalap.Enabled = True

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAcertaMaquina()
On Error GoTo tratar_erro

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from ordemservico where pronto = 'Sim' order by idproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    Do While TBOrdem.EOF = False
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from " & NomeTabelaApTotalizacao & " where os = " & TBOrdem!IDProducao & " and maquina = '" & TBOrdem!maquina & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = True Then TBAbrir.AddNew
        TBAbrir!Ordem = IIf(IsNull(TBOrdem!Ordem), 0, TBOrdem!Ordem)
        TBAbrir!OS = IIf(IsNull(TBOrdem!IDProducao), 0, TBOrdem!IDProducao)
        TBAbrir!Fase = IIf(IsNull(TBOrdem!Fase), 0, TBOrdem!Fase)
        TBAbrir!Data = IIf(IsNull(TBOrdem!DataConclusao), Null, TBOrdem!DataConclusao)
        TBAbrir!maquina = IIf(IsNull(TBOrdem!maquina), "", TBOrdem!maquina)
        TBAbrir!Pronto = IIf(IsNull(TBOrdem!Pronto), "", TBOrdem!Pronto)
        TBAbrir!Preparacao = IIf(IsNull(TBOrdem!Preparacao), 0, TBOrdem!Preparacao)
        TBAbrir!Execucao = IIf(IsNull(TBOrdem!Execucao), 0, TBOrdem!Execucao)
        TBAbrir!QTNC = IIf(IsNull(TBOrdem!QTNC), 0, TBOrdem!QTNC)
        TBAbrir!QTOK = IIf(IsNull(TBOrdem!QTOK), 0, TBOrdem!QTOK)
        TBAbrir!TPUTIL = IIf(IsNull(TBOrdem!TPUTIL), 0, TBOrdem!TPUTIL)
        TBAbrir!TEUTIL = IIf(IsNull(TBOrdem!TEUTIL), 0, TBOrdem!TEUTIL)
        TBAbrir!TETTUTIL = IIf(IsNull(TBOrdem!TETTUTIL), 0, TBOrdem!TETTUTIL)
        TBAbrir!CRLOTE = IIf(IsNull(TBOrdem!CRLOTE), 0, TBOrdem!CRLOTE)
        TBAbrir!CRPECA = IIf(IsNull(TBOrdem!CRPECA), 0, TBOrdem!CRPECA)
        TBAbrir!CPLOTE = IIf(IsNull(TBOrdem!CPLOTE), 0, TBOrdem!CPLOTE)
        TBAbrir!CPPECA = IIf(IsNull(TBOrdem!CPPECA), 0, TBOrdem!CPPECA)
        TBAbrir!Eficiencia_prep = IIf(IsNull(TBOrdem!Eficiencia_prep), 0, TBOrdem!Eficiencia_prep)
        TBAbrir!Eficiencia_exec = IIf(IsNull(TBOrdem!Eficiencia_exec), 0, TBOrdem!Eficiencia_exec)
        TBAbrir!Eficiencia = IIf(IsNull(TBOrdem!Eficiencia), 0, TBOrdem!Eficiencia)
        TBAbrir!Totalprod = IIf(IsNull(TBOrdem!Totalprod), 0, TBOrdem!Totalprod)
        TBAbrir.Update
        TBAbrir.Close
        TBOrdem.MoveNext
    Loop
End If
TBOrdem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAlterarLista()
On Error GoTo tratar_erro

If listaitens.ListItems.Count = 0 Then Exit Sub
If Frame1(3).Visible = True Then
    Frame1(3).Visible = False
    listaitens.Visible = True
    'PBLista.Visible = True
    Frame1(2).Visible = True
    ProcEsconderMostrarBotoes
Else
    Frame1(3).Visible = True
    listaitens.Visible = False
    'PBLista.Visible = False
    Frame1(2).Visible = True
    ProcEsconderMostrarBotoes
    
    StrSql_Ordem_MRP1 = "Select * from Carteira_producao where Codigo = " & listaitens.SelectedItem
    FiltraEstruturaCarteira
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcEmpenhar()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtof = "" Then Exit Sub
If ListaRequisicao.ListItems.Count = 0 Then Exit Sub

'Verifica se o resultado da ordem foi validado
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    USMsgBox ("Não é permitido empenhar requisição, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close

Qtd = 0
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select sum(Quantidade) as Qtd from Producao_NF_Consignada where Ordem = " & txtof & " and Codinterno = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    Qtd = IIf(IsNull(TBAbrir!Qtd), 0, TBAbrir!Qtd)
End If
TBAbrir.Close
Qtde = ListaRequisicao.SelectedItem.ListSubItems(4)
If Qtd >= Qtde And Qtde > 0 Then
    USMsgBox ("Não é permitido empenhar nesta requisição da ordem, pois já foi atingida a quantidade requisitada."), vbExclamation, "CAPRIND v5.0"
Else
    'Verifica se tem lote com QTSaldo maior que 0
    If optconsignacao.Value = 0 Then Familiatext = "and Consignacao = 'False'" Else Familiatext = "and (Consignacao = 'False' or Consignacao = 'True' and id_cliente = " & IIf(Txt_ID_cliente = "", 0, Txt_ID_cliente) & " and Tipodest_NFcons = 'C' or Consignacao = 'True' and Tipodest_NFcons = 'F')"
    Set TBLISTA = CreateObject("adodb.recordset")
    
    StrSql = "Select IDestoque, Estoque_disponivel, Qtde_empenhada, Lote from Estoque_produtos where ID_empresa = " & Cmb_empresa.ItemData(Cmb_empresa.ListIndex) & " and Desenho = '" & ListaRequisicao.SelectedItem.SubItems(1) & "' and Liberado = 'SIM' AND Estoque_disponivel > 0 " & Familiatext & " order by Data, IDestoque"
    'Debug.print StrSql

    TBLISTA.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
    If TBLISTA.EOF = True Then
        USMsgBox ("Não exitem lotes disponíveis para empenhar nesta requisição da ordem."), vbExclamation, "CAPRIND v5.0"
    Else
        If USMsgBox("Deseja realmente empenhar nesta requisição da ordem?", vbYesNo, "CAPRIND v5.0") = vbYes Then
            frmprod_Novo_Nota.Show 1
        End If
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcSalvarOS()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If Framedetalhes.Enabled = False Then
    ProcVerificaSalvar
    Exit Sub
End If
Acao = "salvar"
'If txtVersao.Text = "" Then
'    NomeCampo = "a versão"
'    ProcVerificaAcao
'    txtVersao.SetFocus
'    Exit Sub
'End If
If txtOSFase.Text = "" Then
    NomeCampo = "a fase"
    ProcVerificaAcao
    txtOSFase.SetFocus
    Exit Sub
End If
quantidade = IIf(txtOSLote = "", 0, txtOSLote)
If quantidade <= 0 Then
    NomeCampo = "a quantidade"
    ProcVerificaAcao
    txtOSLote.SetFocus
    Exit Sub
End If
If cmbOSMaquina = "" Then
    NomeCampo = "o posto de trabalho"
    ProcVerificaAcao
    cmbOSMaquina.SetFocus
    Exit Sub
End If
txtpreparacao.PromptInclude = False
If Len(txtpreparacao.Text) < 7 Then
    txtpreparacao.PromptInclude = True
    USMsgBox "Verifique se faltam dados no campo preparação ( " & txtpreparacao.Text & " ) á serem preenchidos.", vbInformation, "CAPRIND v5.0"
    txtpreparacao.SetFocus
    Exit Sub
End If
txtpreparacao.PromptInclude = True
txtexecucao.PromptInclude = False
If Len(txtexecucao.Text) < 7 Then
    txtexecucao.PromptInclude = True
    USMsgBox "Verifique se faltam dados no campo execução ( " & txtexecucao.Text & " ) á serem preenchidos.", vbInformation, "CAPRIND v5.0"
    txtexecucao.SetFocus
    Exit Sub
End If
txtexecucao.PromptInclude = True
If txtPcHora = "" Then
    NomeCampo = "a quantidade de peças x execução"
    ProcVerificaAcao
    txtPcHora.SetFocus
    Exit Sub
End If
If txtdescricao.Text = "" Then
    NomeCampo = "a instrução de trabalho"
    ProcVerificaAcao
    txtdescricao.SetFocus
    Exit Sub
End If

'Verifica se a ordem está concluída e só permite gerar OS de retrabalho
If Novo_Ordem1 = True Then
    If chkRetrabalho.Value = 0 Then
        Set TBOrdem = CreateObject("adodb.recordset")
        TBOrdem.Open "Select NOF from Producao where Ordem = " & txtof & " and Concluida = 'True'", Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdem.EOF = False Then
            USMsgBox ("Só é permitido gerar OS de retrabalho, pois a ordem está concluída."), vbExclamation, "CAPRIND v5.0"
            TBOrdem.Close
            Exit Sub
        End If
        
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select IDproducao, Fase from ordemservico where Ordem = " & txtof & " order by Fase Desc, IDproducao Desc", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            If txtOSFase >= TBAbrir!Fase Then
                Set TBOrdem = CreateObject("adodb.recordset")
                TBOrdem.Open "Select P.NOF from Producao P INNER JOIN ProducaoFases PF ON PF.Ordem = P.Ordem where PF.OS = " & TBAbrir!IDProducao & " and PF.quant > 0 and P.Entrar_estoque = 'True'", Conexao, adOpenKeyset, adLockOptimistic
                If TBOrdem.EOF = False Then
                    USMsgBox ("Só é permitido gerar OS de retrabalho, pois a ordem gera entrada automática no estoque e a última OS já foi apontada."), vbExclamation, "CAPRIND v5.0"
                    TBOrdem.Close
                    Exit Sub
                End If
                TBOrdem.Close
            End If
        End If
    End If
End If

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from ordemservico WHERE IDproducao = " & IIf(txtOS.Text = "", 0, txtOS.Text), Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = True Then TBOrdem.AddNew
TBOrdem!Obs = IIf(txtObs.Text <> "", txtObs.Text, "")
If txtDtValidacao <> "" Then
    TBOrdem.Update
    USMsgBox ("Alteração do campo observação efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
    Evento = "Alterar campo observação da OS"
Else
    If FunVerifValidacaoRegistro("alterar", txtDtValidacao, "ordem", "a OS", False) = False Then Exit Sub
    TBOrdem!Fase = txtOSFase.Text
    
    'Verifica se existe essa fase e máquina no processo
    TBOrdem!IDFase = 0
    If txtVersao <> "" Then
        Set TBFases = CreateObject("adodb.recordset")
        TBFases.Open "Select F.IDFase from Fases F INNER JOIN Producao P ON F.IDprocesso = P.IDprocesso where P.Ordem = " & txtof & " and F.Fase = " & txtOSFase & " and F.Versao = '" & txtVersao & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBFases.EOF = False Then
            TBOrdem!IDFase = TBFases!IDFase
        End If
        TBFases.Close
    End If
          
    TBOrdem!Grupo_op = TxtOS_grupo_op
    TBOrdem!maquina = cmbOSMaquina.Text
    TBOrdem!Ordem = txtof.Text
    TBOrdem!quantidade = txtOSLote.Text
    Quant1 = txtOSLote.Text
    TBOrdem!Pronto = "NÃO"
    TBOrdem!PrazoFinal = Cmb_prazo_os
    TBOrdem!status = txtStatus_OS
    
    Procsaida
    TBOrdem!Preparacao = Preparacao
    TBOrdem!Execucao = Execucao
    TBOrdem!TempoPreparacao = TempoPreparacao
    TBOrdem!TempoExecucao = TxtA3.Text 'Tempo de execução por peça
    TBOrdem!TESegundos = FunCalculaSegPC(TBOrdem!Execucao, txtPcHora) 'Tempo de execução por unidade em segundos
    TotalOS = IIf(IsNull(TBOrdem!Execucao), 0, TBOrdem!Execucao) / IIf(txtPcHora = 0, 1, txtPcHora)
    TotalOS = (TotalOS * Quant1) + IIf(IsNull(TBOrdem!Preparacao), 0, TBOrdem!Preparacao)
    ElapsedTime (TotalOS)
    TBOrdem!TempoTotalLote = HoraTotal  'Tempo total do lote previsto
    TBOrdem!TTLPREVS = s 'Tempo total do lote previsto em segundos
    If chkPchora.Value = 1 Then
        TBOrdem!pecahora = True
        TBOrdem!Pcshora = txtPcHora
    Else
        TBOrdem!pecahora = False
        If IsNull(TBOrdem!Execucao) = False And TBOrdem!Execucao <> "00:00:00" Then
            ElapsedTime (TBOrdem!Execucao)
            TBOrdem!Pcshora = 3600 / s
        End If
    End If
    TBOrdem!pc_te = txtPcHora
    
    'Verifica se a maquina agrega custos/eficiencia na ordem, custo previsto da os
    Set TBMaquinas = CreateObject("adodb.recordset")
    TBMaquinas.Open "Select * from cadmaquinas where maquina = '" & cmbOSMaquina.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBMaquinas.EOF = False Then
        If TBMaquinas!custos = True Then TBOrdem!custos = True Else TBOrdem!custos = False
        TotalFaseSeg = 0
        CustoFase = 0
        CustohoraSeg = 0
        TotalPreparacaoSeg = 0
        CustopreparacaoSeg = 0
        
        'Verifica custo de execucao por segundos * custo da hora maquina
        CustohoraSeg = TBMaquinas!PrecoHora / 3600
        TBOrdem!Valor_hs_exec = TBMaquinas!PrecoHora
        ElapsedTime (IIf(IsNull(TBOrdem!Execucao), 0, TBOrdem!Execucao))
        PcHora = TBOrdem!pc_te
        If PcHora > 0 Then TotalFaseSeg = s / PcHora Else TotalFaseSeg = s
        CustoFase = CustohoraSeg * TotalFaseSeg
        
        'Verifica custo de preparacao por segundos * custo da hora maquina
        If IsNull(TBMaquinas!PrecoHora_Setup) = False And TBMaquinas!PrecoHora_Setup <> "" Then
            CustohoraSeg = TBMaquinas!PrecoHora_Setup / 3600
            TBOrdem!Valor_hs_prep = TBMaquinas!PrecoHora_Setup
        Else
            TBOrdem!Valor_hs_prep = TBMaquinas!PrecoHora
        End If
        ElapsedTime (TBOrdem!Preparacao)
        CustopreparacaoSeg = CustohoraSeg * s
        TBOrdem!CPPECA = Format(CustoFase + (CustopreparacaoSeg / Quant1), "###,##0.0000000000")
        TBOrdem!CPLOTE = Format(TBOrdem!CPPECA * Quant1, "###,##0.0000000000")
    End If
    TBMaquinas.Close
    
    TBOrdem!descfase = txtdescricao.TextRTF
    If chkControlada.Value = 1 Then TBOrdem!OSControlada = True Else TBOrdem!OSControlada = False
    If ChkProcesso_controlado.Value = 1 Then TBOrdem!Processo_controlado = True Else TBOrdem!Processo_controlado = False
    If chkRetrabalho.Value = 1 Then TBOrdem!Retrabalho = True Else TBOrdem!Retrabalho = False
    If Chk_agrega_custos_efic.Value = 1 Then TBOrdem!custos = True Else TBOrdem!custos = False
    If chk_QTFinalOS = 1 Then TBOrdem!QT_Final = True Else TBOrdem!QT_Final = False
    If chkRastreavel = 1 Then TBOrdem!rastreavel = True Else TBOrdem!rastreavel = False
    
    TBOrdem!IDPlano = FunVerifIDPlano(TBOrdem!IDFase)
    TBOrdem.Update
    txtOS.Text = TBOrdem!IDProducao
    TBOrdem.Close
    ProcVerifOSApontamento
    If Novo_Ordem1 = True Then
        USMsgBox ("Nova OS cadastrada com sucesso."), vbInformation, "CAPRIND v5.0"
        Evento = "Nova OS"
    Else
        USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
        Evento = "Alterar OS"
    End If
End If
'==================================
Modulo = "PCP/Gerenciamento de ordem"
ID_documento = txtOS
Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
Documento1 = "OS: " & txtOS.Text
ProcGravaEvento
'==================================
ProcAcertaOS QuantSolicitado, True
ProcCarregaDadosOS txtOS
ProcAtualizalista_os
Novo_Ordem1 = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
On Error GoTo tratar_erro

Select Case SSTab1.Tab
    Case 0:
        Select Case KeyCode
            Case vbKeyF2: ProcFiltrarCarteira
            Case vbKeyF3: If Cmb_opcao_lista = "Gerar MRP" Then ProcMRP
            Case vbKeyF4: If Cmb_opcao_lista = "Cancelar MRP" Then ProcExcluirMRP
            Case vbKeyF5: ProcImprimirCarteira
            Case vbKeyF7: ProcAlterarLista
            Case vbKeyF8: ProcAlterarStatusOrdens
            Case vbKeyF11: ProcEmpenhoPI
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
    Case 1:
        Select Case KeyCode
            Case vbKeyInsert: ProcNovo
            Case vbKeyF2: ProcFiltrarOrdem
            Case vbKeyF3: ProcSalvarOrdem
            Case vbKeyF4: If Cmb_opcao_lista3 = "Excluir" Or SSTab2.Tab = 1 Then ProcExcluir
            Case vbKeyF5: ProcImprimir
            Case vbKeyF8: If Cmb_opcao_lista3 = "Status" Then ProcAlterarStatusOrdem
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
    Case 2:
        Select Case KeyCode
            Case vbKeyInsert: ProcNovoOS
            Case vbKeyF3: ProcSalvarOS
            Case vbKeyF4: If Cmb_opcao_lista1 = "Excluir" Then ProcExcluirOS
            Case vbKeyF5: ProcImprimirOS
            Case vbKeyF8: If Cmb_opcao_lista1 = "Status" Then ProcConcluiOS
            Case vbKeyF9: ProcCancelaOS
            Case vbKeyF10: ProcAtualizaPrazoFinal
            Case vbKeyF11: ProcRenumerar
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
    Case 3:
        Select Case KeyCode
            Case vbKeyInsert: ProcNovoReq
            Case vbKeyF3: procAlterarReq
            Case vbKeyF4: If Cmb_opcao_lista2 = "Excluir" Then ProcExcluirReq
            Case vbKeyF6: ProcEmpenhar
            Case vbKeyF7: ProcCancelarEmpenho
            Case vbKeyF8: ProcAlterarStatusReq
            Case vbKeyF9: If Cmb_opcao_lista2 = "QTBaixar" Then ProcBaixar_estoque
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
    Case 4:
        Select Case KeyCode
            Case vbKeyF2: ProcNovoAP
            Case vbKeyF3: ProcGravarAP
            Case vbKeyF4: ProcExcluirAP
            Case vbKeyF5: ProcImprimirAP
            Case vbKeyF7: ProcRecalcular_OS
            Case vbKeyF8: If cmbAPOS <> "" Then Frmprod_maq_utilizadas.Show 1
            Case vbKeyF9: ProcDesvincularOS
            Case vbKeyF11: ProcAtualizaProducao
            Case vbKeyF12: ProcLista12Ultimos
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
    Case 5:
        Select Case KeyCode
            Case vbKeyF5: ProcImprimirResultados
            Case vbKeyF7: ProcCusto
            Case vbKeyF8: ProcAtualizar_DadosOrdem
            Case vbKeyF1: ProcAjuda
            Case vbKeyEscape: ProcSair
        End Select
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcEmpenhoPI()
On Error GoTo tratar_erro

If listaitens.ListItems.Count = 0 Then Exit Sub
frmprod_empenhos_PI.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNovoAP()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtDtValidacao = "" Then
    USMsgBox ("Não é possivel criar novo apontamento, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

Acao = "criar novo apontamento"
If cmbAPOS = "" Then
    NomeCampo = "o número da OS"
    ProcVerificaAcao
    cmbAPOS.SetFocus
    Exit Sub
End If

'Verifica se o resultado da ordem foi validado
Set TBOSC = CreateObject("adodb.recordset")
If Txt_ID_apontamento <> "" Then
    TBOSC.Open "Select P.ordem from Producao P INNER JOIN Ordemservico OS ON OS.ordem = P.ordem where OS.ID_apontamento = " & Txt_ID_apontamento & " and P.DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
Else
    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
End If
If TBOSC.EOF = False Then
    If Txt_ID_apontamento <> "" Then MsgTexto = " ou da ordem " & TBOSC!Ordem & " (vinculada a esta)" Else MsgTexto = ""
    USMsgBox ("Não é permitido criar novo apontamento, pois já foi validado o resultado desta ordem" & MsgTexto & "."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close
If cmbStatus = "Cancelada" Then
    USMsgBox ("Não é possivel criar novo apontamento, pois a ordem foi cancelada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select IDproducao from Ordemservico where IDproducao = " & cmbAPOS & " and Pronto = 'SIM'", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    USMsgBox ("Não é possivel criar novo apontamento, pois esta OS está concluída."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close

With txtTOK
    .Locked = True
    .TabStop = False
End With
    With txtTNC
    .Locked = True
    .TabStop = False
End With
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select CodigoDesc from " & NomeTabelaAp & " where idfase = " & cmbAPOS & " and Maquina = '" & txtAPMaquina & "' order by Data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    If TBOSC!CodigoDesc = 2 Then
        With txtTOK
            .Locked = False
            .TabStop = True
        End With
        With txtTNC
            .Locked = False
            .TabStop = True
        End With
    End If
End If
TBOSC.Close

ProcLimpaCamposNovoAP True
Novo_Ordem2 = True
Frame15.Enabled = True
If cmbOperador.Text = "" Then
cmbOperador.SetFocus
Else
cmbdescricao.SetFocus
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcLimpaCamposNovoAP(NovoAP As Boolean)
On Error GoTo tratar_erro

txtCodigo.Text = ""
cmbdescricao.ListIndex = -1
mskData.Value = Date
If NovoAP = True Then txtinicioap.Value = Format(Now, "hh:mm:ss") Else txtinicioap.Value = "00:00:00"
txtTOK.Text = ""
txtTNC.Text = ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizalista_carteira()
On Error GoTo tratar_erro

lblRegistros.Caption = "Nº de registros: 0"
lblPaginas.Caption = "Página: 0 de: 0"
listaitens.ListItems.Clear
If StrSql_Ordem_MRP = "" Then Exit Sub
Set TBLISTA_Ordem = CreateObject("adodb.recordset")
'Debug.print StrSql_Ordem_MRP
TBLISTA_Ordem.Open StrSql_Ordem_MRP, Conexao, adOpenKeyset, adLockReadOnly
'Debug.print StrSql_Ordem_MRP
If TBLISTA_Ordem.EOF = False Then
    ProcExibePagina (1)
Else
    TxtEstCodigo = ""
End If
'Debug.print StrSql_Ordem_MRP
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExibePagina(Pagina)
On Error GoTo tratar_erro

listaitens.ListItems.Clear
TBLISTA_Ordem.PageSize = IIf(txtNreg = "", 30, txtNreg)
TBLISTA_Ordem.AbsolutePage = Pagina
TamanhoPagina = TBLISTA_Ordem.PageSize
ContadorReg = 1

'PBLista.Min = 0
'PBLista.Max = FunVerifMaxPBListaPaginacao(TBLISTA_Ordem.RecordCount - IIf(Pagina > 1, (TBLISTA_Ordem.PageSize * (Pagina - 1)), 0), TBLISTA_Ordem.PageSize)
'PBLista.Value = 1
Contador = 0
Do While TBLISTA_Ordem.EOF = False And (ContadorReg <= TamanhoPagina)
    With listaitens.ListItems.Add(, , TBLISTA_Ordem!CODIGO)
        .SubItems(1) = TBLISTA_Ordem!Cotacao
        .SubItems(2) = IIf(IsNull(TBLISTA_Ordem!Empresa), "", TBLISTA_Ordem!Empresa)
        If IsNull(TBLISTA_Ordem!ID_solicitacao) = False And TBLISTA_Ordem!ID_solicitacao <> "" Then .SubItems(19) = IIf(IsNull(TBLISTA_Ordem!Requisicaotexto), "", TBLISTA_Ordem!Requisicaotexto) Else .SubItems(19) = IIf(IsNull(TBLISTA_Ordem!Ncotacao), "", TBLISTA_Ordem!Ncotacao)
        .SubItems(3) = IIf(IsNull(TBLISTA_Ordem!Desenho), "", TBLISTA_Ordem!Desenho)
        .SubItems(4) = IIf(IsNull(TBLISTA_Ordem!Rev_codinterno), "", TBLISTA_Ordem!Rev_codinterno)
        .SubItems(5) = IIf(IsNull(TBLISTA_Ordem!N_referencia), "", TBLISTA_Ordem!N_referencia)
        .SubItems(6) = IIf(IsNull(TBLISTA_Ordem!descricao_tecnica), "", TBLISTA_Ordem!descricao_tecnica)
        .SubItems(7) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_produzir), 0, TBLISTA_Ordem!Qtde_produzir), "###,##0.0000")
        .SubItems(8) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_Faturada), 0, TBLISTA_Ordem!Qtde_Faturada), "###,##0.0000")
        .SubItems(9) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_Faturar), 0, TBLISTA_Ordem!Qtde_Faturar), "###,##0.0000")
        .SubItems(10) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_emp_est), 0, TBLISTA_Ordem!Qtde_emp_est), "###,##0.0000")
        .SubItems(11) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_emp_prod), 0, TBLISTA_Ordem!Qtde_emp_prod), "###,##0.0000")
        .SubItems(12) = Format(IIf(IsNull(TBLISTA_Ordem!Necessidade), 0, TBLISTA_Ordem!Necessidade), "###,##0.0000")
        .SubItems(13) = IIf(IsNull(TBLISTA_Ordem!PrazoFinal), "", Format(TBLISTA_Ordem!PrazoFinal, "dd/mm/yy"))
        .SubItems(14) = TBLISTA_Ordem!Tem_Processo
        .SubItems(15) = TBLISTA_Ordem!Tem_Plano
        .SubItems(16) = IIf(IsNull(TBLISTA_Ordem!DtValidacaoConj), "NÃO", "SIM")
        .SubItems(17) = TBLISTA_Ordem!MRP
        .SubItems(18) = IIf(IsNull(TBLISTA_Ordem!Versao_processo), "", TBLISTA_Ordem!Versao_processo)
        .SubItems(19) = IIf(IsNull(TBLISTA_Ordem!Datavendas), "", Format(TBLISTA_Ordem!Datavendas, "dd/mm/yy"))
        .SubItems(20) = IIf(IsNull(TBLISTA_Ordem!Ncotacao), "", TBLISTA_Ordem!Ncotacao)
        .SubItems(21) = IIf(IsNull(TBLISTA_Ordem!Revisao), "", TBLISTA_Ordem!Revisao)
        .SubItems(22) = IIf(IsNull(TBLISTA_Ordem!Cliente), "", TBLISTA_Ordem!Cliente)
        .SubItems(23) = IIf(IsNull(TBLISTA_Ordem!PCCliente), "", TBLISTA_Ordem!PCCliente)
        .SubItems(24) = Format(IIf(IsNull(TBLISTA_Ordem!qtdeexpedida), 0, TBLISTA_Ordem!qtdeexpedida), "###,##0.0000")
        .SubItems(25) = Format(IIf(IsNull(TBLISTA_Ordem!Qtde_expedir), 0, TBLISTA_Ordem!Qtde_expedir), "###,##0.0000")
        .SubItems(26) = IIf(IsNull(TBLISTA_Ordem!Observacoes), "", TBLISTA_Ordem!Observacoes)
        
        If TBLISTA_Ordem!Utiliza_mat_cons = True Then MRP_utilizaMatConsPI = True Else MRP_utilizaMatConsPI = False
         
        'Muda cor da lista
        If TBLISTA_Ordem!PrazoFinal < Date And IIf(IsNull(TBLISTA_Ordem!Qtde_Faturar), 0, TBLISTA_Ordem!Qtde_Faturar) > 0 Then 'Atrasada
            .ForeColor = vbRed
            .ListSubItems(1).ForeColor = vbRed
            .ListSubItems(2).ForeColor = vbRed
            .ListSubItems(3).ForeColor = vbRed
            .ListSubItems(4).ForeColor = vbRed
            .ListSubItems(5).ForeColor = vbRed
            .ListSubItems(6).ForeColor = vbRed
            .ListSubItems(7).ForeColor = vbRed
            .ListSubItems(8).ForeColor = vbRed
            .ListSubItems(9).ForeColor = vbRed
            .ListSubItems(10).ForeColor = vbRed
            .ListSubItems(11).ForeColor = vbRed
            .ListSubItems(12).ForeColor = vbRed
            .ListSubItems(13).ForeColor = vbRed
            .ListSubItems(14).ForeColor = vbRed
            .ListSubItems(15).ForeColor = vbRed
            .ListSubItems(16).ForeColor = vbRed
            .ListSubItems(17).ForeColor = vbRed
            .ListSubItems(18).ForeColor = vbRed
            .ListSubItems(19).ForeColor = vbRed
            .ListSubItems(20).ForeColor = vbRed
            .ListSubItems(21).ForeColor = vbRed
            .ListSubItems(22).ForeColor = vbRed
            .ListSubItems(23).ForeColor = vbRed
            .ListSubItems(24).ForeColor = vbRed
            .ListSubItems(25).ForeColor = vbRed
        End If
    End With
    TBLISTA_Ordem.MoveNext
    ContadorReg = ContadorReg + 1
    Contador = Contador + 1
    'PBLista.Value = Contador
Loop

lblRegistros.Caption = "Nº de registros: " & TBLISTA_Ordem.RecordCount
If TBLISTA_Ordem.AbsolutePage = adPosBOF Then
   lblPaginas.Caption = "Página: 1 de: " & TBLISTA_Ordem.PageCount
ElseIf TBLISTA_Ordem.AbsolutePage = adPosEOF Then
        lblPaginas.Caption = "Página: " & TBLISTA_Ordem.PageCount & " de: " & TBLISTA_Ordem.PageCount
    Else
        lblPaginas.Caption = "Página: " & TBLISTA_Ordem.AbsolutePage - 1 & " de: " & TBLISTA_Ordem.PageCount
End If

DesenhoMRP = ""
RevDesenhoMRP = ""
listaitens.Refresh

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizalista_os()
On Error GoTo tratar_erro

ListaOS.ListItems.Clear
ListaOS_maq.ListItems.Clear
If txtof.Text = "" Then Exit Sub
Set TBCarteira = CreateObject("adodb.recordset")
TBCarteira.Open "Select OS.Quantidade, OS.IDFase, OS.IDProducao, OS.Fase, OS.Grupo_op, OS.maquina, OS.Pronto, OS.rastreavel, OS.QTNC, OS.QTOK from OrdemServico OS where Ordem = " & txtof.Text & " ORDER BY fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBCarteira.EOF = False Then
    'PBLista2.Min = 0
    'PBLista2.Max = TBCarteira.RecordCount
    'PBLista2.Value = 1
    
    
    Contador = 0
    Do While TBCarteira.EOF = False
    
    If TBCarteira!rastreavel = True Then
    StrSql = "Update Ordemservico Set QTOK = AP.TTOK from Ordemservico OS  Inner Join Etiquetas_aprovadas AP ON OS.IDProducao = AP.OS Where OS.idProducao = '" & TBCarteira!IDProducao & "'  and  AP.Status = 'Aprovado'"
    Conexao.Execute (StrSql)
    
    StrSql = "UPDATE OS SET OS.Totalprod = (SELECT SUM(T2.QTOK) + sum(T2.QTNC) FROM Ordemservico T2 WHERE T2.IDProducao = OS.IDProducao) FROM Ordemservico OS"
    Conexao.Execute (StrSql)
    End If
    
        With ListaOS.ListItems
            .Add , , TBCarteira!IDProducao
            Set TBCFOP = CreateObject("adodb.recordset")
            TBCFOP.Open "Select Versao from fases where IDFase = " & IIf(IsNull(TBCarteira!IDFase), 0, TBCarteira!IDFase), Conexao, adOpenKeyset, adLockOptimistic
            If TBCFOP.EOF = False Then .Item(.Count).SubItems(1) = IIf(IsNull(TBCFOP!versao), "", TBCFOP!versao)
            TBCFOP.Close
            .Item(.Count).SubItems(2) = IIf(IsNull(TBCarteira!Fase), "", TBCarteira!Fase)
            .Item(.Count).SubItems(3) = IIf(IsNull(TBCarteira!Grupo_op), "", TBCarteira!Grupo_op)
            .Item(.Count).SubItems(4) = IIf(IsNull(TBCarteira!maquina), "", TBCarteira!maquina)
            .Item(.Count).SubItems(5) = IIf(IsNull(TBCarteira!Pronto), "", TBCarteira!Pronto)
            .Item(.Count).SubItems(6) = IIf(TBCarteira!rastreavel = True, "Sim", "Não")
            .Item(.Count).SubItems(7) = TBCarteira!QTOK
            .Item(.Count).SubItems(8) = TBCarteira!QTNC
            Saldo = TBCarteira!quantidade - (TBCarteira!QTOK + TBCarteira!QTNC)
            .Item(.Count).SubItems(9) = Saldo
            
        End With
        TBCarteira.MoveNext
        Contador = Contador + 1
       'PBLista2.Value = contador
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Form_Load()
On Error GoTo tratar_erro

ProcCarregaToolBar1 Me, 15195, 11, True
ProcCarregaToolBar2 Me, 15195, 14, True
ProcCarregaToolBar3 Me, 15195, 13, True
ProcCarregaToolBar4 Me, 15195, 6, True
ProcCarregaToolBar5 Me, 15195, 9, True
Formulario = "PCP/Gerenciamento de ordem"
Direitos
ProcVerifColunas
ProcCarregaComboEmpresa Cmb_empresa, False
SSTab1.Tab = 0
SSTab2.Tab = 0
ProcCarregaComboCodigoTrab cmbdescricao, "Bloqueado = 'False'", False
ProcCarregaComboFontes Cmb_fonte
ProcCarregaComboTamanhoFonte Cmb_tamanho_fonte, 8, 16
cmbVersao = "A"
mskprazofina.Value = Date
txtData_emissao = Format(Date, "dd/mm/yy")
mskData.Value = Date
Cmb_prazo_os = Date
Cmb_opcao_lista = "Gerar MRP"
Cmb_opcao_lista3 = "Validação"
Cmb_opcao_lista1 = "Excluir"
Cmb_opcao_lista2 = "Excluir"
ProcLimpaVariaveisPrincipais
listaitens.Visible = True

ProcRemoveObjetosResize Me
'PBLista.Top = 9720

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifColunas()
On Error GoTo tratar_erro

'ProcCorrigeColunasForm listaitens, Formulario & " - Carteira de produção", 25, False, 300, 0, 0, 1000, 0, 1000, 2200, 900, 0, 0, 0, 0, 1000, 850, 700, 0, 1100, 1100, 850, 1100, 525, 2800, 1200, 900, 950, 3000, 0, 0, 0, 0, 0

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub atualiza_lista_ordens(Pagina As Integer)
On Error GoTo tratar_erro

lblRegistros2.Caption = "Nº de registros: 0"
lblPaginas2.Caption = "Página: 0 de: 0"
Lista.ListItems.Clear
If StrSql_Ordem_Localizar = "" Then Exit Sub
Set TBLISTA_Ordem1 = CreateObject("adodb.recordset")
TBLISTA_Ordem1.Open StrSql_Ordem_Localizar, Conexao, adOpenKeyset, adLockReadOnly
If TBLISTA_Ordem1.EOF = False Then ProcExibePagina2 (Pagina)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExibePagina2(Pagina)
On Error GoTo tratar_erro

Lista.ListItems.Clear
TBLISTA_Ordem1.PageSize = IIf(txtNreg2 = "", 30, txtNreg2)
TBLISTA_Ordem1.AbsolutePage = Pagina
TamanhoPagina = TBLISTA_Ordem1.PageSize
ContadorReg = 1

Contador = 0
Do While TBLISTA_Ordem1.EOF = False And (ContadorReg <= TamanhoPagina)
    With Lista.ListItems
        .Add , , TBLISTA_Ordem1!Ordem
        .Item(.Count).SubItems(1) = TBLISTA_Ordem1!Ordem
        .Item(.Count).SubItems(2) = TBLISTA_Ordem1!Empresa
        .Item(.Count).SubItems(3) = IIf(IsNull(TBLISTA_Ordem1!PrazoEntrega) = False, Format(TBLISTA_Ordem1!PrazoEntrega, "dd/mm/yy"), "")
        .Item(.Count).SubItems(4) = IIf(IsNull(TBLISTA_Ordem1!Desenho) = False, TBLISTA_Ordem1!Desenho, "")
        .Item(.Count).SubItems(5) = IIf(IsNull(TBLISTA_Ordem1!N_referencia) = False, TBLISTA_Ordem1!N_referencia, "")
        .Item(.Count).SubItems(6) = IIf(IsNull(TBLISTA_Ordem1!Produto) = False, TBLISTA_Ordem1!Produto, "")
        .Item(.Count).SubItems(7) = IIf(IsNull(TBLISTA_Ordem1!DataEntrega), "", Format(TBLISTA_Ordem1!DataEntrega, "dd/mm/yy"))
        .Item(.Count).SubItems(8) = IIf(IsNull(TBLISTA_Ordem1!DtValidacao) Or TBLISTA_Ordem1!DtValidacao = "", "Não", "Sim")
        .Item(.Count).SubItems(9) = IIf(IsNull(TBLISTA_Ordem1!DtValidacao_custo) Or TBLISTA_Ordem1!DtValidacao_custo = "", "Não", "Sim")
        .Item(.Count).SubItems(10) = IIf(IsNull(TBLISTA_Ordem1!Impof) Or TBLISTA_Ordem1!Impof = 0, "Não", "Sim")
    End With
    TBLISTA_Ordem1.MoveNext
    ContadorReg = ContadorReg + 1
    Contador = Contador + 1
Loop
lblRegistros2.Caption = "Nº de registros: " & TBLISTA_Ordem1.RecordCount
If TBLISTA_Ordem1.AbsolutePage = adPosBOF Then
   lblPaginas2.Caption = "Página: 1 de: " & TBLISTA_Ordem1.PageCount
ElseIf TBLISTA_Ordem1.AbsolutePage = adPosEOF Then
        lblPaginas2.Caption = "Página: " & TBLISTA_Ordem1.PageCount & " de: " & TBLISTA_Ordem1.PageCount
    Else
        lblPaginas2.Caption = "Página: " & TBLISTA_Ordem1.AbsolutePage - 1 & " de: " & TBLISTA_Ordem1.PageCount
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizaOS()
On Error GoTo tratar_erro

If InputBox("Informe a senha para liberar.") = "280362O1" Then
    If USMsgBox("Deseja realmente atualizar os dados da(s) OS?", vbYesNo, "CAPRIND v5.0") = vbYes Then
        Set TBFases = CreateObject("adodb.recordset")
        TBFases.Open "Select * from OrdemServico  order by IDProducao", Conexao, adOpenKeyset, adLockOptimistic
        If TBFases.EOF = False Then
            TBFases.MoveLast
            'PBLista2.Min = 0
            'PBLista2.Max = TBFases.RecordCount
            'PBLista2.Value = 1
            Contador = 0
            TBFases.MoveFirst
            Do While TBFases.EOF = False
                If IsNull(TBFases!CTServico) = True Or TBFases!CTServico = "" Then TBFases!CTServico = 0
                TBFases!IDPlano = FunVerifIDPlano(TBFases!IDFase)
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from Fases where IDFase = " & IIf(IsNull(TBFases!IDFase), 0, TBFases!IDFase), Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    TBFases!Grupo_op = TBAbrir!Grupo_op
                End If
                TBAbrir.Close
                
                TBFases.Update
                TBFases.MoveNext
                Contador = Contador + 1
                'PBLista2.Value = contador
            Loop
        End If
        If USMsgBox("Deseja atualizar o tempo total das OS?", vbYesNo, "CAPRIND v5.0") = vbYes Then
            Set TBFases = CreateObject("adodb.recordset")
            TBFases.Open "Select * from OrdemServico where Quantidade <> 'Null' order by IDProducao", Conexao, adOpenKeyset, adLockOptimistic
            If TBFases.EOF = False Then
                TBFases.MoveLast
                'PBLista2.Min = 0
                'PBLista2.Max = TBFases.RecordCount
                'PBLista2.Value = 1
                Contador = 0
                TBFases.MoveFirst
                Do While TBFases.EOF = False
1:
                    If IsNull(TBFases!pc_te) = True Or TBFases!pc_te = "" Or TBFases!pc_te = "0" Then TBFases!pc_te = 1
                    If IsNull(TBFases!TESegundos) = True Or TBFases!TESegundos = "" Or TBFases!TESegundos = 0 Then TBFases!TESegundos = FunCalculaSegPC(TBFases!Execucao, TBFases!pc_te)
                    
                    'Tempo total previsto do lote
                    ElapsedTime (IIf(IsNull(TBFases!Preparacao), "00:00:00", TBFases!Preparacao))
                    DecimoSegundos = (IIf(IsNull(TBFases!TESegundos), 0, TBFases!TESegundos) * TBFases!quantidade) + s
                    TBFases!TTLPREVS = DecimoSegundos 'Tempo total do lote previsto em segundos
                    TBFases!TempoTotalLote = FormataTempo(DecimoSegundos) 'Tempo total do lote
                    TBFases.Update
                    TBFases.MoveNext
                    Contador = Contador + 1
                    'PBLista2.Value = contador
                Loop
            End If
        End If
        TBFases.Close
        USMsgBox ("Atualização efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
        '==================================
        Modulo = "PCP/Gerenciamento de ordem"
        Evento = "Atualizar1"
        ID_documento = 0
        Documento = ""
        Documento1 = ""
        ProcGravaEvento
        '==================================
    End If
End If

Exit Sub
tratar_erro:
    If Err.Number = "13" Then
        Contador2 = 0
        Do While Contador2 <> 1000
            Contador2 = Contador2 + 1
        Loop
        GoTo 1
    End If
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExcluir()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If SSTab2.Tab = 0 Then
    ProcExcluirOrdem
Else
    Permitido = False
    With Lista_pedidos
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                If Permitido = False Then
                    If USMsgBox("Deseja realmente excluir este(s) empenho(s) da ordem?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
                End If
                Permitido = True
                Conexao.Execute "DELETE from Producao_pedidos where ID = " & .ListItems(InitFor)
            
                'Verifica se tem outra ordem para o IDcarteira desse pedido
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from producao_pedidos where IDCarteira = " & .ListItems(InitFor).ListSubItems(1) & " order by IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = True Then
                    Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'False' where Codigo = " & .ListItems(InitFor).ListSubItems(1)
                End If
                TBAbrir.Close
                
                '==================================
                Modulo = "PCP/Gerenciamento de ordem"
                Evento = "Excluir empenho da ordem"
                ID_documento = .ListItems(InitFor)
                Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
                Documento1 = "Pedido int.: " & .ListItems(InitFor).ListSubItems(2) & " - Rev.: " & .ListItems(InitFor).ListSubItems(3) & " - Cód. interno: " & Lista.SelectedItem.ListSubItems(5) & " - Rev.: " & .SelectedItem.ListSubItems(6) & " - Qtde. empenhada: " & .SelectedItem.ListSubItems(10) & " - Qtde. entrada: " & .SelectedItem.ListSubItems(11)
                ProcGravaEvento
                '==================================
            End If
        Next InitFor
    End With
    If Permitido = False Then
        USMsgBox ("Informe o(s) empenhos(s) da ordem antes de excluir."), vbExclamation, "CAPRIND v5.0"
    Else
        USMsgBox ("Empenho(s) da ordem excluído(s) com sucesso."), vbInformation, "CAPRIND v5.0"
        ProcCarregaListaPedidos
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcNovo()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If SSTab2.Tab = 0 Then
    ProcLimpar True
    frmprod_Novo.Show 1
    If Permitido = True Then Cmdlocalizarcli_Click
Else
    Acao = "empenhar a ordem para o pedido interno"
    If txtof = "" Then
        USMsgBox ("Informe a ordem antes de " & Acao & "."), vbExclamation, "CAPRIND v5.0"
        ProcFiltrarOrdem
        Exit Sub
    End If
    If optconsignacao.Value = 1 And (Txt_ID_cliente = "" Or txtCliente = "") Then
        USMsgBox ("Informe o cliente antes de " & Acao & "."), vbExclamation, "CAPRIND v5.0"
        Cmdlocalizarcli_Click
        Exit Sub
    End If
    If Novo_Ordem = True Then
        USMsgBox ("Salve a ordem antes de " & Acao & "."), vbExclamation, "CAPRIND v5.0"
        Exit Sub
    End If
    
    'Verifica se o resultado da ordem foi validado
    Set TBOSC = CreateObject("adodb.recordset")
    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
    If TBOSC.EOF = False Then
        USMsgBox ("Não é permitido empenhar a ordem para o pedido interno, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
        TBOSC.Close
        Exit Sub
    End If
    TBOSC.Close

    Compras_Requisicao = False
    Compras_Cotacao = False
    Compras_Pedido = False
    frmProd_Lista_Produto.Show 1
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcSalvarOrdem()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If cmbStatus.Text = "" Then
    ProcVerificaSalvar
    Exit Sub
End If
Acao = "salvar"
If Cmb_empresa = "" Then
    NomeCampo = "a empresa"
    ProcVerificaAcao
    Cmb_empresa.SetFocus
    Exit Sub
End If
If txtof.Text = "" Then
    NomeCampo = "o número da ordem"
    ProcVerificaAcao
    txtof.SetFocus
    Exit Sub
End If
QuantSolicitado = IIf(txtQuantidade = "", 0, txtQuantidade)
If QuantSolicitado <= 0 Then
    NomeCampo = "a quantidade"
    ProcVerificaAcao
    txtQuantidade.SetFocus
    Exit Sub
End If
If txtdesenho.Text = "" Then
    NomeCampo = "o código interno"
    ProcVerificaAcao
    txtdesenho.SetFocus
    Exit Sub
End If
If txtRevitem.Text = "" Then ProcCarregaDadosItem
If txtRevitem.Text = "" Then
    USMsgBox ("Não foi encontrado nenhum produto com este código interno, favor revisar."), vbExclamation, "CAPRIND v5.0"
    txtdesenho.SetFocus
    Exit Sub
End If
If txtProduto.Text = "" Then
    NomeCampo = "a descrição"
    ProcVerificaAcao
    txtProduto.SetFocus
    Exit Sub
End If
If optconsignacao.Value = 1 And (Txt_ID_cliente = "" Or txtCliente.Text = "") Then
    NomeCampo = "o nome do cliente"
    ProcVerificaAcao
    Cmdlocalizarcli_Click
    Exit Sub
End If
If mskprazofina < txtData_emissao Then
    If USMsgBox("O prazo final está menor que a data de emissão, deseja prosseguir assim mesmo?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
End If

Call ProcVerifQtdLoteMinimo(txtdesenho, txtQuantidade, Cmb_empresa.ItemData(Cmb_empresa.ListIndex), True)
If Permitido = False Then Exit Sub

ProcGravar
Novo_Ordem = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Function ProcVerifQtdLoteMinimo(Codinterno As String, Qtde As Double, ID_empresa As Long, MostrarMsg As Boolean) As Double
On Error GoTo tratar_erro

Permitido = True
ProcVerifQtdLoteMinimo = Qtde
NovoValor = Replace(Qtde, ",", ".")
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select Qtde_LoteMinimo from projproduto where Desenho = '" & Codinterno & "' and Qtde_LoteMinimo > 0 and Qtde_LoteMinimo is not null and Qtde_LoteMinimo > " & NovoValor, Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    Set TBCQ = CreateObject("adodb.recordset")
    TBCQ.Open "Select codigo from Empresa where codigo = " & ID_empresa & " and Liberar_LoteMinimo = 'True'", Conexao, adOpenKeyset, adLockOptimistic
    If TBCQ.EOF = False Then
        If MostrarMsg = True Then
            If USMsgBox("A quantidade da ordem é menor que o lote mínimo, deseja prosseguir?", vbYesNo, "CAPRIND v5.0") = vbNo Then
                Permitido = False
                Exit Function
            End If
        End If
    Else
        If MostrarMsg = True Then
            USMsgBox "Não é permitido salvar esta ordem, pois a quantidade da ordem é menor que o lote mínimo." + vbCrLf + vbCrLf + "Quantidade: " & Format(Qtde, "###,##0.0000") & vbCrLf + "Lote mínimo: " & Format(TBAbrir!qtde_LoteMinimo, "###,##0.0000"), vbExclamation, "CAPRIND v5.0"
            Permitido = False
        Else
            ProcVerifQtdLoteMinimo = TBAbrir!qtde_LoteMinimo
        End If
    End If
    TBCQ.Close
End If
TBAbrir.Close

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Private Sub Grid1_RowColChange(ByVal Row As Long, ByVal Col As Long)
On Error GoTo tratar_erro

If Grid1.rows = 1 Then Exit Sub
TxtEstCodigo = Grid1.Cell(Row, 1).Text
ProcCarregaDadosProdEstImaProc False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Lista_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

If ColumnHeader = "" Then
    With Lista
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                .ListItems.Item(InitFor).Checked = False
            Else
                If Cmb_opcao_lista3 = "Excluir" Then
                        If .ListItems(InitFor).ListSubItems(8) = "Sim" Then GoTo Proximo
                        'If ProcVerifExclusaoValidDaOrdem(.ListItems(InitFor), .ListItems(InitFor).ListSubItems(4), False, "") = False Then GoTo Proximo
                    ElseIf Cmb_opcao_lista3 = "Validação" Then
                            If .ListItems(InitFor).ListSubItems(8) = "Sim" And .ListItems(InitFor).ListSubItems(9) = "Sim" Then GoTo Proximo
                        ElseIf Cmb_opcao_lista3 = "Validação resultado" Then
                                If .ListItems(InitFor).ListSubItems(7) = "" Or (.ListItems(InitFor).ListSubItems(8) = "Não" And .ListItems(InitFor).ListSubItems(9) = "Não") Then GoTo Proximo
                End If
                .ListItems.Item(InitFor).Checked = True
Proximo:
            End If
        Next InitFor
    End With
Else
    ProcOrdenaListView Lista, ColumnHeader
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Lista_ItemCheck(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

With Lista
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True And .ListItems.Item(InitFor) = Item Then
            If Cmb_opcao_lista3 = "Excluir" Then
                If .ListItems(InitFor).ListSubItems(8) = "Sim" Then
                    USMsgBox "Não é possivel excluir esta ordem, pois a mesma já foi validada.", vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                'If ProcVerifExclusaoValidDaOrdem(.ListItems(InitFor), .ListItems(InitFor).ListSubItems(4), True, "excluir esta") = False Then .ListItems.Item(InitFor).Checked = False
            ElseIf Cmb_opcao_lista3 = "Validação" Then
                    If .ListItems(InitFor).ListSubItems(8) = "Sim" And .ListItems(InitFor).ListSubItems(9) = "Sim" Then
                        USMsgBox "Não é possivel cancelar validação desta ordem, pois os resultados da mesma já foram validados.", vbExclamation, "CAPRIND v5.0"
                        .ListItems.Item(InitFor).Checked = False
                    End If
                ElseIf Cmb_opcao_lista3 = "Validação resultado" Then
                        If .ListItems(InitFor).ListSubItems(7) = "" Then
                            USMsgBox "Não é possivel validar o resultado desta ordem, pois a mesma ainda não foi concluída.", vbExclamation, "CAPRIND v5.0"
                            .ListItems.Item(InitFor).Checked = False
                        End If
                        If .ListItems(InitFor).ListSubItems(8) = "Não" And .ListItems(InitFor).ListSubItems(9) = "Não" Then
                            USMsgBox "Não é possivel validar o resultado desta ordem, pois a mesma ainda não foi validada.", vbExclamation, "CAPRIND v5.0"
                            .ListItems.Item(InitFor).Checked = False
                        End If
            End If
        End If
    Next InitFor
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Function ProcVerifExclusaoValidDaOrdem(Ordem As Long, Codinterno As String, MostrarMsgem As Boolean, TextoMsg As String) As Boolean
On Error GoTo tratar_erro

ProcVerifExclusaoValidDaOrdem = True
Mensagem = "Não é permitido " & TextoMsg & " ordem, pois a mesma está sendo utilizada no módulo"

If MostrarMsgem = True Then
    ProcVerificaRegistroUtilizado "estoque_controle", "lote = '" & Ordem & "' and desenho = '" & Codinterno & "'", "Estoque/Movimentação"
Else
    ProcVerificaRegistroUtilizadoSemMsg "estoque_controle", "lote = '" & Ordem & "' and desenho = '" & Codinterno & "'"
End If
If Permitido = False Then GoTo Pula
If MostrarMsgem = True Then
    ProcVerificaRegistroUtilizado "estoque_movimentacao", "Ordem = " & Ordem & " and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", "Estoque/Movimentação"
Else
    ProcVerificaRegistroUtilizadoSemMsg "estoque_movimentacao", "Ordem = " & Ordem & " and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')"
End If
If Permitido = False Then GoTo Pula
If MostrarMsgem = True Then
    ProcVerificaRegistroUtilizado "ProducaoFases", "Ordem = " & Ordem, "Apontamento"
Else
    ProcVerificaRegistroUtilizadoSemMsg "ProducaoFases", "Ordem = " & Ordem
End If
If Permitido = False Then GoTo Pula
If MostrarMsgem = True Then
    ProcVerificaRegistroUtilizado "ProducaoFases_backup", "Ordem = " & Ordem, "Apontamento"
Else
    ProcVerificaRegistroUtilizadoSemMsg "ProducaoFases_backup", "Ordem = " & Ordem
End If
If Permitido = False Then GoTo Pula
If MostrarMsgem = True Then
    ProcVerificaRegistroUtilizado "medicao", "peca = '" & Ordem & "'", "Qualidade/Controle de medição"
Else
    ProcVerificaRegistroUtilizadoSemMsg "medicao", "peca = '" & Ordem & "'"
End If
If Permitido = False Then GoTo Pula

Set TBTempo = CreateObject("adodb.recordset")
TBTempo.Open "Select P.Ordem from Producao P INNER JOIN Ordemservico OS ON OS.Ordem = P.Ordem where P.Ordem = " & Ordem & " and OS.ID_apontamento IS NOT NULL and OS.ID_apontamento <> 0", Conexao, adOpenKeyset, adLockOptimistic
If TBTempo.EOF = False Then
    If MostrarMsgem = True Then USMsgBox ("Não é permitido " & TextoMsg & " ordem, pois a mesma está sendo utilizada no módulo PCP/Plano de produção."), vbExclamation, "CAPRIND v5.0"
    Permitido = False
End If
TBTempo.Close
If Permitido = False Then GoTo Pula

Set TBTempo = CreateObject("adodb.recordset")
TBTempo.Open "Select * from Compras_pedido_lista where Ordem = " & Ordem, Conexao, adOpenKeyset, adLockOptimistic
If TBTempo.EOF = False Then
    If TBTempo!Status_Item = "REQUISIT." Then
        Texto = "Outros/Solicitação"
    ElseIf TBTempo!Status_Item = "COTANDO" Then
            Texto = "Compras/Cotação"
        Else
            Texto = "Compras/Pedido"
    End If
    If MostrarMsgem = True Then USMsgBox ("Não é permitido " & TextoMsg & " ordem, pois a mesma está sendo utilizada no módulo " & Texto & "."), vbExclamation, "CAPRIND v5.0"
    Permitido = False
End If
TBTempo.Close

Pula:
    ProcVerifExclusaoValidDaOrdem = Permitido

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Private Sub Lista_ItemClick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

ProcLimpar True
Ordem = Lista.SelectedItem
ProcCarregaOrdem
'ProcCarregaResultados

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaOrdem()
On Error GoTo tratar_erro

Novo_Ordem = False
If Ordem <> "" Then
    With txtQuantidade
        .Locked = False
        .TabStop = True
    End With
    With txtdesenho
        .Locked = False
        .TabStop = True
    End With
    With Txt_ID_cliente
        .Locked = False
        .TabStop = True
    End With
    With txtCliente
        .Locked = False
        .TabStop = True
    End With
    Cmdlocalizarcli.Enabled = True
    
    Set TBOrdem = CreateObject("adodb.recordset")
    TBOrdem.Open "Select * from producao where Ordem = " & Ordem, Conexao, adOpenKeyset, adLockOptimistic
    If TBOrdem.EOF = False Then
        Caption = "PCP - Gerenciamento de ordem - (Ordem : " & TBOrdem!Ordem & ")"
        If IsNull(TBOrdem!ID_empresa) = False And TBOrdem!ID_empresa <> "" Then ProcPuxaDadosComboEmpresa Cmb_empresa, TBOrdem!ID_empresa
        txtof.Text = TBOrdem!Ordem
 
        
        txtData = IIf(IsNull(TBOrdem!Data_cadastro), "", Format(TBOrdem!Data_cadastro, "dd/mm/yy"))
        txtResponsavel = IIf(IsNull(TBOrdem!Responsavel), "", TBOrdem!Responsavel)
        mskprazofina.Value = Format(TBOrdem!PrazoEntrega, "dd/mm/yyyy")
        
        txtQuantidade.Text = IIf(IsNull(TBOrdem!Quant), 0, Format(TBOrdem!Quant, "###,##0.000"))
        QuantSolicitado = IIf(IsNull(TBOrdem!Quant), 0, TBOrdem!Quant)
        
        txtdesenho.Text = IIf(IsNull(TBOrdem!Desenho), "", TBOrdem!Desenho)
        ProcCarregaDadosItem
        Desenho = txtdesenho
        
        txtRevitem = IIf(IsNull(TBOrdem!Revitem), "", TBOrdem!Revitem)
        txtProduto.Text = IIf(IsNull(TBOrdem!Produto), "", TBOrdem!Produto)
        txtData_emissao = IIf(IsNull(TBOrdem!Data), Date, Format(TBOrdem!Data, "dd/mm/yy"))
        cmbStatus.Text = IIf(IsNull(TBOrdem!status), "", TBOrdem!status)
        Txt_obs = IIf(IsNull(TBOrdem!Obs), "", TBOrdem!Obs)
        
        If IsNull(TBOrdem!Impof) = False And TBOrdem!Impof > 0 Then Chk_impressa.Value = 1 Else Chk_impressa.Value = 0
        
        Txt_cod_prod = IIf(IsNull(TBOrdem!Codigo_produto), "", TBOrdem!Codigo_produto)
        Txt_rev_cod_prod = IIf(IsNull(TBOrdem!Rev_produto), "", TBOrdem!Rev_produto)
        txtCliente.Text = IIf(IsNull(TBOrdem!Cliente), "", TBOrdem!Cliente)
        txtDtValidacao = IIf(IsNull(TBOrdem!DtValidacao), "", TBOrdem!DtValidacao)
        txtRespValidacao = IIf(IsNull(TBOrdem!RespValidacao), "", TBOrdem!RespValidacao)
        
        If TBOrdem!Consignacao = True Then optconsignacao.Value = 1 Else optconsignacao.Value = 0
                    
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Id from Producao_NF_Consignada where Ordem = " & TBOrdem!Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            With txtQuantidade
                .Locked = True
                .TabStop = False
            End With
            With txtdesenho
                .Locked = True
                .TabStop = False
            End With
            If TBOrdem!Consignacao = True Then
                With Txt_ID_cliente
                    .Locked = True
                    .TabStop = False
                End With
                With txtCliente
                    .Locked = True
                    .TabStop = False
                End With
                Cmdlocalizarcli.Enabled = False
            End If
        End If
        TBAbrir.Close
       
        Txt_ID_cliente = IIf(IsNull(TBOrdem!IDCliente), "", TBOrdem!IDCliente)
        
        txtreferencia.Clear
        If TBOrdem!N_referencia <> "" Then
            txtreferencia.AddItem TBOrdem!N_referencia
            txtreferencia.Text = TBOrdem!N_referencia
        End If
        
        If TBOrdem!IMPREQ = True Then Chk_urgente.Value = 1 Else Chk_urgente.Value = 0
        If TBOrdem!pronta = "SIM" Then txtconcluida.Text = Format(TBOrdem!DataEntrega, "dd/mm/yy")
        Select Case TBOrdem!Tipo
            Case "E": Opt_produto_final = 1
            Case "M": Opt_subconjunto.Value = 1
            Case "F": Opt_componente = 1
            Case "S": Opt_servico = 1
        End Select
        If TBOrdem!OSControlada = True Then OptOSControlada.Value = 1 Else OptOSControlada.Value = 0
        If TBOrdem!Processo_controlado = True Then Opt_processo_controlado.Value = 1 Else Opt_processo_controlado.Value = 0
        If TBOrdem!reposicao = True Then OptReposicao.Value = 1 Else OptReposicao.Value = 0
        
        If TBOrdem!Individual = True Then
        OrdemRastreavel = True
        chkindividual.Value = 1
        chkOrdemRastreavel.Value = 1
        Else
        chkindividual.Value = 0
        chkOrdemRastreavel = 0
        OrdemRastreavel = False
        End If
        
        
        'If TBOrdem!Tipo_Processo = True Then Chk_tipo_processo.Value = 1 Else Chk_tipo_processo.Value = 0
        If TBOrdem!Entrar_estoque = True Then Chk_entrar_estoque.Value = 1 Else Chk_entrar_estoque.Value = 0
        If TBOrdem!Retirar_estoque = True Then Chk_retirar_estoque.Value = 1 Else Chk_retirar_estoque.Value = 0
        If TBOrdem!QT_Final = True Then chkQT_Final = 1 Else chkQT_Final.Value = 0
        
        If TBOrdem!AP_backup = True Then
            NomeTabelaAp = "ProducaoFases_Backup"
            NomeTabelaApTotalizacao = "ProducaoFases_Totalizacao_Backup"
        Else
            NomeTabelaAp = "ProducaoFases"
            NomeTabelaApTotalizacao = "ProducaoFases_Totalizacao"
        End If
        
        Set TBLISTA = CreateObject("adodb.recordset")
        TBLISTA.Open "Select Qtde_produzindo from Qtde_produzindo_produto where Ordem = " & Ordem, Conexao, adOpenKeyset, adLockReadOnly
        If TBLISTA.EOF = False Then
            Txt_qtde_total_produzindo = TBLISTA!Qtde_produzindo
        End If
        TBLISTA.Close
        ProcCarregaListaPedidos
        
        'Versao do processo
        Versao_processo = "A"
        Set TBFases = CreateObject("adodb.recordset")
        TBFases.Open "Select Fases.Versao from Fases INNER JOIN Ordemservico ON Fases.IDFase = Ordemservico.IDFase where Ordemservico.Ordem = " & Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBFases.EOF = False Then
            Versao_processo = IIf(IsNull(TBFases!versao), "A", TBFases!versao)
        End If
        TBFases.Close
        
        Set TBOrdem = CreateObject("adodb.recordset")
        TBOrdem.Open "Select IDProducao from " & NomeTabelaAp & " where Ordem = " & txtof, Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdem.EOF = False Then
            'Frame17.Enabled = False
        End If
        TBOrdem.Close
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Lista_pedidos_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

If ColumnHeader = "" Then
    With Lista_pedidos
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                .ListItems.Item(InitFor).Checked = False
            Else
                If Cmb_opcao_lista3 = "Excluir" Then
                    'Verifica se o resultado da ordem foi validado
                    Set TBOSC = CreateObject("adodb.recordset")
                    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                    If TBOSC.EOF = False Then
                        TBOSC.Close
                        GoTo Proximo
                    End If
                    TBOSC.Close
                End If
                .ListItems.Item(InitFor).Checked = True
Proximo:
            End If
        Next InitFor
    End With
Else
    ProcOrdenaListView Lista_pedidos, ColumnHeader
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Lista_pedidos_DblClick()
On Error GoTo tratar_erro

Qtde = 0
qtde_solicitada = ""
With Lista_pedidos
    If .ListItems.Count = 0 Then Exit Sub
    If .SelectedItem.ListSubItems(17) = "FATURADO" Or .SelectedItem.ListSubItems(17) = "FATURADO PARCIAL" Then
        If USMsgBox("Deseja alterar a quantidade empenhada?", vbYesNo, "CAPRIND v5.0") = vbYes Then
            If Alterar = False Then
                USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
                Exit Sub
            End If
Mensagem:
            qtde_solicitada = txtQuantidade
            qtde_solicitada = InputBox("Favor informar a quantidade empenhada.", , qtde_solicitada)
            If qtde_solicitada = "" Then Exit Sub
            
            If IsNumeric(qtde_solicitada) = False Then
                USMsgBox ("Só é permitido número neste campo."), vbExclamation, "CAPRIND v5.0"
                GoTo Mensagem
            End If
            Qtde = qtde_solicitada
            If Qtde <= 0 Then
                USMsgBox ("So é permitido quantidade maior que 0."), vbExclamation, "CAPRIND v5.0"
                GoTo Mensagem
            End If
            
            'Verifica se a quantidade empenhada é maior que a quantidade da ordem
            valor = Txt_qtde_total_produzindo
            Valor1 = txtQuantidade
            Qtd = IIf(valor > Valor1, Txt_qtde_total_produzindo, txtQuantidade)
            If Qtd < Qtde Then
                USMsgBox ("A quantidade empenhada não pode ser maior que a quantidade da ordem/produzindo, favor alterar."), vbExclamation, "CAPRIND v5.0"
                GoTo Mensagem
            End If
            
            'Verifica se a quantidade empenhada é maior que a quantidade vendida
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select Quantidade from vendas_carteira where Codigo = " & .SelectedItem.ListSubItems(1), Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                valor = 0
                Set TBFI = CreateObject("adodb.recordset")
                TBFI.Open "Select Sum(PP.Qtde_empenho - PP.Qtde_entrada) as Valor from Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem where P.Desenho = '" & frmprod.txtdesenho & "' and PP.IDcarteira = " & .SelectedItem.ListSubItems(1) & " and PP.ID <> " & .SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
                If TBFI.EOF = False Then
                    valor = IIf(IsNull(TBFI!valor), 0, TBFI!valor)
                End If
                
                Valor1 = 0
                Set TBFI = CreateObject("adodb.recordset")
                TBFI.Open "Select Sum(ECEV.Qtde_empenhada) as Valor1 from Estoque_Controle_Empenho_Vendas ECEV INNER JOIN Estoque_controle EC ON EC.IDestoque = ECEV.ID_estoque where ECEV.ID_carteira = " & .SelectedItem.ListSubItems(1) & " and EC.Lote <> '" & txtof & "' and EC.Desenho = '" & frmprod.txtdesenho & "' and (EC.status = 'ENTRADA_ORDEM' or EC.status = 'ENTRADA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
                If TBFI.EOF = False Then
                    Valor1 = IIf(IsNull(TBFI!Valor1), 0, TBFI!Valor1)
                End If
                TBFI.Close
                
                If TBAbrir!quantidade < (valor + Valor1 + Qtde) Then
                    USMsgBox ("A quantidade empenhada não pode ser maior que a quantidade vendida, favor alterar." & vbCrLf & "Qtde. vendida: " & TBAbrir!quantidade & vbCrLf & "Qtde. empenhada outra(s) ordem(ns): " & valor & vbCrLf & "Qtde. empenhada RE('s): " & Valor1 & vbCrLf & "Qtde. à empenhar: " & Qtde), vbExclamation, "CAPRIND v5.0"
                    GoTo Mensagem
                End If
            End If
            TBAbrir.Close
                        
            NovoValor = Replace(Qtde, ",", ".")
            Conexao.Execute "Update Producao_pedidos Set Qtde_empenho = " & NovoValor & " where ID = " & .SelectedItem
            
            ProcAtualizaQtdeEntEmpProd txtof, txtdesenho
            
            USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar quantidade empenhada"
            ID_documento = .SelectedItem
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "Pedido int.: " & .SelectedItem.ListSubItems(2) & " - Rev.: " & .SelectedItem.ListSubItems(3) & " - Cód. interno: " & Lista.SelectedItem.ListSubItems(5) & " - Rev.: " & .SelectedItem.ListSubItems(6) & " - Qtde. empenhada: " & .SelectedItem.ListSubItems(10) & " - Qtde. entrada: " & .SelectedItem.ListSubItems(11)
            ProcGravaEvento
            '==================================
            ProcCarregaListaPedidos
        Else
            ProcVerifQtdeFaturadaProdServ .SelectedItem.ListSubItems(1), .SelectedItem.ListSubItems(5), False
        End If
    Else
        ProcVerifQtdeFaturadaProdServ .SelectedItem.ListSubItems(1), .SelectedItem.ListSubItems(5), False
    End If
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Lista_pedidos_ItemCheck(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

With Lista_pedidos
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True And .ListItems.Item(InitFor) = Item Then
            If Cmb_opcao_lista3 = "Excluir" Then
                'Verifica se o resultado da ordem foi validado
                Set TBOSC = CreateObject("adodb.recordset")
                TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                If TBOSC.EOF = False Then
                    USMsgBox ("Não é permitido excluir o empenho, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
                    TBOSC.Close
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                TBOSC.Close
            End If
        End If
    Next InitFor
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub listaitens_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

Permitido1 = False
FamiliaAntiga = ""
Familiatext = ""
SQL = ""
If ColumnHeader = "" Then
    With listaitens
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                .ListItems.Item(InitFor).Checked = False
            Else
                If Cmb_opcao_lista = "Gerar MRP" Then
                    Permitido1 = True
                    If DesenhoMRP = "" Then DesenhoMRP = .ListItems.Item(InitFor).SubItems(3)
                    If RevDesenhoMRP = "" Then RevDesenhoMRP = .ListItems.Item(InitFor).SubItems(4)
                    If DesenhoMRP <> .ListItems.Item(InitFor).SubItems(3) Or DesenhoMRP = .ListItems.Item(InitFor).SubItems(3) And RevDesenhoMRP <> .ListItems.Item(InitFor).SubItems(4) Then GoTo Proximo
                    Set TBproducao = CreateObject("adodb.recordset")
                    TBproducao.Open "Select Bloq_OP_estrutura, Bloq_OP_processo, Bloq_OP_plano from Empresa where Codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
                    If TBproducao.EOF = False Then
                        Set TBProduto = CreateObject("adodb.recordset")
                        TBProduto.Open "Select Codproduto, Desenho, DtValidacaoConj, DtValidacaoPlano, Qualidade from Projproduto where Desenho = '" & .ListItems.Item(InitFor).SubItems(3) & "'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBProduto.EOF = False Then
                            If TBproducao!Bloq_OP_estrutura = True And IsNull(TBProduto!DtValidacaoConj) = True Then GoTo Proximo
                            If TBproducao!Bloq_OP_processo = True Then
                                Set TBControleNF = CreateObject("adodb.recordset")
                                TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBProduto!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
                                If TBControleNF.EOF = False Then
                                    GoTo Proximo
                                Else
                                    GoTo Proximo
                                End If
                                TBControleNF.Close
                            End If
                            If TBproducao!Bloq_OP_plano = True And TBProduto!Qualidade = True And IsNull(TBProduto!DtValidacaoPlano) = True Then GoTo Proximo
                            
                            ProcVerifBloqGerarMRP TBProduto!Codproduto, IIf(IsNull(TBproducao!Bloq_OP_estrutura), False, TBproducao!Bloq_OP_estrutura), IIf(IsNull(TBproducao!Bloq_OP_processo), False, TBproducao!Bloq_OP_processo), IIf(IsNull(TBproducao!Bloq_OP_plano), False, TBproducao!Bloq_OP_plano)
                            If FamiliaAntiga <> "" Or Familiatext <> "" Or SQL <> "" Then
                                DesenhoMRP = ""
                                RevDesenhoMRP = ""
                                GoTo Proximo
                            End If
                        End If
                        TBProduto.Close
                    End If
                    TBproducao.Close
                    
                    valor = .ListItems.Item(InitFor).SubItems(12)
                    If valor = 0 Then GoTo Proximo
                ElseIf Cmb_opcao_lista = "Cancelar MRP" Then
                        'Verifica se pode excluir a ordem
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select P.Ordem, P.Desenho FROM Producao P INNER JOIN Producao_pedidos PP ON P.Ordem = PP.Ordem where PP.IDCarteira = " & .ListItems(InitFor) & " order by P.Ordem", Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            Do While TBproducao.EOF = False
                                If ProcVerifExclusaoValidDaOrdem(TBproducao!Ordem, TBproducao!Desenho, False, "") = False Then GoTo Proximo
                                TBproducao.MoveNext
                            Loop
                        End If
                        TBproducao.Close
                End If
                .ListItems.Item(InitFor).Checked = True
Proximo:
            End If
        Next InitFor
    End With
Else
    ProcOrdenaListView listaitens, ColumnHeader
End If
If Permitido1 = False Then
    DesenhoMRP = ""
    RevDesenhoMRP = ""
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Listaitens_DblClick()
On Error GoTo tratar_erro

With listaitens
    If .ListItems.Count = 0 Then Exit Sub
    ProcVerifQtdeFaturadaProdServ .SelectedItem, .SelectedItem.ListSubItems(3), True
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub listaitens_ItemCheck(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

Permitido1 = False
FamiliaAntiga = ""
Familiatext = ""
SQL = ""
With listaitens
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Cmb_opcao_lista = "Gerar MRP" Then
                Permitido1 = True
                If DesenhoMRP = "" Then DesenhoMRP = .ListItems.Item(InitFor).SubItems(3)
                If RevDesenhoMRP = "" Then RevDesenhoMRP = .ListItems.Item(InitFor).SubItems(4)
                If DesenhoMRP <> .ListItems.Item(InitFor).SubItems(3) Or DesenhoMRP = .ListItems.Item(InitFor).SubItems(3) And RevDesenhoMRP <> .ListItems.Item(InitFor).SubItems(4) Then
                    USMsgBox ("Só é permitido selecionar produtos/serviços com o código interno " & DesenhoMRP & " e revisão " & RevDesenhoMRP & "."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                Set TBproducao = CreateObject("adodb.recordset")
                TBproducao.Open "Select Bloq_OP_estrutura, Bloq_OP_processo, Bloq_OP_plano from Empresa where Codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
                If TBproducao.EOF = False Then
                    Set TBProduto = CreateObject("adodb.recordset")
                    TBProduto.Open "Select Codproduto, Desenho, DtValidacaoConj, DtValidacaoPlano, Qualidade from Projproduto where Desenho = '" & .ListItems.Item(InitFor).SubItems(3) & "'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBProduto.EOF = False Then
                        If TBproducao!Bloq_OP_estrutura = True And IsNull(TBProduto!DtValidacaoConj) = True Then FamiliaAntiga = "Cód. interno: " & TBProduto!Desenho
                        If TBproducao!Bloq_OP_processo = True Then
                            Set TBControleNF = CreateObject("adodb.recordset")
                            StrSql = "Select DtValidacao from Processos where Codproduto = " & TBProduto!Codproduto
                            'Debug.print StrSql
                            
                            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBProduto!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
                            If TBControleNF.EOF = False Then
                                If IsNull(TBControleNF!DtValidacao) = True Then Familiatext = "Cód. interno: " & TBProduto!Desenho
                            Else
                                Familiatext = "Cód. interno: " & TBProduto!Desenho
                            End If
                            TBControleNF.Close
                        End If
                        If TBproducao!Bloq_OP_plano = True And TBProduto!Qualidade = True And IsNull(TBProduto!DtValidacaoPlano) = True Then
                            SQL = "Cód. interno: " & TBProduto!Desenho
                        End If
                        
                        ProcVerifBloqGerarMRP TBProduto!Codproduto, IIf(IsNull(TBproducao!Bloq_OP_estrutura), False, TBproducao!Bloq_OP_estrutura), IIf(IsNull(TBproducao!Bloq_OP_processo), False, TBproducao!Bloq_OP_processo), IIf(IsNull(TBproducao!Bloq_OP_plano), False, TBproducao!Bloq_OP_plano)
                        If FamiliaAntiga <> "" Or Familiatext <> "" Or SQL <> "" Then
                        'Debug.print FamiliaAntiga
                        'Debug.print Familiatext
                        'Debug.print SQL
                        
                            USMsgBox ("Não é permitido selecionar este produto/serviço, pois existe(m) restrições no mesmo." & vbCrLf & "Produtos/serviços sem validação da esturuta:" & vbCrLf & FamiliaAntiga & vbCrLf & vbCrLf & "Produtos/serviços sem validação do processo:" & vbCrLf & Familiatext & vbCrLf & vbCrLf & "Produtos/serviços sem validação do plano:" & vbCrLf & SQL), vbExclamation, "CAPRIND v5.0"
                            .ListItems.Item(InitFor).Checked = False
                            DesenhoMRP = ""
                            RevDesenhoMRP = ""
                            Exit Sub
                        End If
                    End If
                    TBProduto.Close
                End If
                TBproducao.Close
                
                valor = .ListItems.Item(InitFor).SubItems(12)
                If valor = 0 Then
                    If USMsgBox("Deseja realmente gerar MRP desse produto, pois a necessidade do mesmo é igual a zero.", vbYesNo, "CAPRIND V5.0") = vbNo Then
                    .ListItems.Item(InitFor).Checked = False
                    End If
                End If
                
            ElseIf Cmb_opcao_lista = "Cancelar MRP" Then
                    Set TBproducao = CreateObject("adodb.recordset")
                    TBproducao.Open "Select P.Ordem, P.Desenho FROM Producao P INNER JOIN Producao_pedidos PP ON P.Ordem = PP.Ordem where PP.IDCarteira = " & .ListItems(InitFor) & " order by P.Ordem", Conexao, adOpenKeyset, adLockOptimistic
                    If TBproducao.EOF = False Then
                        Do While TBproducao.EOF = False
                            If ProcVerifExclusaoValidDaOrdem(TBproducao!Ordem, TBproducao!Desenho, True, "excluir esta") = False Then
                                .ListItems.Item(InitFor).Checked = False
                                Exit Sub
                            End If
                            TBproducao.MoveNext
                        Loop
                    End If
                    TBproducao.Close
            End If
        End If
    Next InitFor
End With
If Permitido1 = False Then
    DesenhoMRP = ""
    RevDesenhoMRP = ""
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub listaitens_ItemClick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

If listaitens.ListItems.Count = 0 Then Exit Sub

'With FrmProd_Inf
TxtEstCodigo = listaitens.SelectedItem.ListSubItems(3)
'.Show
ProcCarregaDadosProdEstImaProc False

ProcFiltrarPadrao "PP.IDCarteira = " & listaitens.SelectedItem
atualiza_lista_ordens (1)
'End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaMovimentacao_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

ProcOrdenaListView ListaMovimentacao, ColumnHeader

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaOS_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

If ColumnHeader = "OS" Then
    With ListaOS
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                .ListItems.Item(InitFor).Checked = False
            Else
                If Cmb_opcao_lista1 = "Excluir" Then
                    If txtDtValidacao <> "" Then GoTo Proximo
                
                    'Verifica OS no apontamento
                    Set TBOrdem = CreateObject("adodb.recordset")
                    TBOrdem.Open "Select * from " & NomeTabelaAp & " where OS = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
                    If TBOrdem.EOF = False Then GoTo Proximo

                    'Verifica ordem no pedido de compra
                    Set TBOrdem = CreateObject("adodb.recordset")
                    TBOrdem.Open "Select * from Compras_pedido_lista where OS = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
                    If TBOrdem.EOF = False Then GoTo Proximo
                    TBOrdem.Close
                End If
                If Cmb_opcao_lista1 = "Prazo final" And .ListItems(InitFor).ListSubItems(5) = "SIM" Then
                    If .ListItems(InitFor).ListSubItems(5) = "SIM" Then GoTo Proximo
                    If txtDtValidacao <> "" Then GoTo Proximo
                End If
                If Cmb_opcao_lista1 = "Status" Then
                    If txtDtValidacao = "" Then GoTo Proximo
                    
                    'Verifica se o resultado da ordem foi validado
                    Set TBOSC = CreateObject("adodb.recordset")
                    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                    If TBOSC.EOF = False Then
                        TBOSC.Close
                        GoTo Proximo
                    End If
                    TBOSC.Close
                End If
                .ListItems.Item(InitFor).Checked = True
Proximo:
            End If
        Next InitFor
    End With
Else
    ProcOrdenaListView ListaOS, ColumnHeader
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaOS_DblClick()
On Error GoTo tratar_erro

If ListaOS.ListItems.Count = 0 Then Exit Sub
PCP_Ordem = True
With frmSituacao_Producao
    .ProcAbrir
    .Show
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaOS_ItemCheck(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Cmb_opcao_lista1 = "Excluir" Then
                If txtDtValidacao <> "" Then
                    USMsgBox ("Não é permitido excluir esta OS, pois a ordem já foi validada."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                
                'Verifica OS no apontamento
                Set TBOrdem = CreateObject("adodb.recordset")
                TBOrdem.Open "Select * from " & NomeTabelaAp & " where OS = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
                If TBOrdem.EOF = False Then
                    USMsgBox ("Não é permitido excluir esta OS, pois a mesma está sendo utilizada no módulo de apontamento."), vbExclamation, "CAPRIND v5.0"
                    TBOrdem.Close
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                'Verifica ordem no pedido de compra
                Set TBOrdem = CreateObject("adodb.recordset")
                TBOrdem.Open "Select * from Compras_pedido_lista where OS = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
                If TBOrdem.EOF = False Then
                    If TBOrdem!Status_Item = "REQUISIT." Then
                        Texto = "Outros/Solicitação"
                    ElseIf TBOrdem!Status_Item = "COTANDO" Then
                            Texto = "Compras/Cotação"
                        Else
                            Texto = "Compras/Pedido"
                    End If
                    USMsgBox ("Não é permitido excluir esta OS, pois a mesma está sendo utilizada no módulo " & Texto & "."), vbExclamation, "CAPRIND v5.0"
                    TBOrdem.Close
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                TBOrdem.Close
            End If
            If Cmb_opcao_lista1 = "Prazo final" Then
                If txtDtValidacao <> "" Then
                    USMsgBox ("Não é permitido alterar prazo final desta OS, pois a ordem já foi validada."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If

                If .ListItems(InitFor).ListSubItems(5) = "SIM" Then
                    USMsgBox ("Não é permitido alterar prazo final desta OS, pois a mesma está concluída."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
            End If
            If Cmb_opcao_lista1 = "Status" Then
                If txtDtValidacao = "" Then
                    USMsgBox ("Não é permitido alterar status desta OS, pois a ordem ainda não já foi validada."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                
                'Verifica se o resultado da ordem foi validado
                Set TBOSC = CreateObject("adodb.recordset")
                TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                If TBOSC.EOF = False Then
                    USMsgBox ("Não é permitido alterar status desta OS, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
                    TBOSC.Close
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                TBOSC.Close
            End If
        End If
    Next InitFor
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaOS_ItemClick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

If ListaOS.ListItems.Count = 0 Then Exit Sub

TempoPreparacao = "000:00:00"
TempoExecucao = "000:00:00"
ProcLimparCamposOS
ProcCarregaDadosOS ListaOS.SelectedItem
ProcVerifOSApontamento
Framedetalhes.Enabled = True
Frame24.Enabled = True
If Novo_Ordem1 = True And txtOS <> ListaOS.SelectedItem Then Novo_Ordem1 = False

ProcCarregaListaMaqUtilOS

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCarregaListaMaqUtilOS()
On Error GoTo tratar_erro

ListaOS_maq.ListItems.Clear
maquina = ""
Set TBLISTA = CreateObject("adodb.recordset")
TBLISTA.Open "Select CadMaquinas.* from CadMaquinas inner join Ordemservico_maq_utilizadas on CadMaquinas.Maquina = Ordemservico_maq_utilizadas.Maquina where Ordemservico_maq_utilizadas.OS = " & ListaOS.SelectedItem & " order by Ordemservico_maq_utilizadas.maquina", Conexao, adOpenKeyset, adLockOptimistic
If TBLISTA.EOF = False Then
    Do While TBLISTA.EOF = False
        If maquina <> TBLISTA!maquina Then
            With ListaOS_maq.ListItems
                .Add , , TBLISTA!maquina & " - " & TBLISTA!Descricao
            End With
        End If
        maquina = TBLISTA!maquina
        TBLISTA.MoveNext
    Loop
End If
TBLISTA.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCarregaDadosOS(OS As Long)
On Error GoTo tratar_erro

Set TBFases = CreateObject("adodb.recordset")
TBFases.Open "Select * from ordemservico where IDProducao = " & OS, Conexao, adOpenKeyset, adLockOptimistic
If TBFases.EOF = False Then

'=========================================================================
' Verifica OS Rastreavel
'=========================================================================
If TBFases!rastreavel = True Then
    chkOSRastreavel.Value = 1
    OSRastreavel = True
Else
    chkOSRastreavel.Value = False
    OSRastreavel = False
End If


    txtOS.Text = TBFases!IDProducao
    txtOSFase.Text = TBFases!Fase
    TxtOS_grupo_op = IIf(IsNull(TBFases!Grupo_op), "", TBFases!Grupo_op)
    
    Txt_grupo_op = IIf(IsNull(TBFases!Grupo_op), "", TBFases!Grupo_op)
    'Rotina de tranformacao de preparacao
    If IsNull(TBFases!Preparacao) = False And TBFases!Preparacao <> "__:__:__" Then
        ElapsedTime (TBFases!Preparacao)
        TempoPreparacao = HoraTotal
        If Len(TempoPreparacao) = 8 Then TempoPreparacao = "0" & TempoPreparacao
    End If
    'Rotina de tranformacao de execucao
    If IsNull(TBFases!Execucao) = False And TBFases!Execucao <> "__:__:__" Then
        ElapsedTime (TBFases!Execucao)
        TempoExecucao = HoraTotal
        If Len(TempoExecucao) = 8 Then TempoExecucao = "0" & TempoExecucao
    End If
    txtpreparacao.Text = TempoPreparacao
    txtexecucao.Text = TempoExecucao
    txtOSLote.Text = IIf(IsNull(TBFases!quantidade), "", TBFases!quantidade)
    
    Set TBFIltro = CreateObject("adodb.recordset")
    TBFIltro.Open "Select maquina from Cadmaquinas where Maquina = '" & TBFases!maquina & "' and Bloqueado = 'True'", Conexao, adOpenKeyset, adLockOptimistic
    If TBFIltro.EOF = False Then
        cmbOSMaquina.AddItem TBFIltro!maquina
    End If
    
    If IsNull(TBFases!maquina) = False Then
    cmbOSMaquina.Text = TBFases!maquina
    If SSTab1.Tab = 4 Then
      txtAPMaquina.Text = TBFases!maquina
    End If
  
    End If
    
    TxtTempoTotal.Text = IIf(IsNull(TBFases!TempoTotalLote), "00:00:00", TBFases!TempoTotalLote)
    txtStatus_OS = IIf(IsNull(TBFases!status), "", TBFases!status)
2:
Debug.Print TBFases!descfase
        txtdescricao.TextRTF = IIf(IsNull(TBFases!descfase), "", TBFases!descfase)
        Cmb_prazo_os = IIf(IsNull(TBFases!PrazoFinal), Date, TBFases!PrazoFinal)
        If TBFases!OSControlada = True Then chkControlada.Value = 1 Else chkControlada.Value = 0
        If TBFases!Processo_controlado = True Then ChkProcesso_controlado.Value = 1 Else ChkProcesso_controlado.Value = 0
        If TBFases!Retrabalho = True Then chkRetrabalho.Value = 1 Else chkRetrabalho.Value = 0
        If TBFases!rastreavel = True Then chkRastreavel.Value = 1 Else chkRastreavel.Value = 0
        
        If TBFases!custos = True Then Chk_agrega_custos_efic.Value = 1 Else Chk_agrega_custos_efic.Value = 0
        If TBFases!QT_Final = True Then chk_QTFinalOS.Value = 1 Else chk_QTFinalOS.Value = 0
        
        
        Set TBFIltro = CreateObject("adodb.recordset")
        TBFIltro.Open "Select Descricao, Custos from Cadmaquinas where Maquina = '" & TBFases!maquina & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBFIltro.EOF = False Then
            Txt_descricao_posto = IIf(IsNull(TBFIltro!Descricao), "", TBFIltro!Descricao)
            If TBFIltro!custos = False And TBFases!custos = False Then Chk_agrega_custos_efic.Enabled = False Else Chk_agrega_custos_efic.Enabled = True
        End If
        TBFIltro.Close
        
        If TBFases!pecahora = True Then
          chkPchora.Value = 1
        Else
          chkPchora.Value = 0
          txtPcHora.Text = IIf(IsNull(TBFases!pc_te), 1, TBFases!pc_te)
        End If
        
        If TBFases!pecahora = False Then
          txtPcHorareal = IIf(IsNull(TBFases!Totalprod), 0, TBFases!Totalprod)
        Else
          txtPcHorareal = "1,000"
        End If
        
        TxtA3 = FunCalculaSegPC(IIf(IsNull(TBFases!Execucao), 0, TBFases!Execucao), txtPcHora)
        TxtA3 = FormataTempo(TxtA3.Text)
        txtObs.Text = IIf(IsNull(TBFases!Obs) = False, TBFases!Obs, "")
        
        If IsNull(TBFases!IDFase) = False And TBFases!IDFase <> "" Then
            Set TBCFOP = CreateObject("adodb.recordset")
            TBCFOP.Open "Select Versao from fases where IDFase = " & TBFases!IDFase, Conexao, adOpenKeyset, adLockOptimistic
            If TBCFOP.EOF = False Then txtVersao = IIf(IsNull(TBCFOP!versao), "", TBCFOP!versao)
            TBCFOP.Close
        End If
End If
TBFases.Close

Exit Sub
tratar_erro:
    If Err.Number = "383" Then
        USMsgBox ("Não foi encontrado o posto de trabalho desta OS."), vbExclamation, "CAPRIND v5.0"
        GoTo 2
    End If
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifOSApontamento()
On Error GoTo tratar_erro

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from ordemservico where IDProducao = " & txtOS & " and Status <> 'Aguardando'", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    With txtOSFase
        .Locked = True
        .TabStop = False
    End With
    With TxtOS_grupo_op
        .Locked = True
        .TabStop = False
    End With
    With txtOSLote
        .Locked = True
        .TabStop = False
    End With
    With cmbOSMaquina
        .Locked = True
        .TabStop = False
    End With
    With txtPcHora
        '.Locked = True
        '.TabStop = False
    End With
'    Frame13.Enabled = False
'    Frame31.Enabled = False
Else
    With txtOSFase
        .Locked = False
        .TabStop = True
    End With
    With TxtOS_grupo_op
        .Locked = False
        .TabStop = True
    End With
    With txtOSLote
        .Locked = False
        .TabStop = True
    End With
    With cmbOSMaquina
        .Locked = False
        .TabStop = True
    End With
    With txtPcHora
        '.Locked = False
        '.TabStop = True
    End With
'    Frame13.Enabled = True
'    Frame31.Enabled = True
End If
TBOrdem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRE_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

ProcOrdenaListView ListaRE, ColumnHeader

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRE_DblClick()
On Error GoTo tratar_erro

If ListaRE.ListItems.Count = 0 Then Exit Sub
If USMsgBox("Deseja visualizar os dados ou os apontamentos da OS? " & vbCrLf & "Dados da OS clique em (Sim/Yes) " & vbCrLf & "Apontamentos da OS clique em (Não/No)", vbYesNo, "CAPRIND v5.0") = vbYes Then
    SSTab1.Tab = 2
    TempoPreparacao = "000:00:00"
    TempoExecucao = "000:00:00"
    ProcLimparCamposOS
    ProcCarregaDadosOS ListaRE.SelectedItem
    
    ProcVerifOSApontamento
    Framedetalhes.Enabled = True
    Frame24.Enabled = True
    If Novo_Ordem1 = True And txtOS <> ListaRE.SelectedItem Then Novo_Ordem1 = False
    
    ProcCarregaListaMaqUtilOS
Else
    SSTab1.Tab = 4
    maquina = ListaRE.SelectedItem.ListSubItems(3)
    cmbAPOS = ListaRE.SelectedItem
    txtAPMaquina = maquina
    cmdAPOS_Click
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRE_ItemClick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

If ListaRE.ListItems.Count = 0 Then Exit Sub
Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from ordemservico where idproducao = " & ListaRE.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    IDFase = IIf(IsNull(TBOrdem!IDFase), 0, TBOrdem!IDFase)
End If
TBOrdem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRequisicao_ColumnClick(ByVal ColumnHeader As MSComctlLib.ColumnHeader)
On Error GoTo tratar_erro

If ColumnHeader = "" Then
    With ListaRequisicao
        For InitFor = 1 To .ListItems.Count
            If .ListItems.Item(InitFor).Checked = True Then
                .ListItems.Item(InitFor).Checked = False
            Else
                If Cmb_opcao_lista2 = "Excluir" Then
                    If txtDtValidacao <> "" Then GoTo Proximo
                    If .ListItems.Item(InitFor).SubItems(7) <> "Não" Then GoTo Proximo
                Else
                    If txtDtValidacao = "" Then GoTo Proximo
                    
                    'Verifica se o resultado da ordem foi validado
                    Set TBOSC = CreateObject("adodb.recordset")
                    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                    If TBOSC.EOF = False Then
                        TBOSC.Close
                        GoTo Proximo
                    End If
                    TBOSC.Close
                    
                    If .ListItems.Item(InitFor).SubItems(7) = "Sim" Then GoTo Proximo
                End If
                .ListItems.Item(InitFor).Checked = True
Proximo:
            End If
        Next InitFor
    End With
Else
    ProcOrdenaListView ListaRequisicao, ColumnHeader
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRequisicao_DblClick()
On Error GoTo tratar_erro

'If ListaMovimentacao.ListItems.Count > 0 Then
'USMsgBox "Atenção!" & vbNewLine & "Existe(m) movimentação(ões) no estoque para esse item." & vbNewLine & "Para alterar a quantidade do item na requisição é necessario excluir toda(s) a(s) movimentação(ões).", vbCritical, "CAPRIND v5.0"
'Exit Sub
'End If


If ListaLote.ListItems.Count > 0 Then
USMsgBox "Atenção!" & vbNewLine & "Existe empenho(s) para esse item." & vbNewLine & "Para alterar a quantidade do item na requisição é necessario excluir todo(s) empenho(s).", vbCritical, "CAPRIND v5.0"
Exit Sub
End If


frmProdAlterarRM.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRequisicao_ItemCheck(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

With ListaRequisicao
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True And .ListItems.Item(InitFor) = Item Then
            If Cmb_opcao_lista2 = "Excluir" Then
                If txtDtValidacao <> "" Then
                    USMsgBox ("Não é permitido excluir requisição, pois a ordem já foi validada."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                If .ListItems.Item(InitFor).SubItems(7) <> "REQUISITADO" Then
                    USMsgBox ("Não é permitido excluir esta requisição, pois a mesma já foi movimentada no estoque."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                End If
            Else
                If txtDtValidacao = "" Then
                    USMsgBox ("Não é permitido Baixar esta requisição, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                
                'Verifica se o resultado da ordem foi validado
                Set TBOSC = CreateObject("adodb.recordset")
                TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
                If TBOSC.EOF = False Then
                    USMsgBox ("Não é permitido QTBaixar esta requisição, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
                    TBOSC.Close
                    .ListItems.Item(InitFor).Checked = False
                    Exit Sub
                End If
                TBOSC.Close

                If .ListItems.Item(InitFor).SubItems(6) = "0,00000000" Then
                    USMsgBox ("Não é permitido Baixar esta requisição, pois a mesma já foi baixada total."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                End If
                
                If .ListItems.Item(InitFor).SubItems(8) = "Alternativo" Then
                    USMsgBox ("Não é permitido Baixar esta requisição, pois a mesma é item alternativo."), vbExclamation, "CAPRIND v5.0"
                    .ListItems.Item(InitFor).Checked = False
                End If
                
            End If
        End If
    Next InitFor
End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ListaRequisicao_ItemClick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

ProcCarregaListaEmpenhos
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaListaEmpenhos()
On Error GoTo tratar_erro

ListaMovimentacao.ListItems.Clear
'PBLista4.Value = 0
ListaLote.ListItems.Clear
'PBLista5.Value = 0
valor = ListaRequisicao.SelectedItem.ListSubItems(4)
Set TBLISTA = CreateObject("adodb.recordset")
TBLISTA.Open "Select PNC.ID, PNC.Quantidade, PNC.Quantidade_PC, EC.* from Producao_NF_Consignada PNC INNER JOIN Estoque_controle EC ON PNC.IDestoque = EC.IDestoque where PNC.Ordem = " & txtof & " and PNC.codinterno = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBLISTA.EOF = False Then
    'PBLista4.Min = 0
    'PBLista4.Max = TBLISTA.RecordCount
    'PBLista4.Value = 1
    Contador = 0
    Do While TBLISTA.EOF = False
        With ListaLote.ListItems
            .Add , , TBLISTA!ID
            .Item(.Count).SubItems(1) = TBLISTA!IDEstoque
            If IsNull(TBLISTA!NF) = False And TBLISTA!NF <> "" Then LoteTexto = TBLISTA!NF Else LoteTexto = IIf(IsNull(TBLISTA!LOTE), "", TBLISTA!LOTE)
            .Item(.Count).SubItems(2) = LoteTexto
            .Item(.Count).SubItems(3) = IIf(IsNull(TBLISTA!local_armaz), "", TBLISTA!local_armaz)
            .Item(.Count).SubItems(4) = IIf(IsNull(TBLISTA!Corrida), "", TBLISTA!Corrida)
            .Item(.Count).SubItems(5) = IIf(IsNull(TBLISTA!Certificado), "", TBLISTA!Certificado)
            .Item(.Count).SubItems(6) = IIf(IsNull(TBLISTA!quantidade), "", Format(TBLISTA!quantidade, "###,##0.0000"))
            .Item(.Count).SubItems(7) = IIf(IsNull(TBLISTA!Quantidade_PC), "", Format(TBLISTA!Quantidade_PC, "###,##0.0000"))
        End With
        valor = valor - TBLISTA!quantidade
        TBLISTA.MoveNext
        Contador = Contador + 1
        'PBLista4.Value = contador
    Loop
End If

If valor > 0 Then
    Set TBLISTA = CreateObject("adodb.recordset")
    TBLISTA.Open "Select PP.IDcarteira, PP.Ordem, PP.Qtde_empenho - ISNULL(PNC.Quantidade, 0) as Qtde_empenho from (Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem and P.Desenho = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "') LEFT JOIN Producao_NF_Consignada PNC ON PNC.Ordem = P.Ordem where PP.OrdemEmpenho = " & txtof & " and PP.Qtde_empenho - ISNULL(PNC.Quantidade, 0) > 0 order by PP.Ordem", Conexao, adOpenKeyset, adLockOptimistic
    If TBLISTA.EOF = False Then
        'PBLista4.Min = 0
        'PBLista4.Max = TBLISTA.RecordCount
        'PBLista4.Value = 1
        'Contador = 0
        Do While TBLISTA.EOF = False And valor > 0
            With ListaLote.ListItems
                .Add , , TBLISTA!IDcarteira
                .Item(.Count).SubItems(1) = ""
                .Item(.Count).SubItems(2) = IIf(IsNull(TBLISTA!Ordem), "", TBLISTA!Ordem)
                .Item(.Count).SubItems(3) = ""
                .Item(.Count).SubItems(4) = ""
                .Item(.Count).SubItems(5) = ""
                
                If valor > TBLISTA!Qtde_empenho Then Valor1 = TBLISTA!Qtde_empenho Else Valor1 = valor
                .Item(.Count).SubItems(6) = Format(Valor1, "###,##0.0000")
                valor = valor - Valor1
                
                .Item(.Count).SubItems(7) = Format(IIf(IsNull(TBLISTA!Qtde_empenho), "", TBLISTA!Qtde_empenho), "###,##0.0000")
            End With
            TBLISTA.MoveNext
            'Contador = Contador + 1
            'PBLista4.Value = Contador
        Loop
    End If
End If
TBLISTA.Close

If ListaRequisicao.SelectedItem.ListSubItems(7) <> "REQUISITADO" Then
    Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select EM.IDoperacao, EM.Data, EM.Saida, EM.Saida_PC, EC.Idestoque, EC.Lote, EC.Corrida, EC.Certificado from estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IDestoque = EC.IDestoque where EM.oe = '" & txtof.Text & "' and EM.desenho = '" & ListaRequisicao.SelectedItem.ListSubItems(1) & "' and EM.documento = '" & txtof & "' and (EM.operacao = 'SAIDA_ORDEM' or EM.operacao = 'SAIDA_ORDEM_PARCIAL') order by EM.idoperacao", Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
        'PBLista5.Min = 0
        'PBLista5.Max = TBAbrir.RecordCount
        'PBLista5.Value = 1
        Contador = 0
        Do While TBAbrir.EOF = False
            With ListaMovimentacao.ListItems
                .Add , , TBAbrir!IDoperacao
                .Item(.Count).SubItems(1) = IIf(IsNull(TBAbrir!IDEstoque), "", TBAbrir!IDEstoque)
                .Item(.Count).SubItems(2) = IIf(IsNull(TBAbrir!Data), "", Format(TBAbrir!Data, "dd/mm/yy"))
                .Item(.Count).SubItems(3) = IIf(IsNull(TBAbrir!LOTE), "", TBAbrir!LOTE)
                .Item(.Count).SubItems(4) = IIf(IsNull(TBAbrir!Corrida), "", TBAbrir!Corrida)
                .Item(.Count).SubItems(5) = IIf(IsNull(TBAbrir!Certificado), "", TBAbrir!Certificado)
                .Item(.Count).SubItems(6) = IIf(IsNull(TBAbrir!Saida), "", Format(TBAbrir!Saida, "###,##0.0000"))
                .Item(.Count).SubItems(7) = IIf(IsNull(TBAbrir!Saida_PC), "", Format(TBAbrir!Saida_PC, "###,##0.0000"))
            End With
            TBAbrir.MoveNext
            Contador = Contador + 1
            'PBLista5.Value = contador
        Loop
    End If
    TBAbrir.Close
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Opt_produto_final_Click()
On Error GoTo tratar_erro

If Opt_produto_final.Value = 1 Then
    Opt_servico.Value = 0
    Opt_servico.Enabled = False
    Opt_componente.Value = 0
    Opt_componente.Enabled = False
    Opt_subconjunto.Value = 0
    Opt_subconjunto.Enabled = False
Else
    Opt_servico.Enabled = True
    Opt_componente.Enabled = True
    Opt_subconjunto.Enabled = True
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Opt_componente_Click()
On Error GoTo tratar_erro

If Opt_componente.Value = 1 Then
    Opt_servico.Value = 0
    Opt_servico.Enabled = False
    Opt_produto_final.Value = 0
    Opt_produto_final.Enabled = False
    Opt_subconjunto.Value = 0
    Opt_subconjunto.Enabled = False
Else
    Opt_servico.Enabled = True
    Opt_produto_final.Enabled = True
    Opt_subconjunto.Enabled = True
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Opt_servico_Click()
On Error GoTo tratar_erro

If Opt_servico.Value = 1 Then
    Opt_componente.Value = 0
    Opt_componente.Enabled = False
    Opt_produto_final.Value = 0
    Opt_produto_final.Enabled = False
    Opt_subconjunto.Value = 0
    Opt_subconjunto.Enabled = False
Else
    Opt_componente.Enabled = True
    Opt_produto_final.Enabled = True
    Opt_subconjunto.Enabled = True
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Opt_subconjunto_Click()
On Error GoTo tratar_erro

If Opt_subconjunto.Value = 1 Then
    Opt_servico.Value = 0
    Opt_servico.Enabled = False
    Opt_produto_final.Value = 0
    Opt_produto_final.Enabled = False
    Opt_componente.Value = 0
    Opt_componente.Enabled = False
Else
    Opt_servico.Enabled = True
    Opt_produto_final.Enabled = True
    Opt_componente.Enabled = True
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub optconsignacao_Click()
On Error GoTo tratar_erro

'If optconsignacao.Value = 1 Then
'USMsgBox ("Atenção, ordem consignada somente retira material do estoque de propriedade do mesmo cliente da ordem." & vbCrLf & "Não considera saldo de outras origens."), vbExclamation, "CAPRIND v5.0"
'End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub SSTab2_Click(PreviousTab As Integer)
On Error GoTo tratar_erro

If SSTab2.Tab = 0 Then
    ProcHabDesBotoesOrdem
    If SSTab1.Tab = 1 Then txtreferencia.Visible = True
Else
    With USToolBar2
        .ButtonState(4) = 0
        .Refresh
    End With
    
    txtreferencia.Visible = False
    If txtResponsavel = "" Then
        SSTab2.Tab = 0
        USMsgBox ("Informe a ordem antes de prosseguir."), vbExclamation, "CAPRIND v5.0"
        Exit Sub
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaListaPedidos()
On Error GoTo tratar_erro

Valor3 = 0
Lista_pedidos.ListItems.Clear
Set TBLISTA = CreateObject("adodb.recordset")
TBLISTA.Open "Select VC.*, PP.ID, PP.OrdemEmpenho, PP.Qtde_empenho, PP.Qtde_entrada FROM vendas_carteira VC INNER JOIN Producao_pedidos PP on VC.codigo = PP.IDCarteira where PP.Ordem = " & txtof, Conexao, adOpenKeyset, adLockOptimistic
If TBLISTA.EOF = False Then
    Do While TBLISTA.EOF = False
        With Lista_pedidos.ListItems.Add(, , TBLISTA!ID)
            .SubItems(1) = TBLISTA!CODIGO
            
            Set TBCFOP = CreateObject("adodb.recordset")
            If IsNull(TBLISTA!ID_solicitacao) = True Or TBLISTA!ID_solicitacao = 0 Then
                TBCFOP.Open "Select Ncotacao, Revisao, cliente FROM vendas_proposta where cotacao = " & TBLISTA!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
                If TBCFOP.EOF = False Then
                    .SubItems(2) = IIf(IsNull(TBCFOP!Ncotacao), "", TBCFOP!Ncotacao)
                    .SubItems(3) = IIf(IsNull(TBCFOP!Revisao), "", TBCFOP!Revisao)
                    .SubItems(4) = IIf(IsNull(TBCFOP!Cliente), "", TBCFOP!Cliente)
                End If
            Else
                TBCFOP.Open "Select Requisicaotexto FROM Outros_SolicitacaoPCP where ID = " & TBLISTA!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
                If TBCFOP.EOF = False Then .SubItems(2) = IIf(IsNull(TBCFOP!Requisicaotexto), "", TBCFOP!Requisicaotexto)
            End If
            TBCFOP.Close
            
            .SubItems(5) = IIf(IsNull(TBLISTA!Desenho), "", TBLISTA!Desenho)
            .SubItems(6) = IIf(IsNull(TBLISTA!Rev_codinterno), "", TBLISTA!Rev_codinterno)
            .SubItems(7) = IIf(IsNull(TBLISTA!N_referencia), "", TBLISTA!N_referencia)
            .SubItems(8) = IIf(IsNull(TBLISTA!descricao_tecnica), "", TBLISTA!descricao_tecnica)
            .SubItems(9) = IIf(IsNull(TBLISTA!OrdemEmpenho), "", TBLISTA!OrdemEmpenho)
            valor = IIf(IsNull(TBLISTA!Qtde_empenho), 0, TBLISTA!Qtde_empenho)
            .SubItems(10) = valor
            Valor1 = IIf(IsNull(TBLISTA!Qtde_entrada), 0, TBLISTA!Qtde_entrada)
            .SubItems(11) = Valor1
            .SubItems(12) = valor - Valor1
            .SubItems(13) = IIf(IsNull(TBLISTA!PrazoFinal), "", Format(TBLISTA!PrazoFinal, "dd/mm/yy"))
            .SubItems(14) = IIf(IsNull(TBLISTA!Tipo), "", TBLISTA!Tipo)
            .SubItems(15) = IIf(IsNull(TBLISTA!PCCliente), "", TBLISTA!PCCliente)
            .SubItems(16) = IIf(IsNull(TBLISTA!N_item), "", TBLISTA!N_item)
            .SubItems(17) = IIf(IsNull(TBLISTA!Liberacao), "", TBLISTA!Liberacao)
        End With
        Valor3 = Valor3 + (valor - Valor1)
        TBLISTA.MoveNext
    Loop
End If
TBLISTA.Close
valor = Txt_qtde_total_produzindo
Txt_qtde_total_emp_produzindo = Valor3
Txt_qtde_total_disp_produzindo = valor - Valor3

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Txt_cod_prod_LostFocus()
On Error GoTo tratar_erro

ProcCarregaDadosProduto

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCarregaDadosProduto()
On Error GoTo tratar_erro

If Txt_cod_prod = "" Then Exit Sub
If Novo_Ordem = True Then TextoFiltro = "and DtValidacao IS NOT NULL and Bloqueado = 'False'" Else TextoFiltro = ""
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select Desenho, RevDesenho from projproduto where desenho = '" & Txt_cod_prod & "' and Producao = 'True' and SubTipoItem = 1 " & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    Txt_cod_prod = TBproducao!Desenho
    Txt_rev_cod_prod = IIf(IsNull(TBproducao!RevDesenho), 0, TBproducao!RevDesenho)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Txt_ID_cliente_KeyDown(KeyCode As Integer, Shift As Integer)
On Error GoTo tratar_erro

Select Case KeyCode
    Case vbKeyReturn: Cmdlocalizarcli_Click
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub



Private Sub txtCliente_KeyDown(KeyCode As Integer, Shift As Integer)
On Error GoTo tratar_erro

Select Case KeyCode
    Case vbKeyReturn: Cmdlocalizarcli_Click
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtPcHora_DblClick()
On Error GoTo tratar_erro

frmProd_CalculaExecucao.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtTNC_Change()
On Error GoTo tratar_erro

If txtTNC <> "" Then
    VerifNumero = txtTNC
    ProcVerificaNumero
    If VerifNumero = False Then
        txtTNC = ""
        txtTNC.SetFocus
        Exit Sub
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtTOK_Change()
On Error GoTo tratar_erro

If txtTOK <> "" Then
    VerifNumero = txtTOK
    ProcVerificaNumero
    If VerifNumero = False Then
        txtTOK = ""
        txtTOK.SetFocus
        Exit Sub
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub SSTab1_Click(PreviousTab As Integer)
On Error GoTo tratar_erro

If Frame1(3).Visible = False Then listaitens.Visible = True Else listaitens.Visible = False
'ProcCorrigeForm
ListaRequisicao.Visible = False
If SSTab1.Tab > 1 And (txtof = "" Or txtdesenho = "") Then
    SSTab1.Tab = 1
    Exit Sub
End If
Select Case SSTab1.Tab
    Case 0:
        If Cmb_opcao_lista.Visible = True Then Cmb_opcao_lista.SetFocus
        txtreferencia.Visible = False
        cmbOSMaquina.Visible = False
        'With PBLista
            If Frame1(3).Visible = False Then
        '        .Visible = True
                Frame1(2).Visible = True
            Else
        '        .Visible = False
                Frame1(2).Visible = False
            End If
        'End With
        'PBLista2.Visible = False
    Case 1:
        listaitens.Visible = False
        Frame1(2).Visible = True
        If SSTab2.Tab = 0 Then txtreferencia.Visible = True
        cmbOSMaquina.Visible = False
        listaitens.Visible = False
        ''PBLista.Visible = True
        ''PBLista.Top = 9720
        'PBLista2.Visible = False
        If txtof.Visible = True Then txtof.SetFocus
    Case 2:
        listaitens.Visible = False
        Frame1(2).Visible = False
        txtreferencia.Visible = False
        cmbOSMaquina.Visible = True
        ''PBLista.Visible = False
        'PBLista2.Visible = True
        ProcVerificaProsseguir
        If Permitido = False Then Exit Sub
        ProcAtualizalista_os
        ProcLimparCamposOS
        Framedetalhes.Enabled = False
        Frame24.Enabled = False
        If Framedetalhes.Enabled = True Then txtOS.SetFocus
    Case 3:
        listaitens.Visible = False
        ListaRequisicao.Visible = True
        Frame1(2).Visible = False
        txtreferencia.Visible = False
        cmbOSMaquina.Visible = False
        ''PBLista.Visible = False
        'PBLista2.Visible = False
        ProcVerificaProsseguir
        If Permitido = False Then Exit Sub
        ProcCarregaListaRequisicao
        ListaMovimentacao.ListItems.Clear
        ListaLote.ListItems.Clear
        Cmb_opcao_lista2.SetFocus
        
'        If optconsignacao.Value = 1 Then
'         USMsgBox ("Atenção, ordem consignada somente retira material do estoque de propriedade do mesmo cliente da ordem." & vbCrLf & "Não considera saldo de outras origens."), vbExclamation, "CAPRIND v5.0"
'        End If

    Case 4:
        listaitens.Visible = False
        Frame1(2).Visible = False
        txtreferencia.Visible = False
        cmbOSMaquina.Visible = False
        ''PBLista.Visible = True
        'PBLista2.Visible = False
        ProcVerificaProsseguir
        If Permitido = False Then Exit Sub
        cmbAPOS.SetFocus
        ProcLimpaCamposAP
        Proclimpaevento
        ProcCarregaAPOS
    Case 5:
        listaitens.Visible = False
        Frame1(2).Visible = False
        txtreferencia.Visible = False
        cmbOSMaquina.Visible = False
        ''PBLista.Visible = True
        'PBLista2.Visible = False
        ProcVerificaProsseguir
        If Permitido = False Then Exit Sub
    '    txtDtValidacao_custo.SetFocus
        Proclimpacamposres
        ProcCarregaResultados
'    Case 6:
'        listaitens.Visible = False
'        Frame1(2).Visible = False
'        txtreferencia.Visible = False
'        cmbOSMaquina.Visible = False
'        ProcAjustaGridSerie
'        ProcCarregaListaItens
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub



Private Sub ProcCorrigeForm()
On Error GoTo tratar_erro

'With 'PBLista
'    Select Case SSTab1.Tab
'        Case 0: .Top = listaitens.Top + listaitens.Height
'        Case 1: .Top = Lista.Top + Lista.Height + Frame9.Height
'        Case 4: .Top = APLista.Top + APLista.Height
'        Case 5: .Top = ListaRE.Top + ListaRE.Height
'    End Select
'End With

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaProsseguir()
On Error GoTo tratar_erro

Permitido = True
If Novo_Ordem = True Then
    SSTab1.Tab = 1
    USMsgBox ("Salve a ordem antes de prosseguir."), vbExclamation, "CAPRIND v5.0"
    Permitido = False
    Exit Sub
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaListaRequisicao()
On Error GoTo tratar_erro
Dim Requisitado As Double
Dim Saida As Double


ListaRequisicao.ListItems.Clear
If txtof = "" Then Exit Sub
Set TBLISTA = CreateObject("adodb.recordset")
StrSql = "Select isnull(EP.saldo,0) as SaldoEstoque , PM.Tipo_Item, PM.Idmateriaprima, PM.CODIGO, PM.Unidade, PM.Descricao, PM.Requisitado, isnull(QTSEP.Saida,0) as Saida, ISNULL(SUM(PM.requisitado-QTSEP.saida),0) as saldo, PM.Versao from Producaomaterial PM lEFT join Qtde_saida_estoque_produto QTSEP on PM.Idmateriaprima = QTSEP.IDmateriaprima Left Join Estoque_Controle_Saldo_Item EP ON PM.Codigo = EP.Codigo Where PM.ordem = '" & txtof.Text & "' group by EP.saldo, PM.Tipo_Item, PM.Idmateriaprima, PM.CODIGO, PM.Unidade, PM.Descricao, PM.Requisitado, QTSEP.Saida, PM.versao"
'Debug.print StrSql

TBLISTA.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
If TBLISTA.EOF = False Then
    Contador = 0
    Do While TBLISTA.EOF = False
        With ListaRequisicao.ListItems
            .Add , , TBLISTA!IdMateriaPrima
            .Item(.Count).SubItems(1) = IIf(IsNull(TBLISTA!CODIGO), "", TBLISTA!CODIGO)
            .Item(.Count).SubItems(2) = IIf(IsNull(TBLISTA!Descricao), "", TBLISTA!Descricao)
            .Item(.Count).SubItems(3) = IIf(IsNull(TBLISTA!Unidade), "", TBLISTA!Unidade)
            .Item(.Count).SubItems(4) = IIf(IsNull(TBLISTA!Requisitado), "", Format(TBLISTA!Requisitado, "###,##0.00000000"))
            .Item(.Count).SubItems(5) = IIf(IsNull(TBLISTA!Saida), "0,00000000", Format(TBLISTA!Saida, "###,##0.00000000"))
            
            Requisitado = .Item(.Count).SubItems(4)
            Saida = .Item(.Count).SubItems(5)
            Saldo = Requisitado - Saida
            
            .Item(.Count).SubItems(6) = Format(Saldo, "###,##0.00000000")
            
            If Saida >= Requisitado Then
            status = "BAIXADO"
            .Item(.Count).SubItems(7) = status
            
           .Item(.Count).ListSubItems(7).ForeColor = RGB(35, 107, 142) 'vbBlue
                 If TBLISTA!Saida > TBLISTA!Requisitado Then
                    .Item(.Count).ListSubItems(6).ForeColor = RGB(165, 42, 42) 'vbRed
                 End If
            End If
            
            If IsNull(TBLISTA!Saida) Or TBLISTA!Saida = 0 Then
            status = "REQUISITADO"
            .Item(.Count).SubItems(7) = status
           .Item(.Count).ListSubItems(7).ForeColor = RGB(165, 42, 42) 'vbRed
            End If
            
            If TBLISTA!Saida > 0 And TBLISTA!Saida < TBLISTA!Requisitado Then
                status = "PARCIAL"
                .Item(.Count).SubItems(7) = status
                .Item(.Count).ListSubItems(7).ForeColor = RGB(74, 118, 110) 'vbGreen
            End If
            
            If TBLISTA!Tipo_ITEM = 1 Then
                Tipo_ITEM = "Titular"
                .Item(.Count).SubItems(8) = Tipo_ITEM
                .Item(.Count).ListSubItems(8).ForeColor = RGB(74, 118, 110) 'vbGreen
            Else
                Tipo_ITEM = "Alternativo"
                .Item(.Count).SubItems(8) = Tipo_ITEM
                .Item(.Count).ListSubItems(8).ForeColor = RGB(165, 42, 42) 'vbGreen
            End If
                .Item(.Count).ListSubItems(8).Bold = True
             .Item(.Count).SubItems(9) = Format(TBLISTA!SaldoEstoque, "###,##0.0000")
             .Item(.Count).SubItems(10) = TBLISTA!versao
        
        End With
        TBLISTA.MoveNext
        Contador = Contador + 1

    Loop
End If
TBLISTA.Close

ListaConsignacao.ListItems.Clear
ListaLote.ListItems.Clear

ListaMovimentacao.ListItems.Clear

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Sub ProcOSCarregaMaquina()
On Error GoTo tratar_erro

ProcCarregaComboPostoTrab cmbOSMaquina, "Bloqueado = 'False'", False, False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcCarregaResultados()
On Error GoTo tratar_erro
    
If txtof.Text <> "" And txtconcluida <> "__/__/__" Then ProcAbrirRe

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaAPOS()
On Error GoTo tratar_erro
    
cmbAPOS.Clear
txtAPMaquina.Clear
cmbOperador.Clear
If txtof.Text <> "" Then
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open "Select * FROM ordemservico where Ordem = " & txtof.Text & " ORDER BY fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
        Do While TBproducao.EOF = False
            cmbAPOS.AddItem TBproducao!IDProducao
            TBproducao.MoveNext
        Loop
    End If
    TBproducao.Close
    
    If Chk_carregar_bloqueado.Value = 1 Then
        ProcCarregaComboPostoTrab txtAPMaquina, "Maquina is not null", False, False
        ProcCarregaComboUsuario cmbOperador, "U.Usuario is not null", False
    Else
        ProcCarregaComboPostoTrab txtAPMaquina, "Bloqueado = 'False'", False, False
        ProcCarregaComboUsuario cmbOperador, "U.Bloqueado = 'False'", False
    End If
End If
txtAPOF.Text = txtof.Text
txtAPprazo.Text = mskprazofina.Value
txtAPquant.Text = txtQuantidade.Text
frmprod.Refresh

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Txt_cod_prod_Change()
On Error GoTo tratar_erro

Txt_rev_cod_prod = ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Txt_ID_cliente_Change()
On Error GoTo tratar_erro

txtCliente = ""
If Txt_ID_cliente <> "" Then
    VerifNumero = Txt_ID_cliente
    ProcVerificaNumero
    If VerifNumero = False Then
        Txt_ID_cliente = ""
        Txt_ID_cliente.SetFocus
        Exit Sub
    End If
    Set TBClientes = CreateObject("adodb.recordset")
    TBClientes.Open "Select * from Clientes where IDCliente = " & Txt_ID_cliente, Conexao, adOpenKeyset, adLockOptimistic
    If TBClientes.EOF = False Then
        txtCliente = IIf(IsNull(TBClientes!NomeRazao), "", TBClientes!NomeRazao)
    End If
    TBClientes.Close
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtAPMaquina_Click()
On Error GoTo tratar_erro

txtCodigo.Text = ""
cmbdescricao.ListIndex = -1
mskData.Value = Date
txtinicioap.Value = "00:00:00"
txtTOK.Text = ""
txtTNC.Text = ""
Txt_descricao_posto = ""
APLista.ListItems.Clear
If txtAPMaquina <> "" Then
    Set TBFIltro = CreateObject("adodb.recordset")
    TBFIltro.Open "Select * from Cadmaquinas where Maquina = '" & txtAPMaquina & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBFIltro.EOF = False Then
        Txt_descricao_posto = IIf(IsNull(TBFIltro!Descricao), "", TBFIltro!Descricao)
    End If
    TBFIltro.Close
End If

If cmbAPOS.Text <> "" And txtAPMaquina.Text <> "" Then
    ProcAtualizaProducao
End If


Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtcliente_Change()
On Error GoTo tratar_erro
  
If txtCliente.Text <> "" Then Cliente = txtCliente.Text Else Cliente = ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtDescricao_Change()
On Error GoTo tratar_erro

If Atualizacao = False Then
    With txtdescricao
        Cor_fonte.BackColor = IIf(IsNull(.SelColor), Cor_fonte.BackColor, .SelColor)
        Chk_negrito.Value = IIf(IsNull(.SelBold), 2, Abs(.SelBold))
        Chk_italico.Value = IIf(IsNull(.SelItalic), 2, Abs(.SelItalic))
        Chk_sublinhado.Value = IIf(IsNull(.SelUnderline), 2, Abs(.SelUnderline))
        Cmb_fonte = IIf(IsNull(.SelFontName), "", .SelFontName)
        Cmb_tamanho_fonte = IIf(IsNull(.SelFontSize), "", .SelFontSize)
1:
    End With
End If

Exit Sub
tratar_erro:
    If Err.Number = 383 Then GoTo 1
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtDesenho_Change()
On Error GoTo tratar_erro
  
txtreferencia.Clear
txtProduto.Text = ""
txtRevitem.Text = ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaDadosItem()
On Error GoTo tratar_erro

If txtdesenho = "" Then Exit Sub
If Novo_Ordem = True Then TextoFiltro = "and DtValidacao IS NOT NULL and Bloqueado = 'False'" Else TextoFiltro = ""
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select Desenho,Unidade, Codproduto, Descricao, RevDesenho, SubTipoItem from projproduto where desenho = '" & txtdesenho.Text & "' and Producao = 'True' " & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    txtdesenho = TBproducao!Desenho
    Codproduto = TBproducao!Codproduto
    txtProduto.Text = TBproducao!Descricao
    txtRevitem.Text = IIf(IsNull(TBproducao!RevDesenho), 0, TBproducao!RevDesenho)
    txtUN.Text = TBproducao!Unidade
    
    If Txt_ID_cliente <> "" And Txt_ID_cliente <> "0" Then
        ProcCarregaComboCodRef txtreferencia, "P.codproduto = " & TBproducao!Codproduto, Txt_ID_cliente, "C", True, True
    Else
        ProcCarregaComboCodRef txtreferencia, "P.codproduto = " & TBproducao!Codproduto, 0, "", False, True
    End If
    
    If IsNull(TBproducao!SubTipoItem) = False Then
        Select Case TBproducao!SubTipoItem
            Case 1: Opt_produto_final.Value = 1
            Case 2: Opt_subconjunto.Value = 1
            Case 3: Opt_componente.Value = 1
            Case 5: Opt_servico.Value = 1
        End Select
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtdesenho_LostFocus()
On Error GoTo tratar_erro
  
ProcCarregaDadosItem

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCarregaDadosProdEstImaProc(BuscarEst As Boolean)
On Error GoTo tratar_erro

'TxtEstUN = ""
TxtEstTotal = ""
TxtEstQTEmpenhado = ""
TxtEstdisponivel = ""
Txt_qtde_prod = ""
Txt_qtde_emp_est = ""
Txt_qtde_disp_prod = ""
Txt_qtde_total_disp = ""
TTE = 0
If TxtEstCodigo.Text = "" Or listaitens.ListItems.Count = 0 Then Exit Sub
If BuscarEst = False Then
    'Chk_tem_processo.Value = 0
    'Chk_tem_plano.Value = 0
    Set TBProduto = CreateObject("adodb.recordset")
    TBProduto.Open "Select Unidade, Processo, Plano_inspecao from projproduto where desenho = '" & TxtEstCodigo.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBProduto.EOF = False Then
        TxtEstUN.Text = TBProduto!Unidade
        'If TBProduto!Processo = True Then Chk_tem_processo.Value = 1 Else Chk_tem_processo.Value = 0
        'If TBProduto!Plano_inspecao = True Then Chk_tem_plano.Value = 1 Else Chk_tem_plano.Value = 0
    End If
    TBProduto.Close
Else
    Set TBCarteira = CreateObject("adodb.recordset")
    TBCarteira.Open "Select ID_solicitacao, Cotacao, Desenho from vendas_carteira where Codigo = " & listaitens.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
    If TBCarteira.EOF = False Then
        'Verifica se o item é de uma solicitação de produção ou não
        Set TBNivel1 = CreateObject("adodb.recordset")
        If IsNull(TBCarteira!ID_solicitacao) = True Or TBCarteira!ID_solicitacao = 0 Then
            TBNivel1.Open "Select IDcliente, ID_empresa from vendas_proposta where cotacao = " & TBCarteira!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
        Else
            TBNivel1.Open "Select ID_empresa from Outros_SolicitacaoPCP where ID = " & TBCarteira!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
        End If
        If TBNivel1.EOF = False Then
            Valor1 = FunVerificaQtdeEstoque(TxtEstCodigo, TBNivel1!ID_empresa, "")
            TxtEstTotal = Format(Valor1, "###,##0.0000")
            Valor2 = FunVerificaQtdeEmpenhoEstVenda(TxtEstCodigo, TBNivel1!ID_empresa)
            TTE = FunVerificaQtdeEmpenhoEst(TxtEstCodigo, TBNivel1!ID_empresa)
            TxtEstEmpenhado.Text = Format(Valor2 + TTE, "###,##0.0000")
            Valor_DAS = Valor1 - (Valor2 + TTE)
            TxtEstdisponivel.Text = Format(Valor_DAS, "###,##0.0000")
            
            Valor3 = FunVerificaQtdeProduzindo(TxtEstCodigo, TBNivel1!ID_empresa)
            Txt_qtde_prod = Valor3
            Valor_Cofins_Serv = FunVerificaQtdeEmpenhoProduzindo(TxtEstCodigo, TBNivel1!ID_empresa)
            Txt_qtde_emp_est = Valor_Cofins_Serv
            Valor_CSLL_Prod = Valor3 - Valor_Cofins_Serv
            Txt_qtde_disp_prod = Valor_CSLL_Prod
            
            Txt_qtde_total_disp = Format(Valor_DAS + Valor_CSLL_Prod, "###,##0.0000")
        End If
        TBNivel1.Close
    End If
    TBCarteira.Close
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Function TemEstoque(Requisitado As Double, OrdemEmpenhoEst As Long) As Boolean
On Error GoTo tratar_erro

GerouOrdem = True
If MRP_considerar_estoque = True Then
    'Empenha do estoque para a ordem que requisita o componente
    If Consignacao = False Then Familiatext = "and Consignacao = 'False'" Else Familiatext = "and (Consignacao = 'False' or Consignacao = 'True' and id_cliente = " & IIf(IsNull(TBCarteira!IDCliente), 0, TBCarteira!IDCliente) & " and Tipodest_NFcons = 'C' or Consignacao = 'True' and Tipodest_NFcons = 'F')"
    Set TBEstoque = CreateObject("adodb.recordset")
    TBEstoque.Open "Select IDestoque, Estoque_disponivel, Estoque_real_PC from Estoque_produtos where ID_empresa = " & TBCarteira!ID_empresa & " and Desenho = '" & Desenho & "' and Liberado = 'SIM' and Estoque_disponivel > 0 " & Familiatext & " order by Consignacao desc, Data, IDestoque", Conexao, adOpenKeyset, adLockOptimistic
    If TBEstoque.EOF = False Then
        Do While TBEstoque.EOF = False And QuantSolicitado > 0
            ProcEmpenharREAutomOrdemMRP OrdemEmpenhoEst, TBEstoque!IDEstoque, TBEstoque!Estoque_Disponivel, Desenho
            TBEstoque.MoveNext
        Loop
    End If
    If QuantSolicitado > 0 Then
        'Verifica se o item possui antecipação da produção
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select Dias_antecipacao from projproduto where desenho = '" & Desenho & "' and Dias_antecipacao IS NOT NULL and Dias_antecipacao <> 0", Conexao, adOpenKeyset, adLockOptimistic
        If TBProduto.EOF = False Then
            DataNC = FunDefinirPrazoAntecipacao(TBProduto!Dias_antecipacao, IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date))
        Else
            DataNC = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) 'Prazo previsto para entrega
        End If
        TBProduto.Close

        ProcEmpenharProdProduzindo TBCarteira!ID_empresa, TBCarteira!CODIGO, Desenho, DataNC, False
    End If
    If QuantSolicitado > 0 Then
        TemEstoque = False
        GerouOrdem = True
        QuantSolicitado = Requisitado
    Else
        TemEstoque = True
        GerouOrdem = False
    End If
End If

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Sub Procentrada()
On Error GoTo tratar_erro

'Rotina de tranformacao de preparacao
If TBFases("preparacao") <> "__:__:__" Then
    Hora = Hour(TBFases("preparacao"))
    Minuto = Minute(TBFases("preparacao"))
    Segundo = Second(TBFases("preparacao"))
    If TBFases("diaprep") <> 0 Then
        Dia = TBFases("diaprep")
    End If
    Do While diaprep > 0
        Minuto = Minuto + 1440
        diaprep = diaprep - 1
    Loop
    Minuto = Minuto + Hora * 60
    If Len(Minuto) = 1 Then
        Minuto = "000" & Minuto
    End If
    If Len(Minuto) = 2 Then
        Minuto = "00" & Minuto
    End If
    If Len(Minuto) = 3 Then
        Minuto = "0" & Minuto
    End If
    If Len(Segundo) = 1 Then
        Segundo = "0" & Segundo
    End If
    Preparacao = Minuto & ":" & Segundo
End If
'Rotina de tranformacao de execucao
If TBFases("execucao") <> "__:__:__" Then
    Hora = Hour(TBFases("execucao"))
    Minuto = Minute(TBFases("execucao"))
    Segundo = Second(TBFases("execucao"))
    If TBFases("diaexec") <> 0 Then
        diaexec = TBFases("diaexec")
    End If
    Do While diaexec > 0
        Minuto = Minuto + 1440
        diaexec = diaexec - 1
    Loop
    Minuto = Minuto + Hora * 60
    If Len(Minuto) = 1 Then
        Minuto = "000" & Minuto
    End If
    If Len(Minuto) = 2 Then
        Minuto = "00" & Minuto
    End If
    If Len(Minuto) = 3 Then
        Minuto = "0" & Minuto
    End If
    If Len(Segundo) = 1 Then
        Segundo = "0" & Segundo
    End If
    Execucao = Minuto & ":" & Segundo
End If
        
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub Procsaida()
On Error GoTo tratar_erro

'=======================================================
' CALCULO DE TEMPO DE PREPARACAO MAIOR QUE 23:59:59 HS =
'=======================================================
DataResultado = 0
If SSTab1.Tab = 2 Then
    If txtpreparacao > "023:59:59" Then ProcFormataHora (txtpreparacao) Else DataResultado = txtpreparacao
Else
    If txtAPpreparacao > "023:59:59" Then ProcFormataHora (txtAPpreparacao) Else DataResultado = txtAPpreparacao
End If
ElapsedTime (DataResultado)
Preparacao = DataResultado
TempoPreparacao = HoraTotal
'=====================================================
' CALCULO DE TEMPO DE EXECUÇÃO MAIOR QUE 23:59:59 HS =
'=====================================================
DataResultado = 0
If SSTab1.Tab = 2 Then
    If txtexecucao > "023:59:59" Then ProcFormataHora (txtexecucao) Else DataResultado = txtexecucao
Else
    If txtAPexecucao > "023:59:59" Then ProcFormataHora (txtAPexecucao) Else DataResultado = txtAPexecucao
End If
ElapsedTime (DataResultado)
Execucao = DataResultado
TempoExecucao = HoraTotal

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcBuscaProcesso(Codinterno As String)
On Error GoTo tratar_erro

IDPROCESSO = 0
Set TBProcessos = CreateObject("adodb.recordset")
TBProcessos.Open "Select PR.IDprocesso from Processos PR INNER JOIN projproduto PROD ON PROD.Codproduto = PR.Codproduto where PROD.desenho = '" & Codinterno & "' and PR.tipo <> 'C' and PR.Bloqueado = 'False' and PR.Revisao = (Select MAX(PR1.Revisao) from Processos PR1 where PR1.NProcesso = PR.NProcesso)", Conexao, adOpenKeyset, adLockOptimistic
If TBProcessos.EOF = False Then
    IDPROCESSO = TBProcessos!IDPROCESSO
End If
TBProcessos.Close
        
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCriarRequisicao()
On Error GoTo tratar_erro

Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select * from projproduto where desenho = '" & txtdesenho.Text & "' and DtValidacaoConj IS NOT NULL", Conexao, adOpenKeyset, adLockOptimistic
If TBItem.EOF = False Then
    Set TBProcessos = CreateObject("adodb.recordset")
    TBProcessos.Open "Select PC.*, P.PBruto, P.SubTipoItem, PC.Un_Kg from projconjunto PC INNER JOIN projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & TBItem!Codproduto & " and PC.Versao = '" & Versao_estrutura & "' and P.bloqueado = 'False' order by PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
    If TBProcessos.EOF = False Then
        Do While TBProcessos.EOF = False
            Set TBMaterial = CreateObject("adodb.recordset")
            TBMaterial.Open "Select * from producaomaterial", Conexao, adOpenKeyset, adLockOptimistic
            TBMaterial.AddNew
            TBMaterial!Posicao = TBProcessos!Posicao
            TBMaterial!quantidade = TBProcessos!quantidade * txtQuantidade
            TBMaterial!Unidade = TBProcessos!Unidade
            TBMaterial!CODIGO = TBProcessos!Desenho
            TBMaterial!ID_partnumber_fabricante = TBProcessos!ID_partnumber_fabricante
            TBMaterial!Descricao = TBProcessos!Descricao
            TBMaterial!Ordem = OF
            TBMaterial!PesoMetro = TBProcessos!PesoMetro
            TBMaterial!pesounidade = TBProcessos!Peso
            TBMaterial!PesoTotal = TBProcessos!PesoTotal * txtQuantidade
            TBMaterial!Percentual_perda = TBProcessos!Percentual_perda
            TBMaterial!Dimensao = TBProcessos!Dimensoes
            
            Peso = TBProcessos!quantidade
            If TBProcessos!Un_Kg <> "N/a" And TBProcessos!Un_Kg <> "" And (TBProcessos!Unidade = "KG" Or TBProcessos!Unidade = "MT" Or TBProcessos!Unidade = "MM" Or TBProcessos!Unidade = "M³") Then
                Select Case TBProcessos!Unidade
                    Case "KG": Peso = TBProcessos!PesoTotal
                    Case "MT": Peso = (TBProcessos!Dimensoes / 1000) * TBProcessos!quantidade
                    Case "MM": Peso = TBProcessos!Dimensoes * TBProcessos!quantidade
                    Case "M³": Peso = TBProcessos!PesoTotal
                End Select
            End If
            
 '===============================================================================================
 ' Acrescentar código abaixo
 '===============================================================================================
            If TBProcessos!Unidade = "M³" Then
                TBMaterial!Requisitado = Peso * txtQuantidade
                TBMaterial!DimensaoTotal = TBProcessos!Dimensoes
                TBMaterial!Total_pc = TBProcessos!quantidade
            Else
                TBMaterial!Requisitado = Format(Peso * txtQuantidade, "###,##0.0000")
                If TBProcessos!Un_Kg = "Mt²" Then TBMaterial!DimensaoTotal = ((TBProcessos!Dimensoes / 1000) / 1000) * TBMaterial!quantidade Else TBMaterial!DimensaoTotal = (TBProcessos!Dimensoes / 1000) * TBMaterial!quantidade
             If TBProcessos!Unidade = "KG" Or TBProcessos!SubTipoItem = 1 Or TBProcessos!SubTipoItem = 2 Or TBProcessos!SubTipoItem = 3 Then
                If TBProcessos!Unidade = "KG" And (TBProcessos!Un_Kg = "Mt²" Or TBProcessos!Un_Kg = "Mt/L") Then
                    If IsNull(TBProcessos!PBruto) = False And TBProcessos!PBruto > 0 And TBProcessos!PBruto <> "" Then TBMaterial!Total_pc = Format(TBMaterial!Requisitado / TBProcessos!PBruto, "###,##0.0000") Else TBMaterial!Total_pc = Null
                Else
                    If TBProcessos!Unidade = "PÇ" Or TBProcessos!Unidade = "PC" Or TBProcessos!Unidade = "UN" Or TBProcessos!Unidade = "CJ" Then TBMaterial!Total_pc = TBMaterial!Requisitado Else TBMaterial!Total_pc = Null
                End If
            End If
           End If
'=======================================================================================================
                                    
            TBMaterial!versao = TBProcessos!Versao_desenho
            TBMaterial!Obs = TBProcessos!Obs
            TBMaterial!Saida = "NÃO"
            TBMaterial!Tipo_ITEM = 1 'TBProcessos!Tipo
            Conexao.Execute "DELETE from Producao_NF_Consignada where Ordem = " & txtof & " and codinterno = '" & TBProcessos!Desenho & "'"

            TBMaterial.Update
            TBProcessos.MoveNext
        Loop
        TBMaterial.Close
    End If
    TBProcessos.Close
End If
TBItem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Sub ProcCriarOrdemServico(Desenho As String)
On Error GoTo tratar_erro

TotalUtilizado = "00:00:00"
'Busca dados das fases do processo

1:
Set TBFases = CreateObject("adodb.recordset")
TBFases.Open "Select F.* from fases F INNER JOIN Processos P ON P.IDProcesso = F.IDProcesso where F.idprocesso = " & IDPROCESSO & " AND F.versao = '" & Versao_processo & "' and P.DtValidacao IS NOT NULL order by F.fase", Conexao, adOpenKeyset, adLockOptimistic
If TBFases.EOF = False Then
    Do While TBFases.EOF = False
        Set TBProducaoFases = CreateObject("adodb.recordset")
        TBProducaoFases.Open "Select * from ordemservico where Ordem = " & OF & " and IDFase = " & TBFases!IDFase & " and Retrabalho = 'False'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProducaoFases.EOF = True Then
            TBProducaoFases.AddNew
            If TBFases!Nao_aponta = True Then
                TBProducaoFases!Pronto = "SIM"
                TBProducaoFases!status = "Concluída"
                TBProducaoFases!DataConclusao = Date
            Else
                TBProducaoFases!Pronto = "NÃO"
                TBProducaoFases!status = "Aguardando"
            End If
        End If
        TBProducaoFases!Fase = TBFases!Fase
        TBProducaoFases!Rev_Fase = IIf(IsNull(TBFases!Revisao), 0, TBFases!Revisao)
        TBProducaoFases!Grupo_op = IIf(IsNull(TBFases!Grupo_op), "", TBFases!Grupo_op)
        TBProducaoFases!IDFase = TBFases!IDFase
        TBProducaoFases!maquina = TBFases!maquina
        TBProducaoFases!quantidade = TBProducaoFases!quantidade + QuantSolicitado
        
        DecimoSegundos = (IIf(IsNull(TBFases!TESegundos), 0, TBFases!TESegundos) * TBProducaoFases!quantidade) + IIf(IsNull(TBFases!TPSegundos), 0, TBFases!TPSegundos)
        TBProducaoFases!TTLPREVS = DecimoSegundos 'Tempo total do lote previsto em segundos
        TBProducaoFases!TempoTotalLote = FormataTempo(DecimoSegundos) 'Tempo total do lote previsto
                
        'Verifica se a maquina agrega custos/eficiencia na ordem
        Set TBMaquinas = CreateObject("adodb.recordset")
        TBMaquinas.Open "Select * from cadmaquinas where maquina = '" & TBFases!maquina & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBMaquinas.EOF = False Then
            If TBMaquinas!custos = True Then TBProducaoFases!custos = True Else TBProducaoFases!custos = False
            If IsNull(TBMaquinas!PrecoHora_Setup) = False And TBMaquinas!PrecoHora_Setup <> "" Then TBProducaoFases!Valor_hs_prep = TBMaquinas!PrecoHora_Setup Else TBProducaoFases!Valor_hs_prep = IIf(IsNull(TBMaquinas!PrecoHora), 0, TBMaquinas!PrecoHora)
            TBProducaoFases!Valor_hs_exec = IIf(IsNull(TBMaquinas!PrecoHora), 0, TBMaquinas!PrecoHora)
        End If
        TBMaquinas.Close
        
        TBProducaoFases!IDPROCESSO = TBFases!IDPROCESSO
        TBProducaoFases!Ordem = OF
        
        TBProducaoFases!pecahora = TBFases!pecahora
        If TBFases!pecahora = True Then
            TBProducaoFases!Pcshora = IIf(IsNull(TBFases!pc_te) = False, TBFases!pc_te, 1)
        Else
            If IsNull(TBFases!Execucao) = False And TBFases!Execucao <> "00:00:00" Then
                ElapsedTime (TBFases!Execucao)
                TBProducaoFases!Pcshora = 3600 / s
            End If
        End If
        TBProducaoFases!pc_te = IIf(IsNull(TBFases!pc_te) = False, TBFases!pc_te, 1)
        TBProducaoFases!Preparacao = IIf(IsNull(TBFases!Preparacao), "00:00:00", TBFases!Preparacao)
        TBProducaoFases!Execucao = IIf(IsNull(TBFases!Execucao), "00:00:00", TBFases!Execucao)
        TBProducaoFases!TempoPreparacao = TBFases!TempoPreparacao
        TBProducaoFases!TempoExecucao = TBFases!TempoExecucao
        TBProducaoFases!descfase = TBFases!Descricao
        TBProducaoFases!TESegundos = FunCalculaSegPC(TBProducaoFases!Execucao, TBProducaoFases!pc_te)
        
        If OptOSControlada = 1 Then TBProducaoFases!OSControlada = True Else TBProducaoFases!OSControlada = False
        If Opt_processo_controlado = 1 Then TBProducaoFases!Processo_controlado = True Else TBProducaoFases!Processo_controlado = False
        TBProducaoFases!IDPlano = FunVerifIDPlano(TBFases!IDFase)
        TBProducaoFases!rastreavel = TBFases!rastreavel
        TBProducaoFases.Update
        TBFases.MoveNext
    Loop
Else
    If Versao_processo <> "A" Then
        Versao_processo = "A"
        GoTo 1
    End If
End If

'Prazo final da OS
If MRP = True Or MRP_Prod = True Then
    If IsNull(TBproducao!PrazoEntrega) = False And TBproducao!PrazoEntrega <> "" Then ProcDefinirPrazosOS OF, TBproducao!PrazoEntrega, False Else ProcDefinirPrazosOS OF, Date, False
Else
    ProcDefinirPrazosOS OF, mskprazofina.Value, False
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAcertaCadMaquina()
On Error GoTo tratar_erro

Conexao.Execute "DELETE from CadMaquinas_Monitor where Maquina = '" & txtAPMaquina & "'"
Liberada = "Liberada = 'True'"
Set TBLISTA = CreateObject("adodb.recordset")
TBLISTA.Open "Select * from ProducaoFases where maquina = '" & txtAPMaquina & "' order by data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
If TBLISTA.EOF = False Then
    Set TBOS = CreateObject("adodb.recordset")
    TBOS.Open "Select * from Ordemservico where Idproducao = " & TBLISTA!OS, Conexao, adOpenKeyset, adLockOptimistic
    If TBOS.EOF = False Then
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from CadMaquinas_Monitor where Maquina = '" & txtAPMaquina & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = True Then TBproducao.AddNew
        TBproducao!maquina = txtAPMaquina
        TBproducao!Data = TBLISTA!Data
        TBproducao!TempoInicio = TBLISTA!TempoInicio
        TBproducao!Ordem = TBLISTA!Ordem
        TBproducao!OS = TBLISTA!OS
        TBproducao!Operador = TBLISTA!Usuario
        TBproducao!Evento = TBLISTA!CodigoDesc
        TBproducao!DescEvento = TBLISTA!Descricao
        TBproducao!CP = TBOS!CPPECA
        TBproducao!CR = TBOS!CRPECA
        TBproducao!TP = TBOS!TempoExecucao
        TBproducao!TR = TBOS!TEUTIL
        TBproducao!Eficiencia = TBOS!Eficiencia
        TBproducao.Update
        TBproducao.Close
        
        If TBOS!custos = True Then
            Set TBCodigoDesc = CreateObject("adodb.recordset")
            TBCodigoDesc.Open "Select Liberar_Posto from CodigoDesc where codigo = " & TBLISTA!CodigoDesc, Conexao, adOpenKeyset, adLockOptimistic
            If TBCodigoDesc.EOF = False Then
                If TBCodigoDesc!liberar_posto = True Then Liberada = "Liberada = 'True'" Else Liberada = "Liberada = 'False'"
            End If
            TBCodigoDesc.Close
        Else
            Liberada = "Liberada = 'True'"
        End If
    End If
End If
Conexao.Execute "Update CadMaquinas Set " & Liberada & " where Maquina = '" & txtAPMaquina & "'"

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAPabrir()
On Error GoTo tratar_erro

Ultimo = ""
IDOperador = 0
Chk_apont_simultaneo.Value = 0
Txt_ID_apontamento = ""
Cmb_OS_apont_simult.Clear
Chk_reaproveitamento_tempo_prep.Value = 0
Txt_OS_reapr_tempo_prep = ""

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * FROM Producao WHERE Ordem = " & Int(txtof.Text), Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.BOF = False Then
    IDPROCESSO = TBOrdem!IDPROCESSO
    Set TBProcessos = CreateObject("adodb.recordset")
    TBProcessos.Open "Select * from ordemservico where IDPRODUCAO = " & cmbAPOS.Text, Conexao, adOpenKeyset, adLockOptimistic
    If TBProcessos.EOF = False Then
        Txt_ID_apontamento = IIf(IsNull(TBProcessos!ID_apontamento), "", TBProcessos!ID_apontamento)
        procBloqueiaLiberaAP
        
        If Txt_ID_apontamento <> "" Then
            Chk_apont_simultaneo.Value = 1
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select IDproducao from ordemservico where ID_apontamento = " & TBProcessos!ID_apontamento & " and Idproducao <> " & cmbAPOS.Text, Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                Do While TBAbrir.EOF = False
                    Cmb_OS_apont_simult.AddItem TBAbrir!IDProducao
                    TBAbrir.MoveNext
                Loop
            End If
            TBAbrir.Close
        End If
        
        If TBProcessos!Tempo_prep_reaproveitado = True Then
            Chk_reaproveitamento_tempo_prep.Value = 1
            Txt_OS_reapr_tempo_prep = TBProcessos!OS_reaproveitada
        End If
        
        txtAPOF.Text = TBProcessos!Ordem
        txtAPFase.Text = TBProcessos!Fase
        txtAPprazo.Text = Format(TBProcessos!PrazoFinal, "dd/mm/yy")
        txtAPquant.Text = Format(TBProcessos!quantidade, "###,##0.00")
        
        Set TBMaquinas = CreateObject("adodb.recordset")
        TBMaquinas.Open "Select maquina from Ordemservico_maq_utilizadas where OS = " & cmbAPOS & " order by ID", Conexao, adOpenKeyset, adLockOptimistic
        If TBMaquinas.EOF = False Then
            TBMaquinas.MoveLast
            
            If Chk_carregar_bloqueado.Value = 0 Then
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from CadMaquinas where Maquina = '" & TBMaquinas!maquina & "' and Bloqueado = 'True'", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    txtAPMaquina.AddItem TBMaquinas!maquina
                End If
                TBAbrir.Close
            End If
            
         '   txtAPMaquina.Text = TBMaquinas!maquina
        Else
            If Chk_carregar_bloqueado.Value = 0 Then
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from CadMaquinas where Maquina = '" & TBProcessos!maquina & "' and Bloqueado = 'True'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBAbrir.EOF = False Then
                        txtAPMaquina.AddItem TBProcessos!maquina
                    End If
                TBAbrir.Close
            End If
        txtAPMaquina.Text = TBProcessos!maquina
        End If
        TBMaquinas.Close
        
'==========================================================================================
'Tempo de preparação previsto
'==========================================================================================
ElapsedTime (IIf(IsNull(TBProcessos!Preparacao), 0, TBProcessos!Preparacao))
txtAPpreparacao.Text = HoraTotal
'==========================================================================================
'Tempo de preparação real
'==========================================================================================
ProcFormataHora (IIf(IsNull(TBProcessos!TPUTIL), 0, TBProcessos!TPUTIL))
txtTPUTIL = HoraTotal
'==========================================================================================
'Tempo de execução previsto
'==========================================================================================
If IsNull(TBProcessos!Execucao) = False And TBProcessos!Execucao <> "" Then
If Len(TBProcessos!Execucao) = 9 Or Len(TBProcessos!Execucao) = 19 Then
ElapsedTime (TBProcessos!Execucao)
Else
ProcFormataHora (TBProcessos!Execucao)
End If
txtAPexecucao = HoraTotal
End If
'==========================================================================================
'Tempo de execução real
'==========================================================================================
ProcFormataHora (IIf(IsNull(TBProcessos!TEUTIL), 0, TBProcessos!TEUTIL))
txtTEUTIL = HoraTotal
'==========================================================================================
'unidadee x exec. prev
'==========================================================================================
txtPcHoraPrevista = IIf(IsNull(TBProcessos!pc_te) = False, TBProcessos!pc_te, 1)
'==========================================================================================
'unidade x exec. real
'==========================================================================================
If TBProcessos!pecahora = False Then
txtPcHorareal = IIf(IsNull(TBProcessos!Totalprod), 0, TBProcessos!Totalprod)
Else
txtPcHorareal = "1,00"
End If
'==========================================================================================
'Execução x unidade previsto
'==========================================================================================

s = FunCalculaSegPC(TBProcessos!Execucao, IIf(IsNull(TBProcessos!pc_te) = False, TBProcessos!pc_te, 1))
TxtA3Prevista = FormataTempo(s)

'==========================================================================================
' Tempo de execução da unidade coletado (Real)
'===========================================================================================
If TBProcessos!TEUSEG > 0 And TBProcessos!QTOK > 0 Then
  If TBProcessos!QTOK >= 1 Then
   TEUSEG = Format(TBProcessos!TEUSEG / TBProcessos!QTOK, "###,##0.0000000000")
  Else
   TEUSEG = Format(TBProcessos!TEUSEG * TBProcessos!QTOK, "###,##0.0000000000")
  End If
Else
  TEUSEG = Format(TBProcessos!TEUSEG)
End If

DecimoSegundos = TBProcessos!TEUSEG 'TEUSEG
HoraUnidade = FormataTempo(DecimoSegundos)
ProcFormataHora (HoraUnidade)
TxtA3Real = HoraTotal
'===========================================================================================
'Tempo total previsto
'===========================================================================================
txtAPtotal = IIf(IsNull(TBProcessos!TempoTotalLote), "00:00:00", TBProcessos!TempoTotalLote)
'===========================================================================================
'Tempo total real
'===========================================================================================
txtTTReal = IIf(IsNull(TBProcessos!TETTUTIL), "00:00:00", TBProcessos!TETTUTIL)
'===========================================================================================
'Qtde. total aprov.
'==========================================================================================
txtttok = IIf(IsNull(TBProcessos!QTOK), 0, Format(TBProcessos!QTOK, "###,##0.00"))
'==========================================================================================
'Qtde. total NC
'==========================================================================================
Txtttnc = IIf(IsNull(TBProcessos!QTNC), 0, Format(TBProcessos!QTNC, "###,##0.00"))
'==========================================================================================
'Qtde. total prod.
'==========================================================================================
txtProduzida = IIf(IsNull(TBProcessos!Totalprod), 0, Format(TBProcessos!Totalprod, "###,##0.00"))
'==========================================================================================
'Eficiencia
'==========================================================================================
Txt_APeficiencia_prep = IIf(IsNull(TBProcessos!Eficiencia_prep), 0, Format(TBProcessos!Eficiencia_prep, "###,##0.00")) & "%"
Txt_APeficiencia_exec = IIf(IsNull(TBProcessos!Eficiencia_exec), 0, Format(TBProcessos!Eficiencia_exec, "###,##0.00")) & "%"
Txt_APeficiencia_media = IIf(IsNull(TBProcessos!Eficiencia), 0, Format(TBProcessos!Eficiencia, "###,##0.00")) & "%"
End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcExcluirAP()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtAPOF = "" Then Exit Sub
If APLista.Enabled = False Then Exit Sub
If APLista.ListItems.Count <> 0 And ExcluiSel = True Then
    If EventoAP = "" Or IsNumeric(EventoAP) = False Then
        USMsgBox ("Informe o evento na lista antes de excluir."), vbInformation, "CAPRIND v5.0"
        Exit Sub
    End If
    If USMsgBox("Deseja realmente excluir o evento selecionado?", vbYesNo, "CAPRIND v5.0") = vbYes Then
        'Verifica se o resultado da ordem foi validado
        Set TBOSC = CreateObject("adodb.recordset")
        If Txt_ID_apontamento <> "" Then
            TBOSC.Open "Select P.ordem from Producao P INNER JOIN Ordemservico OS ON OS.ordem = P.ordem where OS.ID_apontamento = " & Txt_ID_apontamento & " and P.DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
        Else
            TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
        End If
        If TBOSC.EOF = False Then
            If Txt_ID_apontamento <> "" Then MsgTexto = " ou da ordem " & TBOSC!Ordem & " (vinculada a esta)" Else MsgTexto = ""
            USMsgBox ("Não é permitido excluir o apontamento, pois já foi validado o resultado desta ordem" & MsgTexto & "."), vbExclamation, "CAPRIND v5.0"
            TBOSC.Close
            Exit Sub
        End If
        TBOSC.Close
        If cmbStatus = "Cancelada" Then
            USMsgBox ("Não é permitido excluir apontamento, pois a ordem foi cancelada."), vbExclamation, "CAPRIND v5.0"
            Exit Sub
        End If
        
        'Verifica se existe movimentação de saida no estoque quando a ordem tiver movimentação de entrada automática
        If Chk_entrar_estoque.Value = 1 Then
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select EC.IDestoque from Estoque_controle EC INNER JOIN Estoque_movimentacao EM ON EM.IDestoque = EC.IDestoque where EC.Lote = '" & txtof & "' and EM.Saida <> 0", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                USMsgBox ("Não é permitido excluir apontamento, pois existe movimentação de saída no estoque no RE dessa ordem."), vbExclamation, "CAPRIND v5.0"
                TBAbrir.Close
                Exit Sub
            End If
            TBAbrir.Close
        End If
            
        If Txt_ID_apontamento <> "" Then
            TextoFiltro = "Select OS.*, P.Desenho, P.Produto from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
        Else
            TextoFiltro = "Select OS.*, P.Desenho, P.Produto from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDProducao = " & cmbAPOS
        End If
        Set TBOS = CreateObject("adodb.recordset")
        TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
        If TBOS.EOF = False Then
            Do While TBOS.EOF = False
                Set TBCiclo = CreateObject("adodb.recordset")
                TBCiclo.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
                If TBCiclo.EOF = False Then
                    
                    Set TBproducao = CreateObject("adodb.recordset")
                    TBproducao.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data = '" & Format(APLista.SelectedItem.ListSubItems(10), "Short Date") & "' and Tempoinicio = '" & APLista.SelectedItem.ListSubItems(3) & "' and CodigoDesc = " & APLista.SelectedItem.ListSubItems(1), Conexao, adOpenKeyset, adLockOptimistic
                    If TBproducao.EOF = False Then
                        TBCiclo.Find ("IDproducao = " & TBproducao!IDProducao)
                    End If
                    TBproducao.Close
                    
                    'Verificar se tem parecer do controle da qualidade
                    If FunVerifNCRejeitado(TBOS!IDProducao) = True Then ParecerCQ = "Rejeitar" Else ParecerCQ = "Nada consta"
                    If IsNull(TBCiclo!Reprovada) = False And TBCiclo!Reprovada <> 0 Then
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select * from CQ_NC_FABRICA where IDProducao = " & TBCiclo!IDProducao & " and PARECERCQ IS NOT NULL and PARECERCQ <> '" & ParecerCQ & "' and Analizada = 1", Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            USMsgBox ("Não é permitido excluir este apontamento, pois o mesmo já possui a disposição do controle de qualidade na Ordem: " & TBOS!Ordem & " - OS: " & TBOS!IDProducao & "."), vbExclamation, "CAPRIND v5.0"
                            TBproducao.Close
                            Exit Sub
                        End If
                        TBproducao.Close
                    End If
            
                    'Verificar se tem paracer do controle da qualidade no evento anterior
                    TBCiclo.MovePrevious
                    If TBCiclo.BOF = False Then
                        ULTICOD = TBCiclo!CodigoDesc
                        If IsNull(TBCiclo!Reprovada) = False And TBCiclo!Reprovada <> 0 Then
                            Set TBproducao = CreateObject("adodb.recordset")
                            TBproducao.Open "Select * from CQ_NC_FABRICA where IDProducao = " & TBCiclo!IDProducao & " and PARECERCQ IS NOT NULL and PARECERCQ <> '" & ParecerCQ & "' and Analizada = 1", Conexao, adOpenKeyset, adLockOptimistic
                            If TBproducao.EOF = False Then
                                USMsgBox ("Não é permitido excluir este apontamento, pois o evento anterior possui a disposição do controle de qualidade na Ordem: " & TBOS!Ordem & " - OS: " & TBOS!IDProducao & "."), vbExclamation, "CAPRIND v5.0"
                                TBproducao.Close
                                TBCiclo.Close
                                Exit Sub
                            End If
                            TBproducao.Close
                        End If
                    Else
                        ULTICOD = 0
                    End If
                    
                    If EventoAP = 3 Then Conexao.Execute "Update Producao Set pronta = 'NÃO', dataentrega = Null, concluida = 'False' where Ordem = " & TBOS!Ordem
                    If EventoAP <> 0 Then
                        'Exclui não conformidade da tabela CQ_NC_FABRICA
                        If TBCiclo.BOF = False Then
                               Conexao.Execute "DELETE from ProducaoFases_Codigos where IDProducao = " & Lista.SelectedItem & " or IDProducao = " & TBCiclo!IDProducao
                               Conexao.Execute "DELETE from CQ_NC_FABRICA_Serie where IDProducao = " & Lista.SelectedItem & " or IDProducao = " & TBCiclo!IDProducao
                               Conexao.Execute "DELETE from CQ_NC_FABRICA where IDProducao = " & Lista.SelectedItem & " or IDProducao = " & TBCiclo!IDProducao
                        End If

                        TBCiclo.MoveNext
                        
                        'Informa turno
                        Turno = TBCiclo!Turno
                        
                        'Informa dados do evento anterior
                        TBCiclo.MovePrevious
                        If TBCiclo.BOF = True Then TBCiclo.MoveNext
                        PenultimoMaq = TBCiclo!maquina
                        Penultimo = TBCiclo!CodigoDesc
                        PenultimoDesc = TBCiclo!Descricao
                        Dataini = TBCiclo!Data
                        Dias = IIf(IsNull(TBCiclo!Dias), 0, TBCiclo!Dias)
                        
                        'Dados do estoque
                        ExcluirAP = True
                        TOK = IIf(IsNull(TBCiclo!quantidade), 0, TBCiclo!quantidade)
                        TNC = IIf(IsNull(TBCiclo!Reprovada), 0, TBCiclo!Reprovada)
                        'Retirar aqui depois por causa do apontamento quebrado da glasscolor
                        
                        qtdeOK = IIf(IsNull(TBCiclo!quantidade), 0, TBCiclo!quantidade)
                        qtdeNC = IIf(IsNull(TBCiclo!Reprovada), 0, TBCiclo!Reprovada)
                        txtTOK.Text = IIf(IsNull(TBCiclo!quantidade), 0, TBCiclo!quantidade)
                        txtTNC.Text = IIf(IsNull(TBCiclo!quantidade), 0, TBCiclo!quantidade)
                        
                        If qtdeOK <> 0 Or qtdeNC <> 0 Then
                            Set TBOrdem = CreateObject("adodb.recordset")
                            TBOrdem.Open "Select * from producao where Ordem = " & TBCiclo!Ordem & " and (Entrar_estoque = 1 or Retirar_estoque = 1)", Conexao, adOpenKeyset, adLockOptimistic
                            If TBOrdem.EOF = False Then
                                Set TBCFOP = CreateObject("adodb.recordset")
                                TBCFOP.Open "Select * from ordemservico where Ordem = " & TBOrdem!Ordem & " order by fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
                                If TBCFOP.EOF = False Then
                                    If TBOrdem!Retirar_estoque = True Then 'Verfica se é a primeira OS e retira o material do estoque
                                        TBCFOP.MoveFirst
                                        If TBCFOP!IDProducao = TBCiclo!OS Then ProcRetirarCancelarEstoque
                                    End If
                                    'If TBOrdem!Entrar_estoque = True Then 'Verfica se é a última OS e entra com o produto no estoque
                                    '    TBCFOP.MoveLast
                                    '    If TBCFOP!IDProducao = TBCiclo!OS Then ProcEntrarCancelarEstoque
                                    'End If
                                End If
                            End If
                            TBOrdem.Close
                        End If
                        
                        TBCiclo!TempoFinal = "00:00:00"
                        TBCiclo!TempoTotal = "00:00:00"
                        TBCiclo!TempoTotalSeg = 0
                        TBCiclo!quantidade = 0
                        TBCiclo!Reprovada = 0
                        TBCiclo!Dias = 0
                        Descricao = TBCiclo!CodigoDesc
                        IDProducao = TBCiclo!IDProducao
                        TBCiclo.Update
                    End If
                    
                    TBCiclo.MoveNext
                    If TBCiclo.EOF = False Then
                        'Verif. se o evento excluído está no meio de outros, se estiver no meio corrige dados do apontamento anterior
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(TBCiclo!Data, "Short Date") & "' and Tempoinicio < '" & TBCiclo!TempoInicio & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            TBproducao.MoveLast
                            TBCiclo.MoveNext
                            If TBCiclo.EOF = False Then
                                TBproducao!TempoFinal = TBCiclo!TempoInicio
                                TempoInicio = TBproducao!TempoInicio
                                TempoFinal = TBproducao!TempoFinal
                                TempoTotal = TempoFinal - TempoInicio
                                ElapsedTime (TempoTotal)
                                TempoTotal = Format(TempoTotal, "hh:mm:ss")
                                TBproducao!TempoTotal = TempoTotal
                                TBproducao!TempoTotalSeg = s
                                TBproducao!Dias = D
                                TBproducao.Update
                            End If
                        End If
                        TBproducao.Close
                    End If
                    
                    TBCiclo.MovePrevious
                    If TBCiclo.BOF = False Then
                        Conexao.Execute "Update Manutencao_data Set status = 'Aberta',IDproducao = 0 where idproducao = " & TBCiclo!IDProducao
                        
                        

                        Conexao.Execute "DELETE from ProducaoFases_Codigos where IDProducao = " & TBCiclo!IDProducao
                        
                                                
                        '=====================================================================
                        ' Apaga o apontamento
                        '=====================================================================
                        Conexao.Execute "DELETE from " & NomeTabelaAp & " WHERE IDProducao = " & TBCiclo!IDProducao
                        '=====================================================================
                        ' Exclui a entrada no estoque
                        '=====================================================================
                        ProcExcluirEntradaEstoque
                        '=====================================================================

                        
                        '==================================
                        Modulo = "PCP/Gerenciamento de ordem"
                        Evento = "Excluir evento"
                        ID_documento = TBCiclo!IDProducao
                        Documento = "Ordem: " & TBOS!Ordem & " - Cód. interno: " & TBOS!Desenho
                        Documento1 = "OS: " & TBOS!IDProducao & " - Evento: " & txtCodigo
                        ProcGravaEvento
                        '==================================
                        
                    End If
                End If
                TBCiclo.Close
        
                'Localiza na tabela producaofases todos os registros desta of, maquina, fase e muda pronta = não
                Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'NÃO' where idfase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "'"
                'Localiza na tabela a ordem de servico todos os registros desta maquina, Ordem e muda pronta = não
                Conexao.Execute "Update ordemservico Set pronto = 'NÃO' where idproducao = " & TBOS!IDProducao
                
                TBOS.MoveNext
            Loop
        End If
        TBOS.Close
        
        ProcVerificaTurno
    
        'Atualiza lista de eventos cadastrados
        'ProcAtualizaProducao
        ProcAtualizaPrepExecUtilTotalizacao
        ProcAtualizaPrepExecUtilTotalizacaoMaq
        ProcAtualizaPrepExecUtil
        
        ProcAtualizaOF
        
        'Grava o status da OS e da OF
        ProcGravarStatusOSOF
        
        If Txt_ID_apontamento <> "" Then
            TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
        Else
            TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDproducao = " & cmbAPOS & " and P.DtValidacao_custo IS NULL"
        End If
        Set TBOS = CreateObject("adodb.recordset")
        TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
        If TBOS.EOF = False Then
            Do While TBOS.EOF = False
                'Verifica se a máquina está sendo utilizada na OS
                Set TBCiclo = CreateObject("adodb.recordset")
                TBCiclo.Open "Select IDProducao from " & NomeTabelaAp & " where OS = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "'", Conexao, adOpenKeyset, adLockOptimistic
                If TBCiclo.EOF = True Then
                    Conexao.Execute "DELETE from Ordemservico_maq_utilizadas where OS = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina & "'"
                End If
                
                'Verifica se existe algum apontamento (totalização) na OS
                Set TBCiclo = CreateObject("adodb.recordset")
                TBCiclo.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and Turno = " & Turno & " and data = '" & Format(Dataini, "Short Date") & "' and (codigodesc = 1 or codigodesc = 2)", Conexao, adOpenKeyset, adLockOptimistic
                If TBCiclo.EOF = True Then
                    Conexao.Execute "DELETE from " & NomeTabelaApTotalizacao & " where OS = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and Turno = " & Turno & " and data = '" & Format(Dataini, "Short Date") & "'"
                End If
                TBCiclo.Close
                
                TBOS.MoveNext
            Loop
        End If
        TBOS.Close
        
        'Acerta cadastro na máquina
        ProcAcertaCadMaquina
        'Calcula e grava valor real do lote e por peça
        ProcGravaValoresOS
        
        USMsgBox ("Evento excluído com sucesso."), vbInformation, "CAPRIND v5.0"
        If APLista.ListItems.Count = 0 Then txtTurno.Text = ""
        maquina = txtAPMaquina
        ProcAPabrir
        txtAPMaquina = maquina
        cmdAPOS_Click
        ProcLimpaCamposNovoAP False
        Frame15.Enabled = False
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcExcluirEntradaEstoque()
On Error GoTo tratar_erro

Conexao.Execute ("Delete from estoque_Movimentacao where IDApontamento = '" & IDProducao & "'")

'===============================================
' Verifica se não existem mais apontamento e exclui a ficha de estoque (RE)
'==============================================================================
Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select * from ProducaoFases where OS = '" & cmbAPOS.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBItem.EOF = True Then
    Conexao.Execute ("Delete from estoque_Controle where Lote = '" & txtof.Text & "'")
End If
TBItem.Close


Exit Sub
tratar_erro:
    MsgBox ("Descrição do erro : " + Error()), vbCritical
    Exit Sub
End Sub

Private Sub ProcExecutarEntradaEstoque()
On Error GoTo tratar_erro

ValorTotal = 0
quantestoque = 0

'============================================================================
' Verifica se o item controla estoque e busca unidade do produto, familia
'============================================================================
Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select * from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBItem.EOF = False Then
    If TBItem!Estoque = True Then
        ControlaEstoque = True
    Else
        ControlaEstoque = False
    End If
    
    Un = TBItem!Unidade
    Familia = TBItem!Classe
End If
TBItem.Close

'================================================
' Se o item fro submetido a estoque
'================================================
If ControlaEstoque = True Then
'================================================
' Busca local de armazanamento padrão
'================================================
LATexto = "ESTOQUE PADRÃO"

Set TBCFOP = CreateObject("adodb.recordset")
TBCFOP.Open "SELECT Descricao FROM Estoque_Localarmazenamento_criar WHERE PadraoOrdem = 'True'", Conexao, adOpenKeyset, adLockReadOnly
If TBCFOP.EOF = False Then
    LATexto = TBCFOP!Descricao
Else
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select ELAC.Descricao FROM Estoque_Localarmazenamento_criar ELAC INNER JOIN Estoque_Localarmazenamento ELA ON ELA.idemb_locarm = ELAC.id where ELA.codinterno = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockReadOnly
    If TBCFOP.EOF = False Then LATexto = TBCFOP!Descricao
End If
TBCFOP.Close

Permitido = False

'================================================
' Busca ficha de estoque
'================================================
Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select * from estoque_controle where ID_empresa = " & TBOrdem!ID_empresa & " and lote = '" & TBOrdem!Ordem & "'", Conexao, adOpenKeyset, adLockOptimistic
'If ExcluirAP = False Or TBEstoque.EOF = False And ExcluirAP = True Then Permitido = True

'If Permitido = True Then
    If TBEstoque.EOF = True Then
    TBEstoque.AddNew 'Cria ficha de estoque se não houver
    TBEstoque!Un = Un
    TBEstoque!Classe = Familia
    TBEstoque!ID_empresa = TBOrdem!ID_empresa
    TBEstoque!LOTE = TBOrdem!Ordem
    TBEstoque!Desenho = TBOrdem!Desenho
    TBEstoque!Descricao = TBOrdem!Produto
    TBEstoque!Data = Date
    TBEstoque!Responsavel = Operador
    TBEstoque!Certificado = 0
    TBEstoque!Corrida = 0
    TBEstoque!status = "ENTRADA_ORDEM"
    TBEstoque!ID_Cliente = IIf(IsNull(TBOrdem!IDCliente), 0, TBOrdem!IDCliente)
    TBEstoque!Cliente = IIf(IsNull(TBOrdem!Cliente), "", TBOrdem!Cliente)
    TBEstoque!local_armaz = LATexto
    TBEstoque.Update
    End If
'=======================================================
' Busca o ID do evento Produzindo anterior
'=======================================================
IDApontamento = 0
Set TBCiclo = CreateObject("adodb.recordset")
TBCiclo.Open "Select * from ProducaoFases where OS = " & Txt_OS.Text & " and Maquina = '" & txtmaquina & "' and usuario = '" & Operador & "' and CodigoDesc = '2' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
If TBCiclo.EOF = False Then
    TBCiclo.MoveLast
    IDApontamento = TBCiclo!IDProducao
End If

'=======================================================
' Realiza a entrada no estoque movimentação
'=======================================================
    Set TBProduto = CreateObject("adodb.recordset")
    StrSql = "Select * from Estoque_movimentacao where IDApontamento = '" & IDApontamento & "'"
    
    TBProduto.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
    
    TBProduto.AddNew
    TBProduto!Destino = "Interno"
    TBProduto!Terceiros = False
    TBProduto!IDApontamento = IDApontamento
    TBProduto!LOTE = TBOrdem!Ordem
    TBProduto!Documento = TBOrdem!Ordem
    TBProduto!Desenho = TBOrdem!Desenho
    TBProduto!Familia = Familia
    TBProduto!Descricao = TBOrdem!Produto
    TBProduto!Data = Date
    TBProduto!Responsavel = Operador
    TBProduto!Entrada = QT_Entrada_Estoque 'Entrada
    TBProduto!Entrada_PC = QT_Entrada_Estoque 'Entrada
    TBProduto!Operacao = "ENTRADA_ORDEM"
    TBProduto!IDEstoque = TBEstoque!IDEstoque
    TBProduto.Update
    
'====================================================================
' Verifica empenho para vendas
'====================================================================
    ProcEmpenharREAutomOrdem TBEstoque!IDEstoque, Entrada, TBEstoque!LOTE, Date, Operador, TBOrdem!Desenho, ExcluirAP
'====================================================================
'Exclui o empenho no produto em estoque para o pedido
    Conexao.Execute "DELETE from Estoque_Controle_Empenho_Vendas where ID_estoque = " & TBProduto!IDEstoque
    ProcEmpenhaProdutoeAtualQtdeEntEmpOrdem TBProduto!LOTE, TBProduto!Desenho, TBEstoque!estoque_real, TBProduto!IDEstoque
'====================================================================
' Corrigir estoque para vendas
'====================================================================

qtdeliberada = 0
QtdeSaida = 0
QtdeEstoque = 0
    
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select * from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDEstoque, Conexao, adOpenKeyset, adLockOptimistic
        If TBProduto.EOF = True Then
            TBEstoque.Delete
        Else
            Set TBProduto = CreateObject("adodb.recordset")
            TBProduto.Open "Select Sum(ISNULL(Entrada, 0)) as qtdeliberada, Sum(ISNULL(Saida, 0)) as QtdeSaida from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDEstoque, Conexao, adOpenKeyset, adLockOptimistic
            If TBProduto.EOF = False Then
                qtdeliberada = IIf(IsNull(TBProduto!qtdeliberada), 0, TBProduto!qtdeliberada)
                QtdeSaida = IIf(IsNull(TBProduto!QtdeSaida), 0, TBProduto!QtdeSaida)
                NovoValor = Replace(qtdeliberada - QtdeSaida, ",", ".")
                Conexao.Execute "Update Estoque_movimentacao Set estoque_venda = " & NovoValor & " where IDestoque = " & TBEstoque!IDEstoque & " and Lote = '" & TBOrdem!Ordem & "' and Data = '" & Format(Date, "Short Date") & "' and Responsavel = '" & Operador & "' and (Operacao = 'ENTRADA_ORDEM' or Operacao = 'ENTRADA_ORDEM_PARCIAL')"
            End If
        End If

    TBProduto.Close
End If
TBEstoque.Close
'End If


Exit Sub
tratar_erro:
    MsgBox ("Descrição do erro : " + Error()), vbCritical
    Exit Sub
End Sub

Private Sub ProcDesvincularOS()
On Error GoTo tratar_erro

If cmbAPOS = "" Then Exit Sub
If Txt_ID_apontamento <> "" Then
    If USMsgBox("Deseja realmente desvincular a OS " & cmbAPOS & " deste apontamento simultâneo?", vbYesNo, "CAPRIND v5.0") = vbYes Then
        If txtDtValidacao = "" Then
            USMsgBox ("Não é possivel desvincular OS, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
            Exit Sub
        End If
        'Verifica se o resultado da ordem foi validado
        Set TBOSC = CreateObject("adodb.recordset")
        TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
        If TBOSC.EOF = False Then
            USMsgBox ("Não é permitido desvincular a os deste apontamento, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
            TBOSC.Close
            Exit Sub
        End If
        TBOSC.Close
        
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select OS.IDProducao, OS.ID_apontamento, OS.Ordem, P.Desenho from ordemservico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDProducao = " & cmbAPOS, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from ordemservico where IDProducao <> " & TBAbrir!IDProducao & " and ID_apontamento = " & TBAbrir!ID_apontamento, Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = True Then
                Conexao.Execute "DELETE from ProducaoFases_OS where ID = " & TBAbrir!ID_apontamento
            End If
            TBFIltro.Close
            TBAbrir!ID_apontamento = Null
            TBAbrir.Update
            
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Desvincular OS"
            ID_documento = TBAbrir!IDProducao
            Documento = "Ordem: " & TBAbrir!Ordem & " - Cód. interno: " & TBAbrir!Desenho
            Documento1 = "OS: " & TBAbrir!IDProducao
            ProcGravaEvento
            '==================================
            
        End If
        TBAbrir.Close
        
        USMsgBox ("OS " & cmbAPOS & " desvinculada com sucesso."), vbInformation, "CAPRIND v5.0"
        ProcAPabrir
    End If
Else
    USMsgBox ("Esta OS não esta vinculada a nenhum apontamento simultâeno."), vbExclamation, "CAPRIND v5.0"
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAcertaColeta()
On Error GoTo tratar_erro

Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from " & NomeTabelaAp & " where Ordem = " & txtof, Conexao, adOpenKeyset, adLockOptimistic
 
If TBAbrir.EOF = False Then
QuantidadeNova = Replace(txtQuantidade.Text, ".", "")
QuantidadeNova = Replace(QuantidadeNova, ",", ".")

StrSql = "Update " & NomeTabelaAp & " Set quant = " & QuantidadeNova & " where Ordem = " & txtof.Text
'Debug.print StrSql

    Conexao.Execute StrSql
End If
TBAbrir.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcGravarDadosCarteira()
On Error GoTo tratar_erro

Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select producao_pedidos.*, vendas_carteira.Desenho from producao_pedidos INNER JOIN vendas_carteira ON producao_pedidos.IDCarteira = vendas_carteira.Codigo where producao_pedidos.Ordem = " & txtof & " and vendas_carteira.Desenho = '" & txtdesenho & "' order by producao_pedidos.IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    Do While TBAbrir.EOF = False
        qt = 0
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select Sum(producao.Quant) as Qt FROM Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem where Producao_pedidos.IDCarteira = " & TBAbrir!IDcarteira & " and Producao.Desenho = '" & TBAbrir!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Quant = IIf(IsNull(TBproducao!qt), 0, TBproducao!qt)
        End If
        TBproducao.Close
        
        'Gravar data de criação da ordem na carteira de pedidos
        Set TBCarteira = CreateObject("adodb.recordset")
        TBCarteira.Open "Select * from vendas_carteira where Codigo = " & TBAbrir!IDcarteira, Conexao, adOpenKeyset, adLockOptimistic
        If TBCarteira.EOF = False Then
            TBCarteira!datapcp = txtData_emissao
            If Opt_produto_final.Value = 1 And Quant >= TBCarteira!quantidade Then TBCarteira!OE = True
            TBCarteira.Update
        End If
        TBCarteira.Close
        TBAbrir.MoveNext
    Loop
End If
TBAbrir.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcEnviaDadosOrdem()
On Error GoTo tratar_erro

TBOrdem!IDPROCESSO = IDPROCESSO
TBOrdem!ID_empresa = Cmb_empresa.ItemData(Cmb_empresa.ListIndex)
TBOrdem!Data_cadastro = IIf(txtData = "", Date, txtData)
TBOrdem!Responsavel = IIf(txtResponsavel = "", pubUsuario, txtResponsavel)
TBOrdem!Ordem = txtof.Text
TBOrdem!Quant = txtQuantidade.Text
TBOrdem!PrazoEntrega = mskprazofina.Value
TBOrdem!Data = txtData_emissao
TBOrdem!status = cmbStatus.Text
TBOrdem!Obs = Txt_obs
TBOrdem!Desenho = txtdesenho.Text
TBOrdem!Revitem = txtRevitem
If txtreferencia.Text <> "" Then TBOrdem!N_referencia = txtreferencia.Text
TBOrdem!Produto = txtProduto.Text
TBOrdem!IDCliente = IIf(Txt_ID_cliente = "", 0, Txt_ID_cliente)
TBOrdem!Cliente = IIf(txtCliente.Text = "", Null, txtCliente.Text)
TBOrdem!Codigo_produto = Txt_cod_prod
TBOrdem!Rev_produto = Txt_rev_cod_prod
If Novo_Ordem = True Then TBOrdem!pronta = "NÃO"
If Chk_urgente.Value = 1 Then Urgencia = True Else Urgencia = False
TBOrdem!IMPREQ = Urgencia
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select SubTipoItem,Rastreavel from projproduto where desenho = '" & txtdesenho.Text & "' and SubTipoItem <> 0 and SubTipoItem <> 4", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    If IsNull(TBproducao!SubTipoItem) = False Then
        Select Case TBproducao!SubTipoItem
            Case 1: TBOrdem!Tipo = "E"
            Case 2: TBOrdem!Tipo = "M"
            Case 3: TBOrdem!Tipo = "F"
            Case 5: TBOrdem!Tipo = "S"
        End Select
    End If
End If
If optconsignacao.Value = 1 Then TBOrdem!Consignacao = True Else TBOrdem!Consignacao = False
If OptOSControlada.Value = 1 Then TBOrdem!OSControlada = True Else TBOrdem!OSControlada = False
If Opt_processo_controlado.Value = 1 Then TBOrdem!Processo_controlado = True Else TBOrdem!Processo_controlado = False
If OptReposicao.Value = 1 Then TBOrdem!reposicao = True Else TBOrdem!reposicao = False

If TBproducao!rastreavel = True Then
    chkindividual.Value = 1
    TBOrdem!Individual = True
    'ProcCriarEtiquetas TBOrdem!Ordem, TBOrdem!Quant
Else

    If chkindividual.Value = 0 Then
    'chkIndividual.Value = 0
    TBOrdem!Individual = False
    Else
    TBOrdem!Individual = True
    End If
    
End If

'If Chk_tipo_processo.Value = 1 Then TBOrdem!Tipo_Processo = True Else TBOrdem!Tipo_Processo = False
If Chk_entrar_estoque.Value = 1 Then TBOrdem!Entrar_estoque = True Else TBOrdem!Entrar_estoque = False
If Chk_retirar_estoque.Value = 1 Then TBOrdem!Retirar_estoque = True Else TBOrdem!Retirar_estoque = False

If chkQT_Final.Value = 1 Then
    TBOrdem!QT_Final = True
    StrSql = "update OrdemServico set QT_Final = 'True' where Ordem = '" & txtof.Text & "'"
    Conexao.Execute StrSql
Else
    TBOrdem!QT_Final = False
    StrSql = "update OrdemServico set QT_Final = 'False' where Ordem = '" & txtof.Text & "'"
    Conexao.Execute StrSql
End If


Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcGravar()
On Error GoTo tratar_erro
Dim Requisitado         As Double 'OK
Dim Quantidade_Ordem    As Double 'OK



Desenho = txtdesenho
QuantSolicitado = txtQuantidade
Cliente = txtCliente
ProcBuscaProcesso txtdesenho.Text
Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * FROM Producao WHERE Ordem = " & txtof.Text, Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = True Then
    TBOrdem.AddNew
    ProcEnviaDadosOrdem
    If optconsignacao.Value = 1 Then ProcAcertaRequisicao txtdesenho, txtof, 0, Versao_estrutura, QuantSolicitado, False Else ProcCriarRequisicao
    ProcCriarOrdemServico txtdesenho
    TBOrdem!Concluida = False
    TBOrdem!QTSaldo = True
    TBOrdem!AP_backup = False
    TBOrdem!Impof = 0
    TBOrdem.Update
    ProcGravarDadosCarteira
    USMsgBox ("Nova ordem cadastrada com sucesso."), vbInformation, "CAPRIND v5.0"
    '==================================
    Modulo = "PCP/Gerenciamento de ordem"
    Evento = "Novo"
    ID_documento = txtof
    Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
    Documento1 = ""
    ProcGravaEvento
    '==================================
    'Corrige dados na ordem de serviço
    ProcAcertaOS QuantSolicitado, False
    
    ProcFiltrarPadrao "P.Ordem = " & txtof
    atualiza_lista_ordens (1)
Else
    If FunVerifValidacaoRegistro("alterar", txtDtValidacao, "mesma", "a ordem", False) = False Then Exit Sub
    Desenho = TBOrdem!Desenho
    
    If Desenho <> txtdesenho Then
        If ProcVerifExclusaoValidDaOrdem(TBOrdem!Ordem, Desenho, True, "alterar o código interno desta") = False Then Exit Sub
    End If
    
    If QuantSolicitado <> TBOrdem!Quant Then
        'Verifica se existe empenho para a ordem
        Familiatext = ""
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Idestoque from Producao_NF_Consignada where Ordem = " & TBOrdem!Ordem & " order by Idestoque", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Do While TBAbrir.EOF = False
                If Familiatext = "" Then Familiatext = TBAbrir!IDEstoque Else Familiatext = Familiatext & " | " & TBAbrir!IDEstoque
                TBAbrir.MoveNext
            Loop
            USMsgBox ("Não é permitido alterar a quantidade dessa ordem, pois a mesma está empenhando o estoque (RE: " & Familiatext & ")."), vbExclamation, "CAPRIND v5.0"
            Exit Sub
        End If
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select ID from Producao_etiquetas where Ordem = " & TBOrdem!Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            MRP_Qtcopias_Etiq = 0
            Conexao.Execute "DELETE from Producao_etiquetas where Ordem = " & TBOrdem!Ordem
            ProcCriarEtiquetas TBOrdem!Ordem, txtQuantidade
        End If
    End If
    
    Valido = False
    
    If OptOSControlada.Value = 1 And TBOrdem!OSControlada = False Or OptOSControlada.Value = 0 And TBOrdem!OSControlada = True Then Valido = True
    If Opt_processo_controlado.Value = 1 And TBOrdem!Processo_controlado = False Or Opt_processo_controlado.Value = 0 And TBOrdem!Processo_controlado = True Then Valido = True
    If mskprazofina <> TBOrdem!PrazoEntrega Then ProcDefinirPrazosOS TBOrdem!Ordem, mskprazofina.Value, False
    
    If Desenho <> txtdesenho Then
        'Deleta a estrutura de material da ordem e cria novamente
        Conexao.Execute "DELETE from producaomaterial where Ordem = " & TBOrdem!Ordem
        Versao_estrutura = "A"
        ProcAcertaRequisicao txtdesenho, TBOrdem!Ordem, 0, Versao_estrutura, QuantSolicitado, False
    End If
    If QuantSolicitado <> TBOrdem!Quant Then
        Valido = True
        ProcAtualizaRequisicaoOrdem TBOrdem!Ordem, TBOrdem!Quant, QuantSolicitado, False
    End If
    
    'Atualiza status das OS's e da Ordem
    Permitido2 = False
    If cmbStatus <> TBOrdem!status Then Permitido2 = True
    
    ProcEnviaDadosOrdem
    TBOrdem.Update
    
    'Atualiza status das OS's e da Ordem
    If Permitido2 = True Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from ordemservico where Ordem = " & TBOrdem!Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Do While TBAbrir.EOF = False
                ProcAlterarStatusOS1 TBAbrir!IDProducao, TBAbrir!Pronto, cmbStatus
                TBAbrir.MoveNext
            Loop
        End If
        TBAbrir.Close
        ProcAlterarStatusOrdem1 TBOrdem!Ordem
    End If
    
    ProcAcertaColeta
    'Deleta OS da ordem
    If Desenho <> txtdesenho Then
        Conexao.Execute "DELETE from ordemservico where Ordem = " & TBOrdem!Ordem
        ProcCriarOrdemServico txtdesenho
    End If
    If Valido = True Then
        'Corrige dados na ordem de serviço
        ProcAcertaOS QuantSolicitado, False
    End If
            
    'Verifica se a ordem é do produto vendido e atualiza qtde. expedida conforme status da ordem, grava data e qtde expedida na carteira
    Set TBFIltro = CreateObject("adodb.recordset")
    TBFIltro.Open "Select * from producao_pedidos where Ordem = " & TBOrdem!Ordem & " order by IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
    If TBFIltro.EOF = False Then
        Do While TBFIltro.EOF = False
            Set TBCarteira = CreateObject("adodb.recordset")
            TBCarteira.Open "Select * from vendas_carteira where codigo = " & TBFIltro!IDcarteira & " and Desenho = '" & txtdesenho & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBCarteira.EOF = False Then
                'MRP
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * FROM Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem where Producao_pedidos.IDCarteira = " & TBFIltro!IDcarteira & " and Producao.Desenho = '" & txtdesenho & "' and Producao.Status <> 'Cancelada'", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    TextoFiltro = "OE = 'True'"
                Else
                    TextoFiltro = "OE = 'False'"
                End If
                Conexao.Execute "Update vendas_carteira Set " & TextoFiltro & " where Codigo = " & TBFIltro!IDcarteira
                TBAbrir.Close
            End If
            TBCarteira.Close
            TBFIltro.MoveNext
        Loop
    End If
    TBFIltro.Close
    
    'Atualiza status de saída do material
    Set TBMateriaprima = CreateObject("adodb.recordset")
    TBMateriaprima.Open "Select * from producaomaterial where Ordem = " & TBOrdem!Ordem & " and Saida <> 'CANCEL.' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
    If TBMateriaprima.EOF = False Then
        Do While TBMateriaprima.EOF = False
            Qtde = TBMateriaprima!Requisitado
            QtdeSaida = 0
            Set TBEstoque = CreateObject("adodb.recordset")
            TBEstoque.Open "Select Sum(Saida) as QtdeSaida FROM Estoque_movimentacao where OE = '" & TBOrdem!Ordem & "' and Desenho = '" & TBMateriaprima!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
            If TBEstoque.EOF = False Then
                QtdeSaida = IIf(IsNull(TBEstoque!QtdeSaida), 0, TBEstoque!QtdeSaida)
            End If
            TBEstoque.Close
            If QtdeSaida <> 0 Then
                If QtdeSaida < Qtde Then TBMateriaprima!Saida = "PARCIAL" Else TBMateriaprima!Saida = "SIM"
            Else
                TBMateriaprima!Saida = "NÃO"
            End If
            TBMateriaprima.Update
            TBMateriaprima.MoveNext
        Loop
    End If
    TBMateriaprima.Close
    
    USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
    
    atualiza_lista_ordens (IIf(ReturnNumbersOnly(Left(lblPaginas.Caption, Len(lblPaginas.Caption) - 5)) <= 1, 1, ReturnNumbersOnly(Left(lblPaginas.Caption, Len(lblPaginas.Caption) - 5))))
        
    '==================================
    Modulo = "PCP/Gerenciamento de ordem"
    Evento = "Alterar"
    ID_documento = TBOrdem!Ordem
    Documento = "Ordem: " & TBOrdem!Ordem & " - Cód. interno: " & txtdesenho
    Documento1 = ""
    ProcGravaEvento
    '==================================
End If

If chkindividual.Value = 1 Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select ID from Producao_etiquetas where Ordem = " & TBOrdem!Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = True Then
            MRP_Qtcopias_Etiq = 0
            ProcCriarEtiquetas TBOrdem!Ordem, txtQuantidade
        End If
End If

Novo_Ordem = False
Ordem = TBOrdem!Ordem
ProcLimpar True
ProcCarregaOrdem

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizaRequisicaoOrdem(Ordem As Long, Qtde_antiga As Double, Qtde_nova As Double, CancelarMRP As Boolean)
On Error GoTo tratar_erro

Set TBMaterial = CreateObject("adodb.recordset")
TBMaterial.Open "Select PM.*, P.un_kg as Un_kg, PC.un_kg as Un_kg_conj, P.PBruto, P.SubTipoItem from (((producaomaterial PM INNER JOIN projproduto P ON P.Desenho = PM.Codigo) INNER JOIN Producao PR ON PR.Ordem = PM.Ordem) INNER JOIN projproduto P1 ON P1.Desenho = PR.Desenho) LEFT JOIN Projconjunto PC ON PC.codproduto = P1.Codproduto and PC.Desenho = PM.Codigo and PC.Versao = PM.Versao where PM.Ordem = " & Ordem, Conexao, adOpenKeyset, adLockOptimistic
If TBMaterial.EOF = False Then
    Do While TBMaterial.EOF = False
        
        QuantSolicitado = Qtde_nova
        
        If CancelarMRP = True Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select Quantidade, Quantidade_PC from Producao_NF_Consignada where Ordem = " & Ordem & " and Codinterno = '" & TBMaterial!CODIGO & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                quantidade = TBMaterial!Requisitado
                Qtde_nova = IIf(IsNull(TBMaterial!Total_pc), 0, TBMaterial!Total_pc)
                Do While TBFIltro.EOF = False
                    If quantidade > TBFIltro!quantidade Then
                        quantidade = quantidade - TBFIltro!quantidade
                        Qtde_nova = Qtde_nova - TBFIltro!Quantidade_PC
                        TBFIltro!quantidade = 0
                        TBFIltro!Quantidade_PC = 0
                    Else
                        TBFIltro!quantidade = TBFIltro!quantidade - quantidade
                        TBFIltro!Quantidade_PC = TBFIltro!Quantidade_PC - Qtde_nova
                        quantidade = 0
                        Qtde_nova = 0
                    End If
                    TBFIltro.Update
                    TBFIltro.MoveNext
                Loop
            End If
            TBFIltro.Close
        End If
        
        quantidade = TBMaterial!quantidade / Qtde_antiga
        PesoTotal = TBMaterial!PesoTotal / Qtde_antiga
        
        Peso = quantidade
        If IsNull(TBMaterial!Un_kg_conj) = False And TBMaterial!Un_kg_conj <> "N/a" And TBMaterial!Un_kg_conj <> "" Or IsNull(TBMaterial!Un_kg_conj) = True And TBMaterial!Un_Kg <> "N/a" And TBMaterial!Un_Kg <> "" And (TBMaterial!Unidade = "KG" Or TBMaterial!Unidade = "MT" Or TBMaterial!Unidade = "MM" Or TBMaterial!Unidade = "M³") Then
            Select Case TBMaterial!Unidade
                Case "KG": Peso = TBMaterial!PesoTotal / Qtde_antiga
                Case "MT": Peso = (TBMaterial!Dimensao / 1000) * quantidade
                Case "MM": Peso = TBMaterial!Dimensao * quantidade
                Case "M³": Peso = TBMaterial!pesounidade
            End Select
        End If
        
        If TBMaterial!Unidade = "M³" Then
            TBMaterial!Requisitado = Peso * txtQuantidade
            TBMaterial!DimensaoTotal = TBMaterial!Dimensao
            TBMaterial!Total_pc = TBMaterial!quantidade
        Else
            TBMaterial!Requisitado = Format(Peso * Qtde_nova, "###,##0.0000")
            TBMaterial!quantidade = quantidade * Qtde_nova
            TBMaterial!PesoTotal = PesoTotal * Qtde_nova
            If TBMaterial!Un_Kg = "Mt²" Then TBMaterial!DimensaoTotal = ((TBMaterial!Dimensao / 1000) / 1000) * TBMaterial!quantidade Else TBMaterial!DimensaoTotal = (TBMaterial!Dimensao / 1000) * TBMaterial!quantidade
            If TBMaterial!Unidade = "KG" Or TBMaterial!SubTipoItem = 1 Or TBMaterial!SubTipoItem = 2 Or TBMaterial!SubTipoItem = 3 Then
                If TBMaterial!Unidade = "KG" And (TBMaterial!Un_Kg = "Mt²" Or TBMaterial!Un_Kg = "Mt/L") Then
                    If IsNull(TBMaterial!PBruto) = False And TBMaterial!PBruto > 0 And TBMaterial!PBruto <> "" Then TBMaterial!Total_pc = Format(TBMaterial!Requisitado / TBMaterial!PBruto, "###,##0.0000") Else TBMaterial!Total_pc = Null
                Else
                    If TBMaterial!Unidade = "PÇ" Or TBMaterial!Unidade = "PC" Or TBMaterial!Unidade = "UN" Or TBMaterial!Unidade = "CJ" Then TBMaterial!Total_pc = TBMaterial!Requisitado Else TBMaterial!Total_pc = Null
                End If
            End If
        End If
        TBMaterial.Update
        
        'Corrige quantidade empenhada
        If CancelarMRP = True Then
            Set TBEstoque = CreateObject("adodb.recordset")
            TBEstoque.Open "Select EC.IDestoque, EC.estoque_real - ((ISNULL(EE.Qtde_empenhada, 0) + ISNULL(PNFC.Quantidade, 0)) - (ISNULL(EE.Qtde_saida, 0) + ISNULL(PNFC.Qtde_saida, 0))) as TotalEstoque from (Estoque_controle EC LEFT JOIN Estoque_Controle_Empenho_Vendas EE ON EE.ID_estoque = EC.IDestoque) LEFT JOIN Producao_NF_Consignada PNFC ON PNFC.IDestoque = EC.IDestoque where PNFC.Ordem = " & Ordem & " and PNFC.Codinterno = '" & TBMaterial!CODIGO & "' and ((EC.Estoque_real - (ISNULL(EE.Qtde_empenhada, 0) + ISNULL(PNFC.Quantidade, 0))) - (ISNULL(EE.Qtde_saida, 0) + ISNULL(PNFC.Qtde_saida, 0)) > 0) order by EC.Data", Conexao, adOpenKeyset, adLockOptimistic
            Do While TBEstoque.EOF = False And QuantSolicitado > 0
                Set TBTempo = CreateObject("adodb.recordset")
                TBTempo.Open "Select PM.Ordem, PM.Requisitado - (ISNULL(QSEP.Saida, 0) + ISNULL(QEPD.Qtde_empenhar, 0)) AS Requisitado from (Producaomaterial PM LEFT JOIN Qtde_saida_estoque_produto QSEP ON QSEP.Ordem = PM.Ordem and QSEP.Desenho = PM.Codigo) LEFT JOIN Qtde_empenhada_produto_detalhado QEPD ON QEPD.Ordem = PM.Ordem and QEPD.Codinterno = PM.Codigo where PM.Ordem = " & Ordem & " AND PM.Codigo = '" & TBMaterial!CODIGO & "' and PM.Saida <> 'SIM' and PM.Requisitado - (ISNULL(QSEP.Saida, 0) + ISNULL(QEPD.Qtde_empenhar, 0)) > 0", Conexao, adOpenKeyset, adLockOptimistic
                If TBTempo.EOF = False Then
                    Qtde_estoque = TBEstoque!TotalEstoque
                    Do While TBTempo.EOF = False And Qtde_estoque > 0 And QuantSolicitado > 0
                        Set TBGravar = CreateObject("adodb.recordset")
                        TBGravar.Open "Select * from Producao_NF_Consignada where Data = '" & Date & "' and Responsavel = '" & pubUsuario & "' and Ordem = " & TBTempo!Ordem & " and IDestoque = " & TBEstoque!IDEstoque, Conexao, adOpenKeyset, adLockOptimistic
                        If TBGravar.EOF = True Then TBGravar.AddNew
                        TBGravar!Data = Date
                        TBGravar!Responsavel = pubUsuario
                        TBGravar!Ordem = TBTempo!Ordem
                        TBGravar!Codinterno = TBMaterial!CODIGO
                        TBGravar!IDEstoque = TBEstoque!IDEstoque
                        If Qtde_estoque > TBTempo!Requisitado Then
                            TBGravar!quantidade = TBGravar!quantidade + TBTempo!Requisitado
                            Qtde_estoque = Qtde_estoque - TBTempo!Requisitado
                            QuantSolicitado = QuantSolicitado - TBTempo!Requisitado
                        Else
                            TBGravar!quantidade = TBGravar!quantidade + Qtde_estoque
                            QuantSolicitado = QuantSolicitado - Qtde_estoque
                            Qtde_estoque = 0
                        End If
                        TBGravar!Quantidade_PC = TBGravar!quantidade
                        
                        TBGravar.Update
                        TBTempo.MoveNext
                    Loop
                End If
                TBTempo.Close
                TBEstoque.MoveNext
            Loop
        End If
        
        TBMaterial.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Private Sub ProcGerarOrdem(CodprodutoAntigo As Long)
On Error GoTo tratar_erro

Codproduto = TBControleNF!Codproduto
Leadtime = IIf(IsNull(TBControleNF!Leadtime), 0, TBControleNF!Leadtime)
SubTipoItem = IIf(IsNull(TBControleNF!SubTipoItem), 0, TBControleNF!SubTipoItem)
'QuantSolicitado = Format(QuantSolicitado, "#00")
QuantSolicitado = ProcVerifQtdLoteMinimo(TBControleNF!Desenho, QuantSolicitado, TBCarteira!ID_empresa, False) 'Format(ProcVerifQtdLoteMinimo(TBControleNF!Desenho, QuantSolicitado, TBCarteira!ID_empresa, False), "#0")

Cliente = ""
If TemEstoque(QuantSolicitado, OrdemEmpenho) = False Then
        
    OF = ProcCriarNumeroOrdem
    If Agrupar_ordem = True Then
        TextoFiltro = "Select P.* from Producao P LEFT JOIN ProducaoFases PF ON PF.Ordem = P.Ordem where P.desenho = '" & TBControleNF!Desenho & "' and PF.Ordem IS NULL and P.Concluida = 'False' and (P.data = '" & Date & "' or P.data < '" & Date & "') and (P.Impof = 0 or P.Impof IS NULL)"
    Else
        TextoFiltro = "Select * from producao where Ordem = " & OF
    End If
        
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = True Then
        TBproducao.AddNew
        TBproducao!Ordem = OF
        TBproducao!status = "Aberta"
        TBproducao!Data_cadastro = Date
        TBproducao!Responsavel = pubUsuario
        If Imprimir = True And (MRP_Imprimir_Ordem = True Or MRP_Imprimir_Ordem_RM = True Or MRP_Imprimir_Ordem_RM_Res = True Or MRP_Imprimir_Ordem_APM = True Or MRP_Imprimir_Ordem_APM = True) Then TBproducao!Impof = 1 Else TBproducao!Impof = 0
        
        'Verifica se o item possui antecipação da produção
        Set TBProduto = CreateObject("adodb.recordset")
        TBProduto.Open "Select Dias_antecipacao from projproduto where desenho = '" & TBControleNF!Desenho & "' and Dias_antecipacao IS NOT NULL and Dias_antecipacao <> 0", Conexao, adOpenKeyset, adLockOptimistic
        If TBProduto.EOF = False Then
            TBproducao!PrazoEntrega = FunDefinirPrazoAntecipacao(TBProduto!Dias_antecipacao, IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date))
        Else
            TBproducao!PrazoEntrega = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) 'Prazo previsto para entrega
        End If
        TBProduto.Close
    Else
        OF = TBproducao!Ordem
        If IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) < TBproducao!PrazoEntrega Then TBproducao!PrazoEntrega = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date)  'Prazo previsto para entrega
    End If
    TBproducao!Quant = TBproducao!Quant + QuantSolicitado
    TBproducao!QTSaldo = True
    
    ProcBuscaProcesso TBControleNF!Desenho
    TBproducao!IDPROCESSO = IDPROCESSO 'Id do processo de fabricação
    TBproducao!Data = Date 'Data de emissão da ordem
    TBproducao!Desenho = TBControleNF!Desenho 'Código do produto filho
    TBproducao!Revitem = TBControleNF!RevDesenho 'Revisão do produto filho
    TBproducao!Produto = TBControleNF!Descricao 'Descrição do item
    TBproducao!Codigo_produto = TBCarteira!Desenho 'Código do produto principal
    TBproducao!Rev_produto = TBCarteira!Rev_codinterno 'Revisão do produto principal
    
    Desenho = TBControleNF!Desenho
    Set TBItem = CreateObject("adodb.recordset")
    TBItem.Open "Select n_referencia from item_aplicacoes where codproduto = " & Codproduto, Conexao, adOpenKeyset, adLockOptimistic
    If TBItem.EOF = False Then
        TBproducao!N_referencia = TBItem!N_referencia
    End If
    TBproducao!pronta = "NÃO" 'Status de conclusão da ordem
    
    If MRP_Prod = True Then
        Valor_DAS = 0
        With listaitens
            valor = frmProd_Opcoes_Mrp.txtQuantidade
            For InitFor = 1 To .ListItems.Count
                If .ListItems.Item(InitFor).Checked = True And valor > 0 Then
                    'Verifica quantidade total solicitada do componente de acordo com a necessidade dos pedidos
                    Set TBItem = CreateObject("adodb.recordset")
                    TBItem.Open "Select quantidade from Projconjunto where codproduto = " & CodprodutoAntigo & " and Versao = '" & Versao_estrutura & "' and Desenho = '" & TBControleNF!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBItem.EOF = False Then
                        If valor < .ListItems.Item(InitFor).ListSubItems(12) Then Valor1 = valor Else Valor1 = .ListItems.Item(InitFor).ListSubItems(12)
                        valor = valor - Valor1
                        If Valor1 > valor Then
                        Valor_DAS = Valor_DAS + (Valor1 * TBItem!quantidade)
                        Else
                        Valor_DAS = Valor_DAS + (valor * TBItem!quantidade)
                        End If
                    End If
                End If
            Next InitFor
            
            'Verifica se todos os produtos selecionados são para o mesmo cliente
            Cliente1 = ""
            Permitido1 = True
            valor = frmProd_Opcoes_Mrp.txtQuantidade
            For InitFor = 1 To .ListItems.Count
                If .ListItems.Item(InitFor).Checked = True And valor > 0 Then
                    If Cliente1 = "" Then Cliente1 = .ListItems.Item(InitFor).SubItems(21)
                    If Cliente1 <> .ListItems.Item(InitFor).SubItems(21) Then Permitido1 = False
'======================================================================================================================
' Criar empenho da ordem no pedido interno
'======================================================================================================================
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from Empresa where codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    Empenho_Producao = TBAbrir!Ativar_empenho_autom_prod
Else
    Empenho_Producao = False
End If
TBAbrir.Close

If Empenho_Producao = True Then
Set TBGravar = CreateObject("adodb.recordset")
TBGravar.Open "Select * from Producao_pedidos where Ordem = " & OF & " and IDcarteira = " & .ListItems.Item(InitFor), Conexao, adOpenKeyset, adLockOptimistic
If TBGravar.EOF = True Then
    TBGravar.AddNew
    TBGravar!Data = Date
    TBGravar!Responsavel = pubUsuario
    TBGravar!Ordem = OF
    TBGravar!OrdemEmpenho = OrdemEmpenho
    TBGravar!IDcarteira = .ListItems.Item(InitFor)
    
    Set TBItem = CreateObject("adodb.recordset")
    TBItem.Open "Select quantidade from Projconjunto where codproduto = " & CodprodutoAntigo & " and Versao = '" & Versao_estrutura & "' and Desenho = '" & TBControleNF!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBItem.EOF = False Then
        If valor < .ListItems.Item(InitFor).ListSubItems(12) Then Valor1 = valor Else Valor1 = .ListItems.Item(InitFor).ListSubItems(12)
        valor = valor - Valor1
        
        If Valor1 > valor Then
        Valor2 = ((Valor1 * TBItem!quantidade) / Valor_DAS) * 100
        Else
        Valor2 = ((valor * TBItem!quantidade) / Valor_DAS) * 100
        End If
        
        TBGravar!Qtde_empenho = (QuantSolicitado * Valor2) / 100
    End If
    
    TBGravar.Update
End If
TBGravar.Close
 End If
 
                    Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'True' where Codigo = " & .ListItems.Item(InitFor)
                    
                End If
            Next InitFor
        End With

Prosseguir:
        If IsNull(TBCarteira!ID_solicitacao) = True Or TBCarteira!ID_solicitacao = 0 Then
            Set TBProposta = CreateObject("adodb.recordset")
            TBProposta.Open "Select ID_empresa, IDcliente, Cliente from vendas_proposta where cotacao = " & TBCarteira!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
            If TBProposta.EOF = False Then
                TBproducao!ID_empresa = TBProposta!ID_empresa
                If Permitido1 = True Then
                    TBproducao!IDCliente = TBProposta!IDCliente
                    TBproducao!Cliente = TBProposta!Cliente
                    Cliente = TBProposta!Cliente
                End If
            End If
            TBProposta.Close
        Else
            Set TBProposta = CreateObject("adodb.recordset")
            TBProposta.Open "Select ID_empresa from Outros_SolicitacaoPCP where ID = " & TBCarteira!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
            If TBProposta.EOF = False Then TBproducao!ID_empresa = TBProposta!ID_empresa
            TBProposta.Close
        End If
    Else
        If IsNull(TBCarteira!ID_solicitacao) = True Or TBCarteira!ID_solicitacao = 0 Then
            Set TBProposta = CreateObject("adodb.recordset")
            TBProposta.Open "Select ID_empresa, IDcliente, Cliente from vendas_proposta where cotacao = " & TBCarteira!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
            If TBProposta.EOF = False Then
                TBproducao!ID_empresa = TBProposta!ID_empresa
                TBproducao!IDCliente = TBProposta!IDCliente
                TBproducao!Cliente = TBProposta!Cliente
                Cliente = TBProposta!Cliente
            End If
        Else
            Set TBProposta = CreateObject("adodb.recordset")
            TBProposta.Open "Select ID_empresa from Outros_SolicitacaoPCP where ID = " & TBCarteira!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
            If TBProposta.EOF = False Then TBproducao!ID_empresa = TBProposta!ID_empresa
        End If
        TBProposta.Close
        
'======================================================================================================================
' Criar empenho da ordem no pedido interno
'======================================================================================================================
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from Empresa where codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then

Empenho_Producao = TBAbrir!Ativar_empenho_autom_prod
Else
Empenho_Producao = False
End If
TBAbrir.Close
If Empenho_Producao = True Then
        
Set TBGravar = CreateObject("adodb.recordset")
TBGravar.Open "Select * from Producao_pedidos where Ordem = " & OF & " and IDcarteira = " & TBCarteira!CODIGO, Conexao, adOpenKeyset, adLockOptimistic
If TBGravar.EOF = True Then
    TBGravar.AddNew
    TBGravar!Data = Date
    TBGravar!Responsavel = pubUsuario
    TBGravar!Ordem = OF
    TBGravar!OrdemEmpenho = OrdemEmpenho
    TBGravar!IDcarteira = TBCarteira!CODIGO
    
    Set TBItem = CreateObject("adodb.recordset")
    TBItem.Open "Select PC.quantidade from (Vendas_carteira VC INNER JOIN Projproduto P ON P.Desenho = VC.Desenho) INNER JOIN Projconjunto PC ON PC.codproduto = P.Codproduto where VC.Codigo = " & TBCarteira!CODIGO & " and PC.Desenho = '" & TBControleNF!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBItem.EOF = False Then
        TBGravar!Qtde_empenho = TBCarteira!Necessidade * TBItem!quantidade
    End If
    TBGravar.Update
End If
TBGravar.Close
End If

Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'True' where Codigo = " & TBCarteira!CODIGO
End If
    
    Select Case SubTipoItem
        Case "1": TBproducao!Tipo = "E" 'Produto acabado
        Case "2": TBproducao!Tipo = "M" 'Subconjunto
        Case "3": TBproducao!Tipo = "F" 'Componente
        Case "5": TBproducao!Tipo = "S" 'Serviço
    End Select
    
    TBproducao!IMPREQ = Urgencia
    If Consignacao = True Then TBproducao!Consignacao = True Else TBproducao!Consignacao = False
    If OSControlada = True Then TBproducao!OSControlada = True Else TBproducao!OSControlada = False
    If Processo_controlado = True Then TBproducao!Processo_controlado = True Else TBproducao!Processo_controlado = False
    If Tipo_Processo = True Then TBproducao!Tipo_Processo = True Else TBproducao!Tipo_Processo = False
    If EntrarEstoque = True Then TBproducao!Entrar_estoque = True Else TBproducao!Entrar_estoque = False
    If RetirarEstoque = True Then TBproducao!Retirar_estoque = True Else TBproducao!Retirar_estoque = False
    If Individual = True Then TBproducao!Individual = True Else TBproducao!Individual = False
    If Validacao = True Then
        TBproducao!DtValidacao = Now
        TBproducao!RespValidacao = pubUsuario
    End If
    
    TBproducao.Update
    ProcAcertaRequisicao Desenho, OF, 0, Versao_estrutura, TBproducao!Quant, False
    ProcCriarOrdemServico Desenho
    ProcAcertaOS TBproducao!Quant, False
    
    Contador1 = 0
    Do While Contador1 < 99999
        Contador1 = Contador1 + 1
    Loop
    
    ProcImprimirOrdens
    TBproducao.Close
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcImprimirOrdens()
On Error GoTo tratar_erro

'Arruma o prazo da(s) ordem(ns)
'Set TBAbrir = CreateObject("adodb.recordset")
'TBAbrir.Open "Select Producao.Ordem, Vendas_carteira.Prazofinal FROM (Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem) INNER JOIN vendas_carteira ON vendas_carteira.codigo = Producao_pedidos.IDCarteira where Producao_pedidos.Ordem = " & OF & " order by Vendas_carteira.Prazofinal", Conexao, adOpenKeyset, adLockOptimistic
'If TBAbrir.EOF = False Then
'    Set TBGravar = CreateObject("adodb.recordset")
'    TBGravar.Open "Select * from producao where Ordem = " & TBAbrir!Ordem, Conexao, adOpenKeyset, adLockOptimistic
'    Datafim = "00:00:00"
'    Dataini = "00:00:00"
'    If IsDate(TBAbrir!prazofinal) = True Then
'        Dataini = Format(TBAbrir!prazofinal, "dd/mm/yyyy")
'        Datafim = Dataini - Leadtime
'    Else
'        Datafim = Date - Leadtime
'    End If
'    TBGravar!PrazoEntrega = Datafim
'    TBGravar.Update
'End If

If MRP_Imprimir_Ordem = True Then
    NomeRel = "Pcp_ordem.rpt"
    If Imprimir = True Then ProcImprimirDireto "{producao.Ordem} = " & OF, "" Else ProcImprimirRel "{producao.Ordem} = " & OF, ""
End If
If MRP_Imprimir_Ordem_RM = True Then
    NomeRel = "Pcp_ordem e rm.rpt"
    If Imprimir = True Then ProcImprimirDireto "{producao.Ordem} = " & OF, "" Else ProcImprimirRel "{producao.Ordem} = " & OF, ""
End If
If MRP_Imprimir_Ordem_RM_Res = True Then
    NomeRel = "Pcp_ordem e rm_resumido.rpt"
    If Imprimir = True Then ProcImprimirDireto "{producao.Ordem} = " & OF, "" Else ProcImprimirRel "{producao.Ordem} = " & OF, ""
End If
If MRP_Imprimir_Ordem_APM = True Then
    NomeRel = "Pcp_ordem_apontamento manual.rpt"
    If Imprimir = True Then ProcImprimirDireto "{producao.Ordem} = " & OF, "" Else ProcImprimirRel "{producao.Ordem} = " & OF, ""
End If
If MRP_Imprimir_RM = True Then
    NomeRel = "Pcp_rm.rpt"
    If Imprimir = True Then ProcImprimirDireto "{producao.Ordem} = " & OF, "" Else ProcImprimirRel "{producao.Ordem} = " & OF, ""
End If
If MRP_Imprimir_Plano = True Then
    Set TBplano = CreateObject("adodb.recordset")
    TBplano.Open "Select * from plano where desenho = '" & Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBplano.EOF = False Then
        NomeRel = "Pcp_plano inspecao_frequencia de medicao.rpt"
        If Imprimir = True Then ProcImprimirDireto "{Producao.Ordem} = " & OF & " and {Planodimensao.Freq} <> '" & Null & "'", "" Else ProcImprimirRel "{Producao.Ordem} = " & OF & " and {Planodimensao.Freq} <> '" & Null & "'", ""
    End If
    TBplano.Close
End If
If MRP_Imprimir_Freq = True Then
    NomeRel = "Pcp_plano inspecao_frequencia de medicao.rpt"
    If Imprimir = True Then ProcImprimirDireto "{Producao.Ordem} = " & OF & " and {Planodimensao.Freq} <> '" & Null & "'", "" Else ProcImprimirRel "{Producao.Ordem} = " & OF & " and {Planodimensao.Freq} <> '" & Null & "'", ""
End If
If MRP_Imprimir_Etiq = True Then
    ProcCriarEtiquetas OF, TBproducao!Quant
    NomeRel = "Pcp_ordem_etiqueta.rpt"
    If Imprimir = True Then ProcImprimirDireto "{etiqueta.Responsavel}= '" & pubUsuario & "' and {etiqueta.Modulo} = '" & Formulario & "'", "" Else ProcImprimirRel "{etiqueta.Responsavel}= '" & pubUsuario & "' and {etiqueta.Modulo} = '" & Formulario & "'", ""
End If
ProcSalvarViaOrdem OF, False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcGerarOrdemProdutoVendido()
On Error GoTo tratar_erro

Dim Contador As Integer
Contador = frmProd_Opcoes_Mrp.txtCopiarOP.Text

Do While Contador > 0

            OF = ProcCriarNumeroOrdem
            If Agrupar_ordem = True Then
                TextoFiltro = "Select P.* from Producao P LEFT JOIN ProducaoFases PF ON PF.Ordem = P.Ordem where P.desenho = '" & TBCarteira!Desenho & "' and PF.Ordem IS NULL and P.Concluida = 'False' and (P.data = '" & Date & "' or P.data < '" & Date & "') and (P.Impof = 0 or P.Impof IS NULL)"
            Else
                TextoFiltro = "Select * from producao where Ordem = " & OF
            End If
                
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = True Then
                TBproducao.AddNew
                TBproducao!Ordem = OF
                TBproducao!status = "Aberta"
                TBproducao!Data_cadastro = Date
                TBproducao!Responsavel = pubUsuario
                TBproducao!Individual = frmProd_Opcoes_Mrp.chkRastreavel.Value
                '===============================================================
                'Gerar etiquetas
                '===============================================================
                Dim QuantEtiquetas As Long
                QuantEtiquetas = QuantSolicitado
                If TBproducao!Individual = True Then
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select ID from Producao_etiquetas where Ordem = " & OF, Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = True Then
                    MRP_Qtcopias_Etiq = 0
                    ProcCriarEtiquetas OF, QuantSolicitado

                End If
                End If
                
                QuantSolicitado = QuantEtiquetas
                
                If Imprimir = True And (MRP_Imprimir_Ordem = True Or MRP_Imprimir_Ordem_RM = True Or MRP_Imprimir_Ordem_RM_Res = True Or MRP_Imprimir_Ordem_APM = True Or MRP_Imprimir_Ordem_APM = True) Then TBproducao!Impof = 1 Else TBproducao!Impof = 0
                
                'Verifica se o item possui antecipação da produção
                Set TBProduto = CreateObject("adodb.recordset")
                TBProduto.Open "Select Dias_antecipacao from projproduto where desenho = '" & TBCarteira!Desenho & "' and Dias_antecipacao IS NOT NULL and Dias_antecipacao <> 0", Conexao, adOpenKeyset, adLockOptimistic
                If TBProduto.EOF = False Then
                    TBproducao!PrazoEntrega = FunDefinirPrazoAntecipacao(TBProduto!Dias_antecipacao, IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date))
                Else
                    If Contador > 1 Then
                        PrazoFinal = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) 'Prazo previsto para entrega
                        frmPrazoEntrega.Show 1
                        TBproducao!PrazoEntrega = PrazoEntrega
                    Else
                        TBproducao!PrazoEntrega = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) 'Prazo previsto para entrega
                    End If
                End If
                TBProduto.Close
            Else
                OF = TBproducao!Ordem
                If IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date) < TBproducao!PrazoEntrega Then TBproducao!PrazoEntrega = IIf(IsDate(TBCarteira!PrazoFinal) = True, TBCarteira!PrazoFinal, Date)  'Prazo previsto para entrega
            End If

            TBproducao!Quant = TBproducao!Quant + QuantSolicitado

            TBproducao!QTSaldo = True
            
            ProcBuscaProcesso TBCarteira!Desenho
            TBproducao!IDPROCESSO = IDPROCESSO 'Id do processo de fabricação
            TBproducao!Data = Date 'Data de emissão da ordem
            TBproducao!Desenho = TBCarteira!Desenho 'Código do produto filho
            TBproducao!Revitem = TBCarteira!Rev_codinterno 'Revisão do produto filho
            TBproducao!Produto = TBCarteira!descricao_tecnica 'Descrição do item
            TBproducao!Codigo_produto = TBCarteira!Desenho 'Código do produto principal
            TBproducao!Rev_produto = TBCarteira!Rev_codinterno 'Revisão do produto principal
            
            Desenho = TBCarteira!Desenho
            
            TBproducao!N_referencia = IIf(IsNull(TBCarteira!N_referencia), "", TBCarteira!N_referencia)
            TBproducao!pronta = "NÃO" 'Status de conclusão da ordem
            
            If MRP_Prod = True Then
                'Verifica se todos os produtos selecionados são para o mesmo cliente
                Cliente1 = ""
                Permitido1 = True
                
                Valor_DAS = QuantSolicitado
                With listaitens
                    For InitFor = 1 To .ListItems.Count
                        If .ListItems.Item(InitFor).Checked = True Then
                            If Cliente1 = "" Then Cliente1 = .ListItems.Item(InitFor).SubItems(21)
                            If Cliente1 <> .ListItems.Item(InitFor).SubItems(21) Then Permitido1 = False
                            
                            
'======================================================================================================================
' Criar empenho da ordem no pedido interno
'======================================================================================================================
If frmProd_Opcoes_Mrp.chkEmpenho.Value = Unchecked Then
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from Empresa where codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
Empenho_Producao = TBAbrir!Ativar_empenho_autom_prod
Else
Empenho_Producao = False
End If
TBAbrir.Close
Else
Empenho_Producao = True
End If

If Empenho_Producao = True Then

Set TBGravar = CreateObject("adodb.recordset")
TBGravar.Open "Select * from Producao_pedidos where Ordem = " & OF & " and IDcarteira = " & .ListItems.Item(InitFor), Conexao, adOpenKeyset, adLockOptimistic
If TBGravar.EOF = True Then
    TBGravar.AddNew
    TBGravar!Data = Date
    TBGravar!Responsavel = pubUsuario
    TBGravar!Ordem = OF
    TBGravar!IDcarteira = .ListItems.Item(InitFor)
    
    If Valor_DAS <= .ListItems.Item(InitFor).SubItems(12) Then
        TBGravar!Qtde_empenho = Valor_DAS
        Valor_DAS = 0
    Else
        TBGravar!Qtde_empenho = .ListItems.Item(InitFor).SubItems(12)
        Valor_DAS = Valor_DAS - .ListItems.Item(InitFor).SubItems(12)
    End If
    TBGravar.Update
End If
TBGravar.Close
End If

Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'True' where Codigo = " & .ListItems.Item(InitFor)

End If
'=========================================================================================================
                        If Valor_DAS <= 0 Then GoTo Prosseguir
                    Next InitFor
                End With
            
Prosseguir:
                If IsNull(TBCarteira!ID_solicitacao) = True Or TBCarteira!ID_solicitacao = 0 Then
                    Set TBProposta = CreateObject("adodb.recordset")
                    TBProposta.Open "Select ID_empresa, IDcliente, Cliente from vendas_proposta where cotacao = " & TBCarteira!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
                    If TBProposta.EOF = False Then
                        TBproducao!ID_empresa = TBProposta!ID_empresa
                        If Permitido1 = True Then
                            TBproducao!IDCliente = TBProposta!IDCliente
                            TBproducao!Cliente = TBProposta!Cliente
                            Cliente = TBProposta!Cliente
                        End If
                    End If
                    TBProposta.Close
                Else
                    Set TBProposta = CreateObject("adodb.recordset")
                    TBProposta.Open "Select ID_empresa from Outros_SolicitacaoPCP where ID = " & TBCarteira!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
                    If TBProposta.EOF = False Then TBproducao!ID_empresa = TBProposta!ID_empresa
                    TBProposta.Close
                End If
            Else
                If IsNull(TBCarteira!ID_solicitacao) = True Or TBCarteira!ID_solicitacao = 0 Then
                    Set TBProposta = CreateObject("adodb.recordset")
                    TBProposta.Open "Select ID_empresa, IDcliente, Cliente from vendas_proposta where cotacao = " & TBCarteira!Cotacao, Conexao, adOpenKeyset, adLockOptimistic
                    If TBProposta.EOF = False Then
                        TBproducao!ID_empresa = TBProposta!ID_empresa
                        TBproducao!IDCliente = TBProposta!IDCliente
                        TBproducao!Cliente = TBProposta!Cliente
                        Cliente = TBProposta!Cliente
                    End If
                Else
                    Set TBProposta = CreateObject("adodb.recordset")
                    TBProposta.Open "Select ID_empresa from Outros_SolicitacaoPCP where ID = " & TBCarteira!ID_solicitacao, Conexao, adOpenKeyset, adLockOptimistic
                    If TBProposta.EOF = False Then TBproducao!ID_empresa = TBProposta!ID_empresa
                End If
                TBProposta.Close
                
'==============================================================================
'Cria empenho na produção par o pedido interno
'==============================================================================

 Set TBAbrir = CreateObject("adodb.recordset")
 TBAbrir.Open "Select Ativar_empenho_autom_prod from Empresa where codigo = " & ID_empresa_MRP, Conexao, adOpenKeyset, adLockOptimistic
 If TBAbrir.EOF = False Then
 Empenho_Producao = TBAbrir!Ativar_empenho_autom_prod
 Else
 Empenho_Producao = False
 End If

If Empenho_Producao = True Then

 Set TBGravar = CreateObject("adodb.recordset")
 TBGravar.Open "Select * from Producao_pedidos where Ordem = " & OF & " and IDcarteira = " & TBCarteira!CODIGO, Conexao, adOpenKeyset, adLockOptimistic
 If TBGravar.EOF = True Then
     TBGravar.AddNew
     TBGravar!Data = Date
     TBGravar!Responsavel = pubUsuario
     TBGravar!Ordem = OF
     TBGravar!IDcarteira = TBCarteira!CODIGO
     If QuantSolicitado <= TBCarteira!Necessidade Then TBGravar!Qtde_empenho = QuantSolicitado Else TBGravar!Qtde_empenho = TBCarteira!Necessidade
     TBGravar.Update
 End If
 TBGravar.Close
 
 End If
 
Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'True' where Codigo = " & TBCarteira!CODIGO
End If
'===============================================================================
            
            Select Case SubTipoItem
                Case "1": TBproducao!Tipo = "E" 'Produto acabado
                Case "2": TBproducao!Tipo = "M" 'Subconjunto
                Case "3": TBproducao!Tipo = "F" 'Componente
                Case "5": TBproducao!Tipo = "S" 'Serviço
            End Select
            
            TBproducao!IMPREQ = Urgencia
            If Consignacao = True Then TBproducao!Consignacao = True Else TBproducao!Consignacao = False
            If OSControlada = True Then TBproducao!OSControlada = True Else TBproducao!OSControlada = False
            If Processo_controlado = True Then TBproducao!Processo_controlado = True Else TBproducao!Processo_controlado = False
            If Tipo_Processo = True Then TBproducao!Tipo_Processo = True Else TBproducao!Tipo_Processo = False
            If EntrarEstoque = True Then TBproducao!Entrar_estoque = True Else TBproducao!Entrar_estoque = False
            If RetirarEstoque = True Then TBproducao!Retirar_estoque = True Else TBproducao!Retirar_estoque = False
            
            If Validacao = True Then
                TBproducao!DtValidacao = Now
                TBproducao!RespValidacao = pubUsuario
            End If
            
            TBproducao.Update
            ProcAcertaRequisicao Desenho, OF, 0, Versao_estrutura, TBproducao!Quant, False
            ProcCriarOrdemServico Desenho
            ProcAcertaOS TBproducao!Quant, False
            ProcImprimirOrdens
            TBproducao.Close
            
            Contador = Contador - 1
        
Loop

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub


Sub ProcNovoOrdem()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
txtof.Text = ProcCriarNumeroOrdem
cmbStatus.Text = "Aberta"
txtData = Format(Date, "dd/mm/yy")
txtResponsavel = pubUsuario
txtQuantidade.Text = ""
txtData_emissao = Date
mskprazofina.Value = Date
MRP = False
MRP_Prod = False
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Function ProcCriarNumeroOrdem() As Long
On Error GoTo tratar_erro

Set TBGravar = CreateObject("adodb.recordset")
TBGravar.Open "Select Ordem from producao order by Ordem desc", Conexao, adOpenKeyset, adLockOptimistic
If TBGravar.EOF = True Then ProcCriarNumeroOrdem = 1 Else ProcCriarNumeroOrdem = TBGravar!Ordem + 1
TBGravar.Close

VerifOrdem:
    Set TBGravar = CreateObject("adodb.recordset")
    TBGravar.Open "Select Ordem from producao where Ordem = " & ProcCriarNumeroOrdem, Conexao, adOpenKeyset, adLockOptimistic
    If TBGravar.EOF = False Then
        ProcCriarNumeroOrdem = ProcCriarNumeroOrdem + 1
        GoTo VerifOrdem
    End If

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Function
End Function

Sub ProcLimpar(LimparCampoOrdem As Boolean)
On Error GoTo tratar_erro

If LimparCampoOrdem = True Then txtof.Text = ""
With txtQuantidade
    .Text = ""
    .Locked = False
    .TabStop = True
End With
QuantSolicitado = 0
Versao_processo = ""
Versao_estrutura = ""
mskprazofina.Value = Date
txtData_emissao = Date
cmbStatus = ""
Txt_obs = ""
Chk_impressa.Value = 0
txtconcluida = "__/__/__"
If LimparCampoOrdem = True Then
    With txtdesenho
        .Text = ""
        .Locked = False
        .TabStop = True
    End With
    txtRevitem = ""
    txtreferencia.Clear
    txtProduto.Text = ""
ElseIf Novo_Ordem = False Then
        With txtdesenho
            .Text = ""
            .Locked = False
            .TabStop = True
        End With
        txtRevitem = ""
        txtreferencia.Clear
        txtProduto.Text = ""
End If
Txt_ID_cliente = ""
txtCliente.Text = ""
Txt_cod_prod = ""
Txt_rev_cod_prod = ""
txtData = Format(Date, "dd/mm/yy")
txtResponsavel = pubUsuario
txtDtValidacao = ""
txtRespValidacao = ""
Opt_componente.Value = 0
Opt_servico.Value = 0
Opt_produto_final.Value = 0
Opt_subconjunto.Value = 0
optconsignacao.Value = 0
OptOSControlada.Value = 0
Opt_processo_controlado.Value = 0
OptReposicao.Value = 0
chkindividual.Value = 0
'Chk_tipo_processo.Value = 0
'Frame17.Enabled = True
Chk_entrar_estoque.Value = 0
Chk_retirar_estoque.Value = 0
Chk_urgente.Value = 0
Lista_pedidos.ListItems.Clear
Txt_qtde_total_produzindo = 0
Txt_qtde_total_emp_produzindo = 0
Txt_qtde_total_disp_produzindo = 0
If LimparCampoOrdem = True Then Proclimpacamposres

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcLimpaCamposAP()
On Error GoTo tratar_erro

txtStatus.Text = ""
txtttok.Text = ""
Txtttnc.Text = ""
txtProduzida.Text = ""
txtTPUTIL.Text = "000:00:00"
txtTEUTIL.Text = "000:00:00"
txtPcHorareal = 1
txtTTReal.Text = "000:00:00"
txtCodigo.Text = ""
cmbdescricao.ListIndex = -1
mskData.Value = Date
txtinicioap.Value = "00:00:00"
txtTOK.Text = ""
txtTNC.Text = ""
txtTurno = ""
Txt_grupo_op = ""
Txt_descricao_posto = ""
APLista.ListItems.Clear

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub Proclimpaevento()
On Error GoTo tratar_erro

txtCodigo.Text = ""
cmbdescricao.ListIndex = -1
txtinicioap.Value = "00:00:00"
mskData.Value = Date
txtttok.Text = ""
Txtttnc.Text = ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub Proclimpacamposres()
On Error GoTo tratar_erro

txtPrazoFinal = ""
txtdataconclusao = ""
txtquantprev = ""
txtquantreal = ""
txtQuantNC = ""
Txt_valor_nc = ""
Txt_qtde_entrada = ""
txtpecaprev = ""
txtpecautil = ""
txttempoprevisto = ""
txttempoutilizado = ""
Txt_eficiencia_prep = ""
Txt_eficiencia_exec = ""
txtEficiencia = ""
cpecaprev = ""
cpecareal = ""
txtcustoprev = ""
txtcustoefet = ""
Txt_custo_material = ""
Txt_custo_terceiros = ""
Txt_custo_outras = ""
Txt_custo_total = ""
Txt_custo_total_peca = ""
Txt_vlr_unit_estoque = ""
txtDtValidacao_custo = ""
txtRespValidacao_custo = ""
ListaRE.ListItems.Clear

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcExcluirOrdem()
On Error GoTo tratar_erro

If txtof.Text <> "" Then
'Verifica se existem apontamentos para a ordem antes de excluir
Set TBAbrir = CreateObject("adodb.recordset")
    TBAbrir.Open "Select * from ProducaoFases where Ordem = " & txtof & "", Conexao, adOpenKeyset, adLockOptimistic
    If TBAbrir.EOF = False Then
    USMsgBox "Não é possivel excluir a ordem " & txtof & "pois existe(m) apontamento(s) feito(s).", vbCritical, "CAPRIND v5.0"
    Exit Sub
    End If
TBAbrir.Close
End If

Permitido = False
With Lista
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente excluir esta(s) ordem(s)?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
            Permitido = True
            
            'Verifica o ID apontamento de multiplas OS
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select * from ordemservico where Ordem = " & .ListItems(InitFor) & " and ID_apontamento is not null order by Idproducao", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                Do While TBAbrir.EOF = False
                    Set TBFI = CreateObject("adodb.recordset")
                    TBFI.Open "Select * from ordemservico where IDproducao <> " & TBAbrir!IDProducao & " and ID_apontamento = " & TBAbrir!ID_apontamento, Conexao, adOpenKeyset, adLockOptimistic
                    If TBFI.EOF = False Then
                        If TBFI.RecordCount <= 1 Then Conexao.Execute "DELETE from ProducaoFases_OS WHERE ID = " & TBAbrir!ID_apontamento
                    Else
                        Conexao.Execute "DELETE from ProducaoFases_OS WHERE ID = " & TBAbrir!ID_apontamento
                    End If
                    TBFI.Close
                    TBAbrir.MoveNext
                Loop
            End If
            
            'Verifica se tem outra ordem para o IDcarteira dessa ordem
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select * from producao_pedidos where Ordem = " & .ListItems(InitFor) & " order by IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                Do While TBAbrir.EOF = False
                    Set TBFI = CreateObject("adodb.recordset")
                    TBFI.Open "Select * from producao_pedidos where Ordem <> " & .ListItems(InitFor) & " and IDCarteira = " & TBAbrir!IDcarteira, Conexao, adOpenKeyset, adLockOptimistic
                    If TBFI.EOF = True Then
                        Conexao.Execute "Update vendas_carteira Set Tem_ordem = 'False' where Codigo = " & TBAbrir!IDcarteira
                    End If
                    TBFI.Close
                    TBAbrir.MoveNext
                Loop
            End If
            TBAbrir.Close
            
            Set TBOrdem = CreateObject("adodb.recordset")
            TBOrdem.Open "Select * from producao where Ordem = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
            If TBOrdem.EOF = False Then
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select producao_pedidos.*, vendas_carteira.Desenho from producao_pedidos INNER JOIN vendas_carteira ON producao_pedidos.IDcarteira = vendas_carteira.Codigo where producao_pedidos.Ordem = " & .ListItems(InitFor) & " and vendas_carteira.Desenho = '" & TBOrdem!Desenho & "' order by producao_pedidos.IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    Do While TBAbrir.EOF = False
                        qtdeliberada = 0
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select Sum(producao.Quant) as qtdeliberada FROM Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem where Producao_pedidos.IDCarteira = " & TBAbrir!IDcarteira & " and Producao.Desenho = '" & TBAbrir!Desenho & "' and ID <> " & TBAbrir!ID, Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            qtdeliberada = IIf(IsNull(TBproducao!qtdeliberada), 0, TBproducao!qtdeliberada)
                        End If
                        TBproducao.Close
                        Set TBVendas = CreateObject("adodb.recordset")
                        TBVendas.Open "Select * from vendas_carteira where Codigo = " & TBAbrir!IDcarteira, Conexao, adOpenKeyset, adLockOptimistic
                        If TBVendas.EOF = False Then
                            If qtdeliberada < TBVendas!quantidade Then Conexao.Execute "Update vendas_carteira Set datapcp = Null, OE = 'False' where Codigo = " & TBAbrir!IDcarteira
                        End If
                        TBVendas.Close
                        TBAbrir.MoveNext
                    Loop
                End If
                TBAbrir.Close
            End If
            TBOrdem.Close
            '====================================
            Modulo = "PCP/Gerenciamento de ordem"
            If Sair = True Then Evento = "Excluir ao sair" Else Evento = "Excluir"
            ID_documento = .ListItems(InitFor)
            Documento = "Ordem: " & .ListItems(InitFor) & " - Cód. interno: " & .ListItems.Item(InitFor).SubItems(4)
            Documento1 = ""
            ProcGravaEvento
            '===================================
            
            Conexao.Execute "DELETE from producao WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from Producao_NF_Consignada WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from producaomaterial WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from Producao_pedidos WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from Ordemservico_maq_utilizadas WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from OSH from Ordemservico_HoraUtilizadaporDia OSH INNER JOIN Ordemservico OS ON OS.IDProducao = OSH.OS Where OS.Ordem = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from ordemservico WHERE Ordem = " & .ListItems(InitFor)
            Conexao.Execute "Update CQ_NC_FABRICA Set OrdemRetrabalho = NULL where OrdemRetrabalho = " & .ListItems(InitFor)
            Conexao.Execute "DELETE from Producao_etiquetas WHERE Ordem = " & .ListItems(InitFor)
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) ordem(ns) antes de excluir."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("Ordem(ns) excluída(s) com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcLimpar True
    atualiza_lista_ordens (1)
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcLista12Ultimos()
On Error GoTo tratar_erro

If cmbAPOS = "" Then Exit Sub
APLista.ListItems.Clear
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from " & NomeTabelaAp & " where OS = " & cmbAPOS & " and maquina = '" & txtAPMaquina.Text & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    If Atualizacao = False Then
        TBproducao.MoveLast
        'PBLista.Min = 0
        'PBLista.Max = TBproducao.RecordCount
        'PBLista.Value = 1
        Contador = 0
        TBproducao.MoveFirst
    End If
    
    If TBproducao.RecordCount > 22 Then
        TBproducao.MoveLast
        Contador2 = 22
        Do While Contador2 > 1
            TBproducao.MovePrevious
            Contador2 = Contador2 - 1
        Loop
        Contador = TBproducao.RecordCount - 22
    End If
    Do Until TBproducao.EOF
        With APLista.ListItems
            .Add , , TBproducao!IDProducao
            .Item(.Count).SubItems(1) = IIf(IsNull(TBproducao!CodigoDesc), 0, TBproducao!CodigoDesc)
            .Item(.Count).SubItems(2) = TBproducao!Descricao
            txtStatus.Text = TBproducao!Descricao
            .Item(.Count).SubItems(3) = Format(TBproducao!TempoInicio, "dd/mm/yy hh:mm:ss")
            .Item(.Count).SubItems(4) = Format(TBproducao!TempoFinal, "dd/mm/yy hh:mm:ss")
            If TBproducao!TempoInicio <> "00:00:00" Then TempoFinal = TBproducao!TempoInicio
            If TBproducao!Dias <> 0 Then
                TempoTotalDias = IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal) + TBproducao!Dias
                ElapsedTime (TempoTotalDias)
                .Item(.Count).SubItems(5) = HoraTotal
            Else
                .Item(.Count).SubItems(5) = IIf(IsNull(TBproducao!TempoTotal), "", TBproducao!TempoTotal)
            End If
            .Item(.Count).SubItems(6) = TBproducao!Usuario
            .Item(.Count).SubItems(7) = IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
            .Item(.Count).SubItems(8) = IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
            .Item(.Count).SubItems(9) = TBproducao!Pronto
            .Item(.Count).SubItems(10) = Format(TBproducao!Data, "dd/mm/yy")
            
            .Item(.Count).Selected = True
        End With
        TBproducao.MoveNext
        If Atualizacao = False Then
            Contador = Contador + 1
            'PBLista.Value = Contador
        End If
    Loop
End If
1:
    TBproducao.Close

Exit Sub
tratar_erro:
    If Err.Number = 365 Then GoTo 1
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaUltimo()
On Error GoTo tratar_erro

Set TBproducao = CreateObject("adodb.recordset")
If Novo_Ordem2 = True Then
    TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio < '" & TempoInicio & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
Else
    TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio < '" & TempoInicio & "' and idproducao <> " & APLista.SelectedItem & " order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
End If
If TBproducao.EOF = False Then
    TBproducao.MoveLast
    ULTICOD = TBproducao!CodigoDesc
    
    'Se o ultimo código de trabalho for igual ao próximo código de trabalho, não aceita
    If TBproducao!CodigoDesc = txtCodigo.Text Then
        USMsgBox ("Não é permitido utilizar este evento, pois o mesmo está sendo utilizado."), vbExclamation, "CAPRIND v5.0"
        Gravar = False
        Exit Sub
    End If
'    If txtCodigo = 3 And (TBproducao!CodigoDesc <> 2 Or TBproducao!CodigoDesc = 0) Then
'        usMsgbox ("Só é permitido encerrar a ordem após código Máquina em produção."), vbExclamation, "CAPRIND v5.0"
'        Gravar = False
'        Exit Sub
'    End If
    'Se o ultimo código de trabalho for maquina em produção e a quantidade igual a nada , e cmb descrição igual a fim de produção, deverá ser colocado a quantidade peças produzidas
    If TBproducao!CodigoDesc = 2 And txtTOK.Text = "" Then
        'Se os dados estiverem corretamente preenchidos
        txtTOK.Locked = False
        txtTOK.TabStop = True
        txtTNC.Locked = False
        txtTNC.TabStop = True
        USMsgBox ("É obrigatório colocar a quantidade aprovada, e se houver as não conforme."), vbExclamation, "CAPRIND v5.0"
        txtTOK.SetFocus
        Gravar = False
        Exit Sub
    End If
Else
    'Se o ultimo código de trabalho for nenhum e o operador quiser terminar o lote não aceita
    ULTICOD = txtCodigo
    If txtCodigo.Text = 3 Then
        USMsgBox ("Só é permitido encerrar a ordem após um evento."), vbExclamation, "CAPRIND v5.0"
        Gravar = False
        Exit Sub
    End If
End If
'Verificar se o turno final e igual ao turno inicio do evento
ProcVerificaTurno
If Ultimo = "" Then Ultimo = 0
Gravar = True

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaTurno()
On Error GoTo tratar_erro

Turno = 0
TempoInicio = 0
TempoFinal = 0
Dataini = mskData.Value
ProcVerificaDia
Dataini = txtinicioap.Value
Set TBMaquinas = CreateObject("adodb.recordset")
TBMaquinas.Open "Select * from CadMaqturnos where maquina = '" & txtAPMaquina.Text & "' and diasemana = '" & Diasemana & "' order by diasemana,turno", Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
    Do While TBMaquinas.EOF = False
        If IsNull(TBMaquinas!Inicioturno) = False Then
            TempoInicio = Left(TBMaquinas!Inicioturno, 8)
            TempoFinal = Left(TBMaquinas!finalturno, 8)
            If TempoInicio > TempoFinal Then
                Dataini = mskData.Value & " " & Dataini
                TempoInicio = mskData.Value & " " & TempoInicio
                TempoFinal = mskData.Value & "  " & TempoFinal
                TempoInicio = TempoInicio - 1
                TempoFinal = TempoFinal + 1
            End If
            Select Case TBMaquinas!Turno
                Case 1:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 1
                        GoTo Sair
                    End If
                Case 2:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 2
                        GoTo Sair
                    End If
                Case 3:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 3
                        GoTo Sair
                    End If
                Case 4:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 4
                        GoTo Sair
                    End If
            End Select
        End If
        TBMaquinas.MoveNext
    Loop
End If
Sair:
    txtTurno.Text = Turno
    Dataini = mskData.Value
    TBMaquinas.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaDia()
On Error GoTo tratar_erro

Diasemana = Weekday(Dataini)
Select Case Diasemana
    Case 1: Diasemana = "Domingo"
    Case 2: Diasemana = "Segunda"
    Case 3: Diasemana = "Terça"
    Case 4: Diasemana = "Quarta"
    Case 5: Diasemana = "Quinta"
    Case 6: Diasemana = "Sexta"
    Case 7: Diasemana = "Sabado"
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifQtdeApontada()
On Error GoTo tratar_erro
TOK = IIf(txtTOK.Text = "", 0, txtTOK.Text)
TNC = IIf(txtTNC.Text = "", 0, txtTNC.Text)

Gravar = True
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select OS.IDProducao, OS.Fase, OS.TotalProd, OS.Quantidade, P.Ordem, P.Quant from ordemservico OS INNER JOIN Producao P ON OS.Ordem = P.Ordem where OS.IDproducao = " & cmbAPOS, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    produzidas = IIf(IsNull(TBproducao!Totalprod), 0, TBproducao!Totalprod)
    If Novo_Ordem2 = False Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Quantidade, Reprovada from " & NomeTabelaAp & " where IDproducao = " & APLista.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            produzidas = produzidas - (IIf(IsNull(TBAbrir!quantidade), 0, TBAbrir!quantidade) + TBAbrir!Reprovada)
        End If
        TBAbrir.Close
    End If
    
    'Verifica qtde. de pçs apontadas na OS anterior
    If Opt_processo_controlado.Value = 1 Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from ordemservico where Ordem = " & TBproducao!Ordem & " and Retrabalho = 'False' and Fase < '" & TBproducao!Fase & "' order by Fase desc", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            qtdeliberada = IIf(IsNull(TBAbrir!QTOK), 0, TBAbrir!QTOK)
        Else
            qtdeliberada = IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
        End If
        TBAbrir.Close
    Else
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Sum(QTNC) as TTNC from ordemservico where Ordem = " & TBproducao!Ordem & " and Idproducao < " & TBproducao!IDProducao, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            QtdeRefugo = IIf(IsNull(TBAbrir!TTNC), 0, TBAbrir!TTNC)
        End If
        TBAbrir.Close
        qtdeliberada = TBproducao!quantidade - QtdeRefugo
    End If
    
    'Verifica se a quantidade produzida é maior que a quantidade da OS anterior
    If Opt_processo_controlado.Value = 1 Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select IDproducao from ordemservico where Ordem = " & TBproducao!Ordem & " and Retrabalho = 'False' and Fase < '" & TBproducao!Fase & "' order by Fase desc", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            If TBAbrir!IDProducao <> TBproducao!IDProducao And (produzidas + TOK + TNC) > qtdeliberada Then
                USMsgBox ("OS com PROCESSO CONTROLADO, a quantidade total apontada é maior que a quantidade apontada na OS anterior." & vbCrLf & vbCrLf & "OS anterior: " & qtdeliberada & vbCrLf & "Produzidas: " & produzidas & vbCrLf & "+ Conforme: " & TOK & vbCrLf & "+ NC: " & TNC & vbCrLf & "= Total: " & produzidas + TOK + TNC), vbExclamation, "CAPRIND v5.0"
                Gravar = False
                TBAbrir.Close
                TBproducao.Close
                Exit Sub
            End If
        Else
            If OptOSControlada.Value = 1 Then
                If (produzidas + TOK + TNC) > qtdeliberada Then
                    USMsgBox ("ORDEM CONTROLADA, a quantidade total apontada é maior que a quantidade do lote." & vbCrLf & vbCrLf & "Lote: " & qtdeliberada & vbCrLf & "Produzidas: " & produzidas & vbCrLf & "+ Conforme: " & TOK & vbCrLf & "+ NC: " & TNC & vbCrLf & "= Total: " & produzidas + TOK + TNC), vbExclamation, "CAPRIND v5.0"
                    Gravar = False
                    TBproducao.Close
                    Exit Sub
                End If
            End If
        End If
    End If
    
    If OptOSControlada.Value = 1 Then
        'Se for encerrar a ordem com quantidade menor que o programado
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select IDProducao from ordemservico where Ordem = " & TBproducao!Ordem & " and Retrabalho = 'False' and Fase < '" & TBproducao!Fase & "' and Pronto = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then qtdeliberada = TBproducao!Quant
        
        If Opt_processo_controlado.Value = 0 Then
            If (produzidas + TOK + TNC) > qtdeliberada Then
                USMsgBox ("ORDEM CONTROLADA, a quantidade total apontada é maior que a quantidade do lote." & vbCrLf & vbCrLf & "Lote: " & qtdeliberada & vbCrLf & "Produzidas: " & produzidas & vbCrLf & "+ Conforme: " & TOK & vbCrLf & "+ NC: " & TNC & vbCrLf & "= Total: " & produzidas + TOK + TNC), vbExclamation, "CAPRIND v5.0"
                Gravar = False
                TBproducao.Close
                Exit Sub
            End If
        End If
        
        If EventoAP = 3 Then
            If (produzidas + TOK + TNC) < qtdeliberada Then
                USMsgBox ("ORDEM CONTROLADA, a quantidade total apontada é menor que a quantidade do lote." & vbCrLf & vbCrLf & "Lote: " & qtdeliberada & vbCrLf & "Produzidas: " & produzidas & vbCrLf & "+ Conforme: " & TOK & vbCrLf & "+ NC: " & TNC & vbCrLf & "= Total: " & produzidas + TOK + TNC), vbExclamation, "CAPRIND v5.0"
                TBproducao.Close
                Gravar = False
                Exit Sub
            End If
        Else
            'Se for encerrar o evento com quantidade produzida igual ao lote não permite
            If Novo_Ordem2 = True Then
                Permitido = False
                If ChkProcesso_controlado.Value = 1 Then
                    'Verifica se a OS apontada não é a primeira
                    Set TBFIltro = CreateObject("adodb.recordset")
                    TBFIltro.Open "Select * from ordemservico where Ordem = " & TBproducao!Ordem & " and Retrabalho = 'False' order by IDproducao", Conexao, adOpenKeyset, adLockOptimistic
                    If TBFIltro.EOF = False Then
                        If TBFIltro!IDProducao <> TBproducao!IDProducao Then
                            Set TBAbrir = CreateObject("adodb.recordset")
                            TBAbrir.Open "Select OS.* from " & NomeTabelaAp & " AP INNER JOIN ordemservico OS ON OS.IdProducao = AP.OS where AP.Ordem = " & TBproducao!Ordem & " and OS.Retrabalho = 'False' and AP.CodigoDesc = 3 and (AP.OS = " & TBproducao!IDProducao - 1 & " or AP.Fase = '" & TBproducao!Fase - 10 & "')", Conexao, adOpenKeyset, adLockOptimistic
                            If TBAbrir.EOF = False Then
                                Permitido = True
                            End If
                            TBAbrir.Close
                        Else
                            Permitido = True
                        End If
                    End If
                    TBFIltro.Close
                Else
                    Permitido = True
                End If
                If Permitido = True Then
                    If (produzidas + TOK + TNC) = qtdeliberada Then
                        USMsgBox ("ORDEM CONTROLADA, a quantidade total apontada é igual ao lote (" & qtdeliberada & "), só é permitido encerrar a ordem com o evento ***FIM DE PRODUÇÃO ***." & vbCrLf & vbCrLf & "Produzidas: " & produzidas & vbCrLf & "+ Conforme: " & TOK & vbCrLf & "+ NC: " & TNC & vbCrLf & "= Total: " & produzidas + TOK + TNC), vbExclamation, "CAPRIND v5.0"
                        TBproducao.Close
                        Gravar = False
                        Exit Sub
                    End If
                End If
            End If
        End If
    End If
End If
TBproducao.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizaPrepExecUtil()
On Error GoTo tratar_erro

TPPREV = 0
TEPSEG = 0
Eficiencia_prep = 0
Eficiencia_exec = 0
If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.*, P.DtValidacao_custo from " & INNERJOINTEXTO & " where " & TextoFiltro & " order by OS.IDproducao"
'Debug.print sqltexto

Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        'Filtra tempo total de preparação e execução por OS
        TempoTotalPrep = "00:00:00"
        TempoTotalProd = "00:00:00"
        TTOK = 0
        TTNC = 0
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and (CodigoDesc = 1 or CodigoDesc = 2) order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                If TBproducao!CodigoDesc = 1 Then
                    TempoTotalPrep = TempoTotalPrep + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                Else
                    TempoTotalProd = TempoTotalProd + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                End If
                TTOK = TTOK + IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
                TTNC = TTNC + IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
        produzidas = TTOK + TTNC
        
        If IsNull(TBOS!DtValidacao_custo) = True Then
            TBOS!QTOK = TTOK
            TBOS!QTNC = TTNC
            TBOS!Totalprod = TTOK + TTNC
            TBOS.Update
        End If
        
        'Verifica tempo total de preparação e execução previsto para todas OS
        'Preparação
        If IsNull(TBOS!Tempo_prep_reaproveitado) = True Or TBOS!Tempo_prep_reaproveitado = False Then TPPREV = TPPREV + IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao)
        
        'Execução
        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        TBOS.MoveNext
    Loop
    ElapsedTime (TPPREV)
    TPPSEG = s
    
    'Verificar o percentual do tempo total por OS
    sqltexto = "Select OS.* from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
    Set TBOS = CreateObject("adodb.recordset")
    TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
    Do While TBOS.EOF = False
        'Preparação
        ElapsedTime (TBOS!Preparacao)
        If TPPSEG > 0 Then QuantComprado = (s / TPPSEG) * 100 Else QuantComprado = 100
        
        'Execução
        s = (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        If TEPSEG > 0 Then QuantComprado1 = (s / TEPSEG) * 100 Else QuantComprado1 = 100
        
        'Preparação
        'Calcula total de segundos utilizados preparando
        ElapsedTime (TempoTotalPrep)
        TPUSEG = s
        
        TPUSEG = Format((TPUSEG * QuantComprado) / 100, "###,##0.0000000000")
        TPUSEGDECS = TPUSEG
        TTPUTIL = FormataTempo(TPUSEG)
        
        TBOS!TPUTIL = TTPUTIL
        TBOS!TPUSEG = TPUSEGDECS
        
        'Execução
        'Calcula total de segundos utilizados produzindo
        ElapsedTime (TempoTotalProd)
        TTEUTILS = s
        
        TTEUTILS = Format((TTEUTILS * QuantComprado1) / 100, "###,##0.0000000000")
        
        TTEUTILDECS = TTEUTILS
        TTUTIL = FormataTempo(TTEUTILS)
        TTEUTILS = TTEUTILDECS
        
        'Soma tempo total de preparação + execução
        TTUTILSEG = TPUSEGDECS + TTEUTILS
        TempoTotalUtil = FormataTempo(TPUSEGDECS + TTEUTILS)
        TBOS!TETTUTIL = TempoTotalUtil 'Grava tempo total utilizado
        'TBOS!TETTUTILN = TempoTotalUtil 'Grava tempo total utilizado
        TBOS!TETTUTILSEG = TTUTILSEG 'Grava tempo total utilizado em segundos
        
'==========================================
' Calcula produzido
'==========================================
'Calcula tempo total de execução
'==========================================
produzidas = TBOS!Totalprod
If produzidas >= 1 Then
  If TTEUTILS > 0 And produzidas > 0 Then
   TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000")
   Else
   TEUSEG = TTEUTILS
  End If
End If

'If produzidas < 1 Then
  If TTEUTILS > 0 And produzidas > 0 Then
   TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000")
   Else
   TEUSEG = Format(TTEUTILS, "###,##0.0000000000")
  End If
'End If
                   
'DecimoSegundos = TEUSEG
TBOS!TEUSEG = TEUSEG
TBOS!TEUTIL = FormataTempo(TEUSEG)

'

'=========================================
'Calcula eficiencia preparacao
'=========================================
 ElapsedTime (IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao))
 If s > 0 And TPUSEGDECS > 0 Then
  Eficiencia_prep = Format((s / TPUSEGDECS) * 100, "###,##0.00")
 Else
  Eficiencia_prep = 0
 End If
 
 TBOS!Eficiencia_prep = Eficiencia_prep
'=========================================
'Calcula eficiencia execucao
'=========================================
If IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) > 0 And TBOS!TEUSEG > 0 Then
 Eficiencia_exec = Format((TBOS!TESegundos / TBOS!TEUSEG) * 100, "###,##0.00")
Else
 Eficiencia_exec = 0
End If

TBOS!Eficiencia_exec = Eficiencia_exec
'=========================================
If Eficiencia_prep > 0 And Eficiencia_exec > 0 Then
  TBOS!Eficiencia = (Eficiencia_prep + Eficiencia_exec) / 2
ElseIf Eficiencia_prep > 0 Then
      TBOS!Eficiencia = Eficiencia_prep
  ElseIf Eficiencia_exec > 0 Then
          TBOS!Eficiencia = Eficiencia_exec
      Else
          TBOS!Eficiencia = 0
End If
'================================================
'Calcula e grava valor real do lote e por peça
'================================================
Set TBMaquinas = CreateObject("adodb.recordset")
StrSql = "Select Sum(CRLote) as CTTLOTE, Sum(TotalProd) as QtdeProduzida from Ordemservico_maq_utilizadas where OS = " & TBOS!IDProducao
'Debug.print StrSql

TBMaquinas.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
    TBOS!CRLOTE = IIf(IsNull(TBMaquinas!CTTLOTE), 0, Format(TBMaquinas!CTTLOTE, "###,##0.00"))
    
    If IsNull(TBMaquinas!QtdeProduzida) = False And TBMaquinas!QtdeProduzida <> "0" Then
    
 '   If TBMaquinas!QtdeProduzida >= 1 Then
    TBOS!CRPECA = Format(TBOS!CRLOTE / TBMaquinas!QtdeProduzida, "###,##0.0000000000")
 '   End If
    
'    If TBMaquinas!QtdeProduzida < 1 Then
'    TBOS!CRPECA = Format(TBOS!CRLOTE / TBMaquinas!QtdeProduzida, "###,##0.0000000000")
'    End If
    
    Else
    TBOS!CRPECA = 0
    End If
End If
TBMaquinas.Close
        
TBOS.Update
TBOS.MoveNext
Loop
End If

TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizaPrepExecUtilTotalizacaoMaq()
On Error GoTo tratar_erro

TPPREV = 0
TEPSEG = 0
Eficiencia_prep = 0
Eficiencia_exec = 0
If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.* from " & INNERJOINTEXTO & " where " & TextoFiltro & " order by OS.IDproducao"
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        'Verifica tempo total de preparação e execução previsto para todas OS
        'Preparação
        If IsNull(TBOS!Tempo_prep_reaproveitado) = True Or TBOS!Tempo_prep_reaproveitado = False Then TPPREV = TPPREV + IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao)
        
        'Execução
        If TBOS!Totalprod >= 1 Then
        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        End If
        
        If TBOS!Totalprod < 1 Then
        'TEPSEG = TEPSEG + IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos / TBOS!Totalprod)
        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, (TBOS!TESegundos) * (TBOS!Totalprod * 100) / 100))
        End If
        
'        If TBOS!Totalprod < 0.1 Then
'        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * (TBOS!Totalprod * 100))
'        End If
        
        TBOS.MoveNext
    Loop
    ElapsedTime (TPPREV)
    TPPSEG = s
    
    'Verificar o percentual do tempo total por OS
    sqltexto = "Select OS.* from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
    Set TBOS = CreateObject("adodb.recordset")
    TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
    Do While TBOS.EOF = False
        'Preparação
        ElapsedTime (TBOS!Preparacao)
        If TPPSEG > 0 Then QuantComprado = (s / TPPSEG) * 100 Else QuantComprado = 100
        
        'Execução
        
        s = (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        
        If TEPSEG > 0 Then QuantComprado1 = (s / TEPSEG) * 100 Else QuantComprado1 = 100
        
        'Filtra tempo total de preparação e execução por OS
        TempoTotalPrep = "00:00:00"
        TempoTotalProd = "00:00:00"
        TTOK = 0
        TTNC = 0
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina.Text & "' and (CodigoDesc = 1 or CodigoDesc = 2) order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                If TBproducao!CodigoDesc = 1 Then
                    TempoTotalPrep = TempoTotalPrep + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                Else
                    TempoTotalProd = TempoTotalProd + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                End If
                TTOK = TTOK + IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
                TTNC = TTNC + IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
        produzidas = TTOK + TTNC
        
        'Preparação
        'Calcula total de segundos utilizados preparando
        ElapsedTime (TempoTotalPrep)
        TPUSEG = s
        
        TPUSEG = Format((TPUSEG * QuantComprado) / 100, "###,##0.0000000000")
        TPUSEGDECS = TPUSEG
        TTPUTIL = FormataTempo(TPUSEG)
        
        'Execução
        'Calcula total de segundos utilizados produzindo
        ElapsedTime (TempoTotalProd)
        TTEUTILS = s
        
        TTEUTILS = Format((TTEUTILS * QuantComprado1) / 100, "###,##0.0000000000")
        TTEUTILDECS = TTEUTILS
        TTUTIL = FormataTempo(TTEUTILS)
        TTEUTILS = TTEUTILDECS
        
        'Soma tempo total de preparação + execução
        TTUTILSEG = TPUSEGDECS + TTEUTILS
        TempoTotalUtil = FormataTempo(TPUSEGDECS + TTEUTILS)
        
        'Calcula tempo total de execução por peça
        
        If produzidas >= 1 Then
        If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000") Else TEUSEG = TTEUTILS
        End If
        
        If produzidas < 1 Then
        If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format((TTEUTILS * (produzidas * 1000) / 1000), "###,##0.0000000000") Else TEUSEG = TTEUTILS
        
  '      If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format((TTEUTILS / produzidas) / (1 / produzidas), "###,##0.0000000000") Else TEUSEG = TTEUTILS
        End If

        
        DecimoSegundos = TEUSEG
           
        'Calcula e grava valor real do lote e por peça
        ProcCalculaValorHoraPosto
        
        Set TBProcessos = CreateObject("adodb.recordset")
        TBProcessos.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBProcessos.EOF = False Then
            'Calcula eficiencia
            ElapsedTime (IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao))
            If s > 0 And TPUSEGDECS > 0 Then Eficiencia_prep = Format((s / TPUSEGDECS) * 100, "###,##0.00") Else Eficiencia_prep = 0
            If IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) > 0 And TEUSEG > 0 Then Eficiencia_exec = Format((TBOS!TESegundos / TEUSEG) * 100, "###,##0.00") Else Eficiencia_exec = 0
            
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from Ordemservico_maq_utilizadas where OS = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = True Then TBproducao.AddNew
            TBproducao!Ordem = TBOS!Ordem
            TBproducao!OS = TBOS!IDProducao
            TBproducao!maquina = txtAPMaquina.Text
            'Preparação
            TBproducao!TPUTIL = TTPUTIL 'Tempo total real de preparação do lote
            TBproducao!TPUSEG = TPUSEGDECS
            'Execução
            TBproducao!QTNC = TTNC
            TBproducao!QTOK = TTOK
            TBproducao!TEUSEG = TEUSEG
            TBproducao!TEUTIL = FormataTempo(TEUSEG) 'Tempo total real de execução por peça
            TBproducao!TETTUTILSEG = TTUTILSEG
            TBproducao!TETTUTIL = TempoTotalUtil 'Tempo total real de preparação + tempo total real de execução do lote
            TBproducao!CRLOTE = CTTLOTE
            TBproducao!CRPECA = CTTPECA
            TBproducao!Eficiencia_prep = Eficiencia_prep
            TBproducao!Eficiencia_exec = Eficiencia_exec
            If Eficiencia_prep > 0 And Eficiencia_exec > 0 Then
                TBproducao!Eficiencia = (Eficiencia_prep + Eficiencia_exec) / 2
            ElseIf Eficiencia_prep > 0 Then
                    TBproducao!Eficiencia = Eficiencia_prep
                ElseIf Eficiencia_exec > 0 Then
                        TBproducao!Eficiencia = Eficiencia_exec
                    Else
                        TBproducao!Eficiencia = 0
            End If
            TBproducao!Totalprod = produzidas
            Set TBProducaoFases = CreateObject("adodb.recordset")
            TBProducaoFases.Open "Select * from " & NomeTabelaAp & " where OS = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina.Text & "' and CodigoDesc = 3", Conexao, adOpenKeyset, adLockOptimistic
            If TBProducaoFases.EOF = False Then
                TBproducao!Pronto = "SIM"
            Else
                TBproducao!Pronto = "NÃO"
            End If
            TBProducaoFases.Close
            TBproducao.Update
            TBproducao.Close
        Else
            Conexao.Execute "DELETE from Ordemservico_maq_utilizadas where OS = " & TBOS!IDProducao & " and maquina = '" & txtAPMaquina & "'"
        End If
        TBProcessos.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizaPrepExecUtilTotalizacao()
On Error GoTo tratar_erro

TPPREV = 0
TEPSEG = 0
Eficiencia_prep = 0
Eficiencia_exec = 0
If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.* from " & INNERJOINTEXTO & " where " & TextoFiltro & " order by OS.IDproducao"
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        'Verifica tempo total de preparação e execução previsto para todas OS
        'Preparação
        If IsNull(TBOS!Tempo_prep_reaproveitado) = True Or TBOS!Tempo_prep_reaproveitado = False Then TPPREV = TPPREV + IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao)
        
'If produzidas < 1 Then
'  If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000") Else TEUSEG = TTEUTILS
'End If
'
'If produzidas >= 1 Then
'  If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = TTEUTILS
'End If
        
        
        'Execução
        If TBOS!Totalprod >= 1 Then
        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        End If
        
        If TBOS!Totalprod < 1 Then
        TEPSEG = TEPSEG + (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * (TBOS!Totalprod * 1000) / 1000)
        End If
                
        TBOS.MoveNext
    Loop
    ElapsedTime (TPPREV)
    TPPSEG = s
    
    'Verificar o percentual do tempo total por OS
    sqltexto = "Select OS.* from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
    Set TBOS = CreateObject("adodb.recordset")
    TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
    Do While TBOS.EOF = False
        'Preparação
        ElapsedTime (TBOS!Preparacao)
        If TPPSEG > 0 Then QuantComprado = (s / TPPSEG) * 100 Else QuantComprado = 100
        
        'Execução
'        s = (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!totalprod)
        
        'Execução
        If TBOS!Totalprod >= 1 Then
        s = (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * TBOS!Totalprod)
        End If
        
        If TBOS!Totalprod < 1 And TBOS!Totalprod > 0 Then
        s = (IIf(IsNull(TBOS!TESegundos), 0, (TBOS!TESegundos / TBOS!Totalprod) / (1 / TBOS!Totalprod)))
        's = (IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) * (TBOS!Totalprod * 1000) / 1000)
        End If
        
        
        If TEPSEG > 0 Then QuantComprado1 = (s / TEPSEG) * 100 Else QuantComprado1 = 100
        
        'Filtra tempo total de preparação e execução por OS
        TempoTotalPrep = "00:00:00"
        TempoTotalProd = "00:00:00"
        TTOK = 0
        TTNC = 0
        Set TBproducao = CreateObject("adodb.recordset")
        
        StrSql = "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and Usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and data = '" & Format(Dataini, "Short Date") & "' and Turno = " & Turno & " and (CodigoDesc = 1 or CodigoDesc = 2) order by Data, Tempoinicio"
        
        'Debug.print StrSql
        
        TBproducao.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                If TBproducao!CodigoDesc = 1 Then
                    TempoTotalPrep = TempoTotalPrep + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                Else
                    TempoTotalProd = TempoTotalProd + IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal)
                End If
                TTOK = TTOK + IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
                TTNC = TTNC + IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
        produzidas = TTOK + TTNC
        
        'Preparação
        'Calcula total de segundos utilizados preparando
        ElapsedTime (TempoTotalPrep)
        TPUSEG = s
        
        TPUSEG = Format((TPUSEG * QuantComprado) / 100, "###,##0.0000000000")
        TPUSEGDECS = TPUSEG
        TTPUTIL = FormataTempo(TPUSEG)
        
        'Execução
        'Calcula total de segundos utilizados produzindo
        ElapsedTime (TempoTotalProd)
        TTEUTILS = s
        
        TTEUTILS = Format((TTEUTILS * QuantComprado1) / 100, "###,##0.0000000000")
        TTEUTILDECS = TTEUTILS
        TTUTIL = FormataTempo(TTEUTILS)
        TTEUTILS = TTEUTILDECS
        
        'Soma tempo total de preparação + execução
        TTUTILSEG = TPUSEGDECS + TTEUTILS
        TempoTotalUtil = FormataTempo(TPUSEGDECS + TTEUTILS)
        
        'Calcula tempo total de execução por unidade
              
'        If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000") Else TEUSEG = TTEUTILS
        
            If produzidas >= 1 Then
              If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format(TTEUTILS / produzidas, "###,##0.0000000000") Else TEUSEG = TTEUTILS
            End If

            If produzidas < 1 Then
              If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format((TTEUTILS * (produzidas * 1000) / 1000), "###,##0.0000000000") Else TEUSEG = TTEUTILS
            End If

        
        
        'TESTE = TTEUTILS / produzidas
        DecimoSegundos = TEUSEG
           
        'Calcula e grava valor real do lote e por peça
        ProcCalculaValorHoraPosto
        
        'Deleta os lançamentos de turno sem apontamento
        Familiatext = ""
        Set TBProcessos = CreateObject("adodb.recordset")
        TBProcessos.Open "Select Turno from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and data = '" & Format(Dataini, "Short Date") & "' and (codigodesc = 1 or codigodesc = 2) group by Turno", Conexao, adOpenKeyset, adLockOptimistic
        If TBProcessos.EOF = False Then
            Do While TBProcessos.EOF = False
                If Familiatext = "" Then Familiatext = "and Turno <> " & TBProcessos!Turno Else Familiatext = Familiatext & " and Turno <> " & TBProcessos!Turno
                TBProcessos.MoveNext
            Loop
            Conexao.Execute "DELETE from " & NomeTabelaApTotalizacao & " where OS = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' " & Familiatext & " and data = '" & Format(Dataini, "Short Date") & "'"
        End If
        
        Set TBProcessos = CreateObject("adodb.recordset")
        TBProcessos.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and Turno = " & Turno & " and data = '" & Format(Dataini, "Short Date") & "' and (codigodesc = 1 or codigodesc = 2)", Conexao, adOpenKeyset, adLockOptimistic
        If TBProcessos.EOF = False Then
            'Calcula eficiencia
            ElapsedTime (IIf(IsNull(TBOS!Preparacao), 0, TBOS!Preparacao))
            If s > 0 And TPUSEGDECS > 0 Then Eficiencia_prep = Format((s / TPUSEGDECS) * 100, "###,##0.00") Else Eficiencia_prep = 0
            If IIf(IsNull(TBOS!TESegundos), 0, TBOS!TESegundos) > 0 And TEUSEG > 0 Then Eficiencia_exec = Format((TBOS!TESegundos / TEUSEG) * 100, "###,##0.00") Else Eficiencia_exec = 0
            
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from " & NomeTabelaApTotalizacao & " where OS = " & TBOS!IDProducao & " and Usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and Turno = " & Turno & " and data = '" & Format(Dataini, "Short Date") & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = True Then TBproducao.AddNew
            TBproducao!Ordem = TBOS!Ordem
            TBproducao!OS = TBOS!IDProducao
            TBproducao!Fase = TBOS!Fase
            TBproducao!Data = Dataini
            TBproducao!Usuario = cmbOperador
            TBproducao!maquina = txtAPMaquina.Text
            TBproducao!Turno = Turno
            'Preparação
            TBproducao!Preparacao = TBOS!TempoPreparacao 'Tempo total previsto de preparação
            TBproducao!TPUTIL = TTPUTIL 'Tempo total real de preparação do lote
            'Execução
            TBproducao!Execucao = TBOS!TempoExecucao 'Tempo total previsto de execução
            TBproducao!QTOK = TTOK
            TBproducao!QTNC = TTNC
            TBproducao!TEUTIL = FormataTempo(TEUSEG) 'Tempo total real de execução por unidade
            TBproducao!TETTUTIL = TempoTotalUtil 'Tempo total real de preparação + tempo total real de execução do lote
            TBproducao!Valor_hs_prep = ValorHoraPrep * 3600
            TBproducao!Valor_hs_exec = ValorHora * 3600
            TBproducao!CRLOTE = CTTLOTE
            TBproducao!CRPECA = CTTPECA
            TBproducao!CPLOTE = TBOS!CPLOTE
            TBproducao!CPPECA = TBOS!CPPECA
            TBproducao!Eficiencia_prep = Eficiencia_prep
            TBproducao!Eficiencia_exec = Eficiencia_exec
            If Eficiencia_prep > 0 And Eficiencia_exec > 0 Then
                TBproducao!Eficiencia = (Eficiencia_prep + Eficiencia_exec) / 2
            ElseIf Eficiencia_prep > 0 Then
                    TBproducao!Eficiencia = Eficiencia_prep
                ElseIf Eficiencia_exec > 0 Then
                        TBproducao!Eficiencia = Eficiencia_exec
                    Else
                        TBproducao!Eficiencia = 0
            End If
            TBproducao!Totalprod = produzidas
            TBproducao.Update
            TBproducao.Close
        Else
            Conexao.Execute "DELETE from " & NomeTabelaApTotalizacao & " where OS = " & TBOS!IDProducao & " and usuario = '" & cmbOperador & "' and maquina = '" & txtAPMaquina.Text & "' and Turno = " & Turno & " and data = '" & Format(Dataini, "Short Date") & "'"
        End If
        TBProcessos.Close
        
        Conexao.Execute "Update " & NomeTabelaApTotalizacao & " Set pronto = '" & TBOS!Pronto & "' where OS = " & TBOS!IDProducao
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCalculaValorHoraPosto()
On Error GoTo tratar_erro

If produzidas = 0 Then Exit Sub

Set TBMaquinas = CreateObject("adodb.recordset")
TBMaquinas.Open "Select * from cadmaquinas where maquina = '" & txtAPMaquina.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
    'Verifica se tem acessórios no posto
    TextoFiltro = "from CadMaquinas_acessorios CMA INNER JOIN Ferramentas F ON F.ID_acessorio = CMA.ID where F.IDFase = " & IIf(IsNull(TBOS!IDFase), 0, TBOS!IDFase) & ""
    
    'Soma valor prep.
    Valor_Cofins_Serv = 0
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select Sum(CMA.Valor_prep * F.Quantidade) as Valor_Cofins_Serv " & TextoFiltro & " and CMA.Operacao_prep = 1", Conexao, adOpenKeyset, adLockOptimistic
    If TBCFOP.EOF = False Then
        Valor_Cofins_Serv = IIf(IsNull(TBCFOP!Valor_Cofins_Serv), 0, TBCFOP!Valor_Cofins_Serv)
    End If
    'Subtrai valor prep.
    Valor_CSLL_Prod = 0
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select Sum(CMA.Valor_prep * F.Quantidade) as Valor_CSLL_Prod " & TextoFiltro & " and CMA.Operacao_prep = 2", Conexao, adOpenKeyset, adLockOptimistic
    If TBCFOP.EOF = False Then
        Valor_CSLL_Prod = IIf(IsNull(TBCFOP!Valor_CSLL_Prod), 0, TBCFOP!Valor_CSLL_Prod)
    End If
    'Soma valor exec.
    Valor_CSLL_Serv = 0
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select Sum(CMA.Valor_exec * F.Quantidade) as Valor_CSLL_Serv " & TextoFiltro & " and CMA.Operacao_exec = 1", Conexao, adOpenKeyset, adLockOptimistic
    If TBCFOP.EOF = False Then
        Valor_CSLL_Serv = IIf(IsNull(TBCFOP!Valor_CSLL_Serv), 0, TBCFOP!Valor_CSLL_Serv)
    End If
    'Subtrai valor exec.
    Valor_INSS_Serv = 0
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select Sum(CMA.Valor_exec * F.Quantidade) as Valor_INSS_Serv " & TextoFiltro & " and CMA.Operacao_exec = 2", Conexao, adOpenKeyset, adLockOptimistic
    If TBCFOP.EOF = False Then
        Valor_INSS_Serv = IIf(IsNull(TBCFOP!Valor_INSS_Serv), 0, TBCFOP!Valor_INSS_Serv)
    End If
    
    'Verifica se tem percentual de HE no turno
    Valor_Cofins_Prod = 0
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select * from CadmaqTurnos where maquina = '" & txtAPMaquina.Text & "' and Diasemana = '" & Diasemana & "' and Turno = " & Turno & " and Percentual_HoraExtra IS NOT NULL", Conexao, adOpenKeyset, adLockOptimistic
    If TBCFOP.EOF = False Then
        If TBCFOP!Percentual_HoraExtra <> "" Then Valor_Cofins_Prod = TBCFOP!Percentual_HoraExtra
    End If
    
    If IsNull(TBMaquinas!PrecoHora_Setup) = False And TBMaquinas!PrecoHora_Setup <> "" Then ValorHoraPrep = TBMaquinas!PrecoHora_Setup + Valor_Cofins_Serv - Valor_CSLL_Prod Else ValorHoraPrep = TBMaquinas!PrecoHora + Valor_Cofins_Serv - Valor_CSLL_Prod
    ValorHoraPrep = (ValorHoraPrep + ((ValorHoraPrep * Valor_Cofins_Prod) / 100)) / 3600
    
    ValorHora = TBMaquinas!PrecoHora + Valor_CSLL_Serv - Valor_INSS_Serv
    ValorHora = (ValorHora + ((ValorHora * Valor_Cofins_Prod) / 100)) / 3600
    
    If produzidas > 1 Then
        If TEUSEG > 0 Or TPUSEGDECS > 0 Then CTTLOTE = Format((ValorHora * (TEUSEG * produzidas)) + (ValorHoraPrep * TPUSEGDECS), "###,##0.00")
        If TEUSEG > 0 Or TPUSEGDECS > 0 Then CTTPECA = Format(CTTLOTE / produzidas, "###,##0.0000000000") Else CTTPECA = 0
    Else
        If TEUSEG > 0 Or TPUSEGDECS > 0 Then CTTLOTE = Format((ValorHora * (TEUSEG / produzidas)) + (ValorHoraPrep * TPUSEGDECS), "###,##0.00")
        If TEUSEG > 0 Or TPUSEGDECS > 0 Then CTTPECA = Format((CTTLOTE / produzidas), "###,##0.0000000000") Else CTTPECA = 0
    End If
Else
    ValorHora = 0
    ValorHoraPrep = 0
End If
TBMaquinas.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcGravaValoresOS()
On Error GoTo tratar_erro

If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.*, P.DtValidacao_custo from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        valor = 0
        Valor1 = 0
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Sum(CRLOTE) as Valor, Sum(Totalprod) as Valor1 from ordemservico_maq_utilizadas where OS = " & TBOS!IDProducao, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            valor = IIf(IsNull(TBAbrir!valor), 0, TBAbrir!valor)
            Valor1 = IIf(IsNull(TBAbrir!Valor1), 0, TBAbrir!Valor1)
        End If
        TBAbrir.Close
        TBOS!CRLOTE = valor
        
'        If Valor1 < 1 Then
'        If valor <> 0 And Valor1 <> 0 Then TBOS!CRPECA = valor * Valor1 Else TBOS!CRPECA = 0
'        Else
        If valor <> 0 And Valor1 <> 0 Then TBOS!CRPECA = valor / Valor1 Else TBOS!CRPECA = 0
'        End If
        
        'Atualiza posto de trabalho na OS
        TBOS!maquina = txtAPMaquina
        
        TBOS.Update
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCalculaEficienciaOF(Ordem As Long, quantidade As Long)
On Error GoTo tratar_erro
'================================================================
' Zera as variaveis
'================================================================
TEPSEG = 0
Eficiencia_prep = 0
Eficiencia_exec = 0
TPPREV = 0
TEPSEG = 0
TEUSEG = 0

'================================================================
' Verifica qtde de peças produzidas na ordem
'================================================================
produzidas = IIf(IsNull(TBproducao!QuantProd), 0, TBproducao!QuantProd)
'================================================================
' Soma total de preparacao e execucao previstos da ordem
'================================================================
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select Preparacao, TESegundos,TEUSEG from ORDEMSERVICO WHERE Ordem = " & Ordem & " and custos = 'true'", Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    Do While TBAbrir.EOF = False
        TPPREV = TPPREV + IIf(IsNull(TBAbrir!Preparacao), 0, TBAbrir!Preparacao)
        TEPSEG = TEPSEG + IIf(IsNull(TBAbrir!TESegundos), 0, TBAbrir!TESegundos)
        TEUSEG = TEUSEG + IIf(IsNull(TBAbrir!TEUSEG), 0, TBAbrir!TEUSEG)
        TBAbrir.MoveNext
    Loop
End If
TBAbrir.Close
'================================================================
' Calcula preparacao previsto em segundos
'================================================================
ElapsedTime (TPPREV)
TPPSEG = s
'================================================================
' Calcula tempo total da ordem execucao + preparacao
'================================================================
If produzidas <> 0 And produzidas >= 1 Then
DecimoSegundos = TEPSEG + (TPPSEG / produzidas)
TBproducao!TPP = FormataTempo(DecimoSegundos)
End If

If produzidas <> 0 And produzidas < 1 Then
DecimoSegundos = (TEPSEG + TPPSEG) ' * produzidas
TBproducao!TPP = FormataTempo(DecimoSegundos)
End If
'================================================================
' Calcula custo da ordem por unidade
'================================================================
If produzidas <> 0 Then
TBproducao!cpp = IIf(IsNull(TBproducao!CTTPrev), 0, TBproducao!CTTPrev) / produzidas
End If

'If produzidas <> 0 And produzidas < 1 Then
'TBproducao!cpp = IIf(IsNull(TBproducao!CTTPrev), 0, TBproducao!CTTPrev) * produzidas
'End If

'================================================================
' Calcula eficiência preparacao unitária da ordem
'================================================================
If TPPSEG > 0 And TPUSEG > 0 Then
Eficiencia_prep = Format((TPPSEG / TPUSEG) * 100, "###,##0.00")
End If
'================================================================
' Calcula tempo de execucao prevista da ordem por unidade
'================================================================
'If produzidas <> 0 And produzidas >= 1 Then
'TEPSEG = TEPSEG / produzidas
'End If

'If produzidas <> 0 And produzidas < 1 Then
'TEPSEG = TEPSEG * produzidas
'End If

'================================================================
' Calcula eficiência execucao unitária da ordem
'================================================================
If TEPSEG > 0 And TEUSEG > 0 Then
Eficiencia_exec = Format((TEPSEG / TEUSEG) * 100, "###,##0.00")
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcGravarEvento()
On Error GoTo tratar_erro
Dim qtdeNC_ordem As Double
Dim qtdeAntigaNC_ordem As Double
Dim TOK
Dim TNC

Set TBproducao = CreateObject("adodb.recordset")
If Novo_Ordem2 = True Then
    TextoFiltro = ""
    If Txt_ID_apontamento <> "" And TBOS!IDProducao <> cmbAPOS Then
        TempoInicio = mskData.Value & " " & txtinicioap.Value
        TextoFiltro = " where idfase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio = '" & TempoInicio & "' and CodigoDesc = " & txtCodigo
    End If
    
    TBproducao.Open "Select * from " & NomeTabelaAp & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
    
    If Txt_ID_apontamento <> "" And TBOS!IDProducao <> cmbAPOS Then
        If TBproducao.EOF = True Then
            TBproducao.AddNew
            Evento = "Novo evento"
        Else
            Evento = "Alterar evento"
        End If
    Else
        TBproducao.AddNew
        Evento = "Novo evento"
    End If
Else
    TBproducao.Open "Select * from " & NomeTabelaAp & " where idfase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data = '" & Format(APLista.SelectedItem.ListSubItems(10), "Short Date") & "' and Tempoinicio = '" & APLista.SelectedItem.ListSubItems(3) & "' and CodigoDesc = " & APLista.SelectedItem.ListSubItems(1), Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = True Then
        TBproducao.AddNew
        Evento = "Novo evento"
    Else
        Evento = "Alterar evento"
        QtdeAntigaAP = IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
    End If
End If

If TBOS!IDProducao = cmbAPOS Then
    produzidas = IIf(txtProduzida = "", 0, txtProduzida)
    TOK = IIf(txtTOK = "", 0, txtTOK)
    TNC = IIf(txtTNC = "", 0, txtTNC)
    If txtTOK.Text <> "" Then
        If APLista.ListItems.Count <> 0 Then
            valor = APLista.SelectedItem.ListSubItems(7)
            Valor1 = APLista.SelectedItem.ListSubItems(8)
        Else
            valor = 0
            Valor1 = 0
        End If
        valor = valor + Valor1
        If Novo_Ordem2 = True Then produzidas = produzidas + TOK + TNC Else produzidas = (produzidas + TOK + TNC) - valor
    End If
    
    'Grava qtdeOK e qtdeNC no apontamento se for máquina em producao
    If Novo_Ordem2 = False And txtCodigo = 2 Then
        TBproducao!quantidade = TOK
        TBproducao!Reprovada = TNC
        If TNC > 0 Then
            IDProducaoNC = TBproducao!IDProducao
            
            If FunVerifNCRejeitado(cmbAPOS) = True Then Conexao.Execute "DELETE from CQ_NC_FABRICA where idproducao = " & TBproducao!IDProducao
        Else
            Conexao.Execute "DELETE from CQ_NC_FABRICA where idproducao = " & TBproducao!IDProducao
        End If
    End If
End If
        
TBproducao!Ordem = TBOS!Ordem
TBproducao!Fase = TBOS!Fase
TBproducao!maquina = txtAPMaquina.Text
TBproducao!Usuario = cmbOperador.Text
TBproducao!Descricao = cmbdescricao.Text
TBproducao!CodigoDesc = txtCodigo.Text
EventoAP = TBproducao!CodigoDesc

TempoInicio = mskData.Value & " " & txtinicioap.Value
TBproducao!Data = mskData.Value
TBproducao!TempoInicio = TempoInicio
ProcVerifApontamentoAnterior
TempoInicio = TBproducao!TempoInicio
If IsNull(TBproducao!TempoFinal) = False And TBproducao!TempoFinal <> "" And TBproducao!TempoFinal <> "00:00:00" Then
    TempoFinal = TBproducao!TempoFinal
    TempoTotal = TempoFinal - TempoInicio
    ElapsedTime (TempoTotal)
    TempoTotal = Format(TempoTotal, "hh:mm:ss")
    TBproducao!TempoTotal = TempoTotal
    TBproducao!TempoTotalSeg = s
    TBproducao!Dias = D
Else
    ProcVerifProximoApontamento
    TBproducao!Pronto = "NÃO"
End If

Procsaida
TBproducao!Preparacao = Preparacao
TBproducao!Execucao = Execucao

TBproducao!Quant = TBOS!quantidade
TBproducao!IDFase = TBOS!IDProducao
TBproducao!OS = TBOS!IDProducao
TBproducao!Turno = Turno
TBproducao.Update
ID_documento = TBproducao!IDProducao

'Grava qtdeOK e qtdeNC no apontamento anterior se for máquina em producao
If TBOS!IDProducao = cmbAPOS Then
    If Novo_Ordem2 = True Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select codigodesc, IDProducao, quantidade, reprovada, Data, maquina, TempoInicio, Turno from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio < '" & TempoInicio & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            TBAbrir.MoveLast
            If TBAbrir!CodigoDesc = 2 Then
                TBAbrir!quantidade = TOK
                TBAbrir!Reprovada = TNC
                If TNC > 0 Then
                    IDProducaoNC = TBAbrir!IDProducao
                    DataNC = TBAbrir!Data
                    MaquinaNC = TBAbrir!maquina
                    InicioNC = Format(TBAbrir!TempoInicio, "hh:mm:ss")
                    TurnoNC = TBAbrir!Turno
                End If
                TBAbrir.Update
            End If
        End If
        TBAbrir.Close
    Else
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select codigodesc, IDProducao, quantidade, reprovada, Data, maquina, TempoInicio, Turno from " & NomeTabelaAp & " where IDproducao = " & APLista.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            If TBAbrir!CodigoDesc = 2 And TNC > 0 Then
                IDProducaoNC = TBAbrir!IDProducao
                DataNC = TBAbrir!Data
                MaquinaNC = TBAbrir!maquina
                InicioNC = Format(TBAbrir!TempoInicio, "hh:mm:ss")
                TurnoNC = TBAbrir!Turno
            End If
        End If
    End If
    'Grava dados de não conformidade na tabela CQ_NC_FABRICA
    If TNC > 0 Then
        
        qtdeAntigaNC_ordem = 0
        Set TBCQ = CreateObject("adodb.recordset")
        TBCQ.Open "Select codigo from CQ_NC_FABRICA where idproducao = " & IDProducaoNC, Conexao, adOpenKeyset, adLockOptimistic
        qtdeAntigaNC_ordem = TBCQ.RecordCount
        TBCQ.Close
        
        If TNC > qtdeAntigaNC_ordem Then
            qtdeNC_ordem = TNC ' - qtdeAntigaNC_ordem
            CamposLoop = ""
            
            OperadorTexto = ""
            Set TBUsuarios = CreateObject("adodb.recordset")
            TBUsuarios.Open "Select CODIGO from Usuarios where Usuario = '" & cmbOperador & "' and Bloqueado = 'False'", Conexao, adOpenKeyset, adLockOptimistic
            If TBUsuarios.EOF = False Then
                If IsNull(TBUsuarios!CODIGO) = False And TBUsuarios!CODIGO <> "" Then OperadorTexto = TBUsuarios!CODIGO & "-" & cmbOperador Else OperadorTexto = cmbOperador
            End If
            TBUsuarios.Close
            
            SetorNC = ""
            Set TBMaquinas = CreateObject("adodb.recordset")
            TBMaquinas.Open "Select Setor from CadMaquinas where Maquina = '" & MaquinaNC & "'", Conexao, adOpenKeyset, adLockOptimistic
            If TBMaquinas.EOF = False Then
                SetorNC = TBMaquinas!Setor
            End If
            TBMaquinas.Close
            
            Dim ParecerCQ As String 'OK
            If FunVerifNCRejeitado(TBOS!IDProducao) = True Then ParecerCQ = "Rejeitar" Else ParecerCQ = "Nada consta"
            
            If FunVerifNCPorDescricao(TBOS!IDProducao) = True Then
                For i = 1 To frmprod_qtdeNC.QtdeDescricaoNC
                    If ArrayQtdeDescNC(i, 2) <> "" And ArrayQtdeDescNC(i, 2) <> "0" Then
                        qtdeNC_ordem = ArrayQtdeDescNC(i, 2)
                       ' Do While qtdeNC_ordem > 0
                            If CamposLoop = "" Then
                                CamposLoop = "(" & IDProducaoNC & "," & TBOS!Ordem & "," & TBOS!IDProducao & ", " & Replace(qtdeNC_ordem, ",", ".") & " , " & txtAPquant.Text & ", '" & DataNC & "', '" & InicioNC & "', '" & MaquinaNC & "', " & TurnoNC & ", '" & ParecerCQ & "', '" & OperadorTexto & "', '" & SetorNC & "', '" & ArrayQtdeDescNC(i, 1) & "', 1)"
                            Else
                                CamposLoop = CamposLoop & ", (" & IDProducaoNC & "," & TBOS!Ordem & "," & TBOS!IDProducao & ", " & Replace(qtdeNC_ordem, ",", ".") & " , " & Replace(txtAPquant.Text, ",", ".") & ", '" & DataNC & "', '" & InicioNC & "', '" & MaquinaNC & "', " & TurnoNC & ", '" & ParecerCQ & "', '" & OperadorTexto & "', '" & SetorNC & "', '" & ArrayQtdeDescNC(i, 1) & "', 1)"
                            End If
                       '     qtdeNC_ordem = qtdeNC_ordem - 1
                       ' Loop
                        Conexao.Execute "INSERT INTO CQ_NC_FABRICA (IDProducao, Ordem, OS, TTNC, LOTE, Data, Hora, Maquina, Turno, PARECERCQ, Operador, Setor, obsFab, Analizada) VALUES " & CamposLoop
                    End If
                    CamposLoop = ""
                Next
            Else
                'Do While qtdeNC_ordem > 0
                    If CamposLoop = "" Then
                        CamposLoop = "(" & IDProducaoNC & "," & TBOS!Ordem & "," & TBOS!IDProducao & ", " & Replace(qtdeNC_ordem, ",", ".") & " , " & Replace(txtAPquant.Text, ",", ".") & ", '" & DataNC & "', '" & InicioNC & "', '" & MaquinaNC & "', " & TurnoNC & ", '" & ParecerCQ & "', '" & OperadorTexto & "', '" & SetorNC & "')"
                    Else
                        CamposLoop = CamposLoop & ", (" & IDProducaoNC & "," & TBOS!Ordem & "," & TBOS!IDProducao & "," & Replace(qtdeNC_ordem, ",", ".") & ", " & Replace(txtAPquant.Text, ",", ".") & ", '" & DataNC & "', '" & InicioNC & "', '" & MaquinaNC & "', " & TurnoNC & ", '" & ParecerCQ & "', '" & OperadorTexto & "', '" & SetorNC & "')"
                    End If
                    'qtdeNC_ordem = qtdeNC_ordem - 1
                'Loop
                '==================================
                'Debug.print CamposLoop
                Conexao.Execute "Delete from CQ_NC_FABRICA Where OS = " & TBOS!IDProducao & ""
                
                Conexao.Execute "INSERT INTO CQ_NC_FABRICA (IDProducao, Ordem, OS, TTNC, LOTE, Data, Hora, Maquina, Turno, PARECERCQ, Operador, Setor) VALUES " & CamposLoop
            End If
        ElseIf TNC < qtdeAntigaNC_ordem Then
                qtdeNC_ordem = qtdeAntigaNC_ordem - TNC
               ' Do While qtdeNC_ordem > 0
                    Set TBCQ = CreateObject("adodb.recordset")
                    TBCQ.Open "Select codigo from CQ_NC_FABRICA where idproducao = " & IDProducaoNC, Conexao, adOpenKeyset, adLockOptimistic
                    If TBCQ.EOF = False Then TBCQ.Delete
                    TBCQ.Close
               '     qtdeNC_ordem = qtdeNC_ordem - 1
               ' Loop
        End If
    End If
End If
TBproducao.Close
'==================================
Modulo = "PCP/Gerenciamento de ordem"
Documento = "Ordem: " & TBOS!Ordem & " - Cód. interno: " & TBOS!Desenho
Documento1 = "OS: " & TBOS!IDProducao & " - Evento: " & txtCodigo
ProcGravaEvento
'==================================

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaEvento()
On Error GoTo tratar_erro

If Gravar = False Then Exit Sub
If Novo_Ordem2 = True Then
    If EventoAP = 3 Then Familiatext = "SIM" Else Familiatext = "NÃO"
    ULTICOD = EventoAP
Else
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " order by Data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
        ULTICOD = TBproducao!CodigoDesc
        If TBproducao!CodigoDesc = 3 Then Familiatext = "SIM" Else Familiatext = "NÃO"
    End If
    TBproducao.Close
End If
'Filtra todos os eventos desta OS na tabela producaofases para marcar como fase pronta
If Txt_ID_apontamento <> "" Then
    Conexao.Execute "Update " & NomeTabelaAp & " Set " & NomeTabelaAp & ".Pronto = '" & Familiatext & "' from " & NomeTabelaAp & " INNER JOIN OrdemServico ON " & NomeTabelaAp & ".IDFase = OrdemServico.IDproducao where OrdemServico.ID_apontamento = " & Txt_ID_apontamento
    
    Set TBOS = CreateObject("adodb.recordset")
    TBOS.Open "Select * from OrdemServico where ID_apontamento = " & Txt_ID_apontamento, Conexao, adOpenKeyset, adLockOptimistic
    If TBOS.EOF = False Then
        Do While TBOS.EOF = False
            ProcMudaStatusOS TBOS!IDProducao, Familiatext
            TBOS.MoveNext
        Loop
        
        TBOS.MoveFirst
        Do While TBOS.EOF = False
            ProcMudaStatusOrdem TBOS!Ordem
            TBOS.MoveNext
        Loop
    End If
    TBOS.Close
Else
    Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = '" & Familiatext & "' where idfase = " & cmbAPOS
    ProcMudaStatusOS cmbAPOS, Familiatext
    ProcMudaStatusOrdem txtAPOF
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcMudaStatusOS(OS As Long, Pronto As String)
On Error GoTo tratar_erro

Conexao.Execute "Update ordemservico Set Pronto = '" & Pronto & "', Dataconclusao = '" & mskData.Value & "', Status = 'Concluída' where IDproducao = " & OS

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcMudaStatusOrdem(Ordem As Long)
On Error GoTo tratar_erro

'Checa se todas as ordens de servicos com processo da ordem foram executadas e da baixa na ordem
Set TBOrdemServico = CreateObject("adodb.recordset")
TBOrdemServico.Open "Select * from ordemservico where Ordem = " & Ordem & " and pronto = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
If TBOrdemServico.EOF = True Then
    Set TBFases = CreateObject("adodb.recordset")
    TBFases.Open "Select * from ordemservico where Ordem = " & Ordem & " order by fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
    If TBFases.EOF = False Then
        TBFases.MoveLast
        Set TBOrdem = CreateObject("adodb.recordset")
        TBOrdem.Open "Select * from Producao where Ordem = " & Ordem, Conexao, adOpenKeyset, adLockOptimistic
        If TBOrdem.EOF = False Then
            If TBFases!Pronto = "SIM" Then
                TBOrdem!pronta = "SIM"
                TBOrdem!Concluida = True
                If TBOrdem!status <> "Entregue" Then TBOrdem!status = "Concluída"
                TBOrdem!DataEntrega = TBFases!DataConclusao
            Else
                TBOrdem!pronta = "NÃO"
                TBOrdem!Concluida = False
                If TBOrdem!status <> "Entregue" Then TBOrdem!status = "Produzindo"
                TBOrdem!DataEntrega = Null
            End If
            TBOrdem.Update
                
            'Verifica se todas as ordems de fabricação do produto já foram concluidas
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from producao_pedidos where Ordem = " & TBOrdem!Ordem & " order by IDCarteira", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                Do While TBFIltro.EOF = False
                    Set TBProcessos = CreateObject("adodb.recordset")
                    TBProcessos.Open "Select Producao_pedidos.IDCarteira FROM Producao INNER JOIN Producao_pedidos ON Producao.Ordem = Producao_pedidos.Ordem where Producao_pedidos.IDCarteira = " & TBFIltro!IDcarteira & " and Producao.pronta = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBProcessos.EOF = True Then
                        Set TBVendas = CreateObject("adodb.recordset")
                        TBVendas.Open "Select * from Vendas_carteira where Codigo = " & TBFIltro!IDcarteira, Conexao, adOpenKeyset, adLockOptimistic
                        If TBVendas.EOF = False Then
                            TBVendas!saida_estoque = True
                            TBVendas!dataprodsaida = TBOrdem!DataEntrega
                            TBVendas.Update
                        End If
                        TBVendas.Close
                    End If
                    TBProcessos.Close
                    TBFIltro.MoveNext
                Loop
            End If
            TBFIltro.Close
        End If
        TBOrdem.Close
    End If
    TBFases.Close
End If
TBOrdemServico.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcRetirarCancelarEstoque()
On Error GoTo tratar_erro
Dim PesquisarEmpenho As Boolean

QTUnitario = 0
QTBaixar = 0
'QTBaixado = 0
QTSaldo = 0
QTEmpenhado = 0
'QTLote = 0
QTEstoque = 0
TOK = IIf(txtTOK.Text = "", 0, txtTOK.Text)
TNC = IIf(txtTNC.Text = "", 0, txtTNC.Text)

Set TBItem = CreateObject("adodb.recordset")
TBItem.Open "Select * from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockReadOnly
If TBItem.EOF = False Then
Set TBMaterial = CreateObject("adodb.recordset")
TBMaterial.Open "Select PM.Unidade, ISNULL(P.IDcliente, 0) AS IDcliente, PM.Ordem, PM.Codigo, PM.Requisitado, PM.Total_pc, PM.Saida, PM.Valor_saida_estoque from Producao P INNER JOIN Producaomaterial PM ON PM.Ordem = P.Ordem where PM.Ordem = " & TBOrdem!Ordem & " order by PM.Posicao", Conexao, adOpenKeyset, adLockReadOnly
'TBMaterial.Open "Select PM.Unidade, ISNULL(P.IDcliente, 0) AS IDcliente, PM.Ordem, PM.Codigo, PM.Requisitado, PM.Requisitado - ISNULL(QSEP.Saida, 0) as TotalRequisitado, ISNULL(QSEP.Saida, 0) as QtdeSaida, PM.Total_pc, PM.Total_pc - ISNULL(QSEP.Saida_PC, 0) as TotalRequisitadoPC, PM.Saida, PM.Valor_saida_estoque, PNC.Quantidade, PNC.Quantidade_PC, PNC.IDestoque from ((Producao P INNER JOIN Producaomaterial PM ON PM.Ordem = P.Ordem) LEFT JOIN Producao_NF_Consignada PNC ON PM.Ordem = PNC.Ordem and PM.Codigo = PNC.Codinterno) LEFT JOIN Qtde_saida_estoque_produto QSEP ON QSEP.Ordem = PM.Ordem and QSEP.Desenho = PM.Codigo where PM.Ordem = " & TBOrdem!Ordem & TextoFiltroRM & " order by PM.Posicao", Conexao, adOpenKeyset, adLockReadOnly
If TBMaterial.EOF = False Then
    Do While TBMaterial.EOF = False
    QTUnitario = TBMaterial!Requisitado / TBOrdem!Quant
    QTBaixar = 0
'==============================================
'Se não for uma exclusão de apontamento
'==============================================
 If ExcluirAP = False Then
     QTBaixado = 0
     QTBaixado1 = 0
'==============================================
'Verifica quantidade que já foi baixada dessa requisição
'==============================================
 Set TBControleNF = CreateObject("adodb.recordset")
 TBControleNF.Open "Select ISNULL(Saida, 0) as QtdeSaida, ISNULL(Saida_PC, 0) as qtdeSaidaPC from Qtde_saida_estoque_produto where Ordem = " & TBOrdem!Ordem & " AND desenho = '" & TBMaterial!CODIGO & "'", Conexao, adOpenKeyset, adLockReadOnly
 If TBControleNF.EOF = False Then
     QTBaixado = TBControleNF!QtdeSaida
     QTBaixado1 = TBControleNF!QtdeSaidaPC
 End If
 TBControleNF.Close
 '=============================================
 'Verifica quantidade a QTBaixar menos quantidade baixada
 Set TBControleNF = CreateObject("adodb.recordset")
 TBControleNF.Open "Select ISNULL(TotalProd,0) as TotalProd from Ordemservico where IDProducao = " & cmbAPOS, Conexao, adOpenKeyset, adLockReadOnly
 If TBControleNF.EOF = False Then
     QTSaldo = (QTUnitario * (TOK + TNC + TBControleNF!Totalprod))
     If QTSaldo > QTBaixado Then
         QTBaixar = Format(QTSaldo - QTBaixado, "0.0000")
     End If
 End If
 TBControleNF.Close
'=============================================
'Efetua o cálculo de Requisitado menos saida
'=============================================
     QTBaixado = IIf(IsNull(TBMaterial!Requisitado), 0, Format(TBMaterial!Requisitado - QTBaixado, "0.0000"))
     QTBaixado1 = IIf(IsNull(TBMaterial!Total_pc), 0, TBMaterial!Total_pc - QTBaixado1)
 Else
     QTBaixar = Format(QTUnitario * (TOK + TNC), "0.0000")
 End If
'============================================
PesquisarEmpenho = False
'============================================
'Se não for exclusão de apontamento
'============================================
If ExcluirAP = False Then
'============================================
'Verifica se tem empenho
'============================================
Set TBControleNF = CreateObject("adodb.recordset")
'============================================
' Verifica se é material consignado
'============================================
TBControleNF.Open "Select IDestoque from Producao_NF_Consignada where Ordem = " & TBOrdem!Ordem & " AND Codinterno = '" & TBMaterial!CODIGO & "' AND (quantidade - qtde_saida) > 0", Conexao, adOpenKeyset, adLockReadOnly
If TBControleNF.EOF = False Then
    PesquisarEmpenho = True
    TextoFiltro = " where EM.ordem = " & TBOrdem!Ordem & " AND EM.Codinterno = '" & TBMaterial!CODIGO & "' AND EC.Estoque_real > 0 AND (EM.quantidade - EM.qtde_saida) > 0 order by EM.id"
    INNERJOINTEXTO = "EC.* from estoque_controle EC INNER JOIN Producao_NF_Consignada EM ON EM.idestoque = EC.idestoque"
Else
'============================================
' Se não for material consignado
'============================================
    TextoFiltro = " where EC.Desenho = '" & TBMaterial!CODIGO & "' and EC.Estoque_real > 0 and EP.Liberado = 'SIM' AND EL.Estoque = 'False' and (EC.Consignacao = 'False' or EC.Consignacao = 'True' and EC.id_cliente = " & TBMaterial!IDCliente & " and EC.Tipodest_NFcons = 'C' or EC.Consignacao = 'True' and EC.Tipodest_NFcons = 'F') order by EC.Data, EC.IDestoque"
    INNERJOINTEXTO = "EC.* from (estoque_controle EC INNER JOIN Estoque_produtos EP ON EP.IDestoque = EC.IDestoque) INNER JOIN Estoque_Localarmazenamento_criar EL ON EL.descricao = EP.local_armaz"
End If
TBControleNF.Close
Else
INNERJOINTEXTO = "EC.* from estoque_controle EC INNER JOIN Estoque_movimentacao EM ON EM.IDestoque = EC.IDestoque"
TextoFiltro = " where EM.Desenho = '" & TBMaterial!CODIGO & "' and EM.Documento = '" & TBOrdem!Ordem & "' and EM.Data = '" & Format(mskData.Value, "Short Date") & "' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL') order by EC.Data desc, EC.IDestoque desc"
End If
'================================================
ContinuaEstoqueSemEmpenho:
Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select " & INNERJOINTEXTO & TextoFiltro, Conexao, adOpenKeyset, adLockReadOnly

Do While TBEstoque.EOF = False
If ExcluirAP = False And PesquisarEmpenho = False Then
    'Verifica se tem empenho para a ordem e pedido interno
    If IsNumeric(TBEstoque!LOTE) = True Then
        Set TBLISTA = CreateObject("adodb.recordset")
        TBLISTA.Open "Select SUM(PP.Qtde_empenho) AS Qtde_empenho from Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem and P.Desenho = '" & TBMaterial!CODIGO & "' where PP.OrdemEmpenho = " & TBMaterial!Ordem & " and PP.Ordem = " & TBEstoque!LOTE, Conexao, adOpenKeyset, adLockReadOnly
        If TBLISTA.EOF = False Then
            QTBaixar = QTBaixar - IIf(IsNull(TBLISTA!Qtde_empenho), 0, TBLISTA!Qtde_empenho)
        End If
        TBLISTA.Close
    End If
End If
If QTBaixar <= 0 Then GoTo Pula

QTEstoque = TBEstoque!estoque_real
If ExcluirAP = False Then
'===============================================
'Verifica se este RE já está QTEmpenhado para ordem de produção
'===============================================
QTEstoque = QTEstoque - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem <> " & TBOrdem!Ordem, False)
'===============================================
'Verifica se este RE já está QTEmpenhado para algum pedido interno
'================================================
QTEstoque = QTEstoque - FunVerificaQtdeEmpenhoREPI("ID_estoque = " & TBEstoque!IDEstoque)

If QTEstoque <= 0 Then
    quantnovo = FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & TBOrdem!Ordem, False)
    If quantnovo > TBEstoque!estoque_real Or quantnovo = 0 Then GoTo Proximo Else QTEstoque = TBEstoque!estoque_real
End If

If PesquisarEmpenho = True Then
    QTEmpenhado = FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & TBOrdem!Ordem, False)
'======================================================================================================
'Verifica se o total em estoque é maior que o empenho, assim ele não retira QTSaldo a mais que o empenho
'======================================================================================================
    If QTEstoque > QTEmpenhado Then QTEstoque = QTEmpenhado
End If
End If
'===================================================================
' Fim da verificação de empenhos
'===================================================================
'Efetua a movimentação no estoque
'===================================================================
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select * from Estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = True Then
'============================================
'Se for a primeira movimentação cria novo
'============================================
TBProduto.AddNew
If ExcluirAP = False Then
  If QTBaixar >= QTEstoque Then QTSaida = QTEstoque Else QTSaida = QTBaixar
   TBProduto!Saida = QTSaida
Else
  If QTBaixar >= TBProduto!Saida Then QTSaida = TBProduto!Saida Else QTSaida = QTBaixar
   TBProduto!Saida = QTSaida
End If
QuantEmpenhoPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), TBProduto!Saida, True)
TBProduto!Saida_PC = QuantEmpenhoPC

Else
'===========================================
' Se não for edita o valor da saida
'===========================================
 If ExcluirAP = False Then
  If QTBaixar >= QTEstoque Then QTSaida = QTEstoque Else QTSaida = QTBaixar
  TBProduto!Saida = TBProduto!Saida + QTSaida
 Else
  If QTBaixar >= TBProduto!Saida Then QTSaida = TBProduto!Saida Else QTSaida = QTBaixar
  TBProduto!Saida = Format(TBProduto!Saida - QTSaida, "0.0000")
 End If
 QuantEmpenhoPC = Format(FunCalculaQtdePC(TBEstoque!Desenho, TBProduto!Saida, True, TBMaterial!Unidade), "0.0000")
 TBProduto!Saida_PC = QuantEmpenhoPC
End If

'=============================================================================================
'If TBProduto.EOF = True Then
'    TBProduto.AddNew
'    If ExcluirAP = False Then
'        If qtdeliberar >= Qtd Then QTSaida = Qtd Else QTSaida = qtdeliberar
'        TBProduto!Saida = QTSaida
'    Else
'        If qtdeliberar >= TBProduto!Saida Then QTSaida = TBProduto!Saida Else QTSaida = qtdeliberar
'        TBProduto!Saida = Format(TBProduto!Saida - QTSaida, "0.0000")
'    End If
'    QuantEmpenhoPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), TBProduto!Saida, True)
'    TBProduto!Saida_PC = QuantEmpenhoPC
'Else
'    If ExcluirAP = False Then
'        If qtdeliberar >= Qtd Then QTSaida = Qtd Else QTSaida = qtdeliberar
'        TBProduto!Saida = TBProduto!Saida + QTSaida
'    Else
'        If qtdeliberar >= TBProduto!Saida Then QTSaida = TBProduto!Saida Else QTSaida = qtdeliberar
'        TBProduto!Saida = Format(TBProduto!Saida - QTSaida, "0.0000")
'    End If
'    QuantEmpenhoPC = Format(FunCalculaQtdePC(TBEstoque!Desenho, TBProduto!Saida, True, TBMaterial!Unidade), "0.0000")
'    TBProduto!Saida_PC = QuantEmpenhoPC
'End If
'===============================================================================================

'==========================================
' Fim dos calculos para saida do material
'==========================================
TBProduto!Destino = "Interno"
TBProduto!Terceiros = False
TBProduto!Documento = TBOrdem!Ordem
TBProduto!LOTE = TBEstoque!LOTE
TBProduto!Desenho = TBEstoque!Desenho
TBProduto!Data = mskData.Value
TBProduto!Descricao = TBEstoque!Descricao
TBProduto!Familia = TBEstoque!Classe
TBProduto!Requisitante = cmbOperador
TBProduto!Responsavel = pubUsuario
TBProduto!IDEstoque = TBEstoque!IDEstoque
TBProduto!Ordem = TBOrdem!Ordem
TBProduto!OE = TBOrdem!Ordem
'============================================
'Atualiza valor do material no estoque
'============================================
TBProduto!VlrUnit = IIf(IsNull(TBEstoque!valor_unitario), 0, Format(TBEstoque!valor_unitario, "0.0000000000"))
TBProduto!vlrTotal = Format(TBProduto!Saida * TBProduto!VlrUnit, "0.00")
'===============================================================
'verifica se a quantidade retirada e menor que a quantidade solicitada
'===============================================================
QuantEmpenhoPC = FunCalculaQtdePCKG(TBProduto!Saida, IIf(IsNull(TBProduto!Saida_PC), 0, TBProduto!Saida_PC), QTSaida, True)
If ExcluirAP = False Then
   If QTSaida >= QTBaixado Or IsNull(TBMaterial!Total_pc) = False And QuantEmpenhoPC >= QTBaixado1 Then
       TBProduto!Operacao = "SAIDA_ORDEM"
   Else
       TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
   End If
'===============================================================
'Grava a movimentação no estoque
'===============================================================
TBProduto.Update
'===============================================================
'Grava valores no Centro de custo
'===============================================================
IDpedido = TBProduto!IDEstoque
IDlista = TBProduto!IDoperacao
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from projproduto where desenho = '" & TBEstoque!Desenho & "'", Conexao, adOpenKeyset, adLockReadOnly
If TBAbrir.EOF = False Then
  Codproduto = TBAbrir!Codproduto
  IDAntigo = IIf(IsNull(TBAbrir!ID_PC), 0, TBAbrir!ID_PC)
End If
TBAbrir.Close

ProcCriaCreditoCCProdutoItem

QTBaixado = Format(QTBaixado - QTSaida, "0.0000")
QTBaixado1 = QTBaixado1 - QuantEmpenhoPC
'===============================================================
Else
TBProduto.Update

'Centro de custo
Conexao.Execute "DELETE from CC_realizado where ID_estoque = " & TBProduto!IDoperacao

If TBProduto!Saida <= 0 And TBProduto.EOF = False Then Conexao.Execute "DELETE from Estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')"
End If

Saida = 0
Saida_PC = 0
Valor_total = 0
Set TBFIltro = CreateObject("adodb.recordset")
TBFIltro.Open "Select Sum(Saida) as Saida, Sum(ISNULL(Saida_PC, 0)) as Saida_PC, Sum(VlrTotal) as Valortotal from Estoque_movimentacao where Documento = '" & TBOrdem!Ordem & "' and Desenho = '" & TBMaterial!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockReadOnly
If TBFIltro.EOF = False Then
Saida = IIf(IsNull(TBFIltro!Saida), 0, TBFIltro!Saida)
Saida_PC = IIf(IsNull(TBFIltro!Saida_PC), 0, TBFIltro!Saida_PC)
Valor_total = IIf(IsNull(TBFIltro!ValorTotal), 0, TBFIltro!ValorTotal)
End If
TBFIltro.Close
If Saida = 0 Then
StatusTexto = "NÃO"
ElseIf Saida >= TBMaterial!Requisitado Then
  StatusTexto = "SIM"
Else
  StatusTexto = "PARCIAL"
End If

NovoValor = Replace(Valor_total, ",", ".")
Conexao.Execute "UPDATE Producaomaterial Set Valor_saida_estoque = " & NovoValor & ", Saida = '" & StatusTexto & "' where Ordem = " & TBOrdem!Ordem & " and Codigo = '" & TBMaterial!CODIGO & "'"
'==============================================================================
'Atualiza qtde. de saída do empenho da ordem
'==============================================================================
Saida = 0
Saida_PC = 0
Set TBFIltro = CreateObject("adodb.recordset")
TBFIltro.Open "Select Sum(Saida) as Saida, Sum(ISNULL(Saida_PC, 0)) as Saida_PC from Estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and Documento = '" & TBOrdem!Ordem & "' and Desenho = '" & TBMaterial!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockReadOnly
If TBFIltro.EOF = False Then
Saida = IIf(IsNull(TBFIltro!Saida), 0, TBFIltro!Saida)
Saida_PC = IIf(IsNull(TBFIltro!Saida_PC), 0, TBFIltro!Saida_PC)
End If
TBFIltro.Close
NovoValor = Replace(Saida, ",", ".")
NovoValor1 = Replace(Saida_PC, ",", ".")
Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & NovoValor & " where IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & TBOrdem!Ordem & " and Codinterno = '" & TBMaterial!CODIGO & "'"
Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDEstoque & " and Ordem = " & TBOrdem!Ordem & " and Codinterno = '" & TBMaterial!CODIGO & "' and Quantidade_PC IS NOT NULL and Quantidade_PC > 0"

qtdeliberada = 0
qtdeliberada_PC = 0
QtdeSaida = 0
QtdeSaida_PC = 0
If TBItem!Estoque = True Then
Set TBProduto = CreateObject("adodb.recordset")
TBProduto.Open "Select Sum(Entrada) as qtdeliberada, Sum(ISNULL(Entrada_PC, 0)) as qtdeliberada_PC, Sum(Saida) as QtdeSaida, Sum(ISNULL(Saida_PC ,0)) as QtdeSaida_PC from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDEstoque, Conexao, adOpenKeyset, adLockOptimistic
If TBProduto.EOF = False Then
  qtdeliberada = IIf(IsNull(TBProduto!qtdeliberada), 0, TBProduto!qtdeliberada)
  qtdeliberada_PC = IIf(IsNull(TBProduto!qtdeliberada_PC), 0, TBProduto!qtdeliberada_PC)
  QtdeSaida = IIf(IsNull(TBProduto!QtdeSaida), 0, TBProduto!QtdeSaida)
  QtdeSaida_PC = IIf(IsNull(TBProduto!QtdeSaida_PC), 0, TBProduto!QtdeSaida_PC)
End If
End If
TBProduto.Close

NovoValor = Replace(qtdeliberada - QtdeSaida, ",", ".")
NovoValor1 = Replace(qtdeliberada_PC - QtdeSaida_PC, ",", ".")
Conexao.Execute "Update Estoque_movimentacao Set estoque_venda = " & NovoValor & " where IDestoque = " & TBEstoque!IDEstoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')"
Conexao.Execute "Update Estoque_controle Set Estoque_real = " & NovoValor & ", estoque_venda = " & NovoValor & ", estoque_real_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDEstoque & ""
Conexao.Execute "Update Estoque_controle Set Valor_Total = ROUND(valor_unitario * Estoque_real, 3) where IDestoque = " & TBEstoque!IDEstoque & ""
                      
QTBaixar = QTBaixar - QTSaida
Proximo:
TBEstoque.MoveNext
Loop
            If TBEstoque.EOF = True And QTBaixar > 0 And ExcluirAP = False And PesquisarEmpenho = True Then
                PesquisarEmpenho = False
                TextoFiltro = " where EC.Desenho = '" & TBMaterial!CODIGO & "' and EC.Estoque_real > 0 and EP.Liberado = 'SIM' and (EC.Consignacao = 'False' or EC.Consignacao = 'True' and EC.id_cliente = " & TBMaterial!IDCliente & " and EC.Tipodest_NFcons = 'C' or EC.Consignacao = 'True' and EC.Tipodest_NFcons = 'F') order by EC.Data, EC.IDestoque"
                INNERJOINTEXTO = "EC.* from estoque_controle EC INNER JOIN Estoque_produtos EP ON EP.IDestoque = EC.IDestoque"
                GoTo ContinuaEstoqueSemEmpenho
            End If
Pula:
            TBEstoque.Close
            TBMaterial.MoveNext
        Loop
    End If
    TBMaterial.Close
End If
TBItem.Close
'================================================================
'Atualiza o custo do material na ordem de produção
'================================================================
Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select Sum(EM.VlrTotal) as Valor from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EC.IDestoque = EM.IDestoque where EM.Documento = '" & TBOrdem!Ordem & "' and EC.Consignacao = 'False' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockReadOnly
If TBEstoque.EOF = False Then
    TBOrdem!CTMaterial = Format(IIf(IsNull(TBEstoque!valor), 0, TBEstoque!valor), "###,##0.00")
    TBOrdem.Update
End If
TBEstoque.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

'Private Sub ProcRetirarCancelarEstoqueOLD()
'On Error GoTo tratar_erro
'
'Set TBItem = CreateObject("adodb.recordset")
'TBItem.Open "Select * from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
'If TBItem.EOF = False Then
'    If ExcluirAP = False Then
'        TextoFiltroRM = "(PM.Saida = 'NÃO' or PM.Saida = 'PARCIAL')"
'        TextoFiltroEmpenho = " and PNC.IDestoque IS NOT NULL"
'    Else
'        TextoFiltroRM = "(PM.Saida = 'SIM' or PM.Saida = 'PARCIAL')"
'        TextoFiltroEmpenho = ""
'    End If
'FiltroSemEmpenho:
'    Set TBMaterial = CreateObject("adodb.recordset")
'    TBMaterial.Open "Select ISNULL(P.IDcliente, 0) AS IDcliente, PM.Ordem, PM.Codigo, PM.Requisitado, PM.Requisitado - ISNULL(QSEP.Saida, 0) as TotalRequisitado, ISNULL(QSEP.Saida, 0) as QtdeSaida, PM.Total_pc, PM.Total_pc - ISNULL(QSEP.Saida_PC, 0) as TotalRequisitadoPC, PM.Saida, PM.Valor_saida_estoque, PNC.Quantidade, PNC.Quantidade_PC, PNC.IDestoque from ((Producao P INNER JOIN Producaomaterial PM ON PM.Ordem = P.Ordem) LEFT JOIN Producao_NF_Consignada PNC ON PM.Ordem = PNC.Ordem and PM.Codigo = PNC.Codinterno) LEFT JOIN Qtde_saida_estoque_produto QSEP ON QSEP.Ordem = PM.Ordem and QSEP.Desenho = PM.Codigo where PM.Ordem = " & TBOrdem!Ordem & " and " & TextoFiltroRM & TextoFiltroEmpenho & " order by PM.Posicao", Conexao, adOpenKeyset, adLockOptimistic
'    If TBMaterial.EOF = False Then
'        Do While TBMaterial.EOF = False
'            QuantComprado = IIf(IsNull(TBMaterial!TotalRequisitado), 0, Format(TBMaterial!TotalRequisitado, "###,##0.0000"))
'            QuantComprado1 = IIf(IsNull(TBMaterial!TotalRequisitadoPC), 0, TBMaterial!TotalRequisitadoPC)
'
'            INNERJOINTEXTO = "EC.* from estoque_controle EC INNER JOIN Estoque_produtos EP ON EP.IDestoque = EC.IDestoque"
'            'If ExcluirAP = False And IsNull(TBMaterial!IDestoque) = False And TextoFiltroEmpenho <> "" Then
'
'            'Else
'                Peso = TBMaterial!Requisitado / TBOrdem!Quant
'
'                qtdeliberar = 0
'                If ExcluirAP = False Then
'                    Set TBControleNF = CreateObject("adodb.recordset")
'                    TBControleNF.Open "Select ISNULL(TotalProd,0) as TotalProd from Ordemservico where IDProducao = " & cmbAPOS, Conexao, adOpenKeyset, adLockReadOnly
'                    If TBControleNF.EOF = False Then
'                        SaqueQTSaldo = (Peso * (TOK + TNC + TBControleNF!Totalprod))
'                        If SaqueQTSaldo > TBMaterial!QtdeSaida Then
'                            'qtdeliberar = IIf(TBMaterial!TotalRequisitado < TBMaterial!Quantidade, Format(TBMaterial!TotalRequisitado, "###,##0.0000"), Format(TBMaterial!Quantidade, "###,##0.0000"))
'                            qtdeliberar = Format(SaqueQTSaldo - TBMaterial!QtdeSaida, "0.0000")
'                        End If
'                    End If
'                    TBControleNF.Close
'                Else
'                    qtdeliberar = Format(Peso * (TOK + TNC), "0.0000")
'                End If
'
'                If ExcluirAP = False And IsNull(TBMaterial!IDestoque) = False And TextoFiltroEmpenho <> "" Then
'                    TextoFiltro = " where EC.IDestoque = " & TBMaterial!IDestoque
'                ElseIf ExcluirAP = False Then
'                    TextoFiltro = " where EC.Desenho = '" & TBMaterial!CODIGO & "' and EC.Estoque_real > 0 and EP.Liberado = 'SIM' and (EC.Consignacao = 'False' or EC.Consignacao = 'True' and EC.id_cliente = " & TBMaterial!IDCliente & " and EC.Tipodest_NFcons = 'C' or EC.Consignacao = 'True' and EC.Tipodest_NFcons = 'F') order by EC.Data, EC.IDestoque"
'                Else
'                    INNERJOINTEXTO = "EC.* from estoque_controle EC INNER JOIN Estoque_movimentacao EM ON EM.IDestoque = EC.IDestoque"
'                    TextoFiltro = " where EM.Desenho = '" & TBMaterial!CODIGO & "' and EM.Documento = '" & TBOrdem!Ordem & "' and EM.Data = '" & Format(mskData.Value, "Short Date") & "' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL') order by EC.Data desc, EC.IDestoque desc"
'                End If
'            'End If
'
'ContinuaEstoqueSemEmpenho:
'            Set TBEstoque = CreateObject("adodb.recordset")
'            TBEstoque.Open "Select " & INNERJOINTEXTO & TextoFiltro, Conexao, adOpenKeyset, adLockReadOnly
'            If TBEstoque.EOF = False Then
'                Do While TBEstoque.EOF = False
'                    If ExcluirAP = False And TextoFiltroEmpenho = "" Then
'                        'Verifica se tem empenho para a ordem e pedido interno
'                        If IsNumeric(TBEstoque!LOTE) = True Then
'                            Set TBLISTA = CreateObject("adodb.recordset")
'                            TBLISTA.Open "Select SUM(PP.Qtde_empenho) AS Qtde_empenho from Producao_pedidos PP INNER JOIN Producao P ON P.Ordem = PP.Ordem and P.Desenho = '" & TBMaterial!CODIGO & "' where PP.OrdemEmpenho = " & TBMaterial!Ordem & " and PP.Ordem = " & TBEstoque!LOTE, Conexao, adOpenKeyset, adLockOptimistic
'                            If TBLISTA.EOF = False Then
'                                qtdeliberar = qtdeliberar - IIf(IsNull(TBLISTA!Qtde_empenho), 0, TBLISTA!Qtde_empenho)
'                            End If
'                            TBLISTA.Close
'                        End If
'                    End If
'                    If qtdeliberar <= 0 Then GoTo Pula
'
'                    Qtd = TBEstoque!estoque_real
'                    If ExcluirAP = False Then
'                        'Verifica se este RE já está QTEmpenhado
'                        Qtd = Qtd - FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDestoque & " and Ordem <> " & TBOrdem!Ordem, False)
'                        Qtd = Qtd - FunVerificaQtdeEmpenhoREPI("ID_estoque = " & TBEstoque!IDestoque)
'                        If Qtd <= 0 Then
'                            quantnovo = FunVerificaQtdeEmpenhoREOrdem("IDestoque = " & TBEstoque!IDestoque & " and Ordem = " & TBOrdem!Ordem, False)
'                            If quantnovo > TBEstoque!estoque_real Or quantnovo = 0 Then GoTo Proximo Else Qtd = TBEstoque!estoque_real
'                        End If
'                    End If
'
'                    Set TBProduto = CreateObject("adodb.recordset")
'                    TBProduto.Open "Select * from Estoque_movimentacao where IDestoque = " & TBEstoque!IDestoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
'                    If TBProduto.EOF = True Then
'                        TBProduto.AddNew
'                        If ExcluirAP = False Then
'                            If qtdeliberar >= Qtd Then Qtd_Prog = Qtd Else Qtd_Prog = qtdeliberar
'                            TBProduto!Saida = Qtd_Prog
'                        Else
'                            If qtdeliberar >= TBProduto!Saida Then Qtd_Prog = TBProduto!Saida Else Qtd_Prog = qtdeliberar
'                            TBProduto!Saida = Format(TBProduto!Saida - Qtd_Prog, "0.0000")
'                        End If
'                        QuantEmpenhoPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), TBProduto!Saida, True)
'                        TBProduto!Saida_PC = QuantEmpenhoPC
'                    Else
'                        If ExcluirAP = False Then
'                            If qtdeliberar >= Qtd Then Qtd_Prog = Qtd Else Qtd_Prog = qtdeliberar
'                            TBProduto!Saida = TBProduto!Saida + Qtd_Prog
'                        Else
'                            If qtdeliberar >= TBProduto!Saida Then Qtd_Prog = TBProduto!Saida Else Qtd_Prog = qtdeliberar
'                            TBProduto!Saida = Format(TBProduto!Saida - Qtd_Prog, "0.0000")
'                        End If
'                        QuantEmpenhoPC = FunCalculaQtdePCKG(TBEstoque!estoque_real, IIf(IsNull(TBEstoque!estoque_real_PC), 0, TBEstoque!estoque_real_PC), TBProduto!Saida, True)
'                        TBProduto!Saida_PC = QuantEmpenhoPC
'                    End If
'                    TBProduto!Destino = "Interno"
'                    TBProduto!Terceiros = False
'                    TBProduto!Documento = TBOrdem!Ordem
'                    TBProduto!LOTE = TBEstoque!LOTE
'                    TBProduto!Desenho = TBEstoque!Desenho
'                    TBProduto!Data = mskData.Value
'                    TBProduto!Descricao = TBEstoque!Descricao
'                    TBProduto!Familia = TBEstoque!classe
'                    TBProduto!requisitante = cmbOperador
'                    TBProduto!Responsavel = pubUsuario
'                    TBProduto!IDestoque = TBEstoque!IDestoque
'                    TBProduto!Ordem = TBOrdem!Ordem
'                    TBProduto!OE = TBOrdem!Ordem
'
'                    'Atualiza valor do material no estoque
'                    TBProduto!VlrUnit = IIf(IsNull(TBEstoque!valor_unitario), 0, Format(TBEstoque!valor_unitario, "0.0000000000"))
'                    TBProduto!VlrTotal = Format(TBProduto!Saida * TBProduto!VlrUnit, "0.00")
'
'                    'verifica se a quantidade retirada e menor q a quant. solicitada
'                    QuantEmpenhoPC = FunCalculaQtdePCKG(TBProduto!Saida, IIf(IsNull(TBProduto!Saida_PC), 0, TBProduto!Saida_PC), Qtd_Prog, True)
'                    If ExcluirAP = False Then
'                        If Qtd_Prog >= QuantComprado Or IsNull(TBMaterial!Total_pc) = False And QuantEmpenhoPC >= QuantComprado1 Then
'                            TBProduto!Operacao = "SAIDA_ORDEM"
'                        Else
'                            TBProduto!Operacao = "SAIDA_ORDEM_PARCIAL"
'                        End If
'                        TBProduto.Update
'
'                        'Centro de custo
'                        IDpedido = TBProduto!IDestoque
'                        IDlista = TBProduto!IDoperacao
'                        Set TBAbrir = CreateObject("adodb.recordset")
'                        TBAbrir.Open "Select * from projproduto where desenho = '" & TBEstoque!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
'                        If TBAbrir.EOF = False Then
'                            Codproduto = TBAbrir!Codproduto
'                            IDAntigo = IIf(IsNull(TBAbrir!ID_PC), 0, TBAbrir!ID_PC)
'                        End If
'                        TBAbrir.Close
'
'                        ProcCriaCreditoCCProdutoItem
'
'                        QuantComprado = Format(QuantComprado - Qtd_Prog, "###,##0.0000")
'                        QuantComprado1 = QuantComprado1 - QuantEmpenhoPC
'                    Else
'                        TBProduto.Update
'
'                        'Centro de custo
'                        Conexao.Execute "DELETE from CC_realizado where ID_estoque = " & TBProduto!IDoperacao
'
'                        If TBProduto!Saida <= 0 And TBProduto.EOF = False Then Conexao.Execute "DELETE from Estoque_movimentacao where IDestoque = " & TBEstoque!IDestoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')"
'                    End If
'
'                    Saida = 0
'                    Saida_PC = 0
'                    Valor_total = 0
'                    Set TBFIltro = CreateObject("adodb.recordset")
'                    TBFIltro.Open "Select Sum(Saida) as Saida, Sum(ISNULL(Saida_PC, 0)) as Saida_PC, Sum(VlrTotal) as Valortotal from Estoque_movimentacao where Documento = '" & TBOrdem!Ordem & "' and Desenho = '" & TBMaterial!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
'                    If TBFIltro.EOF = False Then
'                        Saida = IIf(IsNull(TBFIltro!Saida), 0, TBFIltro!Saida)
'                        Saida_PC = IIf(IsNull(TBFIltro!Saida_PC), 0, TBFIltro!Saida_PC)
'                        Valor_total = IIf(IsNull(TBFIltro!ValorTotal), 0, TBFIltro!ValorTotal)
'                    End If
'                    TBFIltro.Close
'                    If Saida = 0 Then
'                        StatusTexto = "NÃO"
'                    ElseIf Saida >= TBMaterial!Requisitado Or IsNull(TBMaterial!Total_pc) = False And TBMaterial!Total_pc > 0 And Saida_PC >= IIf(IsNull(TBMaterial!Total_pc), 0, TBMaterial!Total_pc) Then
'                            StatusTexto = "SIM"
'                        Else
'                            StatusTexto = "PARCIAL"
'                    End If
'
'                    NovoValor = Replace(Valor_total, ",", ".")
'                    Conexao.Execute "UPDATE Producaomaterial Set Valor_saida_estoque = " & NovoValor & ", Saida = '" & StatusTexto & "' where Ordem = " & TBOrdem!Ordem & " and Codigo = '" & TBMaterial!CODIGO & "'"
'
'                    'Atualiza qtde. de saída do empenho da ordem
'                    Saida = 0
'                    Saida_PC = 0
'                    Set TBFIltro = CreateObject("adodb.recordset")
'                    TBFIltro.Open "Select Sum(Saida) as Saida, Sum(ISNULL(Saida_PC, 0)) as Saida_PC from Estoque_movimentacao where IDestoque = " & TBEstoque!IDestoque & " and Documento = '" & TBOrdem!Ordem & "' and Desenho = '" & TBMaterial!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
'                    If TBFIltro.EOF = False Then
'                        Saida = IIf(IsNull(TBFIltro!Saida), 0, TBFIltro!Saida)
'                        Saida_PC = IIf(IsNull(TBFIltro!Saida_PC), 0, TBFIltro!Saida_PC)
'                    End If
'                    TBFIltro.Close
'                    NovoValor = Replace(Saida, ",", ".")
'                    NovoValor1 = Replace(Saida_PC, ",", ".")
'                    Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida = " & NovoValor & " where IDestoque = " & TBEstoque!IDestoque & " and Ordem = " & TBOrdem!Ordem & " and Codinterno = '" & TBMaterial!CODIGO & "'"
'                    Conexao.Execute "UPDATE Producao_NF_Consignada Set Qtde_saida_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDestoque & " and Ordem = " & TBOrdem!Ordem & " and Codinterno = '" & TBMaterial!CODIGO & "' and Quantidade_PC IS NOT NULL and Quantidade_PC > 0"
'
'                    qtdeliberada = 0
'                    qtdeliberada_PC = 0
'                    QtdeSaida = 0
'                    QtdeSaida_PC = 0
'                    If TBItem!Estoque = True Then
'                        Set TBProduto = CreateObject("adodb.recordset")
'                        TBProduto.Open "Select Sum(Entrada) as qtdeliberada, Sum(ISNULL(Entrada_PC, 0)) as qtdeliberada_PC, Sum(Saida) as QtdeSaida, Sum(ISNULL(Saida_PC ,0)) as QtdeSaida_PC from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDestoque, Conexao, adOpenKeyset, adLockOptimistic
'                        If TBProduto.EOF = False Then
'                            qtdeliberada = IIf(IsNull(TBProduto!qtdeliberada), 0, TBProduto!qtdeliberada)
'                            qtdeliberada_PC = IIf(IsNull(TBProduto!qtdeliberada_PC), 0, TBProduto!qtdeliberada_PC)
'                            QtdeSaida = IIf(IsNull(TBProduto!QtdeSaida), 0, TBProduto!QtdeSaida)
'                            QtdeSaida_PC = IIf(IsNull(TBProduto!QtdeSaida_PC), 0, TBProduto!QtdeSaida_PC)
'                        End If
'                    End If
'                    TBProduto.Close
'
'                    NovoValor = Replace(qtdeliberada - QtdeSaida, ",", ".")
'                    NovoValor1 = Replace(qtdeliberada_PC - QtdeSaida_PC, ",", ".")
'                    Conexao.Execute "Update Estoque_movimentacao Set estoque_venda = " & NovoValor & " where IDestoque = " & TBEstoque!IDestoque & " and Documento = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')"
'                    Conexao.Execute "Update Estoque_controle Set Estoque_real = " & NovoValor & ", estoque_venda = " & NovoValor & ", estoque_real_PC = " & NovoValor1 & " where IDestoque = " & TBEstoque!IDestoque & ""
'                    Conexao.Execute "Update Estoque_controle Set Valor_Total = ROUND(valor_unitario * Estoque_real, 3) where IDestoque = " & TBEstoque!IDestoque & ""
'
'                    qtdeliberar = qtdeliberar - Qtd_Prog
'Proximo:
'                    TBEstoque.MoveNext
'                Loop
'                If TBEstoque.EOF = True And qtdeliberar > 0 And ExcluirAP = False And TextoFiltroEmpenho <> "" Then
'                    TextoFiltroEmpenho = ""
'                    TextoFiltro = " where EC.Desenho = '" & TBMaterial!CODIGO & "' and EC.Estoque_real > 0 and EP.Liberado = 'SIM' and (EC.Consignacao = 'False' or EC.Consignacao = 'True' and EC.id_cliente = " & TBMaterial!IDCliente & " and EC.Tipodest_NFcons = 'C' or EC.Consignacao = 'True' and EC.Tipodest_NFcons = 'F') order by EC.Data, EC.IDestoque"
'                    GoTo ContinuaEstoqueSemEmpenho
'                End If
'            End If
'Pula:
'            TBEstoque.Close
'            TBMaterial.MoveNext
'        Loop
'    End If
'    TBMaterial.Close
'
'    If ExcluirAP = False And TextoFiltroEmpenho <> "" Then
'        TextoFiltroEmpenho = ""
'        GoTo FiltroSemEmpenho
'    End If
'End If
'TBItem.Close
'
''Custo material
'Set TBEstoque = CreateObject("adodb.recordset")
'TBEstoque.Open "Select Sum(EM.VlrTotal) as Valor from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EC.IDestoque = EM.IDestoque where EM.Documento = '" & TBOrdem!Ordem & "' and EC.Consignacao = 'False' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
'If TBEstoque.EOF = False Then
'    TBOrdem!CTMaterial = Format(IIf(IsNull(TBEstoque!Valor), 0, TBEstoque!Valor), "###,##0.00")
'    TBOrdem.Update
'End If
'TBEstoque.Close
'
'Exit Sub
'tratar_erro:
'    usMsgbox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
'    Exit Sub
'End Sub

Private Sub ProcCriaCreditoCCProdutoItem()
On Error GoTo tratar_erro

Set TBFIltro = CreateObject("adodb.recordset")
TBFIltro.Open "Select * from projproduto where Codproduto = " & Codproduto & " and ID_CC is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBFIltro.EOF = False Then
    Set TBFI = CreateObject("adodb.recordset")
    TBFI.Open "Select * from CC_realizado where ID_estoque = " & IDlista & " and ID_CC = " & TBFIltro!ID_CC, Conexao, adOpenKeyset, adLockOptimistic
    If TBFI.EOF = True Then TBFI.AddNew
    ProcEnviaDadosCCProdutoItem TBFIltro!ID_CC
    TBFI.Update
    
    'Grava movimentação no centro consolidado
    Set TBAfericao = CreateObject("adodb.recordset")
    TBAfericao.Open "Select * from Usuarios_Setor_Consolidacao where ID_CC_consolidado = " & TBFIltro!ID_CC, Conexao, adOpenKeyset, adLockOptimistic
    If TBAfericao.EOF = False Then
        Do While TBAfericao.EOF = False
            Set TBFI = CreateObject("adodb.recordset")
            TBFI.Open "Select * from CC_realizado where ID_estoque = " & IDlista & " and ID_CC = " & TBAfericao!ID_CC, Conexao, adOpenKeyset, adLockOptimistic
            If TBFI.EOF = True Then TBFI.AddNew
            ProcEnviaDadosCCProdutoItem TBAfericao!ID_CC
            TBFI.Update
            
            Set TBCiclo = CreateObject("adodb.recordset")
            TBCiclo.Open "Select * from Usuarios_Setor_Consolidacao where ID_CC_consolidado = " & TBAfericao!ID_CC, Conexao, adOpenKeyset, adLockOptimistic
            If TBCiclo.EOF = False Then
                Do While TBCiclo.EOF = False
                    Set TBFI = CreateObject("adodb.recordset")
                    TBFI.Open "Select * from CC_realizado where ID_estoque = " & IDlista & " and ID_CC = " & TBCiclo!ID_CC, Conexao, adOpenKeyset, adLockOptimistic
                    If TBFI.EOF = True Then TBFI.AddNew
                    ProcEnviaDadosCCProdutoItem TBCiclo!ID_CC
                    TBFI.Update
                    TBCiclo.MoveNext
                Loop
            End If
            TBCiclo.Close
            
            TBAfericao.MoveNext
        Loop
    End If
    TBAfericao.Close
End If
TBFIltro.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcEnviaDadosCCProdutoItem(ID_CC As Long)
On Error GoTo tratar_erro

Valor3 = IIf(IsNull(TBEstoque!valor_unitario), 0, TBEstoque!valor_unitario)
Valor_Cofins_Serv = TBProduto!Saida
valor = Format(Valor3 * Valor_Cofins_Serv, "###,##0.00")

TBFI!valor = valor
TBFI!Data = mskData
TBFI!Responsavel = pubUsuario
TBFI!ID_empresa = TBEstoque!ID_empresa
TBFI!Operacao = "Crédito"
TBFI!ID_estoque = IDlista
TBFI!ID_CC = ID_CC
TBFI!Cod_produto = Codproduto
TBFI!ID_PC = IDAntigo
TBFI!Bloqueado = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcEntrarCancelarEstoque()
On Error GoTo tratar_erro

ValorTotal = 0
quantestoque = 0

LATexto = "ESTOQUE PADRÃO"
Set TBCFOP = CreateObject("adodb.recordset")
TBCFOP.Open "SELECT Descricao FROM Estoque_Localarmazenamento_criar WHERE PadraoOrdem = 1", Conexao, adOpenKeyset, adLockReadOnly
If TBCFOP.EOF = False Then
    LATexto = TBCFOP!Descricao
Else
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select ELAC.Descricao FROM Estoque_Localarmazenamento_criar ELAC INNER JOIN Estoque_Localarmazenamento ELA ON ELA.idemb_locarm = ELAC.id where ELA.codinterno = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockReadOnly
    If TBCFOP.EOF = False Then LATexto = TBCFOP!Descricao
End If
TBCFOP.Close

'Não precisa no GERPROD
NovoValor = Replace(QtdeAntigaAP, ",", ".")
If Novo_Ordem1 = True Then TextoFiltro = "local_armaz = '" & LATexto & "'" Else TextoFiltro = "Qtde >= " & NovoValor

Permitido = False
'============================================================================
' Abre a tabela estoque controle e grava o novo lote
'============================================================================
Set TBEstoque = CreateObject("adodb.recordset")
TBEstoque.Open "Select * from estoque_controle where ID_empresa = " & TBOrdem!ID_empresa & " and desenho = '" & TBOrdem!Desenho & "' and lote = '" & TBOrdem!Ordem & "' and certificado = '" & 0 & "' and corrida = '" & 0 & "' and " & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If ExcluirAP = False Or TBEstoque.EOF = False And ExcluirAP = True Then Permitido = True

If Permitido = True Then
    If TBEstoque.EOF = True Then TBEstoque.AddNew
    TBEstoque!ID_empresa = TBOrdem!ID_empresa
    TBEstoque!LOTE = TBOrdem!Ordem
    TBEstoque!Desenho = TBOrdem!Desenho
    
    'Atualiza valor do produto no estoque
    Set TBItem = CreateObject("adodb.recordset")
    TBItem.Open "Select * from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBItem.EOF = False Then
        If TBItem!Estoque = True Then ControlaEstoque = True Else ControlaEstoque = False
        TBEstoque!Un = TBItem!Unidade
        TBEstoque!Classe = TBItem!Classe
    End If
    TBItem.Close
    
    'Estoque_movimentação
    quantestoque = txtTOK.Text 'qtdeOK
    
    TBEstoque!Descricao = TBOrdem!Produto
    TBEstoque!Data = mskData.Value
    TBEstoque!Responsavel = cmbOperador
    TBEstoque!Certificado = 0
    TBEstoque!Corrida = 0
    
    TBEstoque!local_armaz = LATexto
    If ExcluirAP = False Then
        If Novo_Ordem2 = True Then
            TBEstoque!Qtde = TBEstoque!Qtde + quantestoque
            QtdeEstoque = TBEstoque!estoque_real + quantestoque
        Else
            TBEstoque!Qtde = (TBEstoque!Qtde - QtdeAntigaAP) + quantestoque
            QtdeEstoque = (TBEstoque!estoque_real - QtdeAntigaAP) + quantestoque
        End If
    Else
        TBEstoque!Qtde = TBEstoque!Qtde - quantestoque
        QtdeEstoque = TBEstoque!estoque_real - quantestoque
    End If
    
    Qtde = TBOrdem!Quant
    If QtdeEstoque >= Qtde Then TBEstoque!status = "ENTRADA_ORDEM" Else TBEstoque!status = "ENTRADA_ORDEM_PARCIAL"
    TBEstoque!ID_Cliente = IIf(IsNull(TBOrdem!IDCliente), 0, TBOrdem!IDCliente)
    TBEstoque!Cliente = IIf(IsNull(TBOrdem!Cliente), "", TBOrdem!Cliente)
    
    TBEstoque!estoque_real = Format(QtdeEstoque, "0.0000")
    TBEstoque!estoque_real_PC = Format(QtdeEstoque, "0.0000")
    TBEstoque!estoque_venda = Format(QtdeEstoque, "0.0000")
    TBEstoque.Update
    
    Entrada = quantestoque
    quantestoque = TBEstoque!estoque_real
    
    Set TBProduto = CreateObject("adodb.recordset")
    TBProduto.Open "Select * from Estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and Lote = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and Responsavel = '" & cmbOperador & "' and (Operacao = 'ENTRADA_ORDEM' or Operacao = 'ENTRADA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
    If TBProduto.EOF = True Then
        TBProduto.AddNew
        TBProduto!Destino = "Interno"
        TBProduto!Terceiros = False
    End If
    TBProduto!LOTE = TBOrdem!Ordem
    TBProduto!Documento = TBOrdem!Ordem
    TBProduto!Desenho = TBOrdem!Desenho
    
    'Atualiza valor do produto no estoque
    Set TBItem = CreateObject("adodb.recordset")
    TBItem.Open "Select * from projproduto where desenho = '" & TBOrdem!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBItem.EOF = False Then TBProduto!Familia = TBItem!Classe
    TBItem.Close
    
    TBProduto!Descricao = TBOrdem!Produto
    TBProduto!Data = mskData.Value
    TBProduto!Responsavel = cmbOperador
    
    If ExcluirAP = False Then
        If Novo_Ordem2 = True Then TBProduto!Entrada = TBProduto!Entrada + Entrada Else TBProduto!Entrada = (TBProduto!Entrada - QtdeAntigaAP) + Entrada
        Qtd_Prog = TBProduto!Entrada
    Else
        TBProduto!Entrada = TBProduto!Entrada - Entrada
        Qtd_Prog = Entrada
    End If
    TBProduto!Entrada_PC = TBProduto!Entrada
    ProcEmpenharREAutomOrdem TBEstoque!IDEstoque, Qtd_Prog, TBEstoque!LOTE, mskData.Value, cmbOperador, TBOrdem!Desenho, ExcluirAP
    
    Qtde = TBOrdem!Quant
    Entrada = quantestoque
    If Entrada >= Qtde Then
        TBProduto!Operacao = "ENTRADA_ORDEM"
    ElseIf Entrada < Qtde Then
            TBProduto!Operacao = "ENTRADA_ORDEM_PARCIAL"
    End If
    
    TBProduto!IDEstoque = TBEstoque!IDEstoque
    TBProduto.Update
    
    If ExcluirAP = False Then
        'Exclui o empenho no produto em estoque para o pedido
        Conexao.Execute "DELETE from Estoque_Controle_Empenho_Vendas where ID_estoque = " & TBProduto!IDEstoque
        ProcEmpenhaProdutoeAtualQtdeEntEmpOrdem TBProduto!LOTE, TBProduto!Desenho, TBEstoque!estoque_real, TBProduto!IDEstoque
    Else
        If TBProduto!Entrada <= 0 And TBProduto.EOF = False Then
            'Exclui o empenho no produto em estoque para o pedido
            Conexao.Execute "DELETE from Estoque_Controle_Empenho_Vendas where ID_estoque = " & TBProduto!IDEstoque
            
            Conexao.Execute "DELETE from Estoque_movimentacao where IDestoque = " & TBEstoque!IDEstoque & " and Lote = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and Responsavel = '" & cmbOperador & "' and (Operacao = 'ENTRADA_ORDEM' or Operacao = 'ENTRADA_ORDEM_PARCIAL')"
            
            ProcAtualizaQtdeEntEmpProd TBEstoque!LOTE, TBEstoque!Desenho
        End If
    End If
    
'    qtdeliberada = 0
'    QtdeSaida = 0
'    QtdeEstoque = 0
'    If ControlaEstoque = True Then
'        Set TBProduto = CreateObject("adodb.recordset")
'        TBProduto.Open "Select * from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDestoque, Conexao, adOpenKeyset, adLockOptimistic
'        If TBProduto.EOF = True Then
'            TBEstoque.Delete
'        Else
'            Set TBProduto = CreateObject("adodb.recordset")
'            TBProduto.Open "Select Sum(ISNULL(Entrada, 0)) as qtdeliberada, Sum(ISNULL(Saida, 0)) as QtdeSaida from Estoque_movimentacao where IdEstoque = " & TBEstoque!IDestoque, Conexao, adOpenKeyset, adLockOptimistic
'            If TBProduto.EOF = False Then
'                qtdeliberada = IIf(IsNull(TBProduto!qtdeliberada), 0, TBProduto!qtdeliberada)
'                QtdeSaida = IIf(IsNull(TBProduto!QtdeSaida), 0, TBProduto!QtdeSaida)
'                NovoValor = Replace(qtdeliberada - QtdeSaida, ",", ".")
'                Conexao.Execute "Update Estoque_movimentacao Set estoque_venda = " & NovoValor & " where IDestoque = " & TBEstoque!IDestoque & " and Lote = '" & TBOrdem!Ordem & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and (Operacao = 'ENTRADA_ORDEM' or Operacao = 'ENTRADA_ORDEM_PARCIAL')"
'            End If
'        End If
'    End If
'    TBProduto.Close
End If
TBEstoque.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifApontamentoAnterior()
On Error GoTo tratar_erro

Set TBAbrir = CreateObject("adodb.recordset")
If Novo_Ordem2 = True Then
    TBAbrir.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio < '" & TempoInicio & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
Else
    TBAbrir.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data <= '" & Format(APLista.SelectedItem.ListSubItems(3), "Short Date") & "' and Tempoinicio < '" & APLista.SelectedItem.ListSubItems(3) & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
End If
If TBAbrir.EOF = False Then
    TBAbrir.MoveLast
    TBAbrir!TempoFinal = TempoInicio
    TempoInicio = TBAbrir!TempoInicio
    TempoFinal = TBAbrir!TempoFinal
    TempoTotal = TempoFinal - TempoInicio
    ElapsedTime (TempoTotal)
    TempoTotal = Format(TempoTotal, "hh:mm:ss")
    TBAbrir!TempoTotal = TempoTotal
    TBAbrir!TempoTotalSeg = s
    TBAbrir!Dias = D
    TBAbrir.Update
End If
TBAbrir.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifProximoApontamento()
On Error GoTo tratar_erro

Set TBAbrir = CreateObject("adodb.recordset")
If Novo_Ordem2 = True Then
    TBAbrir.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data >= '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio > '" & TempoInicio & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
Else
    TBAbrir.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " and Maquina = '" & txtAPMaquina & "' and Data >= '" & Format(APLista.SelectedItem.ListSubItems(3), "Short Date") & "' and Tempoinicio > '" & APLista.SelectedItem.ListSubItems(3) & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
End If
If TBAbrir.EOF = False Then
    TBAbrir.MoveLast
    TBproducao!TempoFinal = TBAbrir!TempoInicio
    TempoInicio = TBproducao!TempoInicio
    TempoFinal = TBproducao!TempoFinal
    TempoTotal = TempoFinal - TempoInicio
    ElapsedTime (TempoTotal)
    TempoTotal = Format(TempoTotal, "hh:mm:ss")
    TBproducao!TempoTotal = TempoTotal
    TBproducao!TempoTotalSeg = s
    TBproducao!Dias = D
Else
    TBproducao!TempoFinal = "00:00:00"
    TBproducao!TempoTotal = "00:00:00"
    TBproducao!TempoTotalSeg = 0
    TBproducao!Dias = 0
End If
TBAbrir.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcGravarAP()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If Frame15.Enabled = False Then Exit Sub
If txtDtValidacao = "" Then
    USMsgBox ("Não é possivel alterar apontamento, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Set TBOSC = CreateObject("adodb.recordset")
If Txt_ID_apontamento <> "" Then
    TBOSC.Open "Select P.ordem from Producao P INNER JOIN Ordemservico OS ON OS.ordem = P.ordem where OS.ID_apontamento = " & Txt_ID_apontamento & " and P.DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
Else
    TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
End If
If TBOSC.EOF = False Then
    If Txt_ID_apontamento <> "" Then MsgTexto = " ou da ordem " & TBOSC!Ordem & " (vinculada a esta)" Else MsgTexto = ""
    USMsgBox ("Não é permitido alterar o apontamento, pois já foi validado o resultado desta ordem" & MsgTexto & "."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close
If cmbStatus = "Cancelada" Then
    USMsgBox ("Não é possivel alterar apontamento, pois a ordem foi cancelada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

Acao = "salvar"
If cmbAPOS = "" Then
    NomeCampo = "a OS"
    ProcVerificaAcao
    cmbAPOS.SetFocus
    Exit Sub
End If
If txtAPMaquina.Text = "" Then
    NomeCampo = "o posto de trabalho"
    ProcVerificaAcao
    txtAPMaquina.SetFocus
    Exit Sub
End If
If cmbOperador.Text = "" Then
    NomeCampo = "o operador"
    ProcVerificaAcao
    cmbOperador.SetFocus
    Exit Sub
End If
If cmbdescricao.Text = "" Then
    NomeCampo = "o evento"
    ProcVerificaAcao
    cmbdescricao.SetFocus
    Exit Sub
End If
If txtinicioap.Value = "00:00:00" Then
    NomeCampo = "a hora"
    ProcVerificaAcao
    txtinicioap.SetFocus
    Exit Sub
End If

'Verifica se já existe apontamento na mesma data e hora
APLista.SetFocus
TempoInicio = mskData.Value & " " & txtinicioap.Value
If APLista.ListItems.Count = 0 Then Novo_Ordem2 = True
If Txt_ID_apontamento = "" Then
    Set TBproducao = CreateObject("adodb.recordset")
    If Novo_Ordem2 = True Then
        TBproducao.Open "Select IDProducao from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and Maquina = '" & txtAPMaquina & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio = '" & TempoInicio & "'", Conexao, adOpenKeyset, adLockOptimistic
    Else
        TBproducao.Open "Select IDProducao from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and IDProducao <> " & APLista.SelectedItem & " and Maquina = '" & txtAPMaquina & "' and Data = '" & Format(mskData.Value, "Short Date") & "' and Tempoinicio = '" & TempoInicio & "'", Conexao, adOpenKeyset, adLockOptimistic
    End If
    If TBproducao.EOF = False Then
        USMsgBox ("Já existe apontamento com esta data e hora."), vbExclamation, "CAPRIND v5.0"
        TBproducao.Close
        Exit Sub
    End If
End If
'Verifica se a data inicial é maior que a data final do apontamento
If Novo_Ordem2 = False Then
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open "Select TempoFinal from " & NomeTabelaAp & " where IDProducao = " & APLista.SelectedItem & " and Maquina = '" & txtAPMaquina & "'", Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
        If IsNull(TBproducao!TempoFinal) = False And TBproducao!TempoFinal <> "" And TBproducao!TempoFinal <> "00:00:00" And TBproducao!TempoFinal < TempoInicio Then
            USMsgBox ("Não é permitido utilizar este horário, pois a data e hora inicial é maior que a data e hora final do apontamento."), vbExclamation, "CAPRIND v5.0"
            TBproducao.Close
            Exit Sub
        End If
    End If
    TBproducao.Close
End If
If Novo_Ordem2 = False Then
    If Chk_retirar_estoque.Value = 1 And (txtTOK <> APLista.SelectedItem.ListSubItems(7) And APLista.SelectedItem.ListSubItems(7) <> 0 Or txtTNC <> APLista.SelectedItem.ListSubItems(8) And APLista.SelectedItem.ListSubItems(8) <> 0) Then
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select Estoque_real from Estoque_Controle where Lote = '" & txtAPOF & "' and LEFT(Status, 13) = 'ENTRADA_ORDEM'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            valor = txtTOK
            Valor1 = APLista.SelectedItem.ListSubItems(7)
            
            If (TBproducao!estoque_real - Valor1) + valor < 0 Then
                USMsgBox ("Não é permitido alterar a quantidade deste apontamento, pois o estoque vai ficar negativo."), vbExclamation, "CAPRIND v5.0"
                TBproducao.Close
                Exit Sub
            End If
        End If
        TBproducao.Close
    End If
    
    'Verifica NC nas OS
    If Txt_ID_apontamento <> "" Then
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select TempoInicio, CodigoDesc  from " & NomeTabelaAp & " where IDProducao = " & APLista.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Set TBOS = CreateObject("adodb.recordset")
            TBOS.Open "Select OS.IDProducao, OS.Ordem from OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID where PFOS.ID = " & Txt_ID_apontamento & " and IDproducao <> " & cmbAPOS & " order by OS.IDproducao", Conexao, adOpenKeyset, adLockOptimistic
            If TBOS.EOF = False Then
                Do While TBOS.EOF = False
                    If FunVerifNCRejeitado(TBOS!IDProducao) = True Then ParecerCQ = "Rejeitar" Else ParecerCQ = "Nada consta"
                    
                    Set TBproducao = CreateObject("adodb.recordset")
                    TBproducao.Open "Select CQNC.Codigo from " & NomeTabelaAp & " INNER JOIN CQ_NC_FABRICA CQNC ON " & NomeTabelaAp & ".IDProducao = CQNC.IDProducao where " & NomeTabelaAp & ".OS = " & TBOS!IDProducao & " and " & NomeTabelaAp & ".Tempoinicio = '" & TBAbrir!TempoInicio & "' and " & NomeTabelaAp & ".CodigoDesc = " & TBAbrir!CodigoDesc & " and CQNC.PARECERCQ IS NOT NULL and CQNC.PARECERCQ <> '" & ParecerCQ & "' and CQNC.Analizada = 1", Conexao, adOpenKeyset, adLockOptimistic
                    If TBproducao.EOF = False Then
                        USMsgBox ("Não é permitido alterar este apontamento, pois o mesmo já possui a disposição do controle de qualidade na Ordem: " & TBOS!Ordem & " - OS: " & TBOS!IDProducao & "."), vbExclamation, "CAPRIND v5.0"
                        TBproducao.Close
                        Exit Sub
                    End If
                    TBproducao.Close
                    TBOS.MoveNext
                Loop
            End If
            TBOS.Close
        End If
        TBAbrir.Close
    Else
        If FunVerifNCRejeitado(cmbAPOS) = True Then ParecerCQ = "Rejeitar" Else ParecerCQ = "Nada consta"
        If ParecerCQ <> "Nada consta" Then
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select Codigo from CQ_NC_FABRICA where IDProducao = " & APLista.SelectedItem & " and PARECERCQ IS NOT NULL and PARECERCQ <> '" & ParecerCQ & "' and Analizada = 1", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                USMsgBox ("Não é permitido alterar este apontamento, pois o mesmo já possui a disposição do controle de qualidade."), vbExclamation, "CAPRIND v5.0"
                TBproducao.Close
                Exit Sub
            End If
        End If
    End If
    
    'Verifica se o evento é FIM DE PRODUÇÃO e se existe evento após ele
    If txtCodigo = 3 Then
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select IDProducao from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and Tempoinicio > '" & APLista.SelectedItem.ListSubItems(3) & "'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            USMsgBox ("Não é permitido alterar este evento para " & cmbdescricao & ", pois existe(m) apontamento(s) após o mesmo."), vbExclamation, "CAPRIND v5.0"
            TBproducao.Close
            Exit Sub
        End If
        TBproducao.Close
    End If
End If

Dim TOK As Double
Dim TNC As Double

TOK = IIf(IsNumeric(txtTOK) = True, txtTOK, 0)
TNC = IIf(txtTNC <> "", txtTNC, 0)
EventoAP = 0
Gravar = True
'Atribui um valor a variavel descricao
EventoAP = txtCodigo.Text
'Verifica Ultimo evento
ProcVerificaUltimo
If Gravar = False Then Exit Sub
If TOK <> 0 Or TNC <> 0 Or EventoAP = 3 Then ProcVerifQtdeApontada
If Gravar = False Then Exit Sub

If ProcVerificaEstoqueAP = False Then Exit Sub

'Informar a quantidade NC por descrição da NC
If FunVerifNCRejeitado(cmbAPOS) = True And TNC > 0 Then
    frmprod_qtdeNC.Show 1
    If Gravar = False Then Exit Sub
End If

'Gravar evento realizado
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OS.*, P.Desenho from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
Else
    TextoFiltro = "Select OS.*, P.Desenho from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDProducao = " & cmbAPOS
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        ProcGravarEvento
        
'========================================================================
'Retirar requisitado do estoque
'========================================================================
If TOK <> 0 Or TNC <> 0 Then
ExcluirAP = False
Set TBOrdem = CreateObject("adodb.recordset")
'========================================================================
' Verifica se é pra tirar do estoque o material ou entrar no estoque o item
'==========================================================================
TBOrdem.Open "Select * from Producao where Ordem = " & TBOS!Ordem & " and (Entrar_estoque = 'True' Or Retirar_estoque = 'True')", Conexao, adOpenKeyset, adLockOptimistic
'==========================================================================
If TBOrdem.EOF = False Then
 Set TBCFOP = CreateObject("adodb.recordset")
 TBCFOP.Open "Select * from ordemservico where Ordem = " & TBOrdem!Ordem & " order by fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
 If TBCFOP.EOF = False Then
'==========================================================================
'Verifica se é a primeira OS e retira o material do estoque
'==========================================================================
If TBOrdem!Retirar_estoque = True Then
    TBCFOP.MoveFirst
    If TBCFOP!IDProducao = TBOS!IDProducao Then
    ProcRetirarCancelarEstoque 'Retira do estoque ou cancela retirada
    End If
End If
'=========================================================================
'Verifica se é a última OS e entra com o produto no estoque
'=========================================================================
If TBOrdem!Entrar_estoque = True Then
    TBCFOP.MoveLast
    If TBCFOP!IDProducao = TBOS!IDProducao Then
    ProcEntrarCancelarEstoque 'Entra no estoque ou cancela entrada
    End If
End If
'=========================================================================
End If
End If
TBOrdem.Close
End If
TBOS.MoveNext
Loop
End If
TBOS.Close
'==========================================================================
' Fim da movimentação do estoque
'==========================================================================
If Novo_Ordem2 = True Then USMsgBox ("Novo evento cadastrado com sucesso."), vbInformation, "CAPRIND v5.0" Else USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"

'Verifica o evento gravado
ProcVerificaEvento
'Atualiza dados do formulario, e da lista de eventos
'ProcAtualizaProducao
ProcAtualizaPrepExecUtilTotalizacao
ProcAtualizaPrepExecUtilTotalizacaoMaq
ProcAtualizaPrepExecUtil

'Grava o status da OS e da OF
ProcGravarStatusOSOF

Dataini = mskData.Value
ProcVerificaTurno

'Acerta cadastro na máquina
ProcAcertaCadMaquina
'Calcula e grava valor real do lote e por peça
ProcGravaValoresOS
'Atualiza dados da ordem de fabricação (Tempo total utilizado, custo por peça, custo total, etc...)
ProcAtualizaOF

Novo_Ordem2 = False

maquina = txtAPMaquina
ProcAPabrir
txtAPMaquina = maquina
ProcLista12Ultimos

ProcLimpaCamposNovoAP False
Frame15.Enabled = False
txtTOK.Locked = True
txtTOK.TabStop = False
txtTNC.Locked = True
txtTNC.TabStop = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcGravarStatusOSOF()
On Error GoTo tratar_erro

If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.*, P.DtValidacao_custo from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
    
        Set TBNivel12 = CreateObject("adodb.recordset")
        TBNivel12.Open "Select CodigoDesc from ProducaoFases where OS = " & TBOS!IDProducao & " order by Data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
        If TBNivel12.EOF = False Then
            ULTICOD = TBNivel12!CodigoDesc
        End If
        TBNivel12.Close
    
        If ULTICOD <> 1 And ULTICOD <> 2 And ULTICOD <> 3 Then
            StatusTexto = "Aguardando"
        Else
            Select Case ULTICOD
                Case 1: StatusTexto = "Preparando"
                Case 2: StatusTexto = "Produzindo"
                Case 3: StatusTexto = "Concluída"
            End Select
        End If
        Conexao.Execute "UPDATE ordemservico Set Status = '" & StatusTexto & "' where idproducao = " & TBOS!IDProducao
        
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBOS!Ordem & " and Status <> 'Concluída'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = True Then
            StatusTexto = "Concluída"
            GoTo Sair1
        End If
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBOS!Ordem & " and Status <> 'Aguardando'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            StatusTexto = "Produzindo"
            GoTo Sair1
        End If
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBOS!Ordem & " and Status <> 'Preparando' and Status <> 'Produzindo' and Status <> 'Concluída'", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            StatusTexto = "Aberta"
            GoTo Sair1
        End If
Sair1:
        Conexao.Execute "UPDATE producao Set Status = '" & StatusTexto & "' where Ordem = " & TBOS!Ordem & " and Status <> 'Entregue'"
        
        TBAbrir.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAtualizaOF()
On Error GoTo tratar_erro

If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OrdemServico.Ordem from OrdemServico INNER JOIN ProducaoFases_OS ON OrdemServico.ID_apontamento = ProducaoFases_OS.ID where ProducaoFases_OS.ID = " & Txt_ID_apontamento & " Group by OrdemServico.Ordem"
Else
    TextoFiltro = "Select Ordem from OrdemServico where IDproducao = " & cmbAPOS
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        CRLOTE = 0
        CRPECA = 0
        TRLOTE = 0
        TPUSEG = 0
        TEUSEG = 0
        QtdeSaida = 0
        TotalNC = 0
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from ordemservico where Ordem = " & TBOS!Ordem & " ORDER BY fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                If TBproducao!custos = True Then
                    CRLOTE = CRLOTE + IIf(IsNull(TBproducao!CRLOTE), 0, TBproducao!CRLOTE)
                    CRPECA = CRPECA + IIf(IsNull(TBproducao!CRPECA), 0, TBproducao!CRPECA)
                End If
                TRLOTE = TRLOTE + IIf(IsNull(TBproducao!TETTUTILSEG), 0, TBproducao!TETTUTILSEG)
                TPUSEG = TPUSEG + IIf(IsNull(TBproducao!TPUSEG), 0, TBproducao!TPUSEG)
                TEUSEG = TEUSEG + IIf(IsNull(TBproducao!TEUSEG), 0, TBproducao!TEUSEG)
                
                Totalprod = IIf(IsNull(TBproducao!QTOK), 0, TBproducao!QTOK)
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from CQ_NC_FABRICA where OS = " & TBproducao!IDProducao & " and PARECERCQ = 'Rejeitar'", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    Set TBFIltro = CreateObject("adodb.recordset")
                    TBFIltro.Open "Select Sum(TTNC) as TotalNC from CQ_NC_FABRICA where OS = " & TBproducao!IDProducao & " and PARECERCQ = 'Rejeitar'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBFIltro.EOF = False Then
                        TotalNC = TotalNC + IIf(IsNull(TBFIltro!TotalNC), 0, TBFIltro!TotalNC)
                    End If
                    TBFIltro.Close
                Else
                    QtdeSaida = QtdeSaida + IIf(IsNull(TBproducao!QTNC), 0, TBproducao!QTNC)
                End If
                TBAbrir.Close
                TBproducao.MoveNext
            Loop
        End If
        
        Totalprod = Totalprod + TotalNC + QtdeSaida
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from producao where Ordem = " & TBOS!Ordem & " and Controlado_estoque = 'False'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            TBproducao!QuantProd = Totalprod
            TBproducao!QuantNC = TotalNC
            TBproducao.Update
            TBproducao!CPR = Format(CRPECA, "###,##0.0000000000")
            TBproducao!CTTReal = Format(CRLOTE, "###,##0.00")
            
            s = TEUSEG
            TBproducao!tpr = FormataTempo(s)
'================================================================
' Se produzido for maior que 1
'================================================================
            If Totalprod < 1 Then
               If Totalprod > 0 Then
                 TBproducao!tpr = FormataTempo(TRLOTE / Totalprod)
               Else
                 TBproducao!tpr = FormataTempo(TRLOTE)
               End If
            End If
            
'================================================================
' Se produzido for menor que 1
'================================================================
            If Totalprod >= 1 Then
             'If TTEUTILS > 0 And produzidas > 0 Then TEUSEG = Format((TTEUTILS * (produzidas * 1000) / 1000), "###,##0.0000000000") Else TEUSEG = TTEUTILS
                    's = (IIf(IsNull(TBOS!TESegundos), 0, (TBOS!TESegundos / TBOS!Totalprod) / (1 / TBOS!Totalprod)))
               If Totalprod > 0 Then
                 TBproducao!tpr = FormataTempo(TRLOTE / Totalprod)
               Else
                 TBproducao!tpr = FormataTempo(TRLOTE)
               End If
            
            End If
'================================================================
            'TBproducao!tpr = FormataTempo(S3)
            
            TBproducao!TTTReal = FormataTempo(TRLOTE)
            
            ProcCalculaEficienciaOF TBOS!Ordem, TBproducao!Quant
            TBproducao!Eficiencia_prep = Eficiencia_prep
            TBproducao!Eficiencia_exec = Eficiencia_exec
            If Eficiencia_prep > 0 And Eficiencia_exec > 0 Then
                TBproducao!Eficiencia = (Eficiencia_prep + Eficiencia_exec) / 2
            ElseIf Eficiencia_prep > 0 Then
                    TBproducao!Eficiencia = Eficiencia_prep
                ElseIf Eficiencia_exec > 0 Then
                        TBproducao!Eficiencia = Eficiencia_exec
                    Else
                        TBproducao!Eficiencia = 0
            End If
            TBproducao.Update
            
            'Corrige valor do estoque
                                                  'ORDEM            QTDE. PREVISTA                                      QTDE. OK                                                    QT. PROD.(OK+NC)                                                                                                     CUSTO LOTE                                              CUSTO PEÇA                                      CUSTO TERCEIROS                                             CUSTO MATERIAL                                                CUSTO OUTROS                                              ORDEM CONSIGNADA
            Valor_Produto = FunCalculaValorUnitOrdem(TBproducao!Ordem, IIf(IsNull(TBproducao!Quant), 0, TBproducao!Quant), IIf(IsNull(TBproducao!QuantProd), 0, TBproducao!QuantProd), IIf(IsNull(TBproducao!QuantProd), 0, TBproducao!QuantProd) + IIf(IsNull(TBproducao!QuantNC), 0, TBproducao!QuantNC), IIf(IsNull(TBproducao!CTTReal), 0, TBproducao!CTTReal), IIf(IsNull(TBproducao!CPR), 0, TBproducao!CPR), IIf(IsNull(TBproducao!CTServico), 0, TBproducao!CTServico), IIf(IsNull(TBproducao!CTMaterial), 0, TBproducao!CTMaterial), IIf(IsNull(TBproducao!CTOutras), 0, TBproducao!CTOutras), TBproducao!Consignacao)
            NovoValor = Replace(Valor_Produto, ",", ".")
            Conexao.Execute "Update Estoque_Controle set valor_unitario = " & NovoValor & " where Lote = '" & TBproducao!Ordem & "' and Desenho = '" & TBproducao!Desenho & "'"
            Conexao.Execute "Update Estoque_Controle set Valor_Total = ROUND(valor_unitario * estoque_real, 2) where Lote = '" & TBproducao!Ordem & "' and Desenho = '" & TBproducao!Desenho & "'"
            Conexao.Execute "Update EM Set VlrUnit = " & NovoValor & " from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBproducao!Ordem & "' and EM.Desenho = '" & TBproducao!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
            Conexao.Execute "Update EM Set VlrTotal = ROUND(VlrUnit * Entrada, 2) from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBproducao!Ordem & "' and EM.Desenho = '" & TBproducao!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
            Conexao.Execute "Update CC Set CC.Valor = EM.VlrTotal from (CC_realizado CC INNER JOIN Estoque_movimentacao EM ON CC.ID_estoque = EM.Idoperacao) INNER JOIN Estoque_controle EC ON EC.IdEstoque = EM.IdEstoque where EC.Lote = '" & TBproducao!Ordem & "' and EC.Desenho = '" & TBproducao!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
            Conexao.Execute "Update EM set EM.VlrUnit = EM1.VlrUnit from Estoque_movimentacao EM INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBproducao!Ordem & "' and EM.Desenho = '" & TBproducao!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
            Conexao.Execute "Update EC set EC.valor_unitario = EM1.VlrUnit from Estoque_Controle EC INNER JOIN Estoque_movimentacao EM ON EM.IdEstoque = EC.IdEstoque INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBproducao!Ordem & "' and EM.Desenho = '" & TBproducao!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
            Conexao.Execute "Update Estoque_movimentacao set VlrTotal = ROUND(VlrUnit * Saida, 2) where Lote = '" & TBproducao!Ordem & "' and Desenho = '" & TBproducao!Desenho & "' and Saida > 0"
        End If
        TBproducao.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub Form_Resize()
On Error GoTo tratar_erro

Formulario = "PCP/Gerenciamento de ordem"
Direitos
ProcVerifColunas

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub APLista_Itemclick(ByVal Item As MSComctlLib.ListItem)
On Error GoTo tratar_erro

ExcluiSel = True
If APLista.ListItems.Count > 0 Then
    EventoAP = APLista.SelectedItem.ListSubItems.Item(1).Text
    IDProducao = APLista.SelectedItem
    Usuario = APLista.SelectedItem.ListSubItems(6)
    Set TBproducao = CreateObject("adodb.recordset")
    TBproducao.Open "Select * from " & NomeTabelaAp & " where idproducao = " & IDProducao, Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
        txtTurno.Text = TBproducao!Turno
        mskData.Value = Format(TBproducao!TempoInicio, "dd/mm/yy")
        txtinicioap.Value = Format(TBproducao!TempoInicio, "hh:mm:ss")
        
        If Chk_carregar_bloqueado.Value = 0 Then
            ProcCarregaComboUsuario cmbOperador, "U.Bloqueado = 'False'", False
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select * from Usuarios where Usuario = '" & TBproducao!Usuario & "' and Bloqueado = 'True'", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                cmbOperador.AddItem TBproducao!Usuario
            End If
            
            ProcCarregaComboCodigoTrab cmbdescricao, "Bloqueado = 'False'", False
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select * from CodigoDesc where Descricao = '" & TBproducao!Descricao & "' and Bloqueado = 'True'", Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                cmbdescricao.AddItem TBproducao!Descricao
            End If
            TBAbrir.Close
        End If
        cmbOperador.Text = TBproducao!Usuario
        txtCodigo.Text = TBproducao!CodigoDesc
        cmbdescricao = TBproducao!Descricao
        
        txtTOK.Text = IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
        txtTNC.Text = IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
        Frame15.Enabled = True
        If EventoAP = 2 Then
            txtTOK.Locked = False
            txtTOK.TabStop = True
            txtTNC.Locked = False
            txtTNC.TabStop = True
        Else
            txtTOK.Locked = True
            txtTOK.TabStop = False
            txtTNC.Locked = True
            txtTNC.TabStop = False
        End If
        Novo_Ordem2 = False
    End If
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizaProducao()
On Error GoTo tratar_erro

If txtAPOF = "" Or cmbAPOS = "" Then Exit Sub
txtStatus.Text = ""
TempoUtilizadoDescricao = 0

'Verifica o último evento apontado
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select " & NomeTabelaAp & ".* from (" & NomeTabelaAp & " INNER JOIN OrdemServico ON " & NomeTabelaAp & ".IDfase = OrdemServico.IDproducao) INNER JOIN ProducaoFases_OS ON OrdemServico.ID_apontamento = ProducaoFases_OS.ID where ProducaoFases_OS.ID = " & Txt_ID_apontamento & " and " & NomeTabelaAp & ".maquina = '" & txtAPMaquina.Text & "' order by " & NomeTabelaAp & ".Data desc, " & NomeTabelaAp & ".Tempoinicio desc"
Else
    TextoFiltro = "Select * from " & NomeTabelaAp & " where idfase = " & cmbAPOS & " and maquina = '" & txtAPMaquina.Text & "' order by Data desc, Tempoinicio desc"
End If
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    EventoAP = TBproducao!CodigoDesc
End If
TBproducao.Close

'Carrega dados na lista OS, máquina
APLista.ListItems.Clear
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from " & NomeTabelaAp & " where idfase = " & cmbAPOS & " and maquina = '" & txtAPMaquina.Text & "' order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    If Atualizacao = False Then
        'PBLista.Min = 0
        'PBLista.Max = TBproducao.RecordCount
        'PBLista.Value = 1
        Contador = 0
    End If
    Do While TBproducao.EOF = False
        With APLista.ListItems
            .Add , , TBproducao!IDProducao
            .Item(.Count).SubItems(1) = IIf(IsNull(TBproducao!CodigoDesc), 0, TBproducao!CodigoDesc)
            .Item(.Count).SubItems(2) = TBproducao!Descricao
            txtStatus.Text = TBproducao!Descricao
            .Item(.Count).SubItems(3) = Format(TBproducao!TempoInicio, "dd/mm/yy hh:mm:ss")
            .Item(.Count).SubItems(4) = Format(TBproducao!TempoFinal, "dd/mm/yy hh:mm:ss")
            If TBproducao!TempoInicio <> "00:00:00" Then
                TempoFinal = TBproducao!TempoInicio
                TempoUtilizadoDescricao = TBproducao!TempoInicio
            End If
            If TBproducao!Dias <> 0 Then
                TempoTotalDias = IIf(IsNull(TBproducao!TempoTotal), 0, TBproducao!TempoTotal) + TBproducao!Dias
                ElapsedTime (TempoTotalDias)
                .Item(.Count).SubItems(5) = HoraTotal
            Else
                .Item(.Count).SubItems(5) = IIf(IsNull(TBproducao!TempoTotal), "", TBproducao!TempoTotal)
            End If
            .Item(.Count).SubItems(6) = TBproducao!Usuario
            .Item(.Count).SubItems(7) = IIf(IsNull(TBproducao!quantidade), 0, TBproducao!quantidade)
            .Item(.Count).SubItems(8) = IIf(IsNull(TBproducao!Reprovada), 0, TBproducao!Reprovada)
            .Item(.Count).SubItems(9) = TBproducao!Pronto
            .Item(.Count).SubItems(10) = Format(TBproducao!Data, "dd/mm/yy")
            
            .Item(.Count).Selected = True
            ULTICOD = TBproducao!CodigoDesc
            ULTIDESC = TBproducao!Descricao
            UltiOperador = TBproducao!Usuario
        End With
        If TBproducao!CodigoDesc = 3 Then Tempoprocesso = TBproducao!Data
        
        If Atualizacao = False Then
            Contador = Contador + 1
            'PBLista.Value = Contador
        End If
        
        TBproducao.MoveNext
    Loop
    
1:
    'Se tiver mais de um evento gravado
    PenultimoMaq = ""
    Penultimo = 0
    PenultimoDesc = ""
    TBproducao.MoveFirst
    If APLista.ListItems.Count <> 0 Then
        TBproducao.Find ("IDproducao = " & IDProducao)
        If TBproducao.EOF = False Then
            'Grava evento na variavel ultimo
            UltimoMaq = TBproducao!maquina
            Ultimo = TBproducao!CodigoDesc
            UltimoDesc = TBproducao!Descricao
            TempoUltimo = TBproducao!TempoInicio
            Dataini = TBproducao!Data
            
            TBproducao.MovePrevious
            If TBproducao.BOF = False Then
                'Grava evento na variavel penultimo
                PenultimoMaq = TBproducao!maquina
                Penultimo = TBproducao!CodigoDesc
                PenultimoDesc = TBproducao!Descricao
                'Informa turno
                If IsNull(TBproducao!Turno) = False Then Turno = TBproducao!Turno
                txtTurno = Turno
                'Informa data do penultimo evento
                Dataini = TBproducao!Data
            End If
        Else
            'Grava evento na variavel ultimo
            TBproducao.MoveLast
            UltimoMaq = TBproducao!maquina
            Ultimo = TBproducao!CodigoDesc
            UltimoDesc = TBproducao!Descricao
            TempoUltimo = TBproducao!TempoInicio
            
            TBproducao.MovePrevious
            If TBproducao.BOF = False Then
                'Grava evento na variavel penultimo
                PenultimoMaq = TBproducao!maquina
                Penultimo = TBproducao!CodigoDesc
                PenultimoDesc = TBproducao!Descricao
                'Informa turno
                If IsNull(TBproducao!Turno) = False Then Turno = TBproducao!Turno
                txtTurno = Turno
                'Informa data do penultimo evento
                Dataini = TBproducao!Data
            End If
        End If
    End If
Else
    UltimoMaq = ""
    Ultimo = 0
    UltimoDesc = ""
    TempoUltimo = 0
    PenultimoMaq = ""
    Penultimo = 0
    PenultimoDesc = ""
    TotalOK = 0
    TotalNC = 0
    APLista.ListItems.Clear
    EventoAP = 0
    ULTICOD = 0
    ULTIDESC = ""
    UltiOperador = ""
End If
TBproducao.Close

'ProcAtualizaPrepExecUtilTotalizacao
'ProcAtualizaPrepExecUtilTotalizacaoMaq
'ProcAtualizaPrepExecUtil
'
'ProcAtualizaOF

Exit Sub
tratar_erro:
    If Err.Number = 365 Then GoTo 1
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub cmbdescricao_Click()
On Error GoTo tratar_erro

Set TBCodigoDesc = CreateObject("adodb.recordset")
TBCodigoDesc.Open "Select Codigo from CodigoDesc where Descricao = '" & cmbdescricao.Text & "'", Conexao, adOpenKeyset, adLockOptimistic
If TBCodigoDesc.EOF = False Then
    txtCodigo.Text = TBCodigoDesc!CODIGO
End If
TBCodigoDesc.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtexecucao_Change()
On Error GoTo tratar_erro

ProcCalculaExecucaoPeca

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtOF_Change()
On Error GoTo tratar_erro

If txtof.Text <> "" Then
    VerifNumero = txtof.Text
    ProcVerificaNumero
    If VerifNumero = False Then
        txtof.Text = ""
        txtof.SetFocus
        Exit Sub
    End If
    OF = txtof
End If
ProcLimpar False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

 Private Sub procAtualiza()
On Error GoTo tratar_erro

frmSenha.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizacao()
On Error GoTo tratar_erro

If USMsgBox("Deseja realmente executar essa(s) atualização(ões)?", vbYesNo, "CAPRIND v5.0") = vbYes Then
    Atualizacao = True
    Permitido1 = False
    With frmprod_atualizar
        If .Chk1.Value = 1 Or .Chk2.Value = 1 Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                TBFIltro.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBFIltro.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                TBFIltro.MoveFirst
                Do While TBFIltro.EOF = False
                    
                    'Número da OS nos apontamentos
                    If .Chk1.Value = 1 Then
                        Set TBOrdem = CreateObject("adodb.recordset")
                        TBOrdem.Open "Select * from Ordemservico where Ordem = " & TBFIltro!Ordem & " order by Fase", Conexao, adOpenKeyset, adLockOptimistic
                        If TBOrdem.EOF = False Then
                            Do While TBOrdem.EOF = False
                                Conexao.Execute "Update " & NomeTabelaAp & " Set IdFase = " & TBOrdem!IDProducao & ", OS = " & TBOrdem!IDProducao & " where Ordem = " & TBFIltro!Ordem & " and Fase = " & TBOrdem!Fase
                                Conexao.Execute "Update " & NomeTabelaApTotalizacao & " Set OS = " & TBOrdem!IDProducao & " where Ordem = " & TBFIltro!Ordem & " and Fase = " & TBOrdem!Fase
                                TBOrdem.MoveNext
                            Loop
                        End If
                        TBOrdem.Close
                    End If
                    
                    'Status do material
                    If .Chk2.Value = 1 Then
                        If Permitido1 = False Then
                            If USMsgBox("Deseja atualizar o status de acordo com a movimentação de estoque?", vbYesNo, "CAPRIND v5.0") = vbYes Then
                                Permitido = True
                            Else
                                USMsgBox ("O status das ordens concluídas será atualizado para SIM."), vbInformation, "CAPRIND v5.0"
                                Permitido = False
                            End If
                            Permitido1 = True
                        End If
                        If Permitido = True Then
                            Set TBMateriaprima = CreateObject("adodb.recordset")
                            TBMateriaprima.Open "Select * from producaomaterial where Ordem = " & TBFIltro!Ordem & " and Saida <> 'CANCEL.' order by Posicao, codigo", Conexao, adOpenKeyset, adLockOptimistic
                            If TBMateriaprima.EOF = False Then
                                Do While TBMateriaprima.EOF = False
                                    Qtde = TBMateriaprima!Requisitado
                                    QtdeSaida = 0
                                    Set TBEstoque = CreateObject("adodb.recordset")
                                    TBEstoque.Open "Select Sum(Saida) as QtdeSaida FROM Estoque_movimentacao where Ordem = '" & TBFIltro!Ordem & "' and Desenho = '" & TBMateriaprima!CODIGO & "' and (Operacao = 'SAIDA_ORDEM' or Operacao = 'SAIDA_ORDEM_PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
                                    If TBEstoque.EOF = False Then
                                        QtdeSaida = IIf(IsNull(TBEstoque!QtdeSaida), 0, TBEstoque!QtdeSaida)
                                    End If
                                    TBEstoque.Close
                                    If QtdeSaida <> 0 Then
                                        If Format(QtdeSaida, "###,##0.0000") < Format(Qtde, "###,##0.0000") Then TBMateriaprima!Saida = "PARCIAL" Else TBMateriaprima!Saida = "SIM"
                                    Else
                                        TBMateriaprima!Saida = "NÃO"
                                    End If
                                    TBMateriaprima.Update
                                    TBMateriaprima.MoveNext
                                Loop
                            End If
                            TBMateriaprima.Close
                        ElseIf Permitido = False And TBFIltro!Concluida = True Then
                                Conexao.Execute "UPDATE producaomaterial Set Saida = 'SIM' where Ordem = " & TBFIltro!Ordem
                        End If
                    End If
                    TBFIltro.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFIltro.Close
        End If
        
        'Dados das OS's
        If .Chk3.Value = 1 Then
            Set TBCFOP = CreateObject("adodb.recordset")
            TBCFOP.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBCFOP.EOF = False Then
                TBCFOP.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBCFOP.RecordCount
                '.PBLista.Value = 1
                Contador1 = 0
                TBCFOP.MoveFirst
                Do While TBCFOP.EOF = False
                    If TBCFOP!AP_backup = True Then NomeTabelaAp = "ProducaoFases_Backup" Else NomeTabelaAp = "ProducaoFases"
                    OF = TBCFOP!Ordem
                    ProcAcertaOS IIf(IsNull(TBCFOP!Quant), 0, TBCFOP!Quant), False
                    TBCFOP.MoveNext
                    Contador1 = Contador1 + 1
                    '.PBLista.Value = Contador1
                Loop
            End If
            TBCFOP.Close
        End If
        
        If .Chk4.Value = 1 Or .Chk5.Value = 1 Or .Chk6.Value = 1 Or .chk7.Value = 1 Or .chk8.Value = 1 Then
            Set TBAcessos = CreateObject("adodb.recordset")
            TBAcessos.Open "Select PF.IDFase from Producao P INNER JOIN " & NomeTabelaAp & " PF ON PF.Ordem = P.Ordem where (P.data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' Group by PF.IDFase", Conexao, adOpenKeyset, adLockReadOnly
            If TBAcessos.EOF = False Then
                TBAcessos.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBAcessos.RecordCount
                '.PBLista.Value = 1
                Contador1 = 0
                TBAcessos.MoveFirst
                Do While TBAcessos.EOF = False
                    Set TBFI = CreateObject("adodb.recordset")
                    TBFI.Open "Select Ordem from OrdemServico where Idproducao = " & TBAcessos!IDFase, Conexao, adOpenKeyset, adLockOptimistic
                    If TBFI.EOF = False Then
                    
                        txtof = TBFI!Ordem
                        txtAPOF = TBFI!Ordem
                        
                        ProcCarregaAPOS
                        
                        cmbAPOS = TBAcessos!IDFase
                        
                        If .Chk4.Value = 1 Then ProcCorrigeHoraApont
                        If .Chk5.Value = 1 Then ProcCorrigeTunosApont
                        If .Chk6.Value = 1 Then ProcCorrigeCodigoApont
                        If .chk7.Value = 1 Then ProcCorrigeDiasApont
                        If .chk8.Value = 1 Then
                            ProcCorrigeProdFasesTotalizacao
                            ProcAtualizaPrepExecUtil
                            ProcGravarStatusOSOF
                            ProcGravaValoresOS
                            ProcAtualizaOFAtualizacao
                        End If
                    End If
                    TBAcessos.MoveNext
                    Contador1 = Contador1 + 1
                    '.PBLista.Value = Contador1
                Loop
            End If
            TBAcessos.Close
        End If
        
        If .chk9.Value = 1 Or .chk10.Value = 1 Then
            Set TBFI = CreateObject("adodb.recordset")
            TBFI.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBFI.EOF = False Then
                TBFI.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBFI.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                TBFI.MoveFirst
                Do While TBFI.EOF = False
                    txtof = TBFI!Ordem
                    OF = TBFI!Ordem
                    txtAPOF.Text = TBFI!Ordem
                    txtAPquant = TBFI!Quant
                    
                    'Quantidade expedida
                    If .chk9.Value = 1 Then
                        ProcAtualizaOF
                    ElseIf TBFI!Tipo = "F" Then
                        ProcAtualizaOF
                    End If
                    
                    'Atualizar Dimensaototal na tabela Producaomaterial
                    If .chk10.Value = 1 Then
                        Set TBItem = CreateObject("adodb.recordset")
                        TBItem.Open "Select * from projproduto where desenho = '" & TBFI!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBItem.EOF = False Then
                            Set TBProcessos = CreateObject("adodb.recordset")
                            TBProcessos.Open "Select PC.*, P.SubTipoItem from projconjunto PC INNER JOIN projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & TBItem!Codproduto & " order by PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
                            If TBProcessos.EOF = False Then
                                Do While TBProcessos.EOF = False
                                    Set TBMaterial = CreateObject("adodb.recordset")
                                    TBMaterial.Open "Select * from producaomaterial WHERE Ordem = " & TBFI!Ordem & " and codigo = '" & TBProcessos!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
                                    If TBMaterial.EOF = False Then
                                        TBMaterial!Posicao = TBProcessos!Posicao
                                        TBMaterial!PesoMetro = TBProcessos!PesoMetro
                                        TBMaterial!pesounidade = TBProcessos!Peso
                                        TBMaterial!PesoTotal = TBProcessos!PesoTotal * TBFI!Quant
                                        TBMaterial!Dimensao = TBProcessos!Dimensoes
                                        Peso = TBProcessos!quantidade
                                        If TBProcessos!Un_Kg <> "N/a" And TBProcessos!Un_Kg <> "" And (TBProcessos!Unidade = "KG" Or TBProcessos!Unidade = "MT" Or TBProcessos!Unidade = "MM" Or TBProcessos!Unidade = "M³") Then
                                            Select Case TBProcessos!Unidade
                                                Case "KG": Peso = TBProcessos!PesoTotal
                                                Case "MT": Peso = (TBProcessos!Dimensoes / 1000) * TBProcessos!quantidade
                                                Case "MM": Peso = TBProcessos!Dimensoes * TBProcessos!quantidade
                                                Case "M³": Peso = TBProcessos!PesoTotal
                                            End Select
                                        End If
                                        TBMaterial!Requisitado = Peso * TBFI!Quant
                                        If TBProcessos!Un_Kg = "Mt²" Then TBMaterial!DimensaoTotal = ((TBMaterial!Dimensao / 1000) / 1000) * TBMaterial!quantidade Else TBMaterial!DimensaoTotal = (TBMaterial!Dimensao / 1000) * TBMaterial!quantidade
                                        TBMaterial.Update
                                    End If
                                    TBMaterial.Close
                                    TBProcessos.MoveNext
                                Loop
                            End If
                            TBProcessos.Close
                        End If
                        TBItem.Close
                    End If
                    TBFI.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFI.Close
        End If
        
        'Atualizar status, responsavel, revisões e dados da ordem consignada
        If .chk11.Value = 1 Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                TBFIltro.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBFIltro.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                TBFIltro.MoveFirst
                Do While TBFIltro.EOF = False
                    
                    'Revisão do cód. interno
'                    Set TBProduto = CreateObject("adodb.recordset")
'                    TBProduto.Open "Select Revdesenho from projproduto where desenho = '" & TBFIltro!Desenho & "'", Conexao, adOpenKeyset, adLockOptimistic
'                    If TBProduto.EOF = False Then
'                        TBFIltro!Revitem = TBProduto!RevDesenho
'                    End If
'                    TBProduto.Close
                    
                    'Atualiza status da OS e ordem
'                    Set TBproducao = CreateObject("adodb.recordset")
'                    TBproducao.Open "Select idproducao, pronto, Status from ordemservico where Ordem = " & TBFIltro!Ordem & " order by idproducao", Conexao, adOpenKeyset, adLockOptimistic
'                    If TBproducao.EOF = False Then
'                        Do While TBproducao.EOF = False
'                            Set TBProducaoFases = CreateObject("adodb.recordset")
'                            TBProducaoFases.Open "Select CodigoDesc from " & NomeTabelaAp & " where idfase = " & TBproducao!IDProducao & " order by Data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
'                            If TBProducaoFases.EOF = False Then
'                                ULTICOD = TBProducaoFases!CodigoDesc
'
'                                If ULTICOD <> 1 And ULTICOD <> 2 And ULTICOD <> 3 Then
'                                    TBproducao!Status = "Aguardando"
'                                Else
'                                    Select Case ULTICOD
'                                        Case 1: TBproducao!Status = "Preparando"
'                                        Case 2: TBproducao!Status = "Produzindo"
'                                        Case 3: TBproducao!Status = "Concluída"
'                                    End Select
'                                End If
'                            Else
'                                If TBproducao!Pronto = "NÃO" Then TBproducao!Status = "Aguardando" Else TBproducao!Status = "Concluída"
'                            End If
'                            TBProducaoFases.Close
'
'                            TBproducao.Update
'                            TBproducao.MoveNext
'                        Loop
'                    End If
'                    TBproducao.Close
                    
                    If TBFIltro!status <> "Entregue" Then
                        Set TBAbrir = CreateObject("adodb.recordset")
                        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBFIltro!Ordem & " and Status <> 'Concluída'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBAbrir.EOF = True Then
                            TBFIltro!status = "Concluída"
                            GoTo Sair1
                        End If
                        Set TBAbrir = CreateObject("adodb.recordset")
                        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBFIltro!Ordem & " and Status <> 'Aguardando'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBAbrir.EOF = False Then
                            TBFIltro!status = "Produzindo"
                            GoTo Sair1
                        End If
                        Set TBAbrir = CreateObject("adodb.recordset")
                        TBAbrir.Open "Select Status from ordemservico where Ordem = " & TBFIltro!Ordem & " and Status <> 'Preparando' and Status <> 'Produzindo' and Status <> 'Concluída'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBAbrir.EOF = False Then
                            TBFIltro!status = "Aberta"
                            GoTo Sair1
                        End If
                    End If
Sair1:
                    TBAbrir.Close
                    
                    'Atualiza responsável pela ordem
                    If IsNull(TBFIltro!Responsavel) = True Or TBFIltro!Responsavel = "" Then
                        Set TBMascara = CreateObject("adodb.recordset")
                        TBMascara.Open "Select usuario from mascara where modulo = 'PCP/Gerenciamento de ordem' and operacao = 'Novo' and documento = '" & TBFIltro!Ordem & "'", Conexao, adOpenKeyset, adLockOptimistic
                        If TBMascara.EOF = False Then
                            TBFIltro!Responsavel = TBMascara!Usuario
                        End If
                        TBMascara.Close
                    End If
                    
                    'Data de conclusão da ordem
                    Set TBproducao = CreateObject("adodb.recordset")
                    TBproducao.Open "Select * from ordemservico where Ordem = " & TBFIltro!Ordem & " and Pronto = 'NÃO'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBproducao.EOF = True Then
                        Set TBproducao = CreateObject("adodb.recordset")
                        TBproducao.Open "Select Dataconclusao from ordemservico where Ordem = " & TBFIltro!Ordem & " ORDER BY fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
                        If TBproducao.EOF = False Then
                            TBproducao.MoveLast
                            TBFIltro!DataEntrega = TBproducao!DataConclusao
                            TBFIltro!Concluida = True
                        End If
                    End If
                    TBproducao.Close
                    TBFIltro.Update
                    TBFIltro.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFIltro.Close
        End If
    
        'Atualiza qtde não conforme na ordem
        If .chk12.Value = 1 Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                TBFIltro.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBFIltro.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                TBFIltro.MoveFirst
                Do While TBFIltro.EOF = False
                    TotalNC = 0
                    Set TBOrdem = CreateObject("adodb.recordset")
                    TBOrdem.Open "Select * from Ordemservico where Ordem = " & TBFIltro!Ordem & " order by Idproducao", Conexao, adOpenKeyset, adLockOptimistic
                    If TBOrdem.EOF = False Then
                        Do While TBOrdem.EOF = False
                            Set TBAbrir = CreateObject("adodb.recordset")
                            TBAbrir.Open "Select Sum(TTNC) as TotalNC from CQ_NC_FABRICA where OS = " & TBOrdem!IDProducao & " and PARECERCQ = 'Rejeitar'", Conexao, adOpenKeyset, adLockOptimistic
                            If TBAbrir.EOF = False Then
                                TotalNC = TotalNC + IIf(IsNull(TBAbrir!TotalNC), 0, TBAbrir!TotalNC)
                            End If
                            TBAbrir.Close
                            TBOrdem.MoveNext
                        Loop
                    End If
                    TBOrdem.Close
                    TBFIltro!QuantNC = TotalNC
                    TBFIltro.Update
                    TBFIltro.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFIltro.Close
        End If
    
        'Código dos clientes
        If .chk13.Value = 1 Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select * from producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                TBFIltro.MoveLast
                '.PBLista.Min = 0
                '.PBLista.Max = TBFIltro.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                TBFIltro.MoveFirst
                Do While TBFIltro.EOF = False
                    Set TBClientes = CreateObject("adodb.recordset")
                    TBClientes.Open "Select IDCliente From Clientes where NomeRazao = '" & TBFIltro!Cliente & "'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBClientes.EOF = False Then
                        TBFIltro!IDCliente = TBClientes!IDCliente
                        TBFIltro.Update
                    End If
                    TBFIltro.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFIltro.Close
        End If
    
        'Atualizar número da ordem na tabela estoque_movimentacao
        If .Chk14.Value = 1 Then
            Set TBFIltro = CreateObject("adodb.recordset")
            TBFIltro.Open "Select EM.* from Producao P INNER JOIN estoque_movimentacao EM ON EM.Ordem = P.Ordem where (P.data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL') order by EM.Idoperacao", Conexao, adOpenKeyset, adLockOptimistic
            If TBFIltro.EOF = False Then
                '.PBLista.Min = 0
               ' .PBLista.Max = TBFIltro.RecordCount
               ' .PBLista.Value = 1
                Contador = 0
                Do While TBFIltro.EOF = False
                    Contador2 = TBFIltro!Documento
                    TBFIltro!Documento = Contador2
                    TBFIltro.Update
                    TBFIltro.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBFIltro.Close
        End If
                    
        'Valor dos materiais nas ordens
        If .Chk15.Value = 1 Then
            Conexao.Execute "Update producao Set CTMaterial = 0 where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "'"
            
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from Producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                '.PBLista.Min = 0
                '.PBLista.Max = TBproducao.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                Do While TBproducao.EOF = False
                    Conexao.Execute "Update Producaomaterial Set Valor_saida_estoque = 0 where Ordem = " & TBproducao!Ordem
                    
                    valor = 0
                    Valor1 = 0
                    Set TBFI = CreateObject("adodb.recordset")
                    TBFI.Open "Select PM.Codigo, SUM(EM.VlrTotal) as Valor, PM.Valor_saida_estoque from (producaomaterial PM INNER JOIN Estoque_movimentacao EM ON EM.Desenho = PM.Codigo) INNER JOIN Estoque_Controle EC ON EC.IDestoque = EM.IDestoque where PM.Ordem = " & TBproducao!Ordem & " and EM.Documento = '" & TBproducao!Ordem & "' and EC.Consignacao = 'False' and (EM.Operacao = 'SAIDA_ORDEM' or EM.Operacao = 'SAIDA_ORDEM_PARCIAL') group by PM.codigo, PM.Valor_saida_estoque", Conexao, adOpenKeyset, adLockReadOnly
                    If TBFI.EOF = False Then
                       ' PBLista.Min = 0
                       ' PBLista.Max = TBFI.RecordCount
                       ' PBLista.Value = 1
                        Contador = 0
                        Do While TBFI.EOF = False
                            valor = IIf(IsNull(TBFI!valor), 0, TBFI!valor)
                            NovoValor = Replace(valor, ",", ".")
                            Conexao.Execute "UPDATE producaomaterial Set Valor_saida_estoque = " & NovoValor & " where Codigo = '" & TBFI!CODIGO & "' and Ordem = " & TBproducao!Ordem
                            
                            Valor1 = Valor1 + valor
                            TBFI.MoveNext
                            Contador = Contador + 1
                           ' PBLista.Value = Contador
                        Loop
                    End If
                    TBFI.Close
                    If Valor1 > 0 Then
                        TBproducao!CTMaterial = Format(Valor1, "###,##0.00")
                        TBproducao.Update
                    Else
                        Set TBAliquota = CreateObject("adodb.recordset")
                        TBAliquota.Open "Select * from Empresa where Codigo = " & TBproducao!ID_empresa, Conexao, adOpenKeyset, adLockOptimistic
                        If TBAliquota.EOF = False Then
                            If TBAliquota!Real = True Then
                                TextoFiltro = "Sum(NFP.dbl_ValorTotal - (CST_ICMS.Valor_ICMS + CST_ICMS.Valor_ICMS_ST + CST_ICMS.Valor_ICMS_SN) - (NFP.Total_PIS_prod + NFP.Total_Cofins_prod))"
                            Else
                                TextoFiltro = "Sum(NFP.dbl_ValorTotal - (CST_ICMS.Valor_ICMS + CST_ICMS.Valor_ICMS_ST + CST_ICMS.Valor_ICMS_SN))"
                            End If
                            Set TBCompras_Lista = CreateObject("adodb.recordset")
                            TBCompras_Lista.Open "Select ROUND(" & TextoFiltro & ", 2) AS Valortotal from ((tbl_Detalhes_Nota NFP INNER JOIN Compras_pedido_lista PP ON NFP.codigo = PP.IDlista and NFP.int_Cod_Produto = PP.Desenho) INNER JOIN tbl_Detalhes_Nota_CST_ICMS CST_ICMS ON CST_ICMS.ID_item = NFP.Int_codigo) INNER JOIN Compras_pedido P ON P.IDpedido = PP.IDpedido where NFP.Ordem = '" & TBproducao!Ordem & "' and PP.remessa = 'False' and (PP.OS is null or PP.OS = 0)", Conexao, adOpenKeyset, adLockOptimistic
                            If TBCompras_Lista.EOF = False Then
                                TBproducao!CTMaterial = IIf(IsNull(TBCompras_Lista!ValorTotal), 0, TBCompras_Lista!ValorTotal)
                            End If
                            TBCompras_Lista.Close
                            TBproducao.Update
                        End If
                        TBAliquota.Close
                    End If
                    
                    TBproducao.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBproducao.Close
        End If
        
        'Valor de terceiros nas ordens
        If .Chk16.Value = 1 Then
            Conexao.Execute "Update producao Set CTServico = 0 where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "'"
        
            Set TBproducao = CreateObject("adodb.recordset")
            TBproducao.Open "Select * from Producao where (data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "' order by Ordem", Conexao, adOpenKeyset, adLockOptimistic
            If TBproducao.EOF = False Then
                '.PBLista.Min = 0
                '.PBLista.Max = TBproducao.RecordCount
                '.PBLista.Value = 1
                Contador = 0
                Do While TBproducao.EOF = False
                    'Custo terceiros utilizado pela OS da ordem
                    valor = 0
                    Set TBOrdem = CreateObject("adodb.recordset")
                    TBOrdem.Open "Select * from ordemservico where Ordem = " & TBproducao!Ordem & " and Custos = 'False'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBOrdem.EOF = False Then
                        Do While TBOrdem.EOF = False
                            Valor1 = 0
                            Set TBAbrir = CreateObject("adodb.recordset")
                            TBAbrir.Open "Select Sum(ROUND(NFP.dbl_ValorUnitario * NFPP.Quantidade, 2)) as Valor1 from (Compras_pedido_lista CPL INNER JOIN tbl_Detalhes_Nota_pedidos NFPP ON NFPP.ID_carteira = CPL.IDlista and NFPP.Codinterno = CPL.Desenho) INNER JOIN tbl_Detalhes_Nota NFP ON NFP.Int_codigo = NFPP.ID_prod_NF where CPL.Ordem = " & TBOrdem!Ordem & " and CPL.OS  = " & TBOrdem!IDProducao & " and CPL.Remessa = 'False' and (CPL.Status_Item = 'RECEBIDO' or CPL.Status_Item = 'PARCIAL')", Conexao, adOpenKeyset, adLockOptimistic
                            If TBAbrir.EOF = False Then
                                Valor1 = IIf(IsNull(TBAbrir!Valor1), 0, TBAbrir!Valor1)
                            End If
                            TBOrdem!CTServico = Format(Valor1, "###,##0.00")
                            TBOrdem.Update
                            valor = valor + Valor1
                            TBOrdem.MoveNext
                        Loop
                    End If
                    TBOrdem.Close
                
                    'Custo terceiros utilizado pela ordem
                    TBproducao!CTServico = Format(valor, "###,##0.00")
                    TBproducao.Update
                    
                    TBproducao.MoveNext
                    Contador = Contador + 1
                    '.PBLista.Value = Contador
                Loop
            End If
            TBproducao.Close
        End If
        
        'Valor unitário do estoque
        If .Chk17.Value = 1 Then ProcAtualizarVlrUnitOrdemEst "(data) Between '" & Format(.msk_fltInicio, "Short Date") & "' And '" & Format(.msk_fltFim, "Short Date") & "'", .PBLista

'===========================================================================================
' Inserir na qualidade itens com não conformidade
'===========================================================================================
If .Chk18.Value = 1 Then
 StrSql = "select PF.* , CQ.idproducao as CQ_ID from ProducaoFases PF Left join CQ_NC_Fabrica  CQ on PF.IDProducao = CQ.idproducao where PF.reprovada > '0' and CQ.idproducao is null"
  Set TBproducao = CreateObject("adodb.recordset")
  TBproducao.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
    If TBproducao.EOF = False Then
    .PBLista.Min = 0
    .PBLista.Max = TBproducao.RecordCount
    .PBLista.Value = 0
    Contador = 0
    Do While TBproducao.EOF = False
    CamposLoop = "(" & TBproducao!IDProducao & "," & TBproducao!Ordem & "," & TBproducao!OS & "," & Replace(TBproducao!Reprovada, ",", ".") & "," & Replace(TBproducao!Quant, ",", ".") & ",'" & TBproducao!Data & "','" & Time & "','" & TBproducao!maquina & "'," & TBproducao!Turno & ",'NULL','" & TBproducao!Usuario & "','PRODUÇÃO','NULL','FALSE')"
    StrSql = "INSERT INTO CQ_NC_FABRICA (IDProducao, Ordem, OS, TTNC, LOTE, Data, Hora, Maquina, Turno, PARECERCQ, Operador, Setor, obsFab, Analizada) VALUES " & CamposLoop
    'Debug.print StrSql
    
    Conexao.Execute StrSql
    TBproducao.MoveNext
    .PBLista.Value = .PBLista.Value + 1
    .Refresh
    Loop
   End If
End If

        
USMsgBox ("Atualização efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
Atualizacao = False
ProcLimpar True
'==================================
Modulo = "PCP/Gerenciamento de ordem"
Evento = "Atualizar"
ID_documento = 0
Documento = ""
Documento1 = ""
ProcGravaEvento
'==================================
End With
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Private Sub txtOSFase_LostFocus()
On Error GoTo tratar_erro

If txtOSFase.Text <> "" Then
    VerifNumero = txtOSFase.Text
    ProcVerificaNumero
    If VerifNumero = False Then
        txtOSFase.Text = ""
        txtOSFase.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtOSLote_LostFocus()
On Error GoTo tratar_erro

If txtOSLote.Text <> "" Then
    VerifNumero = txtOSLote.Text
    ProcVerificaNumero
    If VerifNumero = False Then
        txtOSLote.Text = ""
        txtOSLote.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtNreg_Change()
On Error GoTo tratar_erro

If txtNreg <> "" Then
    VerifNumero = txtNreg
    ProcVerificaNumero
    If VerifNumero = False Then
        txtNreg = ""
        txtNreg.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtNreg2_Change()
On Error GoTo tratar_erro

If txtNreg2 <> "" Then
    VerifNumero = txtNreg2
    ProcVerificaNumero
    If VerifNumero = False Then
        txtNreg2 = ""
        txtNreg2.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtPagIr_Change()
On Error GoTo tratar_erro

If txtPagIr <> "" Then
    VerifNumero = txtPagIr
    ProcVerificaNumero
    If VerifNumero = False Then
        txtPagIr = ""
        txtPagIr.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtPagIr2_Change()
On Error GoTo tratar_erro

If txtPagIr2 <> "" Then
    VerifNumero = txtPagIr2
    ProcVerificaNumero
    If VerifNumero = False Then
        txtPagIr2 = ""
        txtPagIr2.SetFocus
        Exit Sub
    End If
End If
    
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtPcHora_Change()
On Error GoTo tratar_erro

If txtPcHora.Text <> "" Then
    VerifNumero = txtPcHora.Text
    ProcVerificaNumero
    If VerifNumero = False Then
        txtPcHora.Text = ""
        txtPcHora.SetFocus
        Exit Sub
    End If
End If
ProcCalculaExecucaoPeca

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCalculaExecucaoPeca()
On Error GoTo tratar_erro

txtpreparacao.PromptInclude = True
txtexecucao.PromptInclude = False
If Len(txtexecucao.Text) < 7 Then
    txtexecucao.PromptInclude = True
    Exit Sub
End If
txtexecucao.PromptInclude = True
If txtexecucao > "023:59:59" Then
    ProcFormataHora (txtexecucao)
    Familiatext = DataResultado
    TxtA3 = FunCalculaSegPC(Familiatext, txtPcHora)
Else
    TxtA3 = FunCalculaSegPC(txtexecucao, txtPcHora)
End If
TxtA3 = FormataTempo(TxtA3.Text)
txtexecucao.PromptInclude = False

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtquantidade_LostFocus()
On Error GoTo tratar_erro

If txtQuantidade.Text <> "" Then
    VerifNumero = txtQuantidade.Text
    ProcVerificaNumero
    If VerifNumero = False Then
        txtQuantidade.Text = ""
        txtQuantidade.SetFocus
        Exit Sub
    End If
End If
QuantSolicitado = IIf(txtQuantidade = "", 0, txtQuantidade)

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCalculaCusto()
On Error GoTo tratar_erro

'Calcula total de segundos utilizados produzindo
DataVariavel = CalculaDHMS(TEUTIL, 0)
TEUSEG = CalculaIntervaloSegundos(Dia, Hora, Minuto, Segundo)
Set TBOrdemServico = CreateObject("adodb.recordset")
TBOrdemServico.Open "Select * from ordemservico where IDPRODUCAO = " & txtOS.Text, Conexao, adOpenKeyset, adLockOptimistic
If TBOrdemServico.EOF = False Then
    TBOrdemServico!TEUTIL = TEUTIL
    If TTOK > 0 Then
        TBOrdemServico!TEUTIL = TBOrdemServico!TEUTIL / TTOK
        txtTEUTIL = TEUTIL / TTOK
        txtTEUTIL = Format(txtTEUTIL, "hh:mm:ss")
    Else
        TBOrdemServico!TEUTIL = TBOrdemServico!TEUTIL
        txtTEUTIL = TEUTIL
    End If
    TBOrdemServico!TEUSEG = TEUSEG
    If TTOK > 0 Then
        TBOrdemServico!TEUSEG = TBOrdemServico!TEUSEG / TTOK
    Else
        TBOrdemServico!TEUSEG = TBOrdemServico!TEUSEG
    End If
    TBOrdemServico!TETTUTIL = TEUTIL
    TBOrdemServico!TETTUTILSEG = TEUSEG
    TBOrdemServico!QTOK = TTOK
    TBOrdemServico!QTNC = TTNC
    TBOrdemServico.Update
End If
TBOrdemServico.Close
txtTTReal = TEUTIL

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub txtun_Change()
On Error GoTo tratar_erro

Label1(87).Caption = txtUN.Text & " x execução"
Label1(88).Caption = "Execução x " & txtUN.Text
Label1(91).Caption = txtUN.Text & " x execução"
Label1(92).Caption = "Execução x " & txtUN.Text
Label1(98).Caption = "MO prevista x " & txtUN.Text
Label1(109).Caption = "MO real x " & txtUN.Text
Label1(115).Caption = "(=) Total x " & txtUN.Text
Label1(28).Caption = "Previsto x " & txtUN.Text
Label1(107).Caption = "Real x " & txtUN.Text
Label1(67).Caption = txtUN.Text & " x exec."
Label1(68).Caption = "exec. x " & txtUN.Text
chkPchora.Caption = txtUN.Text & " x exec."

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub


Private Sub USToolBar1_ButtonClick(ByVal ButtonIndex As Integer, ByVal key As String, ByVal Left As Integer, ByVal Top As Integer, ByVal Width As Integer, ByVal Height As Integer, ByVal Visible As Boolean)
On Error GoTo tratar_erro

Select Case ButtonIndex
    Case 1: ProcFiltrarCarteira
    Case 2: ProcAlterarLista
    Case 3: ProcImprimirCarteira
    Case 4: ProcMRP
    Case 5: ProcExcluirMRP
    Case 6: ProcAlterarStatusOrdens
    Case 7: ProcEmpenhoPI
    Case 9: ProcAjuda
    Case 10: ProcSair
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub USToolBar2_ButtonClick(ByVal ButtonIndex As Integer, ByVal key As String, ByVal Left As Integer, ByVal Top As Integer, ByVal Width As Integer, ByVal Height As Integer, ByVal Visible As Boolean)
On Error GoTo tratar_erro

Select Case ButtonIndex
    Case 1: ProcNovo
    Case 2: ProcFiltrarOrdem
    Case 3: ProcSalvarOrdem
    Case 4: ProcExcluir
    Case 5: ProcImprimir
    Case 6: ProcAnterior
    Case 7: procProxima
    Case 8: ProcAlterarStatusOrdem
    Case 9: ProcValidarRegistros Lista, IIf(Cmb_opcao_lista3 = "Validação", "PCP/Gerenciamento de ordem", "PCP/Gerenciamento de ordem/Validar resultados")
    Case 10:
    
    If chkindividual.Value = 1 Then
    frmProd_Rastreabilidade.Show
    End If
    
    Case 11: procAtualiza
    Case 13: ProcAjuda
    Case 14: ProcSair
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub USToolBar3_ButtonClick(ByVal ButtonIndex As Integer, ByVal key As String, ByVal Left As Integer, ByVal Top As Integer, ByVal Width As Integer, ByVal Height As Integer, ByVal Visible As Boolean)
On Error GoTo tratar_erro

Select Case ButtonIndex
    Case 1: ProcNovoOS
    Case 2: ProcSalvarOS
    Case 3: ProcExcluirOS
    Case 4: ProcImprimirOS
    Case 5: ProcAnterior
    Case 6: procProxima
    Case 7: ProcAlterarStatusOS
    Case 8: ProcAtualizaPrazoFinal
    Case 9: ProcRenumerar
    Case 10: ProcAtualizaOS
    Case 12: ProcAjuda
    Case 13: ProcSair
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub USToolBar4_ButtonClick(ByVal ButtonIndex As Integer, ByVal key As String, ByVal Left As Integer, ByVal Top As Integer, ByVal Width As Integer, ByVal Height As Integer, ByVal Visible As Boolean)
On Error GoTo tratar_erro

Select Case ButtonIndex
    Case 1: ProcNovoReq
    Case 2: procAlterarReq
    Case 3: ProcExcluirReq
    Case 5: ProcAjuda
    Case 6: ProcSair
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub USToolBar5_ButtonClick(ByVal ButtonIndex As Integer, ByVal key As String, ByVal Left As Integer, ByVal Top As Integer, ByVal Width As Integer, ByVal Height As Integer, ByVal Visible As Boolean)
On Error GoTo tratar_erro

Select Case ButtonIndex
    Case 1: ProcImprimirResultados
    Case 2: ProcAnterior
    Case 3: procProxima
    Case 4: ProcCusto
    Case 5: ProcAtualizar_DadosOrdem
    Case 6:
        If USMsgBox("Deseja realmente validar/Cancelar validação do resultado desta ordem?", vbYesNo, "CAPRIND v5.0") = vbYes Then
            If txtDtValidacao = "" Then
                USMsgBox "Não é possivel validar o resultado da ordem, pois a mesma ainda não foi validada.", vbExclamation, "CAPRIND v5.0"
                Exit Sub
            End If
            If procVerificaEstoqueValidacao = False Then Exit Sub
            
            Formulario = "PCP/Gerenciamento de ordem/Validar resultados"
            frmValidar.Show 1
        End If
    Case 8: ProcAjuda
    Case 9: ProcSair
End Select

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcImprimirOS()
On Error GoTo tratar_erro

If txtOS = "" Then
    USMsgBox ("Informe a OS antes de visualizar impressão."), vbInformation, "CAPRIND v5.0"
    Exit Sub
End If
NomeRel = "Pcp_ordem.rpt"
ProcImprimirRel "{Producao.Ordem} = " & txtof & " and {OrdemServico.idproducao}= " & txtOS, ""

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizar_DadosOrdem()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtDtValidacao = "" Then
    USMsgBox "Não é possivel atualizar dados da ordem, pois a mesma ainda não foi validada.", vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

frmProd_AtualizarOrdens.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcNovoReq()
On Error GoTo tratar_erro

If Incluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If FunVerifValidacaoRegistro("criar nova", txtDtValidacao, "ordem", "requisição", False) = False Then Exit Sub
PCP_Ordem = True
ID_Familia = 0
frmproj_EstruturaLocaliza_item.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcExcluirReq()
On Error GoTo tratar_erro

If Excluir = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
Permitido = False
With ListaRequisicao
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente excluir esta(s) requisição(ões)?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
            Permitido = True
            Set TBFI = CreateObject("adodb.recordset")
            TBFI.Open "Select Posicao, Versao from producaomaterial where Idmateriaprima = " & .ListItems(InitFor), Conexao, adOpenKeyset, adLockOptimistic
            If TBFI.EOF = False Then
                Conexao.Execute "Update producaomaterial Set Posicao = Posicao - 1 where Posicao > " & TBFI!Posicao & " and Posicao IS NOT NULL and Ordem = " & txtof & " and Versao = '" & TBFI!versao & "'"
                Conexao.Execute "DELETE from producaomaterial WHERE Idmateriaprima = " & .ListItems(InitFor)
                Conexao.Execute "DELETE from Producao_NF_Consignada WHERE Ordem = " & txtof & " and Codinterno = '" & .ListItems(InitFor).ListSubItems(1) & "'"
                
                '==================================
                Modulo = "PCP/Gerenciamento de ordem"
                Evento = "Excluir Requisição de material"
                ID_documento = .ListItems(InitFor)
                Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
                Documento1 = "Cód. interno: " & .ListItems(InitFor).ListSubItems(1)
                ProcGravaEvento
                '==================================
            End If
            TBFI.Close
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) requisição(ões) antes de excluir."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("Requisição(ões) excluída(s) com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcCarregaListaRequisicao
    If ListaRequisicao.ListItems.Count <> 0 Then ProcCarregaListaEmpenhos
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAlterarStatusOrdens()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If listaitens.ListItems.Count = 0 Then Exit Sub
frmprod_Status.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAlterarStatusReq()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If ListaRequisicao.ListItems.Count = 0 Then Exit Sub

'Verifica se o resultado da ordem foi validado
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    USMsgBox ("Não é permitido alterar status da requisição, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close

frmprod_StatusReq.Show 1

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAlterarStatusOrdem()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If


Permitido2 = False
With Lista
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
        NOrdem = .ListItems.Item(InitFor)
        Dataini = .ListItems.Item(InitFor).ListSubItems(3).Text
        statusordem = IIf(.ListItems.Item(InitFor).ListSubItems(7).Text <> "", "Concluída", "Aberta")
'==================================
' NOVA FUNÇÃO QTBaixar ESTOQUE 2019
'==================================
 'If statusordem = "Aberta" Then
 
 '   Do While True
 '   DataOrdem = InputBox("Digite a data de encerramento da ordem: (DD/MM/AAAA)", "CAPRIND")
 '     If Not IsDate(DataOrdem) Then
 '      usMsgbox "Data invalida"
 '     Else
 '      Exit Do
 '     End If
 '   Loop
 'End If
 'Concluir as OS
 '=================================
            Set TBAbrir = CreateObject("adodb.recordset")
            TBAbrir.Open "Select P.AP_backup, P.Status, OS.* from Producao P INNER JOIN ordemservico OS ON OS.Ordem = P.Ordem where OS.Ordem = " & .ListItems.Item(InitFor), Conexao, adOpenKeyset, adLockOptimistic
            If TBAbrir.EOF = False Then
                If TBAbrir!AP_backup = True Then
                    NomeTabelaAp = "ProducaoFases_Backup"
                    NomeTabelaApTotalizacao = "ProducaoFases_Totalizacao_Backup"
                Else
                    NomeTabelaAp = "ProducaoFases"
                    NomeTabelaApTotalizacao = "ProducaoFases_Totalizacao"
                End If
                
                Do While TBAbrir.EOF = False
                    ProcAlterarStatusOS1 TBAbrir!IDProducao, TBAbrir!Pronto, IIf(TBAbrir!status = "Cancelada", TBAbrir!status, IIf(TBAbrir!status <> "Concluída", "Concluída", TBAbrir!status))
                    TBAbrir.MoveNext
                Loop
            End If
            TBAbrir.Close
            '==================================
            ' NOVA FUNÇÃO QTBaixar ESTOQUE
            '==================================
               'Concluir ordem de produção e colocar data de conclusão
'               If .ListItems.Count = 1 Then
'                           If statusordem <> "Concluída" Then
'                               ProcBaixar_estoque_ordem
'                               ProcEntradaEstoqueOrdem
'                           End If
                           ProcAlterarStatusOrdem1 .ListItems.Item(InitFor)
'                End If
 
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar status da ordem"
            ID_documento = .ListItems(InitFor)
            Documento = "Ordem: " & .ListItems.Item(InitFor) & " - Cód. interno: " & .ListItems.Item(InitFor).ListSubItems(4)
            Documento1 = ""
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
atualiza_lista_ordens (IIf(ReturnNumbersOnly(Left(lblPaginas.Caption, Len(lblPaginas.Caption) - 5)) <= 1, 1, ReturnNumbersOnly(Left(lblPaginas.Caption, Len(lblPaginas.Caption) - 5))))
USMsgBox ("Alteração de Status da(s) ordem(ns) efetuada com sucesso."), vbInformation, "CAPRIND v5.0", "CAPRIND"

Exit Sub
tratar_erro:
    USMsgBox ("Erro validação dos dados : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAlterarStatusOS()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

Permitido = False
With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente alterar o status desta(s) OS(s)?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
            End If
1:
            Permitido = True
            ProcAlterarStatusOS1 .ListItems.Item(InitFor), .ListItems(InitFor).SubItems(5), IIf(cmbStatus = "Cancelada", cmbStatus, IIf(cmbStatus <> "Concluída", "Concluída", cmbStatus))
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar status da OS"
            ID_documento = .ListItems(InitFor)
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "OS: " & .ListItems(InitFor)
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = True Then
    ProcAlterarStatusOrdem1 txtof
    ProcAtualizalista_os
    USMsgBox ("Alteração efetuada com sucesso."), vbInformation, "CAPRIND v5.0"
Else
    USMsgBox ("Informe a(s) OS(s) antes de alterar o status."), vbExclamation, "CAPRIND v5.0"
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcAlterarStatusOS1(OS As Long, Concluida As String, status As String)
On Error GoTo tratar_erro

Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from ordemservico where IDproducao = " & OS, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    If Concluida = "NÃO" And status = "Concluída" Then
        TBproducao!Pronto = "SIM"
        TBproducao!DataConclusao = Date
        If status = "Cancelada" Then TBproducao!status = "Cancelada" Else TBproducao!status = "Concluída"
        Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'SIM' where idfase = " & TBproducao!IDProducao
        Conexao.Execute "Update Ordemservico_maq_utilizadas Set Pronto = 'SIM' where OS = " & TBproducao!IDProducao
        Conexao.Execute "Update CM Set CM.Liberada = 'True' from cadmaquinas CM INNER JOIN cadmaquinas_Monitor CMM ON CM.Maquina = CMM.Maquina where CMM.maquina = '" & TBproducao!maquina & "' and CMM.OS = " & TBproducao!IDProducao
    Else
        TBproducao!Pronto = "NÃO"
        TBproducao!DataConclusao = Null
        Set TBProducaoFases = CreateObject("adodb.recordset")
        TBProducaoFases.Open "Select CodigoDesc, Data from " & NomeTabelaAp & " where IDFase = " & TBproducao!IDProducao & " order by Data desc, Tempoinicio desc", Conexao, adOpenKeyset, adLockOptimistic
        If TBProducaoFases.EOF = False Then
            If TBProducaoFases!CodigoDesc = 1 Then TBproducao!status = "Preparando"
            If TBProducaoFases!CodigoDesc = 2 Then TBproducao!status = "Produzindo"
            If TBProducaoFases!CodigoDesc = 3 Then
                TBproducao!Pronto = "SIM"
                If status = "Cancelada" Then TBproducao!status = "Cancelada" Else TBproducao!status = "Concluída"
                TBproducao!DataConclusao = TBProducaoFases!Data
                Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'SIM' where idfase = " & TBproducao!IDProducao
                Conexao.Execute "Update Ordemservico_maq_utilizadas Set Pronto = 'SIM' where OS = " & TBproducao!IDProducao
                Conexao.Execute "Update CM Set CM.Liberada = 'True' from cadmaquinas CM INNER JOIN cadmaquinas_Monitor CMM ON CM.Maquina = CMM.Maquina where CMM.maquina = '" & TBproducao!maquina & "' and CMM.OS = " & TBproducao!IDProducao
            Else
                Conexao.Execute "Update " & NomeTabelaAp & " Set pronto = 'NÃO' where idfase = " & TBproducao!IDProducao
                Conexao.Execute "Update Ordemservico_maq_utilizadas Set Pronto = 'NÃO' where OS = " & TBproducao!IDProducao
                Conexao.Execute "Update CM Set CM.Liberada = 'False' from cadmaquinas CM INNER JOIN cadmaquinas_Monitor CMM ON CM.Maquina = CMM.Maquina where CMM.maquina = '" & TBproducao!maquina & "' and CMM.OS = " & TBproducao!IDProducao
            End If
        Else
            If status = "Cancelada" Then TBproducao!status = "Cancelada" Else TBproducao!status = "Aguardando"
        End If
        TBProducaoFases.Close
    End If
    TBproducao.Update
End If
TBproducao.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcAlterarStatusOrdem1(Ordem As Long)
On Error GoTo tratar_erro

Permitido = False
Permitido1 = False
Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select Pronto, DataConclusao from ordemservico where Ordem = " & NOrdem & " order by IDproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    PagarParcial = True
    Do While TBproducao.EOF = False
        If TBproducao!Pronto = "NÃO" Then
            Permitido = True
        Else
            Permitido1 = True
            If IsNull(TBproducao!DataConclusao) = False And TBproducao!DataConclusao <> "" Then Dataini = TBproducao!DataConclusao
        End If
        TBproducao.MoveNext
    Loop
Else
    PagarParcial = False
End If

Set TBproducao = CreateObject("adodb.recordset")
TBproducao.Open "Select * from producao where Ordem = " & NOrdem, Conexao, adOpenKeyset, adLockOptimistic
If TBproducao.EOF = False Then
    If Permitido = True Or PagarParcial = False And IsNull(TBproducao!DataEntrega) = False Then
        TBproducao!DataEntrega = Null
        TBproducao!Concluida = False
        TBproducao!pronta = "NÃO"
        If TBproducao!status <> "Cancelada" And TBproducao!status <> "Aguardando" And TBproducao!status <> "Entregue" And TBproducao!status <> "Sem material" Then
            If Permitido1 = True Then TBproducao!status = "Produzindo" Else TBproducao!status = "Aberta"
        End If
    Else
        If IsNull(TBproducao!DataEntrega) = True Or TBproducao!DataEntrega = "" Then TBproducao!DataEntrega = IIf(DataOrdem <> "", DataOrdem, Date)
        TBproducao!Concluida = True
        TBproducao!pronta = "SIM"
        If TBproducao!status <> "Entregue" Then TBproducao!status = "Concluída"
    End If
    TBproducao.Update
End If
TBproducao.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

'=================================================================================================================================
'Atualização dos apontamentos e resultados

Sub ProcAtualizaDadosOSOrdem()
On Error GoTo tratar_erro

maquina = txtAPMaquina

'PBLista.Value = 0
'PBLista.Max = 10
'PBLista.Max = 9
ProcCorrigeHoraApont
'PBLista.Value = PBLista.Value + 1

ProcCorrigeTunosApont
'PBLista.Value = PBLista.Value + 1

ProcCorrigeCodigoApont
'PBLista.Value = PBLista.Value + 1

ProcCorrigeDiasApont
'PBLista.Value = PBLista.Value + 1

txtAPMaquina.Clear
Set TBMaquinas = CreateObject("adodb.recordset")
TBMaquinas.Open "Select * from cadmaquinas order by maquina", Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
    txtAPMaquina.AddItem ""
    Do While TBMaquinas.EOF = False
        txtAPMaquina.AddItem TBMaquinas!maquina
        TBMaquinas.MoveNext
    Loop
End If
TBMaquinas.Close

ProcCorrigeProdFasesTotalizacao
'PBLista.Value = PBLista.Value + 1

'ProcAtualizaPrepExecUtilTotalizacaoMaq
'PBLista.Value = PBLista.Value + 1

ProcAtualizaPrepExecUtil
'PBLista.Value = PBLista.Value + 1

ProcGravarStatusOSOF
'PBLista.Value = PBLista.Value + 1

ProcGravaValoresOS
'PBLista.Value = PBLista.Value + 1

ProcAtualizaOFAtualizacao
'PBLista.Value = PBLista.Value + 1

ProcAPabrir
txtAPMaquina = maquina
cmdAPOS_Click

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCorrigeHoraApont()
On Error GoTo tratar_erro

'Corrige Horainicio e final nos apontamentos
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OS.* from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
Else
    TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDproducao = " & cmbAPOS & " and P.DtValidacao_custo IS NULL"
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                Dataini = Format(TBproducao!TempoInicio, "dd/mm/yy")
                DataFim = Format(TBproducao!TempoFinal, "dd/mm/yy")
                TempoInicio = Format(TBproducao!TempoInicio, "hh:mm:ss")
                TempoFinal = Format(TBproducao!TempoFinal, "hh:mm:ss")
                If DataFim < Dataini And TempoFinal <> "00:00:00" Then
                    TempoInicio = TBproducao!TempoInicio
                    TempoFinal = TBproducao!TempoFinal
                    TBproducao!TempoInicio = TempoFinal
                    TBproducao!TempoFinal = TempoInicio
                    TempoTotal = TBproducao!TempoFinal - TBproducao!TempoInicio
                    ElapsedTime (TempoTotal)
                    If TempoTotal > "23:59:59" Then TBproducao!TempoTotal = "23:59:59" Else TBproducao!TempoTotal = TempoTotal
                    GoTo Proximo:
                End If
                If DataFim = Dataini And TempoInicio > TempoFinal Then
                    TBproducao!TempoInicio = TempoFinal
                    TBproducao!TempoFinal = TempoInicio
                    TempoTotal = TBproducao!TempoFinal - TBproducao!TempoInicio
                    ElapsedTime (TempoTotal)
                    If TempoTotal > "23:59:59" Then TBproducao!TempoTotal = "23:59:59" Else TBproducao!TempoTotal = TempoTotal
                End If
Proximo:
                If IsNull(TBproducao!TempoFinal) = False And TBproducao!TempoFinal <> "00:00:00" Then
                    TempoTotal = TBproducao!TempoFinal - TBproducao!TempoInicio
                    ElapsedTime (TempoTotal)
                    TBproducao!TempoTotalSeg = s
                Else
                    TBproducao!TempoTotalSeg = 0
                End If
                TBproducao.Update
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close
Dataini = 0
DataFim = 0
TempoInicio = 0
TempoFinal = 0

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCorrigeTunosApont()
On Error GoTo tratar_erro

'Corrige turnos nos apontamentos
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OS.* from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
Else
    TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDproducao = " & cmbAPOS & " and P.DtValidacao_custo IS NULL"
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " order by data, idproducao", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                ProcVerificaTurnoApontamento
                TBproducao!Turno = Turno
                TBproducao.Update
                TBproducao.MoveNext
            Loop
        End If
        TBproducao.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerificaTurnoApontamento()
On Error GoTo tratar_erro

Turno = 0
TempoInicio = 0
TempoFinal = 0
Dataini = Format(TBproducao!Data, "dd/mm/yy")
ProcVerificaDia
Dataini = Format(TBproducao!TempoInicio, "hh:mm:ss")
Set TBMaquinas = CreateObject("adodb.recordset")
TBMaquinas.Open "Select * from CadMaqturnos where maquina = '" & TBproducao!maquina & "' and diasemana = '" & Diasemana & "' order by diasemana,turno", Conexao, adOpenKeyset, adLockOptimistic
If TBMaquinas.EOF = False Then
    Do While TBMaquinas.EOF = False
        If IsNull(TBMaquinas!Inicioturno) = False Then
            TempoInicio = Left(TBMaquinas!Inicioturno, 8)
            TempoFinal = Left(TBMaquinas!finalturno, 8)
            If TempoInicio > TempoFinal Then
                Dataini = TBproducao!Data & " " & Dataini
                TempoInicio = TBproducao!Data & " " & TempoInicio
                TempoFinal = TBproducao!Data & "  " & TempoFinal
                TempoInicio = TempoInicio - 1
                TempoFinal = TempoFinal + 1
            End If
            Select Case TBMaquinas!Turno
                Case 1:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 1
                        GoTo Sair
                    End If
                Case 2:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 2
                        GoTo Sair
                    End If
                Case 3:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 3
                        GoTo Sair
                    End If
                Case 4:
                    If Dataini >= TempoInicio And Dataini <= TempoFinal Then
                        Turno = 4
                        GoTo Sair
                    End If
            End Select
        End If
        TBMaquinas.MoveNext
    Loop
End If
Sair:
    TBMaquinas.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCorrigeCodigoApont()
On Error GoTo tratar_erro

'Corrige código do evento
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OS.* from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
Else
    TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDproducao = " & cmbAPOS & " and P.DtValidacao_custo IS NULL"
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select * from CodigoDesc order by descricao", Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            Do While TBAbrir.EOF = False
                Set TBproducao = CreateObject("adodb.recordset")
                TBproducao.Open "Select codigodesc from " & NomeTabelaAp & " where descricao = '" & TBAbrir!Descricao & "' and codigodesc <> " & TBAbrir!CODIGO & " and IDFase = " & TBOS!IDProducao & " order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
                If TBproducao.EOF = False Then
                    Do While TBproducao.EOF = False
                        TBproducao!CodigoDesc = TBAbrir!CODIGO
                        TBproducao.Update
                        TBproducao.MoveNext
                    Loop
                End If
                TBproducao.Close
                TBAbrir.MoveNext
            Loop
        End If
        TBAbrir.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcCorrigeDiasApont()
On Error GoTo tratar_erro

'Corrige Dias nos eventos
If Txt_ID_apontamento <> "" Then
    TextoFiltro = "Select OS.* from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " order by OS.IDproducao"
Else
    TextoFiltro = "Select OS.* from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDproducao = " & cmbAPOS & " and P.DtValidacao_custo IS NULL"
End If
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & TBOS!IDProducao & " order by Data, Tempoinicio", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            TempoTotal = 0
            Do While TBproducao.EOF = False
                If TBproducao!TempoFinal <> "00:00:00" Then
                    TempoInicio = TBproducao!TempoInicio
                    TempoFinal = TBproducao!TempoFinal
                    If TempoInicio <= TempoFinal Then
                        TempoTotal = TempoFinal - TempoInicio
                        D = Int(CSng(TempoTotal))
                        If TBproducao!Dias <> D Then
                            TBproducao!Dias = D
                            TBproducao.Update
                        End If
                    End If
                End If
                
                'Corrige tempo de execução previsto
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from Ordemservico where IDProducao = " & TBproducao!IDFase, Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    TBproducao!Execucao = TBAbrir!TempoExecucao
                    TBproducao.Update
                End If
                TBAbrir.Close
                TBproducao.MoveNext
                TempoInicio = 0
                TempoFinal = 0
                D = 0
            Loop
        End If
        TBproducao.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCorrigeProdFasesTotalizacao()
On Error GoTo tratar_erro

'Corrige dados na tabela ProducaoFases_Totalizacao
Conexao.Execute "DELETE from " & NomeTabelaApTotalizacao & " where OS = " & cmbAPOS

Set TBAfericao = CreateObject("adodb.recordset")
TBAfericao.Open "Select * from " & NomeTabelaAp & " where IDFase = " & cmbAPOS & " and (codigodesc = 1 or codigodesc = 2) order by tempoinicio,codigodesc", Conexao, adOpenKeyset, adLockOptimistic
If TBAfericao.EOF = False Then
    Do While TBAfericao.EOF = False
        
        With cmbOperador
            .Clear
            .AddItem TBAfericao!Usuario
            .Text = TBAfericao!Usuario
        End With
        
        With txtAPMaquina
            .Clear
            .AddItem TBAfericao!maquina
            .Text = TBAfericao!maquina
        End With
        
        Turno = TBAfericao!Turno
        Dataini = TBAfericao!Data

        ProcAtualizaPrepExecUtilTotalizacao
        ProcAtualizaPrepExecUtilTotalizacaoMaq
        
        TBAfericao.MoveNext
    Loop
End If
TBAfericao.Close
        
Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcAtualizaOFAtualizacao()
On Error GoTo tratar_erro

If Txt_ID_apontamento <> "" Then
    INNERJOINTEXTO = "(OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "PFOS.ID = " & Txt_ID_apontamento
Else
    INNERJOINTEXTO = "OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem"
    TextoFiltro = "OS.IDproducao = " & cmbAPOS
End If
sqltexto = "Select OS.*, P.DtValidacao_custo from " & INNERJOINTEXTO & " where " & TextoFiltro & " and P.DtValidacao_custo IS NULL order by OS.IDproducao"
Set TBOS = CreateObject("adodb.recordset")
TBOS.Open sqltexto, Conexao, adOpenKeyset, adLockOptimistic
If TBOS.EOF = False Then
    Do While TBOS.EOF = False
        CRLOTE = 0
        CRPECA = 0
        TRLOTE = 0
        TPUSEG = 0
        TEUSEG = 0
        QtdeSaida = 0
        TotalNC = 0
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from ordemservico where Ordem = " & TBOS!Ordem & " ORDER BY fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            Do While TBproducao.EOF = False
                If TBproducao!custos = True Then
                    CRLOTE = CRLOTE + IIf(IsNull(TBproducao!CRLOTE), 0, TBproducao!CRLOTE)
                    CRPECA = CRPECA + IIf(IsNull(TBproducao!CRPECA), 0, TBproducao!CRPECA)
                    TRLOTE = TRLOTE + IIf(IsNull(TBproducao!TETTUTILSEG), 0, TBproducao!TETTUTILSEG)
                    TPUSEG = TPUSEG + IIf(IsNull(TBproducao!TPUSEG), 0, TBproducao!TPUSEG)
                    TEUSEG = TEUSEG + IIf(IsNull(TBproducao!TEUSEG), 0, TBproducao!TEUSEG)
                End If
                Totalprod = IIf(IsNull(TBproducao!QTOK), 0, TBproducao!QTOK)
                Set TBAbrir = CreateObject("adodb.recordset")
                TBAbrir.Open "Select * from CQ_NC_FABRICA where OS = " & TBproducao!IDProducao & " and PARECERCQ = 'Rejeitar'", Conexao, adOpenKeyset, adLockOptimistic
                If TBAbrir.EOF = False Then
                    Set TBFIltro = CreateObject("adodb.recordset")
                    TBFIltro.Open "Select Sum(TTNC) as TotalNC from CQ_NC_FABRICA where OS = " & TBproducao!IDProducao & " and PARECERCQ = 'Rejeitar'", Conexao, adOpenKeyset, adLockOptimistic
                    If TBFIltro.EOF = False Then
                        TotalNC = TotalNC + IIf(IsNull(TBFIltro!TotalNC), 0, TBFIltro!TotalNC)
                    End If
                    TBFIltro.Close
                Else
                    QtdeSaida = IIf(IsNull(TBproducao!QTNC), 0, TBproducao!QTNC)
                End If
                TBAbrir.Close
                TBproducao.MoveNext
            Loop
        End If
        
        Totalprod = Totalprod + TotalNC + QtdeSaida
        Set TBproducao = CreateObject("adodb.recordset")
        TBproducao.Open "Select * from producao where Ordem = " & TBOS!Ordem & " and Controlado_estoque = 'False'", Conexao, adOpenKeyset, adLockOptimistic
        If TBproducao.EOF = False Then
            TBproducao!QuantProd = Totalprod
            TBproducao!QuantNC = TotalNC
            TBproducao.Update
            TBproducao!CPR = Format(CRPECA, "###,##0.0000000000")
            TBproducao!CTTReal = Format(CRLOTE, "###,##0.00")
            
'            S = TEUSEG
'            TBproducao!tpr = FormataTempo(S)
            
            If Totalprod > 0 Then TBproducao!tpr = FormataTempo(TRLOTE / Totalprod) Else TBproducao!tpr = FormataTempo(TRLOTE)
            
            TBproducao!TTTReal = FormataTempo(TRLOTE)
            
            ProcCalculaEficienciaOF TBOS!Ordem, TBproducao!Quant
            TBproducao!Eficiencia_prep = Eficiencia_prep
            TBproducao!Eficiencia_exec = Eficiencia_exec
            If Eficiencia_prep > 0 And Eficiencia_exec > 0 Then
                TBproducao!Eficiencia = (Eficiencia_prep + Eficiencia_exec) / 2
            ElseIf Eficiencia_prep > 0 Then
                    TBproducao!Eficiencia = Eficiencia_prep
                ElseIf Eficiencia_exec > 0 Then
                        TBproducao!Eficiencia = Eficiencia_exec
            End If
            
            TBproducao.Update
        End If
        TBproducao.Close
        TBOS.MoveNext
    Loop
End If
TBOS.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

'=================================================================================================================================

Sub ProcAtualizarVlrUnitOrdemEst(TextoFiltro As String, PBLista As USProgressBar)
On Error GoTo tratar_erro

Set TBOrdem = CreateObject("adodb.recordset")
TBOrdem.Open "Select * from producao where " & TextoFiltro, Conexao, adOpenKeyset, adLockOptimistic
If TBOrdem.EOF = False Then
    'PBLista.Min = 0
    'PBLista.Max = TBOrdem.RecordCount
    'PBLista.Value = 1
    Contador1 = 0
    Do While TBOrdem.EOF = False
                                       'ORDEM        QTDE. PREVISTA                                QTDE. OK                                              QT. PROD.(OK+NC)                                                                                         CUSTO LOTE                                                              CUSTO PEÇA                                                         CUSTO TERCEIROS                                                             CUSTO MATERIAL                                                                CUSTO OUTRAS                                                              ORDEM CONSIGNADA
        'valor = FunCalculaValorUnitOrdem(TBOrdem!Ordem, IIf(IsNull(TBOrdem!Quant), 0, TBOrdem!Quant), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd), IIf(IsNull(TBOrdem!QuantProd), 0, TBOrdem!QuantProd) + IIf(IsNull(TBOrdem!QuantNC), 0, TBOrdem!QuantNC), IIf(IsNull(TBOrdem!CTTReal), 0, Format(TBOrdem!CTTReal, "###,##0.00")), IIf(IsNull(TBOrdem!CPR), 0, Format(TBOrdem!CPR, "###,##0.0000000000")), IIf(IsNull(TBOrdem!CTServico), 0, Format(TBOrdem!CTServico, "###,##0.00")), IIf(IsNull(TBOrdem!CTMaterial), 0, Format(TBOrdem!CTMaterial, "###,##0.00")), IIf(IsNull(TBOrdem!CTOutras), 0, Format(TBOrdem!CTOutras, "###,##0.00")), TBOrdem!consignacao)
        NovoValor = Replace(frmprod.Txt_custo_total_peca, ",", ".")
        Conexao.Execute "Update Estoque_Controle set valor_unitario = " & NovoValor & " where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "'"
        Conexao.Execute "Update Estoque_Controle set Valor_Total = ROUND(valor_unitario * estoque_real, 2) where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "'"
        Conexao.Execute "Update EM Set VlrUnit = " & NovoValor & " from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
        Conexao.Execute "Update EM Set VlrTotal = ROUND(VlrUnit * Entrada, 2) from Estoque_movimentacao EM INNER JOIN Estoque_controle EC ON EM.IdEstoque = EC.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
        Conexao.Execute "Update CC Set CC.Valor = EM.VlrTotal from (CC_realizado CC INNER JOIN Estoque_movimentacao EM ON CC.ID_estoque = EM.Idoperacao) INNER JOIN Estoque_controle EC ON EC.IdEstoque = EM.IdEstoque where EC.Lote = '" & TBOrdem!Ordem & "' and EC.Desenho = '" & TBOrdem!Desenho & "' and (EM.Operacao = 'ENTRADA_ORDEM' Or EM.Operacao = 'ENTRADA_ORDEM_PARCIAL')"
        Conexao.Execute "Update EM set EM.VlrUnit = EM1.VlrUnit from Estoque_movimentacao EM INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
        Conexao.Execute "Update EC set EC.valor_unitario = EM1.VlrUnit from Estoque_Controle EC INNER JOIN Estoque_movimentacao EM ON EM.IdEstoque = EC.IdEstoque INNER JOIN Estoque_movimentacao EM1 on EM1.IdEstoque = EM.IdEstoque where EM.Lote = '" & TBOrdem!Ordem & "' and EM.Desenho = '" & TBOrdem!Desenho & "' and EM.Saida > 0 and EM1.Entrada > 0"
        Conexao.Execute "Update Estoque_movimentacao set VlrTotal = ROUND(VlrUnit * Saida, 2) where Lote = '" & TBOrdem!Ordem & "' and Desenho = '" & TBOrdem!Desenho & "' and Saida > 0"
        TBOrdem.MoveNext
        Contador1 = Contador1 + 1
        'PBLista.Value = Contador1
    Loop
End If
TBOrdem.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcAtualizaPrazoFinal()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If

Permitido = False
With ListaOS
    For InitFor = 1 To .ListItems.Count
        If .ListItems.Item(InitFor).Checked = True Then
            If Permitido = False Then
                If USMsgBox("Deseja realmente alterar o prazo final da(s) OS(s)?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
Mensagem1:
                Retrabalho = InputBox("Favor informar o número de dias para alteração.")
                If Retrabalho = "" Then Exit Sub
                If IsNumeric(Retrabalho) = False Then
                    USMsgBox ("Só é permitido número neste campo."), vbExclamation, "CAPRIND v5.0"
                    GoTo Mensagem1
                End If
            End If
            Qtde = Retrabalho
            Permitido = True
            
            ProcDefinirPrazosOS .ListItems(InitFor), Date, True
            '==================================
            Modulo = "PCP/Gerenciamento de ordem"
            Evento = "Alterar prazo final da OS"
            ID_documento = .ListItems(InitFor)
            Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
            Documento1 = "OS: " & .ListItems(InitFor)
            ProcGravaEvento
            '==================================
        End If
    Next InitFor
End With
If Permitido = False Then
    USMsgBox ("Informe a(s) OS(s) antes de alterar o prazo final."), vbExclamation, "CAPRIND v5.0"
Else
    USMsgBox ("Prazo final alterado com sucesso."), vbInformation, "CAPRIND v5.0"
    ProcLimparCamposOS
    ListaOS_maq.ListItems.Clear
    ProcAtualizalista_os
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcRenumerar()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If txtof = 0 Or ListaOS.ListItems.Count = 0 Then Exit Sub
If USMsgBox("Deseja realmente renumerar as fases?", vbYesNo, "CAPRIND v5.0") = vbNo Then Exit Sub
If FunVerifValidacaoRegistro("renumerar", txtDtValidacao, "ordem", "a OS", False) = False Then Exit Sub
Fase = 10
Set TBFases = CreateObject("adodb.recordset")
TBFases.Open "Select IDFase, Fase, IDPlano from Ordemservico where Ordem = " & txtof & " and (Retrabalho = 'False' or Retrabalho = 'True' and IDfase = 0) order by IDproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBFases.EOF = False Then
    Do While TBFases.EOF = False
        TBFases!Fase = Fase
        TBFases!IDPlano = FunVerifIDPlano(TBFases!IDFase)
        Fase = Fase + 10
        TBFases.Update
        TBFases.MoveNext
    Loop
End If
TBFases.Close

'Arruma fase das os de retrabalho, pois a OS de retrabalho tem que ser o mesmo número de fase da OS que originou o retrabalho
Set TBFases = CreateObject("adodb.recordset")
TBFases.Open "Select Fase, IDfase, IDplano, IDProducao from Ordemservico where Ordem = " & txtof & " and Retrabalho = 'true' and IDfase <> 0 order by IDproducao", Conexao, adOpenKeyset, adLockOptimistic
If TBFases.EOF = False Then
    Do While TBFases.EOF = False
        Set TBAbrir = CreateObject("adodb.recordset")
        TBAbrir.Open "Select Fase from Ordemservico where Ordem = " & txtof & " and IDfase = " & TBFases!IDFase & " and IDProducao <> " & TBFases!IDProducao, Conexao, adOpenKeyset, adLockOptimistic
        If TBAbrir.EOF = False Then
            TBFases!Fase = TBAbrir!Fase
            TBFases!IDPlano = TBAbrir!IDPlano
            TBFases.Update
        End If
        TBAbrir.Close
        TBFases.MoveNext
    Loop
End If
TBFases.Close

USMsgBox ("Fases renumeradas com sucesso."), vbInformation, "CAPRIND v5.0"
'==================================
Modulo = "PCP/Gerenciamento de ordem"
Evento = "Renumerar fases"
ID_documento = txtof
Documento = "Ordem: " & txtof.Text & " - Cód. interno: " & txtdesenho
Documento1 = ""
ProcGravaEvento
'==================================
ProcLimparCamposOS
ListaOS_maq.ListItems.Clear
ProcAtualizalista_os

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub ProcRecalcular_OS()
On Error GoTo tratar_erro

If cmbAPOS = "" Then
    USMsgBox ("Informe a OS antes de recalcular."), vbExclamation, "CAPRIND v5.0"
    cmbAPOS.SetFocus
    Exit Sub
End If
If txtDtValidacao = "" Then
    USMsgBox ("Não é possivel recalcular apontamento, pois a ordem ainda não foi validada."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
'Verifica se o resultado da ordem foi validado
Set TBOSC = CreateObject("adodb.recordset")
TBOSC.Open "Select ordem from Producao where ordem = " & txtof & " and DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
If TBOSC.EOF = False Then
    USMsgBox ("Não é permitido recalcular o apontamento, pois o resultado da ordem já foi validado."), vbExclamation, "CAPRIND v5.0"
    TBOSC.Close
    Exit Sub
End If
TBOSC.Close

FrmProd_recalcular_OS.Show

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub procAlterarReq()
On Error GoTo tratar_erro

If Alterar = False Then
    USMsgBox ("Atenção usuário " & pubUsuario & " você não tem acesso a este recurso."), vbExclamation, "CAPRIND v5.0"
    Exit Sub
End If
If ListaRequisicao.ListItems.Count = 0 Then Exit Sub
If FunVerifValidacaoRegistro("alterar", txtDtValidacao, "ordem", "requisição", False) = False Then Exit Sub
Set TBAbrir = CreateObject("adodb.recordset")
TBAbrir.Open "Select * from producaomaterial where Idmateriaprima = " & ListaRequisicao.SelectedItem, Conexao, adOpenKeyset, adLockOptimistic
If TBAbrir.EOF = False Then
    PCP_Ordem = True
    With frmproj_EstruturaLocaliza_item
        .ProcPuxaDados_PCP
        .Show 1
    End With
End If
TBAbrir.Close

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Public Sub procBloqueiaLiberaAP()
On Error GoTo tratar_erro

With cmbdescricao
    .Locked = False
    .TabStop = True
End With
mskData.Enabled = True
txtinicioap.Enabled = True
With txtTOK
    .Locked = False
    .TabStop = True
End With
With txtTNC
    .Locked = False
    .TabStop = True
End With
If Txt_ID_apontamento <> "" Then
    Set TBOSC = CreateObject("adodb.recordset")
    TBOSC.Open "Select P.ordem from Producao P INNER JOIN Ordemservico OS ON OS.ordem = P.ordem where OS.ID_apontamento = " & Txt_ID_apontamento & " and P.DtValidacao_custo is not null", Conexao, adOpenKeyset, adLockOptimistic
    If TBOSC.EOF = False Then
        With cmbdescricao
            .Locked = True
            .TabStop = False
        End With
        mskData.Enabled = False
        txtinicioap.Enabled = False
        With txtTOK
            .Locked = True
            .TabStop = False
        End With
        With txtTNC
            .Locked = True
            .TabStop = False
        End With
    End If
    TBOSC.Close
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Sub ProcCriarEtiquetas(Ordem As Long, Quant As Double)
On Error GoTo tratar_erro

Conexao.Execute "DELETE from etiqueta where Modulo = '" & Formulario & "' and Responsavel = '" & pubUsuario & "'"
Cont2 = 1
Do While Quant > 0
    Cont = MRP_Qtcopias_Etiq
    Familiatext = FunTamanhoTextoZeroEsq(Ordem, 4) & FunTamanhoTextoZeroEsq(Cont2, 4)
    Set TBGravar = CreateObject("adodb.recordset")
    StrSql = "Select * from Producao_etiquetas where Ordem = " & Ordem & " and N_serie = '" & Familiatext & "'"
    'Debug.print StrSql
    
    TBGravar.Open StrSql, Conexao, adOpenKeyset, adLockOptimistic
    If TBGravar.EOF = True Then TBGravar.AddNew
    TBGravar!Ordem = Ordem
    TBGravar!N_Serie = Familiatext
    
    TBGravar.Update
    
    'Se for gerado pelo MRP cria número de cópias
    Do While Cont > 0
        Set TBFI = CreateObject("adodb.recordset")
        TBFI.Open "Select * from etiqueta", Conexao, adOpenKeyset, adLockOptimistic
        TBFI.AddNew
        TBFI!Modulo = Formulario
        TBFI!Responsavel = pubUsuario
        TBFI!ID_nome = TBGravar!ID
        TBFI.Update
        TBFI.Close
        Cont = Cont - 1
    Loop
    TBGravar.Close
    Quant = Quant - 1
    Cont2 = Cont2 + 1
Loop

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel1 = CreateObject("adodb.recordset")
TBNivel1.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel1.EOF = False Then
    Do While TBNivel1.EOF = False
        Desenho = TBNivel1!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel1!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel1!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel1!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel1!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel1!Qualidade = True And IsNull(TBNivel1!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP2 TBNivel1!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel1.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP2(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel2 = CreateObject("adodb.recordset")
TBNivel2.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel2.EOF = False Then
    Do While TBNivel2.EOF = False
        Desenho = TBNivel2!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel2!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel2!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel2!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel2!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel2!Qualidade = True And IsNull(TBNivel2!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP3 TBNivel2!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel2.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP3(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel3 = CreateObject("adodb.recordset")
TBNivel3.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel3.EOF = False Then
    Do While TBNivel3.EOF = False
        Desenho = TBNivel3!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel3!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel3!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel3!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel3!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel3!Qualidade = True And IsNull(TBNivel3!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP4 TBNivel3!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel3.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP4(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel4 = CreateObject("adodb.recordset")
TBNivel4.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel4.EOF = False Then
    Do While TBNivel4.EOF = False
        Desenho = TBNivel4!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel4!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel4!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel4!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel4!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel4!Qualidade = True And IsNull(TBNivel4!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP5 TBNivel4!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel4.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP5(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel5 = CreateObject("adodb.recordset")
TBNivel5.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel5.EOF = False Then
    Do While TBNivel5.EOF = False
        Desenho = TBNivel5!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel5!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel5!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel5!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel5!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel5!Qualidade = True And IsNull(TBNivel5!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP6 TBNivel5!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel5.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP6(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel6 = CreateObject("adodb.recordset")
TBNivel6.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel6.EOF = False Then
    Do While TBNivel6.EOF = False
        Desenho = TBNivel6!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel6!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel6!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel6!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel6!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel6!Qualidade = True And IsNull(TBNivel6!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP7 TBNivel6!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel6.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP7(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel7 = CreateObject("adodb.recordset")
TBNivel7.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel7.EOF = False Then
    Do While TBNivel7.EOF = False
        Desenho = TBNivel7!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel7!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel7!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel7!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel7!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel7!Qualidade = True And IsNull(TBNivel7!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP8 TBNivel7!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel7.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP8(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel8 = CreateObject("adodb.recordset")
TBNivel8.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel8.EOF = False Then
    Do While TBNivel8.EOF = False
        Desenho = TBNivel8!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel8!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel8!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel8!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel8!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel8!Qualidade = True And IsNull(TBNivel8!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP9 TBNivel8!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel8.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP9(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel9 = CreateObject("adodb.recordset")
TBNivel9.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel9.EOF = False Then
    Do While TBNivel9.EOF = False
        Desenho = TBNivel9!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel9!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel9!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel9!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel9!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel9!Qualidade = True And IsNull(TBNivel9!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP10 TBNivel9!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel9.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP10(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel10 = CreateObject("adodb.recordset")
TBNivel10.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel10.EOF = False Then
    Do While TBNivel10.EOF = False
        Desenho = TBNivel10!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel10!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel10!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel10!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel10!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel10!Qualidade = True And IsNull(TBNivel10!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP11 TBNivel10!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel10.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP11(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel11 = CreateObject("adodb.recordset")
TBNivel11.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel11.EOF = False Then
    Do While TBNivel11.EOF = False
        Desenho = TBNivel11!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel11!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel11!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel11!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel11!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel11!Qualidade = True And IsNull(TBNivel11!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP12 TBNivel11!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel11.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP12(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel12 = CreateObject("adodb.recordset")
TBNivel12.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel12.EOF = False Then
    Do While TBNivel12.EOF = False
        Desenho = TBNivel12!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel12!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel12!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel12!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel12!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel12!Qualidade = True And IsNull(TBNivel12!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP13 TBNivel12!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel12.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP13(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel13 = CreateObject("adodb.recordset")
TBNivel13.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel13.EOF = False Then
    Do While TBNivel13.EOF = False
        Desenho = TBNivel13!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel13!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel13!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel13!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel13!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel13!Qualidade = True And IsNull(TBNivel13!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        ProcVerifBloqGerarMRP14 TBNivel13!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel13.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
    Exit Sub
End Sub

Private Sub ProcVerifBloqGerarMRP14(Codproduto As Long, VerifEstrutura As Boolean, VerifProcesso As Boolean, VerifPlano As Boolean)
On Error GoTo tratar_erro

Set TBNivel14 = CreateObject("adodb.recordset")
TBNivel14.Open "Select PC.*, P.Codproduto, P.Qualidade, P.DtValidacaoConj, DtValidacaoPlano from projconjunto PC INNER JOIN Projproduto P ON P.Desenho = PC.Desenho where PC.codproduto = " & Codproduto & " and P.Producao = 'True' and (P.SubTipoItem = 1 or P.SubTipoItem = 2 or P.SubTipoItem = 3) order by PC.Versao, PC.Posicao, PC.codigo", Conexao, adOpenKeyset, adLockOptimistic
If TBNivel14.EOF = False Then
    Do While TBNivel14.EOF = False
        Desenho = TBNivel14!Desenho
        If VerifEstrutura = True Then
            If IsNull(TBNivel14!DtValidacaoConj) = True Then
                If FamiliaAntiga = "" Then FamiliaAntiga = "Cód. interno: " & Desenho & " - Versão: " & TBNivel14!versao Else FamiliaAntiga = FamiliaAntiga & " | Cód. interno: " & Desenho & " - Versão: " & TBNivel14!versao
            End If
        End If
        If VerifProcesso = True Then
            Set TBControleNF = CreateObject("adodb.recordset")
            TBControleNF.Open "Select DtValidacao from Processos where Codproduto = " & TBNivel14!Codproduto, Conexao, adOpenKeyset, adLockOptimistic
            If TBControleNF.EOF = False Then
                If IsNull(TBControleNF!DtValidacao) = True Then
                    If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
                End If
            Else
                If Familiatext = "" Then Familiatext = "Cód. interno: " & Desenho Else Familiatext = Familiatext & " | Cód. interno: " & Desenho
            End If
            TBControleNF.Close
        End If
        If VerifPlano = True Then
            If TBNivel14!Qualidade = True And IsNull(TBNivel14!DtValidacaoPlano) = True Then
                If SQL = "" Then SQL = "Cód. interno: " & Desenho Else SQL = SQL & " | Cód. interno: " & Desenho
            End If
        End If
        'ProcVerifBloqGerarMRPN15 TBNivel14!Codproduto, VerifEstrutura, VerifProcesso, VerifPlano
        TBNivel14.MoveNext
    Loop
End If

Exit Sub
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Sub

Public Function ProcVerificaEstoqueAP() As Boolean
On Error GoTo tratar_erro

If TOK <> 0 Or TNC <> 0 Then
    'Verifica se existe quantidade em estoque para fazer a baixa, quando a ordem tem baixa de material automatico, se não tiver não deixa apontar
    '=========================================================================================================================================================================================================================================================
    If Varias_OS = True Then
        TextoFiltro = "Select OS.*, P.Desenho, P.Quant, P.Ordem from (OrdemServico OS INNER JOIN ProducaoFases_OS PFOS ON OS.ID_apontamento = PFOS.ID) INNER JOIN Producao P ON P.Ordem = OS.Ordem where PFOS.ID = " & Txt_ID_apontamento & " AND P.Retirar_estoque = 'True' order by OS.IDproducao"
    Else
        TextoFiltro = "Select OS.*, P.Desenho, P.Quant, P.Ordem from OrdemServico OS INNER JOIN Producao P ON P.Ordem = OS.Ordem where OS.IDProducao = " & cmbAPOS & " AND P.Retirar_estoque = 'True'"
    End If
    
    Set TBCotacao = CreateObject("adodb.recordset")
    TBCotacao.Open TextoFiltro, Conexao, adOpenKeyset, adLockReadOnly
    If TBCotacao.EOF = False Then
        Do While TBCotacao.EOF = False
        
            Set TBCFOP = CreateObject("adodb.recordset")
            TBCFOP.Open "Select * from ordemservico where Ordem = " & TBCotacao!Ordem & " order by fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockReadOnly
            If TBCFOP.EOF = False Then
                TBCFOP.MoveFirst
                If TBCFOP!IDProducao = TBCotacao!IDProducao Then
                    QtdeSaida = 0
                    Set TBMaterial = CreateObject("adodb.recordset")
                    TBMaterial.Open "Select PM.Requisitado, ISNULL(QSEP.Saida, 0) as QtdeSaida, PM.CODIGO, P.IDcliente from ((Producao P INNER JOIN Producaomaterial PM ON PM.Ordem = P.Ordem) LEFT JOIN Qtde_saida_estoque_produto QSEP ON QSEP.Ordem = PM.Ordem and QSEP.Desenho = PM.Codigo) where PM.Ordem = " & TBCotacao!Ordem, Conexao, adOpenKeyset, adLockReadOnly
                    If TBMaterial.EOF = False Then
                        Do While TBMaterial.EOF = False
                        
                            QtdeSaida = IIf(IsNull(TBMaterial!QtdeSaida), 0, TBMaterial!QtdeSaida)
                            Peso = TBMaterial!Requisitado / TBCotacao!Quant
                            SaqueQTSaldo = (Peso * (TOK + TNC + TBCotacao!Totalprod))
                            SaqueQTSaldo = SaqueQTSaldo - QtdeSaida
                            
                            SaqueValorTotal = FunVerificaQtdeEmpenhoREOrdem("Ordem = " & TBCotacao!Ordem, False)
                            
                            If SaqueValorTotal < SaqueQTSaldo Then
                            
                                Set TBFI = CreateObject("adodb.recordset")
                                StrSql = "Select SUM(EP.Estoque_real - (ISNULL(QP.Qtde_empenhar,0) + ISNULL(QV.Qtde_requisitar,0))) as TotalEstoque from ((estoque_controle EC INNER JOIN Estoque_produtos EP ON EP.IDestoque = EC.IDestoque) INNER JOIN Estoque_Localarmazenamento_criar EL ON EL.descricao = EP.local_armaz LEFT JOIN Qtde_empenhada_produto_detalhado QP ON QP.IDestoque = EC.idestoque AND QP.Ordem <> " & TBCotacao!Ordem & ") LEFT JOIN Qtde_empenhada_produto_venda_detalhado QV ON EC.idestoque = QV.ID_estoque where EC.Desenho = '" & TBMaterial!CODIGO & "' and EC.Estoque_real > 0 and EP.Liberado = 'SIM' AND EL.Estoque = 'False' and (EC.Consignacao = 'False' or EC.Consignacao = 'True' and EC.id_cliente = " & TBMaterial!IDCliente & " and EC.Tipodest_NFcons = 'C' or EC.Consignacao = 'True' and EC.Tipodest_NFcons = 'F')"
                                'Debug.print StrSql
                                
                                TBFI.Open StrSql, Conexao, adOpenKeyset, adLockReadOnly
                                If TBFI.EOF = False Then qtdeliberar = IIf(IsNull(TBFI!TotalEstoque), 0, TBFI!TotalEstoque)
                                TBFI.Close

                                If SaqueQTSaldo > qtdeliberar Then
                                    USMsgBox ("Não é permitido apontar, pois a quantidade requisitada do item " & TBMaterial!CODIGO & " é maior que a disponivel em estoque."), vbExclamation, "CAPRIND v5.0"
                                    ProcVerificaEstoqueAP = False
                                    Exit Function
                                End If
                            End If
                            
                            TBMaterial.MoveNext
                        Loop
                    End If
                    TBMaterial.Close
                End If
            End If
            TBCFOP.Close
            TBCotacao.MoveNext
        Loop
    End If
    TBCotacao.Close
End If
ProcVerificaEstoqueAP = True

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Function

Public Function procVerificaEstoqueValidacao() As Boolean
On Error GoTo tratar_erro

'Verifica se a quantidade produzida é diferente da quantidade retirada, para ordem que tem saida automatica
Set TBCotacao = CreateObject("adodb.recordset")
TBCotacao.Open "Select Desenho, Quant, Ordem, QuantProd from Producao where Ordem = " & txtof & " AND Retirar_estoque = 'True' AND RespValidacao_custo IS NULL", Conexao, adOpenKeyset, adLockReadOnly
If TBCotacao.EOF = False Then
    Set TBCFOP = CreateObject("adodb.recordset")
    TBCFOP.Open "Select ISNULL(TotalProd,0) as TotalProd from ordemservico where Ordem = " & TBCotacao!Ordem & " order by fase, retrabalho, IDproducao", Conexao, adOpenKeyset, adLockReadOnly
    If TBCFOP.EOF = False Then
        TBCFOP.MoveFirst
                
        QtdeSaida = 0
        Set TBMaterial = CreateObject("adodb.recordset")
        TBMaterial.Open "Select PM.Requisitado, ISNULL(QSEP.Saida, 0) as QtdeSaida, PM.CODIGO, P.IDcliente from ((Producao P INNER JOIN Producaomaterial PM ON PM.Ordem = P.Ordem) LEFT JOIN Qtde_saida_estoque_produto QSEP ON QSEP.Ordem = PM.Ordem and QSEP.Desenho = PM.Codigo) where PM.Ordem = " & TBCotacao!Ordem, Conexao, adOpenKeyset, adLockReadOnly
        If TBMaterial.EOF = False Then
            Do While TBMaterial.EOF = False
            
                QtdeSaida = IIf(IsNull(TBMaterial!QtdeSaida), 0, Format(TBMaterial!QtdeSaida, "0.0000"))
                Peso = TBMaterial!Requisitado / TBCotacao!Quant
                SaqueQTSaldo = Format((Peso * TBCFOP!Totalprod), "0.0000")

                If SaqueQTSaldo <> QtdeSaida Then
                    USMsgBox "Não é possivel validar o resultado da ordem, pois a quantidade produzida é diferente da saida do estoque.", vbExclamation, "CAPRIND v5.0"
                    procVerificaEstoqueValidacao = False
                    Exit Function
                End If
                
                TBMaterial.MoveNext
            Loop
        End If
        TBMaterial.Close
    End If
    TBCFOP.Close
End If
TBCotacao.Close
procVerificaEstoqueValidacao = True

Exit Function
tratar_erro:
    USMsgBox ("Descrição do erro : " + Error()), vbCritical, "CAPRIND v5.0"
End Function
